define(["jquery","managers/page-vars","translations/interest","version!fly/managers/debug","managers/recommendation","managers/recommendation-data","components/urban-airship","version!fly/components/base"],function(e,t,n,s,i,a,o){s=s.init("interest"),e.widget("cnet.interest",e.fly.base,{interest:null,options:{id:null,name:null,type:null},_create:function(){var t=this;this._setup(),t.interest={id:t.options.id,name:t.options.name,type:t.options.type},window.UA?this._onLoadUrbanAirship():e(window).on("urban-airship-loaded",function(){t._onLoadUrbanAirship()})},_displayFollowInterest:function(){this.$element.removeClass("followedInterest"),this.$element.addClass("nonFollowedInterest"),this.$element.find("[data-follow-text]").text(n.follow),this.$element.removeClass("have"),this.$element.addClass("add")},_displayRemoveInterest:function(){this.$element.addClass("followedInterest"),this.$element.removeClass("nonFollowedInterest"),this.$element.find("[data-follow-text]").text(n.following),this.$element.removeClass("add"),this.$element.addClass("have")},_onLoadUrbanAirship:function(){var t=this;window.UA.then(function(n){if(n.canRegister&&t.interest&&"none"!==t.interest.id){var i=a.getTagGroupByInterest(t.interest.type);if(n.channel&&(n.channel.tags.has(t.interest.name.toUpperCase(),i)||n.channel.tags.has("Interest_"+t.interest.name.toUpperCase(),"device")))t._displayRemoveInterest();else if(t._displayFollowInterest(),"true"!==localStorage.getItem("CnetHasSeenInterestBanner")){t.$element.prev().removeClass("hidden");try{localStorage.setItem("CnetHasSeenInterestBanner","true")}catch(e){s.error("Writing to localStorage failed for interest banner view state.")}}e(".es-header").addClass("interestDisplayed"),t.$element.removeClass("hidden"),t._setupEvents(n)}else t.$element.addClass("hidden")})},_setupEvents:function(e){var t=this;e.addEventListener("channel",function(n){if(t.$element.hasClass("followedInterest")){var s=a.getTagGroupByInterest(t.interest.type);n.channel&&!n.channel.tags.has(t.interest.name.toUpperCase(),s)&&i.addExplicitInterest(e,t.interest)}}),this.$element.prev().on("click",function(){t.$element.prev().addClass("hidden")}),this.$element.on("click",function(n){if("denied"!==Notification.permission&&n.preventDefault(),t.$element.hasClass("followedInterest"))return t._displayFollowInterest(),void i.removeExplicitInterest(e,t.interest);if(t.$element.prev().addClass("hidden"),!e.channel||"default"===Notification.permission){o.trackEvent("message","notification");let t=Notification.permission;e.register().then(function(n){"default"!==e.permission&&"default"===t&&o.trackEvent("tap",(n.optedIn,"opt-in"))}).catch(function(){"default"===t&&"denied"===Notification.permission&&airship.trackEvent("tap","notification|opt-out")})}t._displayRemoveInterest(),i.addExplicitInterest(e,t.interest)})}})});