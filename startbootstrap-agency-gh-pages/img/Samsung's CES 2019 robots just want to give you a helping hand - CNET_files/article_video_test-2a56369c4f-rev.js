define("fly/utils/object-helper-1.0",["jquery"],function(t){return{deepFind:function(t,e){if(!t||!e)return null;var n=e.split("."),s=n.length;for(i=0;i<s;i++){if(!t.hasOwnProperty(n[i]))return null;t=t[n[i]]}return t}}}),define("fly/managers/components-1.0",["jquery","version!fly/utils/string-helper","version!fly/utils/object-helper","version!fly/managers/debug","version!fly/components/base"],function(t,e,i,n,s){var a,r={attr:"data-component",includeContext:!0},o=n.init("components"),l={};return t(document).on("domUpdated",function(t,e){e=e||{},a.process(e.$context)}),a={process:function(i){var n=this;this.findByAttr(i).each(function(i,s){var a=t(s),r=a.data(),o=e.toCleanArray(r.component);t.each(o,function(t,e){n.init(e,a)})})},init:function(e,i,n){var s,a,r=l[e];r&&(n=n||{},s=t.makeArray(r.require)||[],a=e,r.alias&&(a=r.alias,n=t.extend(!0,{},r.options||{},n)),require(s,function(){i&&i.length&&t.isFunction(i[a])&&i[a](n)}),o.log("init: ",e,i,n))},setConfig:function(e){if(!t.isPlainObject(e))throw new Error("Component setConfig failure. Map is in the wrong format.");t.extend(r,e)},register:function(e){if(!t.isPlainObject(e))throw new Error("Component register failure. Map is in the wrong format.");t.each(e,function(t,e){l[t]=e,e.options&&s.setDefaultOptions(t,e.options),e.events&&s.addDefaultEvents(t,e.events)}),o.log("register: ",e)},findByAttr:function(e,i,n){var s,a="";return(i=i&&!t.isArray(i)?[i]:i)?t.each(i,function(t,e){a+=t>0?", ":"",a+="["+r.attr+'="'+e+'"], ['+r.attr+"*='\""+e+"\"']"}):a="["+r.attr+"]",s=(e=e||t(document.body)).find(a),(n=void 0!==n?n:r.includeContext)&&(s=s.addBack(a)),s}}}),define("managers/third-party/playbuzz",["jquery","version!fly/managers/debug"],function(t,e){return e=e.init("playbuzz"),{init:function(){document.body.addEventListener("pbItemEvent",function(t){try{switch(t.detail.name){case"pb.item.scroll-top-into-view":this.quizName=t.detail.data.title||"unknown quiz name","object"==typeof om&&"function"==typeof om.trackPlayBuzz?om.trackPlayBuzz("view",this.quizName):window.pl_buzz_name=this.quizName;break;case"pb.section.poll-vote":this.quizName=this.quizName||window.pl_buzz_name||"unknown quiz name";var i=t.detail.data.component.questions[0].text||"unknown question text",n=t.detail.data.text||"unknown answer text";"object"==typeof om&&"function"==typeof om.trackPlayBuzz&&om.trackPlayBuzz("answer",[this.quizName,i,n].join("|"))}e.log("Playbuzz event",t)}catch(t){e.error("Playbuzz data error",t)}})}}}),define("managers/tealium",["jquery","version!fly/managers/debug","managers/page-vars","managers/client-storage","managers/third-party/playbuzz","managers/tracking","optional!"+(window.CnetPageVars.services.tealium&&window.CnetPageVars.services.tealium.enabled?"tealium":"feature-disabled")],function(t,e,i,n,s,a){var r=e.get("tealium"),o={timeThreshold:4e3,requestThreshold:10,requestCount:0},l={_getCollectionId:function(){var t="";return"object"==typeof i.tracking.data.collectionId?t=i.tracking.data.collectionId[0]:"string"==typeof i.tracking.data.collectionId&&(t=i.tracking.data.collectionId),t},getDwTag:function(t,e){var i=[];e=e||3;do{(t=t.parents("[section],[id]")).attr("section")?i.push(t.attr("section")):t.attr("id")&&i.push(t.attr("id"))}while(i.length<e&&0<t.length);return i.reverse().join("|")},getHbParams:function(e){utag_data.videoAutoPlay="off"===n.read("autoplayEnabled")?"off":"on";var s=new Array("brand","siteEdition","siteSection","siteType","articleId","articleType","articleTitle","mediaAutoPlay","mfr","pageType","pageTypeId","pageOntologyId","pageViewGuid","productId","productName","productSeriesId","productSeriesName","productSlug","productType","showId","showTitle","showEpisodeId","showEpisodeTitle","userState","userId","userType","userRegId","deviceType","dwAnonId","videoAutoPlay"),a=new Array,r={};e=e||{};for(var o=0;o<s.length;o++)utag_data[s[o]]&&(a[s[o]]=utag_data[s[o]]);var l=i.tracking.data;return t.extend(r,a,{siteRsids:l.reportSuiteId,siteCode:l.brand,pageName:l.siteName?l.siteName+":"+window.location.pathname:void 0,pageUrl:window.location.href,sitePrimaryRsid:l.reportSuiteId,userStatus:l.userType,siteHier:l.siteName&&l.siteHier?l.siteName+":"+l.siteHier.join("|"):void 0,topicPrimaryId:l.topicId&&l.topicId.length>=0?l.topicId[0]:void 0,authorList:l.articleAuthorId?l.articleAuthorId.join("|"):void 0,test:l.testName?l.testName+"|"+l.testVersion+"|"+l.testGroup:""},e),r},_getUdoStockData:function(){var t=i.tracking.data;return{siteEdition:t.siteEdition,pageViewGuid:t.pageViewGuid,pageType:t.pageType,siteHier:t.siteHier,siteType:t.siteType,deviceType:t.deviceType,articleId:t.articleId,articleTitle:t.articleTitle,articleType:t.articleType,articlePubDate:t.articlePubDate,articleAuthorId:t.articleAuthorId,articleAuthorName:t.articleAuthorName,topicId:t.topicId,topicName:t.topicName}},_initRequestTracking:function(){if("article"===i.tracking.data.pageType){var t=0,e=this;window.setInterval(function(){try{var i=window.performance.getEntriesByType("resource");for(t=t>=i.length?0:t;t<i.length;){var n=i[t];e._trackServiceRequest(n),t++}}catch(t){r.error("Failed to monitor tracking requests:",t)}},500)}},_trackClickViaUtag:function(e,n,s,o,l){try{if(!0===i.tracking.enabled){l="object"!=typeof l?{}:l;var d={_test:i.tracking.data.testName?i.tracking.data.testName+"|"+i.tracking.data.testVersion+"|"+i.tracking.data.testGroup:"",userState:i.tracking.data.userState,userType:i.tracking.data.userType,oneTrustGroup1:window.utag_data.oneTrustGroup1,oneTrustGroup2:window.utag_data.oneTrustGroup2,oneTrustGroup3:window.utag_data.oneTrustGroup3,oneTrustGroup4:window.utag_data.oneTrustGroup4,oneTrustGroup5:window.utag_data.oneTrustGroup5};if(o="object"!=typeof o?{}:o,o=t.extend({},l,d,o,a.getServiceVars()),t.inArray(e,["om","omnitureMgr","utag"])>=0){r.info(s+" ping: ",o);var u=r.enabled?t.extend({},o):{};if("view"===n?a.trackPageView({path:window.location.pathname,data:o}):a.trackPageEvent({path:window.location.pathname,data:o}),o.dwLinkTag?window.dwTag=o.dwLinkTag:window.dwTag&&(o.dwLinkTag=window.dwTag),window[e][n](o),delete window.dwTag,"object"==typeof window.s&&(window.s.events="",window.s.eVar21="",window.s.eVar37="",window.s.eVar38=""),r.enabled){for(var c in u)o[c]!==u[c]&&r.warn("Tealium overrode our data: "+c+' was changed from "'+u[c]+'" to "'+o[c]+'"');var h={};for(var c in o)void 0===u[c]&&(h[c]=o[c]);0!==h.length&&r.log("Tealium added the following data to the tracking call: ",h)}}else r.error("Invalid tracking object",e)}else r.info(s+" aborted; tracking is not enabled!")}catch(t){r.error(s+" failed:",t)}},trackComment:function(e,n,s){var a={link_text:e,_clickAction:s||e,socialService:"cnet",brand:i.tracking.data.brand,_collectionPrimaryId:this._getCollectionId(),dwLinkTag:n.sharebarSection};this._trackClickViaUtag("utag","link",e,n,t.extend({},this._getUdoStockData(),a))},trackCustomEvent:function(t,e,i){var n={link_text:t,_clickAction:i||"trackClick"};this._trackClickViaUtag("utag","link",t,e,n)},trackExternalLink:function(t){this._trackClickViaUtag("om","trackClick","trackExternalLink",t)},trackForum:function(t,e){this._trackClickViaUtag("om","trackForum",t,e)},trackLead:function(t){var e=jQuery.extend({},i.tracking.data,{_merchantId:t.merid,_merchantName:t.merchantName,_leadType:t.ltype,_destCat:t.destcat,_destUrl:t.destUrl,leadCpc:t.leadcpc,mfr:t.manufacturer,productName:t.productTitle,productSeriesId:t.seriesGuid,productId:void 0!==t.productId?";"+t.productId+";;;;":"",_videoAction:"",videoSegments:"",_leadProdPrice:t.productPrice,videoTime:0,_clickAction:"leadClick",link_text:"clickLead"},t);this._trackClickViaUtag("utag","link","trackLeadClick",t,e)},trackPageLoad:function(e){this._trackClickViaUtag("utag","view","Track view",e,i.tracking.data),t(window).trigger("dynamicloadcomplete"),a.trackChartbeatPageView()},trackPodcast:function(t){this._trackClickViaUtag("om","trackPodcast","trackPodcast",t)},_trackServiceRequest:function(e){for(var n in this.monitoredServices){var s=this.monitoredServices[n];s.fireCount<s.maxFireCount&&-1!==e.name.indexOf(s.requestPrefix)&&(r.info("Tracking the request: "+s.timerName,e.fetchStart),this.trackCustomEvent(s.timerName,t.extend({},i.tracking.data)),s.fireCount++)}},_trackSlaRequest:function(e){if(o.timeThreshold<=e.duration&&o.requestThreshold>o.requestCount){var n=document.createElement("a");if(n.href=e.name,"".endsWith&&!n.host.endsWith(".cnet.com")&&!n.pathname.endsWith(".mp4")){o.requestCount++;var s=Math.round(e.duration/1e3);r.info("slow request ("+s+" seconds)",e.name),this.trackCustomEvent("trackSlaEnforcement",t.extend({serviceWorkerDomain:n.host,serviceWorkerRequestTime:s,serviceWorkerConnection:window.navigator.connection?window.navigator.connection.effectiveType:"unsupported"},i.tracking.data))}}},trackSocial:function(t){var e={brand:i.tracking.data.brand,_collectionPrimaryId:this._getCollectionId(),dwLinkTag:t.sharebarSection};this._trackClickViaUtag("om","trackSocialClick","trackSocialClick",t,e)},trackSuggestedSearch:function(t){this._trackClickViaUtag("om","trackSuggestedSearchClick","trackSuggestedSearchClick",t)},trackVideo:function(t,e,n){var s=t.charAt(0).toUpperCase()+t.slice(1),a="pause"===t?"videoTime":"video"+s+(0===e?"Start":100===e?"Complete":e+"Percent"),r=i.tracking.data,o={_videoAction:a,link_text:a,siteHier:r.siteHier,siteSection:r.siteSection,siteEdition:r.siteEdition,brand:r.brand,siteType:r.siteType,deviceType:r.deviceType,pageType:r.pageType,pageNum:null!=r.pageNum?r.pageNum:1,topicId:r.topicId,pageViewGuid:r.pageViewGuid,articleAuthorId:r.articleAuthorId,articleAuthorName:r.articleAuthorName,articleId:r.articleId,articleTitle:r.articleTitle,articleType:r.articleType,productId:r.productId,productName:r.productName};this._trackClickViaUtag("utag","link",a,n,o)}};return s.init(),l._initRequestTracking(),l}),function(){var t,e=this;if("function"==typeof e.require)try{var i=e.require("crypto").randomBytes;t=i&&function(){return i(16)}}catch(t){}if(!t&&e.crypto&&crypto.getRandomValues){var n=new Uint8Array(16);t=function(){return crypto.getRandomValues(n),n}}if(!t){var s=new Array(16);t=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),s[e]=t>>>((3&e)<<3)&255;return s}}for(var a="function"==typeof e.Buffer?e.Buffer:Array,r=[],o={},l=0;l<256;l++)r[l]=(l+256).toString(16).substr(1),o[r[l]]=l;function d(t,e){var i=e||0,n=r;return n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]}var u=t(),c=[1|u[0],u[1],u[2],u[3],u[4],u[5]],h=16383&(u[6]<<8|u[7]),p=0,g=0;function f(e,i,n){var s=i&&n||0;"string"==typeof e&&(i="binary"==e?new a(16):null,e=null);var r=(e=e||{}).random||(e.rng||t)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,i)for(var o=0;o<16;o++)i[s+o]=r[o];return i||d(r)}var v=f;v.v1=function(t,e,i){var n=e&&i||0,s=e||[],a=null!=(t=t||{}).clockseq?t.clockseq:h,r=null!=t.msecs?t.msecs:(new Date).getTime(),o=null!=t.nsecs?t.nsecs:g+1,l=r-p+(o-g)/1e4;if(l<0&&null==t.clockseq&&(a=a+1&16383),(l<0||r>p)&&null==t.nsecs&&(o=0),o>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=r,g=o,h=a;var u=(1e4*(268435455&(r+=122192928e5))+o)%4294967296;s[n++]=u>>>24&255,s[n++]=u>>>16&255,s[n++]=u>>>8&255,s[n++]=255&u;var f=r/4294967296*1e4&268435455;s[n++]=f>>>8&255,s[n++]=255&f,s[n++]=f>>>24&15|16,s[n++]=f>>>16&255,s[n++]=a>>>8|128,s[n++]=255&a;for(var v=t.node||c,m=0;m<6;m++)s[n+m]=v[m];return e||d(s)},v.v4=f,v.parse=function(t,e,i){var n=e&&i||0,s=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){s<16&&(e[n+s++]=o[t])});s<16;)e[n+s++]=0;return e},v.unparse=d,v.BufferClass=a;var m=e.uuid;v.noConflict=function(){return e.uuid=m,v},e.uuid=v}.call(this),define("fly/libs/guid-1.0",function(){}),define("managers/recommendation-data",["jquery","managers/page-vars","version!fly/managers/debug","version!fly/libs/guid"],function(t,e,i){var n={APPLE:"17cf639e-36ce-4e2e-8ea8-a093af98d566",CARS:"b122d23f-29eb-493e-83e6-e9fbfeaf79c8",DEALS:"cc98b5a4-d3a9-4e35-b6d7-625e8289a152",GOOGLE:"303efe12-c4e2-4abd-af02-f99b9d1b2828","HOW TO":"787724c6-2b1e-4f6a-90d9-afa0eebd1abb",MOBILE:"d1753851-e519-4744-897e-9b6ea3b1c04b","SMART HOME":"5787016e-17a5-438f-8690-70ca531844fb","TV & AUDIO":"a13a6b57-a74a-4eaf-be94-c72b9dc931c2",CULTURE:"7b5fc82b-deb8-4e73-8a23-70461cd49a63"},s={broad:"broad-interest",specific:"specific-interest",video:"video-interest",general:"general"};i=i.init("recommendationDataManager");var a={testForLocalStorage:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return!1}},pruneViews:function(t){for(;t.length>=2e3;)t.shift();var e=Date.now();if(t.length>0)for(var i=t[0];i&&i.date_created&&i.date_created+158112e5<e;)t.shift(),i=t[0];for(var n=[],s=t.length-1;s>=0;s--)n.some(function(e){return e.content_entity_id===t[s].content_entity_id&&e.content_type===t[s].content_type})||n.push(t[s]);return n.reverse()},createNewViewEvent:function(t){var i=e.tracking.data;return{content_entity_id:i.contentId,content_type:"content_"+i.contentType,site:i.brand,dev:i.isDev,view_guid:i.pageViewGuid,page_type:i.pageType,user_id:i.userId,is_logged_in:!!t&&t.isLoggedIn,anon_id:this.getAnon(),deviceType:i.deviceType,date_created:Date.now(),interest:i.interest?i.interest:this.getNoneInterest(),annotations:i.annotations||[],edition:i.siteEdition}},getAnon:function(){var t=localStorage.getItem("CnetAnon");t||(t=window.uuid.v4());try{localStorage.setItem("CnetAnon",t)}catch(e){i.error("Writing to localStorage for anon failed."),t="00000000-0000-0000-0000-000000000000"}return t},writeViewsArray:function(t){var e=!1;try{localStorage.setItem("CnetViewList",JSON.stringify(t)),e=!0}catch(s){i.error("Writing to localStorage failed, attempting to prune view data...");for(var n=0;n<t.length/10;n++)t.shift();try{localStorage.setItem("CnetViewList",JSON.stringify(t)),e=!0}catch(t){i.error("Writing to localStorage failed, even after pruning 10% of view data."),e=!1}}return e},writeExplicitInterestToLocalStorage:function(t){var e=localStorage.getItem("CnetExplicitList");e=e?JSON.parse(e):[];for(var i=!1,n=0;n<e.length;n++)if(t.interest_name&&e[n].interest_name&&t.interest_name===e[n].interest_name&&t.type&&e[n].type&&t.type===e[n].type&&t.implicit===e[n].implicit){if(t.date_created<e[n].date_created)return;e[n]=t,i=!0;break}return i||e.push(t),localStorage.setItem("CnetExplicitList",JSON.stringify(e)),{all:e,new:t}},createExplicitInterestObject:function(t,e,i){var n=this.createNewViewEvent(i);return n=this.normalizeView(n),e&&e.id&&(n.interest=e),{anon_id:n.anon_id,implicit:!1,date_created:n.date_created,type:n.interest?n.interest.type:"none",interest_name:n.interest?n.interest.name.toUpperCase():"none",interest_id:n.interest?n.interest.id:"none",site:n.site,edition:n.edition,action:t,user_id:n.user_id}},createMockExplicitInterestObject:function(t){var e=this.createNewViewEvent();return{anon_id:(e=this.normalizeView(e)).anon_id,implicit:!1,date_created:e.date_created,type:"broad",interest_name:t,interest_id:n[t]?n[t]:"interest_id",site:e.site,edition:e.edition,action:"unfollow"}},createImplicitInterestObject:function(t){return t||(t=this.createNewViewEvent()),{anon_id:(t=this.normalizeView(t)).anon_id,implicit:!0,date_created:t.date_created,type:t.interest.type,interest_name:t.interest.name.toUpperCase(),interest_id:t.interest.id,site:t.site,edition:t.edition,action:"follow",urs_id:t.user_id}},normalizeView:function(t){return t.broad_interest?t.interest={id:n[t.broad_interest]?n[t.broad_interest]:"interest_id",type:"broad",name:t.broad_interest}:t.interest||(t.interest=this.getNoneInterest()),null!=t.is_logged_in&&0!=t.is_logged_in||(t.user_id=""),t},repopulateInterestDB:function(t,e){var n=this.getExplicitInterests(),s=n.filter(function(t){return"unfollow"!==t.action&&!1===t.implicit}),a=this.getViewEvents(),r=this.buildImplicitInterestObjectsFromViews(a),o=n.filter(function(t){return"unfollow"!==t.action&&!0===t.implicit}),l=r.concat(o),d=[];l.forEach(function(t){n.some(function(e){return t.interest_id===e.interest_id&&"unfollow"===e.action})||d.push(t)});var u=s.concat(d);i.log("Backfilling interests"),this.sendInterestsToBackend(u,t,e)},sendInterestsToBackend:function(e,i,n){if(!e||!e.length||e.length<1)i();else{e.sort(function(t,e){return e.date_created-t.date_created});var s=[];e.forEach(function(t){t=r(t),s.some(function(e){return t.interest_id===e.interest_id&&t.action===e.action&&t.implicit===e.implicit})||("video"===t.type&&(t.type="specific"),void 0!==t.user_id&&delete t.user_id,s.push(t))});var a="/personalization/interest/";n&&(a+="?excludeUrsInfo=true"),t.post(a,JSON.stringify(s),i)}},syncInterestsWithBackend:function(e,n){var s=this;return!!e.isLoggedIn&&(t.ajax({method:"GET",dataType:"json",url:"/personalization/interest/"}).done(function(t){if(t.results){var e=t.results[0].interests;e&&0!==e.length&&(e.sort(function(t,e){return t.lastViewed-e.lastViewed}),e.forEach(function(t){var e;e=t.broadInterestId?"broad":"collection"===t.type?"video":"specific";var i="follow";t.isImplicit||t.isActive||(i="unfollow");var a={action:i,anon_id:s.getAnon(),date_created:t.lastViewed,edition:t.edition,implicit:t.isImplicit,interest_id:t.broadInterestId?t.broadInterestId:t.interestId,interest_name:t.name.toUpperCase(),site:"cnet",type:e};s.writeExplicitInterestToLocalStorage(a),"follow"===i?n.channel.tags.add(t.name.toUpperCase(),s.getTagGroupByInterest(e)):n.channel.tags.remove(t.name.toUpperCase(),s.getTagGroupByInterest(e))}),i.log("Interest Sync complete"))}}),!0)},buildImplicitInterestObjectsFromViews:function(t){var e=[],i=function(t){var e={};return t.forEach(function(t){t.interest&&"none"!==t.interest.id&&(e[t.interest.id]?e[t.interest.id].push(t):e[t.interest.id]=[t])}),e}(t);return i&&Object.keys(i).forEach(function(t){var n=i[t];if(!(n.length<2))for(var s=0;s<n.length-1;s++)if(n[s].date_created+2592e6>n[s+1].date_created){var o=a.createImplicitInterestObject(n[n.length-1]);o=r(o),e.push(o);break}}),e},getNoneInterest:function(){return{id:"none",type:"none",name:"none"}},getViewEvents:function(){var t=localStorage.getItem("CnetViewList");return t?JSON.parse(t):[]},getExplicitInterests:function(){var t=localStorage.getItem("CnetExplicitList");return t?t=(t=JSON.parse(t)).map(function(t){return r(t)}):[]},getTagGroupByInterest:function(t){return s[t]?s[t]:"device"},triggerPeriodicBackfillSync:function(e,i){var n=localStorage.getItem("CnetInterestSyncTime");if(!n||Number.parseInt(n)+36e5<Date.now())if(e.isLoggedIn)a.repopulateInterestDB(function(){window.UA?window.UA.then(function(t){a.syncInterestsWithBackend(e,t)&&localStorage.setItem("CnetInterestSyncTime",Date.now())}):t(window).on("urban-airship-loaded",function(){window.UA.then(function(t){a.syncInterestsWithBackend(e,t)&&localStorage.setItem("CnetInterestSyncTime",Date.now())})})});else{var s=a.buildImplicitInterestObjectsFromViews(i),r=a.getExplicitInterests().concat(s);if(0===r.length)return;for(var o=r.sort(function(t,e){return e.date_created-t.date_created}),l=null,d=0;d<o.length;d++){if(!o[d].implicit){l=o[d];break}if(!r.some(function(t){return t.interest_id===o[d].interest_id&&"unfollow"===t.action&&!t.implicit})){l=o[d];break}}var u=Date.now()-2592e6;l&&l.date_created<u&&a.repopulateInterestDB(function(){localStorage.setItem("CnetInterestSyncTime",Date.now())})}}};function r(t){return t.interest_id=t.interest_id.replace("cnet_tag","CNET_TAG").replace("cnet_cat_topic","CNET_CAT_TOPIC"),t}return a}),define("translations/form-validate",["managers/edition"],function(t){return t.getTranslation({en:{required:{field:"This field is required",radio:"One of these fields is required"},availableEmail:"This e-mail address is already in use. Please choose another.",availableUsername:"That username is already taken. Try another.",validPassword:"Your password needs at least 6 characters, and 3 of these 4: special characters, numbers, or upper or lowercase letters.",minlength:"This field must be at least {minlength} characters",maxlength:"This field must be no more than {maxlength} characters",email:"Oops! Please enter a valid email.",noUrl:"A url is not allowed in this field",noSpecialCharacters:"The special characters @, &, and % are not allowed in this field",equalTo:"Fields do not match",usernameSpecialCharacters:'Please use only alphanumeric characters, underscores "_", and dashes "-"',usernameCharacterLength:"Your username must be between 3 and 25 characters.",atLeastOneAlphanumeric:"You must include at least one alphanumeric character",generic:"Oops! Something went wrong, try again.","invalid.loginpassword":"Oops! That’s not the password for this account, try again.","locked.account":"Too many attempts. Wait 5 minutes and try again, or reset your password.","invalid.email":"Oops! Please enter a valid email.","inuse.userName":"That username is already taken. Try another.","required.email":"We're sorry that you do not wish to create a CNET account."},es:{required:{field:"Campo requerido",radio:"One of these fields is required"},availableEmail:"Este email esta en uso.  Elige otro.",availableUsername:"Ese nombre de usuario ya existe. Inténtalo de nuevo.",validPassword:"Tu contraseña debe incluir al menos seis caracteres sin espacios y contar con un número, un símbolo especial y una mayúscula.",minlength:"Este campo debe tener al menos {minlength} caracteres",maxlength:"This field must be no more than {maxlength} characters",email:"Tu cuenta de e-mail no es válida, inténtalo de nuevo.",noUrl:"A url is not allowed in this field",noSpecialCharacters:"The special characters @, &, and % are not allowed in this field",equalTo:"Fields do not match",usernameSpecialCharacters:'Por favor, usa solamente caracteres alfanuméricos, guiones bajos "_", y guiones "-"',usernameCharacterLength:"Tu nombre de usuario debe contener entre 3 y 23 letras.",atLeastOneAlphanumeric:"You must include at least one alphanumeric character",generic:"¡Lo sentimos! Algo no está funcionando, inténtalo más tarde.","invalid.loginpassword":"¡Lo sentimos! Esa no es la contraseña correcta. Inténtalo de nuevo.","locked.account":"Ingresaste una contraseña equivocada demasiadas veces. Espera 5 minutos para intentarlo de nuevo o restablece tu contraseña.","invalid.email":"Tu cuenta de e-mail no es válida, inténtalo de nuevo.","inuse.userName":"Ese nombre de usuario ya existe. Inténtalo de nuevo.","required.email":"Sentimos mucho que no quieras crear una cuenta con CNET en este momento. ¡Gracias por visitarnos!"}})}),define("utils/urs-helper",["jquery","version!fly/managers/debug","managers/page-vars","optional!urs"],function(t,e,i){e=e.init("ursHelper");var n={16:257,103:259,222:263,225:265,242:266,256:268,295:298,358:359,363:361,364:362,368:365,369:366,370:367,372:371,403:401,404:402,9:269,36:270,74:278,305:304,27:280,374:373,376:375,202:394,393:394,395:396,397:398};return{getSocialAppId:function(t){return n[t]},getUrs:function(t,e){var n={};return"object"==typeof window.URS&&"function"==typeof URS.getInstance&&"function"==typeof URS.newInstance&&((n=URS.getInstance(t,"v2.2"))||(n=URS.newInstance({appId:t,clientToken:"12d6d06e118e4a90",environment:i.environment.indexOf("prod")>-1?URS.ursEnvironments.LIVE:URS.ursEnvironments.QA,version:"v2.2"}),e&&e(n))),n}}}),define("fly/utils/string-vars-1.0",["jquery"],function(t){return{compile:function(e,i,n){var s=this;return"string"!=typeof e?"":(n=t.makeArray(n),e=e.replace(/\{([^}]+)\}/g,function(e){var a=n,r="";return e=e.replace(/\|[^\}|]+/g,function(t){return a.push(t.substr(1)),""}),r=i[e.replace(/[{}]+/g,"")]||"",t.each(a,function(t,e){r=s.modify(e,r)}),r}))},modify:function(t,e){switch(t){case"lower":e=e.toLowerCase();break;case"upper":e=e.toUpperCase();break;case"urlencode":e=encodeURIComponent(e)}return e}}}),define("fly/components/form-validate-1.0",["jquery","version!fly/utils/string-helper","version!fly/utils/string-vars","version!fly/managers/debug","version!fly/components/base"],function(t,e,i,n){var s=t.support.touch?"vclick":"click",a=n.init("formValidate");t.widget("fly.formValidate",t.fly.base,{options:{inlineErrorTemplate:'<label for="{id}" class="validate-{type}">{message}</label>',globalErrorTemplate:'<div class="alert alert-{type}">{message}</div>',classFieldStatus:"validate-{type}",animation:"slide",fieldSelector:'[data-item="field"]',ignoreHidden:!0,ignoreSelector:null,validateOnChange:!0,scrollToErrors:!1,attributes:["required","maxlength","minlength"],rules:{},success:function(t,e){e.$form.submit()},failure:function(t,e){},placeError:function(t,e){e.is(":checkbox, :radio")&&e.parent("label").length?t.insertAfter(e.parent("label")):t.insertAfter(e)}},rules:{required:{message:function(t){return t.is(":radio")?"One of these fields is required":"This field is required"},test:function(t){return t.is(":radio")?t.closest("form").find(':radio[name="'+t.attr("name")+'"]').is(":checked"):!!(t.is(":checkbox")?t.is(":checked"):t.val())}},mailcheck:{type:"warning",message:null,test:function(t,e){var i=this,n=t.closest("form");return require(["fly/libs/mailcheck-1.1"],function(){t.mailcheck({suggested:function(a,r){i.message='Did you mean <a class="mailcheck" data-_insert="mailcheck">'+r.domain+"</a>?",n.on(s+".mailcheck",'[data-_insert="mailcheck"]',function(){t.val(r.full).trigger("change")}),e.reject("mailcheck")},empty:function(t){n.off(".mailcheck"),e.resolve()}})}),e.promise()}},availableEmail:{remote:!0,message:"Email is already in use"},availableUsername:{remote:!0,message:"User Name is already in use"},minlength:{message:function(t){return"This field must be at least "+t.attr("minlength")+" characters"},test:function(t){return t.val().length>=t.attr("minlength")}},maxlength:{message:function(t){return"This field must be no more than "+t.attr("maxlength")+" characters"},test:function(t){return t.val().length<=t.attr("maxlength")}},email:{message:"Please enter a valid email",test:function(t){return/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,4}$/i.test(t.val())}},noUrl:{message:"A url is not allowed in this field",test:function(t){return!/http:\/\//i.test(t.val())}},noSpecialCharacters:{message:"The special characters @, &, and % are not allowed in this field",test:function(t){return/^[^@&%]+$/i.test(t.val())}},equalTo:{message:"Fields do not match",test:function(e){var i=t('input[name="'+e.data("validate-equal-to")+'"]');return i.length&&e.val()===i.val()}}},wasSubmitted:!1,isWorking:!1,isFormValid:!1,_create:function(){var t=this.options,e={};this._setup(),this.$form=this.$element,this.$form.attr("novalidate","novalidate"),this.globalErrors=[],this.ignoreSelector=":submit, :reset, :image, [disabled]",t.ignoreHidden&&(this.ignoreSelector+=", :hidden"),t.ignoreSelector&&(this.ignoreSelector+=", "+t.ignoreSelector),this.addRules(t.rules),this._on(this.$form,{submit:"_handleSubmit"}),t.validateOnChange&&(e["focusout :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleFocusOut",e["keyup :input:not("+this.ignoreSelector+", [readonly])"]="_handleChange",e["change :input:not("+this.ignoreSelector+")"]="_handleChange",this._on(this.$form,e))},_handleSubmit:function(t){this._off(this.$form,"focusout"),this.wasSubmitted=!0,this.isFormValid||(t.preventDefault(),t.stopImmediatePropagation(),this.validate())},_handleFocusOut:function(e){t(e.target).attr("data-_enabled","true"),this._handleChange(e)},_handleChange:function(e){var i=t(e.target);this.isFormValid=!1,(this.wasSubmitted||i.data("_enabled"))&&(i.data("_passed",!1),this.testField(i))},getRule:function(t){return void 0!==this.rules[t]&&this.rules[t]},getRulesToValidate:function(e){var i=this,n=e.data("validate")||[],s=t.isArray(n)?n:n.split(" ");return t.each(this.options.attributes,function(t,i){e.attr(i)&&s.unshift(i)}),t.grep(s,function(t,e){return i.getRule(t)})},addRules:function(e){t.isPlainObject(e)&&t.extend(this.rules,e)},removeRule:function(t){!1!==this.getRule(t)&&delete this.rules[t]},setFieldDelegate:function(t){var e=null;return t.is(":radio")&&(e=this.$form.find(':radio[name="'+t.attr("name")+'"]').first()),t.data("_field_delegate",e),t},testField:function(e){var i,n=this,s=[],r=e.data()||{},o=r.error||{},l=t.Deferred();return r._passed?(l.resolve(),l.promise()):(this.setFieldDelegate(e),r.remoteRequest&&r.remoteRequest.abort(),i=this.getRulesToValidate(e),a.log("test field: ",e," w/ rules:",i),t.each(i,function(i,r){var l,d=n.getRule(r),u=!0,c=!!d.remote,h=null;if(c&&(h=d.remoteUrl||e.data("remoteUrl"),n.removeError(e)),l=(l=function(){var i=t.Deferred(),s=null;return!1===(s=c?n.requestRemote(h,e,r,i):d.test(e,i))?(u=!1,i.reject(r)):!0===s&&i.resolve(r),i.promise()})(),s.push(l),t.when(l).fail(function(){a.log("rule failed: ",r,e)}).then(function(){o.name===r&&n.removeError(e),a.log("rule passed: ",r,e)}),!u)return!1}),t.when.apply(null,s).fail(function(t){var i=n.getRule(t),s=i.type?i.type:"error",r=e.data(),o=r.error||{};r.remoteTimeout&&clearTimeout(r.remoteTimeout),r.remoteRequest&&r.remoteRequest.abort(),o.message!=n.getMessage(t,e)&&(n.removeError(e),n.addInlineError(e,t)),"error"!==s?(l.resolve(),a.log("field passed: ",e," type: ",s)):(l.reject(),a.log("field failed: ",e))}).then(function(){e.data("_passed",!0),n.removeError(e),l.resolve(),a.log("field passed: ",e)}),l.promise())},requestRemote:function(e,i,n,s){var a,r={},o=null,l=i.data()||{};l.remoteTimeout&&(clearTimeout(l.remoteTimeout),l.remoteQueue.resolve(n)),r[i.attr("name")]=i.val(),a=setTimeout(function(){o=t.ajax({type:"POST",dataType:"json",url:e,data:r,timeout:5e3,success:function(e){switch(e){case!0:s.resolve(n);break;case!1:s.reject(n);break;default:t.isPlainObject(e)&&e.status?"success"===e.status?s.resolve(n):s.reject(n):s.resolve(n)}},complete:function(){i.data("remoteRequest",null)},error:function(t,e){s.resolve(n),i.data("_passed",!1)}}),i.data({remoteRequest:o,remoteQueue:null,remoteTimeout:null})},300),i.data({remoteQueue:s,remoteTimeout:a})},validate:function(){var e=this.options,i=this,n=[];this.isWorking||!1!==this._trigger("validate")&&(this.isWorking=!0,this.removeGlobalErrors(),this.$form.find(":input").not(this.ignoreSelector).each(function(){var e=t(this);n.push(i.testField(e))}),t.when.apply(null,n).fail(function(){a.log("validate failed"),i._trigger("failure",null,{$form:i.$form}),e.scrollToErrors&&i.scrollToErrors()}).then(function(){a.log("validate success"),i.isFormValid=!0,i._trigger("success",null,{$form:i.$form}),i.isFormValid=!1}).always(function(){i._trigger("validated"),i.isWorking=!1}))},scrollToErrors:function(){var e=this.options,i=this.$form.find("[data-validate-error]").first(),n=i.closest(e.fieldSelector),s=(n.length?n:i).offset().top;!1!==this._trigger("scroll",null,{offset:s})&&(s-=this.$window.height()/6,t("html, body").animate({scrollTop:s},"fast"))},removeError:function(e){e=e.data("_field_delegate")||e;var i=this,n=this.options,s=e.data("error");s&&("slide"===n.animation?s.$error.slideUp("fast",function(){t(this).remove(),i._completeRemoveError(s,e)}):(e.remove(),this._completeRemoveError(s,e)),e.removeClass(s.fieldClass).removeData("error"))},getMessage:function(e,i){var n=this.getRule(e),s=i.data("validate-message-"+e)||i.data("validate-message-"+e.toLowerCase());return s||!1===s||(s=t.isFunction(n.message)?n.message(i):n.message),s},addInlineError:function(e,n){e=e.data("_field_delegate")||e;var s,a,r,o=this,l=this.options,d=e.data("error")||{},u={name:n,position:"inline"};"error"!==d.type&&(a=this.getMessage(n,e),s=this.getRule(n).type||"error",r=i.compile(l.inlineErrorTemplate,{type:s,id:e.attr("id"),message:a}),t.extend(u,{type:s,message:a,$error:t(r).attr("data-validate-error",!0),fieldClass:i.compile(this.options.classFieldStatus,{type:s})}),e.addClass(u.fieldClass).data("error",u),!1!==a&&("slide"===l.animation?(u.$error=t("<div />").wrapInner(u.$error),u.$error.hide(),l.placeError.call(this,u.$error,e),u.$error.slideDown("fast",function(){o._completeAddError(u,e)})):(l.placeError.call(this,u.$error,e),this._completeAddError(u,e))))},addGlobalError:function(e,n){n=n||"error";var s,a=this,r=this.options,o={position:"global",type:n,message:e};s=i.compile(r.globalErrorTemplate,{type:n,message:e}),t.extend(o,{$error:t(s).attr("data-validate-error",!0)}),"slide"===r.animation?(o.$error=t("<div />").wrapInner(o.$error),o.$error.hide().prependTo(this.$form).slideDown("fast",function(){a._completeAddError(o)})):(this.$form.prepend(o.$error),this._completeAddError(o)),this.globalErrors.push(o)},removeGlobalErrors:function(){var e=this;t.each(this.globalErrors,function(t,i){i.$error.remove(),e._completeRemoveError(i)})},removeInlineErrors:function(){var e=this;this.$form.find("[data-validate-error]").each(function(){var i=t(this),n=i.data();n.error&&e.removeError(i),n.remoteRequest&&n.remoteRequest.abort()})},_completeAddError:function(e,i){this._trigger("errorAdded",null,t.extend(e,{$field:i})),this.$document.trigger("displayChange",{type:"errorAdded"})},_completeRemoveError:function(e,i){this._trigger("errorRemoved",null,t.extend(e,{$field:i})),this.$document.trigger("displayChange",{type:"errorRemoved"})},_disable:function(){this.removeGlobalErrors(),this.removeInlineErrors()},_destroy:function(){this._disable()}})}),define("components/form-validate",["jquery","version!fly/managers/debug","translations/form-validate","version!fly/utils/string-vars","version!fly/components/form-validate"],function(t,e,i,n){e.init("formValidate"),t.widget("cnet.formValidate",t.fly.formValidate,{options:{validateOnBlur:!1},rules:{required:{message:function(t){return t.is(":radio")?i.required.radio:i.required.field}},mailcheck:{message:null},availableEmail:{message:i.availableEmail},availableUsername:{message:i.availableUsername},validPassword:{message:i.validPassword,test:function(t){var e=t.val(),i=0;return/[0-9]+/.test(e)&&i++,/[a-z]+/.test(e)&&i++,/[A-Z]+/.test(e)&&i++,/[\(\)\.@`!#\$%\^&*+=\-\[\]\\';,/\{\}\|":<>\?~_]+/.test(e)&&i++,i>=3&&e.length>=6&&-1==e.indexOf(" ")}},minlength:{message:function(t){return n.compile(i.minlength,{minlength:t.attr("minlength")})}},maxlength:{message:function(t){return n.compile(i.maxlength,{maxlength:t.attr("maxlength")})}},email:{message:i.email,test:function(t){return/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}$/i.test(t.val())}},noUrl:{message:i.noUrl},noSpecialCharacters:{message:i.noSpecialCharacters},equalTo:{message:i.equalTo},usernameSpecialCharacters:{message:i.usernameSpecialCharacters,test:function(t){return/^[a-z0-9\-_]*$/i.test(t.val())}},usernameCharacterLength:{message:i.usernameCharacterLength,test:function(t){var e=t.val().length;return e>=3&&e<=25}},atLeastOneAlphanumeric:{message:i.atLeastOneAlphanumeric,test:function(t){return/.*[a-z0-9]+.*/i.test(t.val())}}},_create:function(){var t=this.options,e={};this._super(),t.validateOnBlur&&(e["focusout :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleFocusOut",e["blur :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleChange",this._on(this.$form,e))},getMessage:function(t,e){return this._super(t,e)||i[t||"generic"]||i.generic},addInlineError:function(e,i){e=e.data("_field_delegate")||e;var s,a,r,o=this.options,l={name:i,position:"inline"};"error"!==(e.data("error")||{}).type&&(a=this.getMessage(i,e),s=this.getRule(i).type||"error",r=n.compile(o.inlineErrorTemplate,{type:s,id:e.attr("id"),message:a}),t.extend(l,{type:s,message:a,$error:t(r).attr("data-validate-error",!0),fieldClass:n.compile(this.options.classFieldStatus,{type:s})}),e.addClass(l.fieldClass).data("error",l),e.attr("aria-invalid","true"),!1!==a&&("slide"===o.animation?(l.$error=t("<div />").wrapInner(l.$error),o.placeError.call(this,l.$error,e),this._completeAddError(l,e)):(o.placeError.call(this,l.$error,e),this._completeAddError(l,e))))},removeError:function(t){t=t.data("_field_delegate")||t;var e=this.options,i=t.data("error");i&&("slide"===e.animation?i.$error.remove():(t.remove(),this._completeRemoveError(i,t)),t.removeClass(i.fieldClass).removeData("error"),t.attr("aria-invalid","false"),this._completeRemoveError(i,t))}})}),define("translations/loading",["managers/edition"],function(t){return t.getTranslation({en:{loading:"Loading",end:"The End",error:"Error Encountered"},es:{loading:"Cargando",end:"Fin",error:"Error Encontrado"}})}),define("fly/components/loading-1.0",["jquery","version!fly/utils/string-vars","version!fly/components/base"],function(t,e){t.widget("fly.loading",t.fly.base,{options:{disabled:!1,delay:100,timeout:25e3,initState:"",template:'<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',classes:{base:"loader",idle:"",loading:"loading",end:"load-end",error:"load-error"},text:{idle:"",loading:"Loading",end:"The End",error:"Error Encountered :("}},_create:function(){this._setup(),this._state=null,this._timeoutId=null},_init:function(){var t=this.options;!t.disabled&&t.initState&&(this._setContent(t.initState),this._state=t.initState)},_setContent:function(i,n){var s,a=this.options;"remove"!==i?(s=e.compile(a.template,t.extend({state:i,baseClass:a.classes.base,stateClass:a.classes[i],text:a.text[i]},n)),this.$element.html(s)):this.$element.empty()},add:function(){var e=this.options;!1!==this._trigger("add")&&(this.update("loading"),"number"==typeof e.timeout&&e.timeout>0&&(this._timeoutId=setTimeout(t.proxy(this.remove,this),e.timeout)),this._trigger("added"))},remove:function(){!1!==this._trigger("remove")&&(this.update("remove"),this._trigger("removed"))},update:function(t,e){var i=this.options,n={state:t};!1!==this._trigger("update",null,n)&&(this._state=t,i.disabled||(clearTimeout(this._timeoutId),this._setContent(t,e),this._trigger("updated",null,n)))},isLoading:function(){return"loading"===this._state},getState:function(){return this._state},_setOption:function(t,e){var i=this.options;"data"===t?this.$element.data("data",e):"disabled"===t&&(!0===e?this.$element.empty():this._setContent(i.initState)),this._super(t,e)},_destroy:function(){this.$element.remove()}})}),define("components/loading",["jquery","version!fly/managers/debug","translations/loading","version!fly/components/loading"],function(t,e,i){e=e.init("loading"),t.widget("cnet.loading",t.fly.loading,{options:{template:'<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',classes:{base:"loader",idle:"",loading:"loadingCircle",end:"load-end",error:"load-error"},text:i},add:function(){this._super(),this.$element.parent().addClass("loadingArea")},remove:function(){this._super(),this.$element.parent().removeClass("loadingArea")}})}),define("components/authentication",["jquery","version!fly/managers/debug","managers/ad","version!fly/managers/components","utils/cookie","managers/edition","managers/page-vars","managers/tealium","managers/recommendation-data","translations/form-validate","utils/urs-helper","version!fly/utils/url-helper","version!fly/components/base","components/form-validate","components/loading"],function(t,e,i,n,s,a,r,o,l,d,u,c){e=e.init("authentication"),t.widget("cnet.authentication",t.fly.base,{options:{classComplete:"complete",classSelected:"selected",classShow:"show",classActive:"active",classFade:"fade",classHide:"hide"},appId:376,entryPoints:{375:"brand_nav",270:"comments",280:"forums",265:"polls",263:"my_list",367:"brand_nav",359:"my_list",394:"brand_nav",398:"comments",376:"brand_nav",36:"comments",27:"forums",225:"polls",222:"my_list",361:"sweepstakes",370:"brand_nav",358:"my_list",368:"sweepstakes",393:"brand_nav",397:"comments",386:"sweepstakes"},newsletterCodes:{375:"e245",270:"e245",280:"e245,e497",265:"e245",263:"e245",367:"e226,e231",359:"e226,e231",394:"e237,e245",398:"e237,e245",452:"e245",453:"e245",455:"e226,e231",376:"e245",36:"e245",27:"e245,e497",202:"e237,e245",225:"e245",222:"e245",361:"e239,e245,e214",370:"e226,e231",358:"e226,e231",368:"e226,e231,e148",393:"e237,e245",397:"e237,e245",386:"e237,e245",451:"e245",454:"e245",456:"e226,e231"},$form:null,$modal:null,loading:!1,nextAction:null,refresh:!1,socialRegistration:!1,step:"start",regService:"",steps:["facebookRegister","forgot","interests","login","loginOrRegister","register","start","username"],userData:null,termsRequired:!1,termsChecked:!1,_baseTrackingData:{_pageTitle:r.tracking.data._pageTitle,siteSection:r.tracking.data.siteSection,pageType:r.tracking.data.pageType,siteEdition:r.tracking.data.siteEdition,siteType:r.tracking.data.siteType,siteHier:r.tracking.data.siteHier,brand:r.tracking.data.brand,_pageChannelType:r.tracking.data._pageChannelType,audienceManagerBlob:r.tracking.data.guid,pageViewGuid:r.guid},_create:function(){this._setup(),this._setupPageEvents(),this._loadUserData(),this._checkForOpenLoginOnLoad()},_close:function(){this.$modal.removeClass(this.options.classShow),t("body").removeClass("noScroll"),this.$modal.attr({"aria-hidden":"true",tabindex:"-1"})},_completeLogin:function(){var e=this,n=r.tracking.data;this.getUserData(function(t,n){"function"==typeof e.nextAction&&(e.refresh=e.nextAction(t),e.nextAction=null),l.repopulateInterestDB(function(){window.UA.then(function(t){l.syncInterestsWithBackend(n,t)})}),!0===e.refresh?window.location.reload():i.loadAds(i.getAdUnits(),r.ads.data)}),o.trackCustomEvent("trackLogin",t.extend(!0,{},this._baseTrackingData,{userId:n.userId,userState:"authenticated",userType:"registered",regService:e.regService,regDriver:e.entryPoints[e.appId]}),"login")},_displayError:function(t){var e=this.$form.find('[data-global-errors*="'+t+'"]'),i=this.$form.data("formValidate");0===e.length?i.addGlobalError(d[t||"generic"]||d.generic,"error"):i.addInlineError(e,t)},getUserData:function(t){this.userData?t(null,this.userData):this.$element.one("userdataloaded",t)},hasAccess:function(e){var i=this;(e=t.extend(!0,{nextAction:null,requireUsername:!1},e)).appId&&(i.appId=e.appId),this.getUserData(function(t,n){n.isLoggedIn?e.requireUsername&&!n.userName?(i.nextAction=e.nextAction,i._show("username")):"function"==typeof e.nextAction&&e.nextAction(n):(i.nextAction=e.nextAction,i._show("start"),i._trackCustomEvent("tap","start_authentication"))})},_loadUserData:function(){var e=this;this.userData=null,s.read("purs_1")?t.ajax({dataType:"json",url:r.user.urls.userData}).done(function(i){e.userData=t.extend(!0,i.user,{isLoggedIn:i.isLoggedIn}),window._cbq.push(["_acct","lgdin"]),e._updateDisplay(),e.$element.trigger("userdataloaded",[e.userData])}):(this.userData={isLoggedIn:!1},window._cbq.push(["_acct","anon"]))},logout:function(){var e=this;r.tracking.data,t.ajax({dataType:"json",url:t('[data-user-action="logout"]').attr("href")}).done(function(i){e.userData={isLoggedIn:!1},o.trackCustomEvent("trackLogout",t.extend(!0,{},e._baseTrackingData,{userId:"",userState:"not authenticated",userType:"anon",regService:e.regService,regDriver:e.entryPoints[e.appId]}),"logout"),window._cbq.push(["_acct","anon"]),e._updateDisplay(),e.$element.trigger("userhasloggedout")})},_setStep:function(e){var i=this;if(this.$modal){var n=this.$modal.find("._"+this.step+" input[type=email]").val();this.$modal.find("._"+e+" input[type=email]").val(n)}this.step=e,this.$modal&&(this.$modal.removeClass(this.steps.join(" ")).addClass(this.step).addClass(this.options.classShow),this.$modal.find("._"+this.step).addClass(this.options.classActive).attr("aria-hidden","false"),this.$modal.find("input:not([type=hidden])").attr("disabled","disabled"),this.$modal.find("._"+this.step+" input").removeAttr("disabled"),this.$modal.find("[data-app-ids]").each(function(e,n){var s=t(n);s.data("appIds").indexOf(i.appId)<0&&s.attr("disabled","disabled")}),this.$modal.attr({"aria-hidden":"false",tabindex:"0"}),t(".c-siteHeader").hasClass("-srOnly")&&this.$modal.trigger("focus"),this.$modal.find('[data-focus="'+this.step+'"]').trigger("focus"),t("body").addClass("noScroll"))},_fadeOutStep:function(){this.$modal.find(".fade").removeClass(this.options.classFade);var e=this.$modal.find(".active");e&&(t(e).removeClass(this.options.classActive),t(e).addClass(this.options.classFade),this.$modal.attr("aria-hidden","true"))},_setupModalEvents:function(){var i=this;i.termsChecked=!1,this.$modal&&(this.$modal.find('[data-action="close"]').on("click",function(t){i._close()}),this.$modal.find('[data-action="close"]').on("keydown",function(e){13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),i._close(),"mobile"===r.device?t('[data-component="nav"]').focus():t("[data-authentication]").focus())}),this.$modal.find('[data-action="urs"]').on("tap",function(t){i.regService="urs",i._trackCustomEvent("tap","choose_authentication_method")}),this.$modal.find('[data-action="facebook"]').on("tap",function(t){u.getUrs(u.getSocialAppId(i.appId),i._setupSocialEvents.bind(i)).social.authenticate("facebook"),i.regService="facebook",i._trackCustomEvent("tap","choose_authentication_method")}),this.$modal.find('[data-action="forgot"]').on("tap",function(e){var n=i.$form.data("formValidate"),s=i.$form.find("#authentication_login_email");n.testField(s)&&t.ajax({data:{email:s.val(),csrf:i.$form.find("#authentication_csrf").val()},dataType:"json",type:"POST",url:r.user.urls.forgot}).done(function(t){i._show("forgot")})}),this.$modal.find('[data-action="showHidePass"]').on("click",function(t){var e=i.$form.find("._"+i.step+" .password");""!=e.val()&&("password"==e.prop("type")?(e.prop("type","text"),i._trackCustomEvent("click","unmask pw")):(e.prop("type","password"),i._trackCustomEvent("click","mask pw")),i.$modal.find('[data-action="showHidePass"]').toggleClass("u-hidden")),e.focus()}),this.$modal.find("[data-interest]").on("tap",function(e){var n=t(this).data("interest");t(this).toggleClass(i.options.classSelected),i._trackCustomEvent("tap","mark_interest|"+n.tracking)}),this.$modal.find("#authentication_register_password").on("keyup",function(e){if(t(e.target).parent().hasClass("active")){var n=i.$form.find("."+i.options.classActive+" button"),s=i.$form.find("#authentication_register_terms"),a=i.$form.find("[data-password-validation=requirements]"),r=i.$form.find("[data-password-validation=characters]"),o=i.$form.find("[data-password-validation=letter]"),l=i.$form.find("[data-password-validation=number]"),d=i.$form.find("[data-password-validation=specialCharacter]"),u=t(this).val();i.termsChecked=s.prop("checked");var c=u.length>=6,h=/[A-Za-z]+/g.test(u),p=/[0-9]/g.test(u),g=/[\(\)\.@`!#\$%\^&*+=\-\[\]\\';,/\{\}\|":<>\?~_]+/.test(u);u.length>0&&!(c&&h&&p&&g)?(a.addClass(i.options.classShow).removeClass(i.options.classHide),c?r.addClass(i.options.classComplete):r.removeClass(i.options.classComplete),h?o.addClass(i.options.classComplete):o.removeClass(i.options.classComplete),p?l.addClass(i.options.classComplete):l.removeClass(i.options.classComplete),g?d.addClass(i.options.classComplete):d.removeClass(i.options.classComplete)):a.addClass(i.options.classHide),c&&h&&p&&g&&(!i.termsRequired||i.termsChecked)?n.removeAttr("disabled"):n.attr("disabled","disabled")}}),this.$modal.find("#authentication_register_terms").on("change",function(e){var n=i.$form.find("."+i.options.classActive+" button"),s=t(this),a=i.$form.find("#authentication_register_password").val();i.termsChecked=s.prop("checked");var r=a.length>=6,o=/[A-Za-z]+/g.test(a),l=/[0-9]/g.test(a),d=/[\(\)\.@`!#\$%\^&*+=\-\[\]\\';,/\{\}\|":<>\?~_]+/.test(a);r&&o&&l&&d&&(!i.termsRequired||i.termsChecked)?n.removeAttr("disabled"):n.attr("disabled","disabled")}),this.$modal.find("#authentication_facebook_terms").on("change",function(e){i.termsChecked=t(this).prop("checked")}),this.$form.formValidate({validateOnBlur:!0,validateOnChange:!1,success:function(n){n.preventDefault();var s=i.$form.serializeArray(),d={appId:i.appId},c=0===s.length?d:s.reduce(function(t,e){return t[e.name]=e.value,t},d),h=i.$form.find('[data-component="loading"]').data("cnetLoading");switch(i.step){case"start":i._show("loginOrRegister");break;case"facebookRegister":u.getUrs(u.getSocialAppId(i.appId),i._setupSocialEvents.bind(i)).social.authenticate("facebook",!0,{userName:i.$form.find("#authentication_facebook_username").val()});break;case"loginOrRegister":h.add(),t.ajax({data:c,dataType:"json",type:"POST",url:r.user.urls.checkEmail}).done(function(t){if(t.success){var e=t.taken?"signin_started":"registration_started";i._trackCustomEvent("enterData","email|"+e),i._show(t.taken?"login":"register")}else i._displayError(t.error);i.$modal.find("#authentication_csrf").val(t.csrf),h.remove()});break;case"register":h.add(),t.ajax({data:c,dataType:"json",type:"POST",url:r.user.urls.register}).done(function(e){e.success?(i._loadUserData(),a.isEspanol()?(i._close(),i._completeLogin()):i._show("interests"),i._newsletterSubscribe(),o.trackCustomEvent("trackRegistration",t.extend(!0,{},i._baseTrackingData,{userid:r.tracking.data.userId,regService:i.regService,regDriver:i.entryPoints[i.appId],userState:"authenticated",userType:"registered",clickGenericText:"email_opt_in|"+i.termsChecked}),"confirmRegistration")):(i._displayError(e.error),"inuse.userName"===e.error?i._trackCustomEvent("enterData","username|taken"):"invalid.email"===e.error&&i._trackCustomEvent("enterData","email|invalid")),i.$modal.find("#authentication_csrf").val(e.csrf),h.remove()});break;case"interests":h.add();var p=i.$form.find("[data-interest]."+i.options.classSelected).get().reduce(function(e,n){var s=t(n).data("interest");e.interests.push(s.interest),e.newsletters.push(s.newsletter);let a={id:s.id,name:s.tracking,type:"broad"};return i.getUserData(function(t,e){let i=l.createExplicitInterestObject("follow",a,e);l.writeExplicitInterestToLocalStorage(i)}),window.UA.then(function(t){t.channel&&t.channel.tags&&t.channel.tags.add(a.name.toUpperCase(),l.getTagGroupByInterest(a.type))}),e},{interests:[],newsletters:[]});i._trackCustomEvent("tap","submit_interest|"+p.interests.length),i.getUserData(function(e,n){t.ajax({data:{interests:p.interests.join(","),newsletters:p.newsletters.join(","),regId:n.registrationId},dataType:"json",type:"POST",url:r.user.urls.interests}).done(function(t){t.success?(i._close(),i._completeLogin()):i._displayError(t.error),i.$modal.find("#authentication_csrf").val(t.csrf),h.remove()})});break;case"login":h.add(),t.ajax({data:c,dataType:"json",type:"POST",url:r.user.urls.login}).done(function(t){t.success?(i._close(),i._loadUserData(),i._completeLogin()):(i._displayError(t.error),"invalid.loginpassword"===t.error&&i._trackCustomEvent("enterData","password|wrong")),i.$modal.find("#authentication_csrf").val(t.csrf),h.remove()});break;case"forgot":i._close();break;case"username":h.add(),t.ajax({data:c,dataType:"json",type:"POST",url:r.user.urls.username}).done(function(t){t.success?(i._close(),i._loadUserData(),i._completeLogin()):(i._displayError(t.error),"inuse.userName"===t.error&&i._trackCustomEvent("enterData","username|taken")),h.remove()});break;default:e.log("Current step not recognized.")}},placeError:function(t,e){e.is(":checkbox, :radio")&&e.parent("label").length?t.insertBefore(e.parent("label")):t.insertBefore(e)},errorAdded:function(t,e){"email"===e.name?i._trackCustomEvent("enterData","email|invalid"):"validPassword"===e.name?i._trackCustomEvent("enterData","password|invalid"):"usernameSpecialCharacters"!==e.name&&"usernameCharacterLength"!==e.name||i._trackCustomEvent("enterData","username|invalid")}}))},_setupPageEvents:function(){var e=this;this.$document.on("keydown","[data-authentication]",function(i){if(13===i.keyCode||32===i.keyCode){i.preventDefault();var n=t(this).data("authentication");e._setupEntryPoints(n)}}),this.$document.on("tap","[data-authentication]",function(i){var n=t(this).data("authentication");e._setupEntryPoints(n)}),this.$document.on("tap",'[data-user-action="logout"]',function(i){"true"===t('[data-user-action="logout"]').attr("data-user-suppress-refresh")&&i.preventDefault(),l.repopulateInterestDB(function(){e.logout()},!0)})},_setupEntryPoints:function(t){var e=this;t.appId&&(e.appId=t.appId),"boolean"==typeof t.refresh&&(e.refresh=t.refresh),e.socialRegistration=!1,e._trackCustomEvent("tap","start_authentication"),e.getUserData(function(i,n){n.isLoggedIn&&t.requireUsername&&!n.userName?e._show("username"):e._show("start")})},_setupSocialEvents:function(e){var i=this;e.common.addEventListener(URS.events.AUTH_COMPLETE,function(e,n){if(n.response.status.errors&&n.response.status.errors.length>0){var l=t.map(n.response.status.errors,function(t,e){return t.applicationCode});l.indexOf("invalid.noLink")>=0?(i.socialRegistration=!0,i._show("facebookRegister"),i._trackCustomEvent("enterData","facebook_credentials|registration_started")):(i._displayError(l[0]),l.indexOf("required.email")>=0&&i.$modal.find("._facebookRegister").addClass("failed"),l.indexOf("inuse.userName")>=0&&i._trackCustomEvent("enterData","username|taken"))}else s.write(i.options.cookieUserRecognized,JSON.stringify({username:n.response.receipt.account.displayName,socialSite:n.response.socialSite}),{expires:365}),t.post("/user/social-login/",{email:n.response.receipt.account.emailAddress},function(e){"success"===e.status&&(i._loadUserData(),i.socialRegistration&&!a.isEspanol()?(o.trackCustomEvent("trackRegistration",t.extend(!0,{},i._baseTrackingData,{userid:r.tracking.data.userId,regService:"facebook",regDriver:i.entryPoints[i.appId],userState:"authenticated",userType:"registered",clickGenericText:"email_opt_in|"+i.termsChecked}),"confirmRegistration"),i._show("interests")):(i._close(),i._completeLogin()),i._newsletterSubscribe())},"json")})},_show:function(e){var i=this;if(!this.loading)if(["start","username"].indexOf(e)>=0)this.loading=!0,this.$modal&&this.$modal.remove(),t.ajax({url:r.user.urls.modal}).done(function(s){i.$modal=t(s.html).addClass("appId"+i.appId).appendTo(t("body")),i._setStep(e),i.$form=i.$modal.find("form"),n.process(i.$modal),i._setupModalEvents(),i.loading=!1,t(window).trigger("authenticationLoaded")});else{this.$form.data("formValidate").removeGlobalErrors();var s=100*(3*this.$modal.find("._"+this.step)[0].children.length+5);setTimeout(function(){i._setStep(e)},s),i._fadeOutStep()}},_updateDisplay:function(){var e=this,i=t("body");this.userData.isLoggedIn?(t("[data-user-var]").each(function(){var i=t(this),n=i.data("userVar"),s=i.data("userVarAttr"),a=e.userData[n];"userName"===n?(a||(a=e.userData.displayName),a.length>13&&"mobile"==r.device?a=a.substr(0,13)+"...":a.length>25&&(a=a.substr(0,22)+"...")):"profileLink"===n&&(s="href",a=i.attr("data-template").replace("__username__",e.userData.userName?e.userData.userName.replace(/ /g,"+").toLowerCase():e.userData.registrationId)),a&&(s?i.attr(s,a):"avatar"===n?i.html('<img class="avatarImg" src="'+a+'" />'):i.text(a))}),i.addClass("is-logged-in").removeClass("not-logged-in")):(t("[data-user-var]").each(function(){var i=t(this),n=i.data("userVar"),s=i.data("userVarAttr"),a=e.userData[n];"userName"===n?a=" ":"profileLink"===n&&(s="href",a="#"),a&&(s?i.attr(s,a):"avatar"===n?i.find("img").remove():i.text(a))}),i.removeClass("is-logged-in").addClass("not-logged-in"),t(".loggedIn .navMenu").removeClass("is-expanded").addClass("is-collapsed"),t(".c-siteHeader").removeClass("is-expanded").addClass("is-collapsed"),t("body").removeClass("nav-open").addClass("nav-closed"))},_newsletterSubscribe:function(){var i=this;i.termsChecked&&i.getUserData(function(n,s){s.isLoggedIn?t.ajax({data:{newsletters:i.newsletterCodes[i.appId],regId:s.registrationId},dataType:"json",type:"POST",url:r.user.urls.newsletters}).done(function(t){t.success?e.log("Successfully subscribed user to eCodes: "+i.newsletterCodes[i.appId]):e.log("Failed to subscribe user to newsletters.")}):e.log("Cannot subscribe to newsletters: User must be logged in.")})},_checkForOpenLoginOnLoad:function(){"1"==c.getParam("openLogin")&&t("[data-authentication]").first().trigger("tap")},_trackCustomEvent:function(i,n){e.log("Track custom event: "+i),r.tracking.data,o.trackCustomEvent(i,t.extend(!0,{},this._baseTrackingData,{clickGenericText:n,regService:this.regService,regDriver:this.entryPoints[this.appId]}),"trackClick")}})}),define("fly/utils/data-selector-1.0",["jquery"],function(t){t.extend(t.expr[":"],{data:t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}})})}),define("components/tabs-modal",["jquery","managers/tealium","managers/page-vars","version!fly/components/base","version!fly/utils/data-selector"],function(t,e,i){t.widget("cnet.tabsModal",t.fly.base,{options:{classOverlay:"loadingArea",classSelected:"selected",classOpen:"modalopen",closeModalSelector:'[data-item="close"]',enableDeselect:!1,enableEsc:!1,idOverlay:"bodyWrapper",notRoadshow:!1,selectorFocus:'[data-item="focus"]',tabSelector:'[data-item="trigger"]',closeOnScroll:!1},$currentTab:null,_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},_create:function(){var t=this.options,e={},i=this;this._setup(),e["click "+t.tabSelector]="_handleClick",this._on(this.$element,e),this.$element.on("click",this.options.closeModalSelector,function(){i._hide(i.$currentTab)}),this.options.enableEsc&&this.$element.on("keydown",function(t){27===t.keyCode&&(t.preventDefault(),i._hide(i.$currentTab))})},_handleClick:function(e){var i=this.options,n=t(e.target).closest(i.tabSelector);e.preventDefault(),this.change(n)},_handleScroll:function(){this.$window.off("scroll.tabsModal"),this._hide(this.$currentTab)},_getContent:function(e){var i,n=e.data()||{},s=n.$content||[];return s.length?s:(i=n.target||e.attr("href"),s=t(i),e.data("$content",s),s)},_show:function(i){var n,s=this.options,a=this;if(!1!==this._trigger("show",null,{$tab:i})){this.$currentTab=i,n=this._getContent(i),t("html").addClass("scrollDisabled"),i.addClass(s.classSelected),n.addClass(s.classSelected),this._trigger("shown",null,{$tab:i,$content:n});var r="false"===i.attr("aria-expanded");i.attr("aria-expanded",r),n.attr("aria-hidden",!r),this.showOverlay();var o=t.extend(a._baseTrackingData,{clickGenericText:a.$currentTab.data("clicktracking")+"|open"});e.trackCustomEvent(a.$currentTab.data("eventName"),o,"trackClick"),setTimeout(function(){n.find(a.options.selectorFocus).focus()},300),s.closeOnScroll&&this.$window.on("scroll.tabsModal",this._handleScroll.bind(this))}},_hide:function(i){var n,s=this.options;if(!1!==this._trigger("hide",null,{$tab:i})){n=this._getContent(i),i.removeClass(s.classSelected),n.removeClass(s.classSelected),t("html").removeClass("scrollDisabled"),this._trigger("hidden",null,{$tab:i,$content:n});var a="false"===i.attr("aria-expanded");if(i.attr("aria-expanded",a),n.attr("aria-hidden",!a),this.hideOverlay(),this.$currentTab){var r=t.extend(this._baseTrackingData,{clickGenericText:this.$currentTab.data("clicktracking")+"|close"});e.trackCustomEvent(this.$currentTab.data("eventName"),r,"trackClick")}this.$currentTab=null}},change:function(t){var e,i=this.options;e=this.$element.find(i.tabSelector+"."+i.classSelected),t.data(),t.hasClass(i.classSelected)?i.enableDeselect&&this._hide(e):(this._hide(e),this._show(t))},showOverlay:function(){var e=t("<div>",{id:this.options.idOverlay,class:this.options.classOverlay});this.options.notRoadshow?t("#rbHeader").addClass(this.options.classOpen):t(".autoHeader").addClass(this.options.classOpen),t("body").append(e);var i=this;e.on("click",function(){i.change(t(i.options.tabSelector+"."+i.options.classSelected,i.$element))})},hideOverlay:function(){t(".autoHeader").removeClass(this.options.classOpen),t("#rbHeader").removeClass(this.options.classOpen),t("#"+this.options.idOverlay).remove()}})}),define("components/site-header",["jquery","managers/client-storage","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(t,e,i,n,s){i=i.init("siteHeader"),t.widget("cnet.siteHeader",t.fly.base,{options:{classExpanded:"is-expanded",classCollapsed:"is-collapsed",classScreenRead:"-srOnly",selectorNav:".c-siteHeader",classLink:".menuList_link",selectorMenuContainer:'[data-item="menuContainer"]',storageName:"cnet_header_new_tag"},_baseTrackingData:{_pageTitle:s.tracking.data._pageTitle,siteSection:s.tracking.data.siteSection,pageType:s.tracking.data.pageType,siteEdition:s.tracking.data.siteEdition,siteType:s.tracking.data.siteType,siteHier:s.tracking.data.siteHier,brand:s.tracking.data.brand,_pageChannelType:s.tracking.data._pageChannelType},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var i=this,n=i.options,s=t(".search .navMenuItem"),a=this.$element.find('[data-item="menuItem"]'),r=this.$element.find(n.selectorMenuContainer),o=t(n.selectorNav),l=t(n.classLink);s.on("click",function(){setTimeout(function(){t("[data-search-input]").focus()},200)}),a.on("click",function(s){if(s.preventDefault(),t(s.currentTarget).closest(n.selectorMenuContainer).hasClass(n.classExpanded))t(s.currentTarget).closest(n.selectorMenuContainer).removeClass(n.classExpanded).addClass(n.classCollapsed),i._trackEvent("navClick",o.attr("section")+"|"+t(s.currentTarget).closest(n.selectorMenuContainer).attr("section")+"|close");else{for(var a=0;a<r.length;a++)r.eq(a).hasClass(n.classExpanded)&&r.eq(a).removeClass(n.classExpanded).addClass(n.classCollapsed);if(t(s.currentTarget).closest(n.selectorMenuContainer).removeClass(n.classCollapsed).addClass(n.classExpanded),i._trackEvent("navClick",o.attr("section")+"|"+t(s.currentTarget).closest(n.selectorMenuContainer).attr("section")+"|open"),"reviews"===t(s.currentTarget).closest(n.selectorMenuContainer).attr("section")){var l=e.read(i.options.storageName);l>=3?i.$element.find("[data-new-flag]").addClass("hidden"):l?e.write(i.options.storageName,parseInt(l,10)+1):e.write(i.options.storageName,1)}}}),a.on("keydown",function(e){switch(e.which){case 38:e.preventDefault(),t(e.currentTarget).closest(n.selectorMenuContainer).removeClass(n.classExpanded).addClass(n.classCollapsed);break;case 32:e.preventDefault(),t(e.currentTarget).trigger("click");break;case 40:if(e.preventDefault(),"searchMenuItem"===e.currentTarget.id)t(e.currentTarget).trigger("click");else{for(var i=0;i<r.length;i++)r.eq(i).hasClass(n.classExpanded)&&r.eq(i).removeClass(n.classExpanded).addClass(n.classCollapsed);t(e.currentTarget).closest(n.selectorMenuContainer).removeClass(n.classCollapsed).addClass(n.classExpanded)}break;case 27:e.preventDefault();for(var s=0;s<r.length;s++)r.eq(s).hasClass(n.classExpanded)&&r.eq(s).removeClass(n.classExpanded).addClass(n.classCollapsed)}}),t(this.$element).on("keydown",function(e){9===e.keyCode&&t(e.currentTarget).addClass(n.classScreenRead)}),t(this.$element).on("click",function(e){t(e.currentTarget).removeClass(n.classScreenRead)}),t(this.$element.nextAll()).click(function(){for(var t=0;t<r.length;t++)r.eq(t).hasClass(n.classExpanded)&&r.eq(t).removeClass(n.classExpanded).addClass(n.classCollapsed)}),l.on("click",function(e){i._trackEvent("navLinkClick",o.attr("section")+"|"+t(e.currentTarget).closest(n.selectorMenuContainer).attr("section")+"|"+t(e.currentTarget).text().replace(" ","-"))})},_trackEvent:function(e,i){n.trackCustomEvent(e,t.extend(this._baseTrackingData,{clickGenericText:i}),"trackClick")}})}),define("components/auto-suggest",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(t,e,i,n){e=e.init("autoSuggest"),t.widget("cnet.autoSuggest",t.fly.base,{options:{limit:null,classMenuShow:"active",classOpen:"open",classReady:"ready",classSelected:"selected",selectorMenu:".menuWrapper",selectorSuggestions:"li:not(.hed)",url:"/autosuggest/xhr/",showLimit:10,clickable:!1},suggestXhr:null,$searchBox:null,$submitButton:null,_didTrackEnterSubmit:!1,_baseTrackingData:{_pageTitle:n.tracking.data._pageTitle,siteSection:n.tracking.data.siteSection,pageType:n.tracking.data.pageType,siteEdition:n.tracking.data.siteEdition,siteType:n.tracking.data.siteType,siteHier:n.tracking.data.siteHier,brand:n.tracking.data.brand,_pageChannelType:n.tracking.data._pageChannelType},_create:function(){this._setup(),this.$searchBox=this.$element.find("input"),this.$submitButton=this.$element.find('[type="submit"]'),this.$siteHeader=t("#rbHeader"),this._setupEvents(),this._setupTracking()},_setupEvents:function(){var e=this;this.$element.on("submit",function(i){var n=t(e.options.selectorSuggestions,e.$element).filter("."+e.options.classSelected),s=n.text(),a=n.attr("href");a?(i.preventDefault(),window.location.href=a):s&&e.$searchBox.val(s)}),this.$element.on("mousedown",this.options.selectorSuggestions,function(i){var n=t(this).attr("href");if(n)window.location=n;else{var s=t(e.options.selectorSuggestions,e.$element).filter("."+e.options.classSelected);""!==s.text()&&s.removeClass(e.options.classSelected),e._submitAutoSuggest(i)}}),this.$searchBox.on("focusout",function(i){0==t(i.relatedTarget).closest(".menuWrapper").length&&e._hideAutoSuggest()}),this.$searchBox.on("keyup",function(t){t.which>=37&&t.which<=40||e._doAutoSuggest()}),this.$searchBox.on("keydown",function(t){t.which>=37&&t.which<=40&&e._doArrowKey(t)}),t('[data-component="siteHeader"]').on("siteheadersectionchange",function(){e._updateSmartSearchTracking()}),t("#searchMenu [data-searchoverlay]").on("click",function(){e.$siteHeader.hasClass("showSearch")&&e.$siteHeader.removeClass("showSearch")})},_doAutoSuggest:function(){var i=this,n=i.options;if(i.suggestXhr&&4!=i.suggestXhr.readyState&&0!==i.suggestXhr.readyState&&i.suggestXhr.abort(),""!==i.$searchBox.val()){var s=n.url+"?query="+i.$searchBox.val();n.limit&&(s=s+"&limit="+n.limit),n.showLimit&&(s=s+"&showLimit="+n.showLimit),e.log("AutoSuggestXHR: ",s),this.$submitButton.addClass(this.options.classReady),this.$searchBox.addClass(this.options.classReady),!1===this.options.clickable&&!this.$siteHeader.hasClass("showSearch")&&this.$siteHeader.addClass("showSearch"),i.suggestXhr=t.ajax({url:s,dataType:"json",context:document.body}).done(function(e){i.$element.addClass(n.classMenuShow);var s=t(t.parseHTML(t.trim(e.html)));t(n.selectorSuggestions,s).length>0?(0===t(n.selectorMenu,i.$element).length?s.appendTo(i.$element):t(n.selectorMenu,i.$element).replaceWith(s),i._setupAdditionalResults()):(i._hideAutoSuggest(),t(n.selectorMenu,i.$element).html(""))}).fail(function(){i._hideAutoSuggest()})}else i._hideAutoSuggest(),t(n.selectorMenu,i.$element).html(""),this.$siteHeader.hasClass("showSearch")&&this.$siteHeader.removeClass("showSearch"),this.$submitButton.removeClass(this.options.classReady),this.$searchBox.removeClass(this.options.classReady)},_doArrowKey:function(e){var i=t(this.options.selectorSuggestions,this.$element),n=i.filter("."+this.options.classSelected),s=i.index(n);if(38===e.which)n.removeClass(this.options.classSelected),s<=0?i.last().addClass(this.options.classSelected):i.eq(s-1).addClass(this.options.classSelected);else if(40===e.which)n.removeClass(this.options.classSelected),s<0||s===i.length-1?i.first().addClass(this.options.classSelected):i.eq(s+1).addClass(this.options.classSelected);else if(37===e.which||39===e.which){var a=n.closest("[data-additional-results]");a.length>0&&this._toggleAdditionalResults(this.$element.find("[data-additional-results]"),a,39===e.which)}},_hideAutoSuggest:function(){var t=this.options;this.$element.removeClass(t.classMenuShow)},_updateSmartSearchTracking:function(){var e=t("#searchTab [data-searchtracking]");if(e.length>0){var i=t("#rbHeader > nav[section]").attr("section")?t("#rbHeader > nav[section]").attr("section"):"";e.attr("section",i)}},_submitAutoSuggest:function(e){var n=t(e.target),s=n.text();i.trackSuggestedSearch({searchTerm:s,dwLinkTag:"search|suggestedSearch|"+n.prevAll().length}),this.$searchBox.val(s),this.$element.submit()},_setupAdditionalResults:function(){var e=this,i=this.$element.find("[data-additional-results]");i.each(function(n,s){var a=t(s);a.find('[data-auto-suggest-item="trigger"]').on("click",function(){e._toggleAdditionalResults(i,a)})})},_toggleAdditionalResults:function(e,i,n){var s=this,a=i.find('[data-auto-suggest-item="container"]');a.html()?i.toggleClass(function(t,e,i){return i||a.find("."+s.options.classSelected).removeClass(s.options.classSelected),s.options.classOpen},n):!1!==n&&t.ajax({dataType:"json",type:"GET",url:i.data("additionalResults")}).done(function(t){t.html&&(a.html(t.html),i.addClass(s.options.classOpen))}),e.not(i).removeClass(this.options.classOpen)},_setupTracking:function(){e.log("Setting up Smart Search tracking");var i=this,n=i.$element,s=n.find('input[type="search"]'),a=n.find(".submit");t('[data-target="#search"]'),s.on("keydown.smartSearchTracking",function(t){13===t.keyCode&&(i._trackSubmit("enter"),i._didTrackEnterSubmit=!0)}),a.on("click.smartSearchTracking",function(){i._didTrackEnterSubmit||i._trackSubmit("button")}),n.on("click",'[data-smartsearch="seeall"]',function(){i._didTrackEnterSubmit||i._trackSubmit("seeall")}),n.on("click.smartSearchTrackingMakeAndModel",".makesAndModels a",function(e){i._trackMakeModelClick(t(this))}),n.on("click.smartSearchTrackingContent",".results a",function(e){i._trackContentLinkClick(t(this))})},_trackSubmit:function(n){e.log("Track submit with "+n);var s=this.$element.find('input[type="search"]').val();e.log("Typed text: "+s);var a="search|submit|"+n;this.$element.find("button[data-smartsearch]").attr("data-smartsearch")&&(a="brand_nav|"+(this.$siteHeader.hasClass("fixed")?"popup":"top")+"|search|typed|"+n),i.trackCustomEvent("searchSubmit",t.extend(this._baseTrackingData,{_searchTerm:s.toLowerCase(),clickGenericText:a}),"trackClick")},_trackMakeModelClick:function(n){e.log("Track make and model click");var s=n.text(),a=(t('.autoHeader input[type="search"]').val(),"search|suggested"+n.attr("data-category")+"|"+(n.parent().index()+1)),r=t.extend(this._baseTrackingData,{searchTerm:s.toLowerCase(),clickGenericText:a});i.trackCustomEvent("searchResultClick",r,"trackClick")},_trackContentLinkClick:function(n){e.log("Track content link click");var s=t('.autoHeader input[type="search"]').val(),a="search|suggestedContent|"+(n.parent().index()+1);i.trackCustomEvent("searchResultClick",t.extend(this._baseTrackingData,{searchTerm:s,clickGenericText:a}),"trackClick")}})}),define("components/lazyload-component",["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/components/base"],function(t,e,i){e=e.init("lazyloadComponent"),t.widget("cnet.lazyloadComponent",t.fly.base,{options:{endpoint:"",slug:"",view:"",familyName:"",typeName:"",limit:""},_create:function(){this._setup();var i=this.options.endpoint+"?endpoint=%2Fapi%2Fcomponent%2Fcomponent%2F"+this.options.slug+"&view="+this.options.view+"&familyName="+this.options.familyName+"&typeName="+this.options.typeName;""!==this.options.limit&&(i+="&limit="+this.options.limit),e.log("URL: ",i),t.ajax({url:i,dataType:"json",context:{context:this}}).done(this._onSuccess).fail(this._onError)},_onSuccess:function(e){"use strict";var n=this.context.$element,s=t(t.parseHTML(t.trim(e.component.html)));n.append(s),n.removeClass("hide"),n.addClass("show"),i.process(n)},_onError:function(){}})}),function(){"use strict";var t=0,e={};function i(n){if(!n)throw new Error("No options passed to Waypoint constructor");if(!n.element)throw new Error("No element option passed to Waypoint constructor");if(!n.handler)throw new Error("No handler option passed to Waypoint constructor");this.key="waypoint-"+t,this.options=i.Adapter.extend({},i.defaults,n),this.element=this.options.element,this.adapter=new i.Adapter(this.element),this.callback=n.handler,this.axis=this.options.horizontal?"horizontal":"vertical",this.enabled=this.options.enabled,this.triggerPoint=null,this.group=i.Group.findOrCreate({name:this.options.group,axis:this.axis}),this.context=i.Context.findOrCreateByElement(this.options.context),i.offsetAliases[this.options.offset]&&(this.options.offset=i.offsetAliases[this.options.offset]),this.group.add(this),this.context.add(this),e[this.key]=this,t+=1}i.prototype.queueTrigger=function(t){this.group.queueTrigger(this,t)},i.prototype.trigger=function(t){this.enabled&&this.callback&&this.callback.apply(this,t)},i.prototype.destroy=function(){this.context.remove(this),this.group.remove(this),delete e[this.key]},i.prototype.disable=function(){return this.enabled=!1,this},i.prototype.enable=function(){return this.context.refresh(),this.enabled=!0,this},i.prototype.next=function(){return this.group.next(this)},i.prototype.previous=function(){return this.group.previous(this)},i.invokeAll=function(t){var i=[];for(var n in e)i.push(e[n]);for(var s=0,a=i.length;s<a;s++)i[s][t]()},i.destroyAll=function(){i.invokeAll("destroy")},i.disableAll=function(){i.invokeAll("disable")},i.enableAll=function(){i.invokeAll("enable")},i.refreshAll=function(){i.Context.refreshAll()},i.viewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight},i.viewportWidth=function(){return document.documentElement.clientWidth},i.adapters=[],i.defaults={context:window,continuous:!0,enabled:!0,group:"default",horizontal:!1,offset:0},i.offsetAliases={"bottom-in-view":function(){return this.context.innerHeight()-this.adapter.outerHeight()},"right-in-view":function(){return this.context.innerWidth()-this.adapter.outerWidth()}},window.Waypoint=i}(),function(){"use strict";function t(t){window.setTimeout(t,1e3/60)}var e=0,i={},n=window.Waypoint,s=window.onload;function a(t){this.element=t,this.Adapter=n.Adapter,this.adapter=new this.Adapter(t),this.key="waypoint-context-"+e,this.didScroll=!1,this.didResize=!1,this.oldScroll={x:this.adapter.scrollLeft(),y:this.adapter.scrollTop()},this.waypoints={vertical:{},horizontal:{}},t.waypointContextKey=this.key,i[t.waypointContextKey]=this,e+=1,this.createThrottledScrollHandler(),this.createThrottledResizeHandler()}a.prototype.add=function(t){var e=t.options.horizontal?"horizontal":"vertical";this.waypoints[e][t.key]=t,this.refresh()},a.prototype.checkEmpty=function(){var t=this.Adapter.isEmptyObject(this.waypoints.horizontal),e=this.Adapter.isEmptyObject(this.waypoints.vertical);t&&e&&(this.adapter.off(".waypoints"),delete i[this.key])},a.prototype.createThrottledResizeHandler=function(){var t=this;function e(){t.handleResize(),t.didResize=!1}this.adapter.on("resize.waypoints",function(){t.didResize||(t.didResize=!0,n.requestAnimationFrame(e))})},a.prototype.createThrottledScrollHandler=function(){var t=this;function e(){t.handleScroll(),t.didScroll=!1}this.adapter.on("scroll.waypoints",function(){t.didScroll&&!n.isTouch||(t.didScroll=!0,n.requestAnimationFrame(e))})},a.prototype.handleResize=function(){n.Context.refreshAll()},a.prototype.handleScroll=function(){var t={},e={horizontal:{newScroll:this.adapter.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.adapter.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}};for(var i in e){var n=e[i],s=n.newScroll>n.oldScroll?n.forward:n.backward;for(var a in this.waypoints[i]){var r=this.waypoints[i][a],o=n.oldScroll<r.triggerPoint,l=n.newScroll>=r.triggerPoint;(o&&l||!o&&!l)&&(r.queueTrigger(s),t[r.group.id]=r.group)}}for(var d in t)t[d].flushTriggers();this.oldScroll={x:e.horizontal.newScroll,y:e.vertical.newScroll}},a.prototype.innerHeight=function(){return this.element==this.element.window?n.viewportHeight():this.adapter.innerHeight()},a.prototype.remove=function(t){delete this.waypoints[t.axis][t.key],this.checkEmpty()},a.prototype.innerWidth=function(){return this.element==this.element.window?n.viewportWidth():this.adapter.innerWidth()},a.prototype.destroy=function(){var t=[];for(var e in this.waypoints)for(var i in this.waypoints[e])t.push(this.waypoints[e][i]);for(var n=0,s=t.length;n<s;n++)t[n].destroy()},a.prototype.refresh=function(){var t,e=this.element==this.element.window,i=this.adapter.offset(),n={};for(var s in this.handleScroll(),t={horizontal:{contextOffset:e?0:i.left,contextScroll:e?0:this.oldScroll.x,contextDimension:this.innerWidth(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:e?0:i.top,contextScroll:e?0:this.oldScroll.y,contextDimension:this.innerHeight(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}}){var a=t[s];for(var r in this.waypoints[s]){var o,l,d,u,c=this.waypoints[s][r],h=c.options.offset,p=c.triggerPoint,g=0,f=null==p;c.element!==c.element.window&&(g=c.adapter.offset()[a.offsetProp]),"function"==typeof h?h=h.apply(c):"string"==typeof h&&(h=parseFloat(h),c.options.offset.indexOf("%")>-1&&(h=Math.ceil(a.contextDimension*h/100))),o=a.contextScroll-a.contextOffset,c.triggerPoint=g+o-h,l=p<a.oldScroll,d=c.triggerPoint>=a.oldScroll,u=!l&&!d,!f&&(l&&d)?(c.queueTrigger(a.backward),n[c.group.id]=c.group):!f&&u?(c.queueTrigger(a.forward),n[c.group.id]=c.group):f&&a.oldScroll>=c.triggerPoint&&(c.queueTrigger(a.forward),n[c.group.id]=c.group)}}for(var v in n)n[v].flushTriggers();return this},a.findOrCreateByElement=function(t){return a.findByElement(t)||new a(t)},a.refreshAll=function(){for(var t in i)i[t].refresh()},a.findByElement=function(t){return i[t.waypointContextKey]},window.onload=function(){s&&s(),a.refreshAll()},n.requestAnimationFrame=function(e){(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||t).call(window,e)},n.Context=a}(),function(){"use strict";function t(t,e){return t.triggerPoint-e.triggerPoint}function e(t,e){return e.triggerPoint-t.triggerPoint}var i={vertical:{},horizontal:{}},n=window.Waypoint;function s(t){this.name=t.name,this.axis=t.axis,this.id=this.name+"-"+this.axis,this.waypoints=[],this.clearTriggerQueues(),i[this.axis][this.name]=this}s.prototype.add=function(t){this.waypoints.push(t)},s.prototype.clearTriggerQueues=function(){this.triggerQueues={up:[],down:[],left:[],right:[]}},s.prototype.flushTriggers=function(){for(var i in this.triggerQueues){var n=this.triggerQueues[i],s="up"===i||"left"===i;n.sort(s?e:t);for(var a=0,r=n.length;a<r;a+=1){var o=n[a];(o.options.continuous||a===n.length-1)&&o.trigger([i])}}this.clearTriggerQueues()},s.prototype.next=function(e){this.waypoints.sort(t);var i=n.Adapter.inArray(e,this.waypoints);return i===this.waypoints.length-1?null:this.waypoints[i+1]},s.prototype.previous=function(e){this.waypoints.sort(t);var i=n.Adapter.inArray(e,this.waypoints);return i?this.waypoints[i-1]:null},s.prototype.queueTrigger=function(t,e){this.triggerQueues[e].push(t)},s.prototype.remove=function(t){var e=n.Adapter.inArray(t,this.waypoints);e>-1&&this.waypoints.splice(e,1)},s.prototype.first=function(){return this.waypoints[0]},s.prototype.last=function(){return this.waypoints[this.waypoints.length-1]},s.findOrCreate=function(t){return i[t.axis][t.name]||new s(t)},n.Group=s}(),function(){"use strict";var t=window.jQuery,e=window.Waypoint;function i(e){this.$element=t(e)}t.each(["innerHeight","innerWidth","off","offset","on","outerHeight","outerWidth","scrollLeft","scrollTop"],function(t,e){i.prototype[e]=function(){var t=Array.prototype.slice.call(arguments);return this.$element[e].apply(this.$element,t)}}),t.each(["extend","inArray","isEmptyObject"],function(e,n){i[n]=t[n]}),e.adapters.push({name:"jquery",Adapter:i}),e.Adapter=i}(),function(){"use strict";var t=window.Waypoint;function e(e){return function(){var i=[],n=arguments[0];return e.isFunction(arguments[0])&&((n=e.extend({},arguments[1])).handler=arguments[0]),this.each(function(){var s=e.extend({},n,{element:this});"string"==typeof s.context&&(s.context=e(this).closest(s.context)[0]),i.push(new t(s))}),i}}window.jQuery&&(window.jQuery.fn.waypoint=e(window.jQuery)),window.Zepto&&(window.Zepto.fn.waypoint=e(window.Zepto))}(),define("libs/waypoints/jquery.waypoints-3.1.1",function(){}),define("fly/libs/jquery.throttle-debounce-1.1",["jquery"],function(t){var e;t.throttle=e=function(e,i,n,s){var a,r=0;function o(){var t=this,o=+new Date-r,l=arguments;function d(){r=+new Date,n.apply(t,l)}s&&!a&&d(),a&&clearTimeout(a),void 0===s&&o>e?d():!0!==i&&(a=setTimeout(s?function(){a=void 0}:d,void 0===s?e-o:e))}return"boolean"!=typeof i&&(s=n,n=i,i=void 0),t.guid&&(o.guid=n.guid=n.guid||t.guid++),o},t.debounce=function(t,i,n){return void 0===n?e(t,i,!1):e(t,n,!1!==i)}}),define("managers/waypoints",["jquery","version!fly/managers/debug","version!libs/waypoints/jquery.waypoints","version!fly/libs/jquery.throttle-debounce"],function(t,e){e=e.init("waypoints");var i=!1;return{init:function(){i||(i=!0,t(window).on("scroll",t.throttle(500,function(){Waypoint.refreshAll()})))}}}),define("components/taboola",["jquery","version!fly/managers/debug","managers/page-vars","managers/global-functions","managers/tealium","version!fly/utils/url-helper","managers/client-storage","managers/edition","managers/waypoints","version!fly/components/base"],function(t,e,i,n,s,a,r,o,l){e=e.init("taboola"),l.init(),i.services.taboola.enabled&&t.widget("cnet.taboola",t.fly.base,{options:{mode:null,container:null,lazyload:!1,lazyloadOffset:0,placement:null,prependPlacement:!0,targetType:"mix",url:null,pushPlacement:null,allowTargeting:!1,assetSelector:"[data-item-id]"},_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},initOptions:null,isLoaded:!1,waypoint:null,_create:function(){var n=this;if(this._super(),this.initOptions={},!this.isLoaded){var s=0<t("[data-component=videoPlayer]").length,o="off"===a.getParam("autoplayEnabled")||"off"===r.read("autoplayEnabled"),l="article"===i.pageType&&"desktop"===i.device;this.options.lazyload?this.waypoint=new Waypoint({element:this.$element,handler:function(t){n._loadTaboola(),this.destroy()},offset:this.options.lazyloadOffset}):l&&s&&!o?i.video&&i.video.performance&&(i.video.performance.adstart||i.video.performance.contentstart)?(e.log("Load Taboola; video content already started"),n._loadTaboola()):t(window).one("cnet_video.adstart cnet_video.contentstart cnet_video.error",function(t){n.isLoaded||(e.log("Load Taboola on cnet_video.adstart / cnet_video.contentstart"),n._loadTaboola())}):(e.log("Load Taboola regardless of cnet_video"),this._loadTaboola())}},_loadTaboola:function(){this.isLoaded=!0;var t=this;n.gdprConsentCallback("script_taboola",function(n,s){function a(){require([o.isEspanol()?"taboola-es":"taboola"],function(n){if(i.services.taboola&&i.services.taboola.enabled){n=window._taboola||[],e.log("Taboola widget created");var s=t.options;pageType=t._getPageType(),e.log("Taboola Page Type: "+pageType),t.initOptions[pageType]="auto",t.initOptions.visibile=!!s.mode,s.url&&(t.initOptions.url=s.url),s.pushPlacement=s.prependPlacement?i.tracking.data.pageType+" "+i.device+" "+s.placement:s.placement,t._pushTaboola(n)}else e.log("Ads disabled")})}null!=s?s.ot.targetingAllowed(function(i){t.options.allowTargeting=i,e.log("Taboola targeting is "+(i?"allowed":"not allowed")),a()}):a()},{},"targeting","Ads")},_getPageType:function(){var t={front_door:"home",article:"article",video_page:"video",image_gallery:"photo",section_door:"category",image_gallery_list:"category",search:"search",search_null:"search"},e="other";return t[i.pageType]&&(e=t[i.pageType]),e},_pushTaboola:function(t){var e=this.options;e.mode&&t.push({mode:e.mode,container:e.container,placement:e.pushPlacement,target_type:e.targetType,user_opt_out:!e.allowTargeting}),t.push(this.initOptions),t.push({listenTo:"click",handler:this._clickTracking.bind(this)})},_clickTracking:function(i){this.options,e.log("Taboola Element Clicked, Tracking Now");var n=i.detail.type;"sponsored"==n?n="paid":"organic"==n&&(n="recirc"),s.trackCustomEvent("TaboolaClick",t.extend({},this._baseTrackingData,{dwLinkTag:this._setupDwTag(this.$element)+"|"+n+"["+(i.detail.slot+1)+"]",contentWidget:this.options.container}))}})}),define("components/mobile-footer-link",["jquery","version!fly/managers/debug","managers/client-storage","utils/cookie","version!fly/components/base"],function(t,e,i,n){e=e.init("mobileFooterLink"),t.widget("cnet.mobileFooterLink",t.fly.base,{options:{},_create:function(){this._setup(),i.read("mobileRedirect")&&(this.$element.append('<li><a class="view">Switch to mobile</a></li>'),this._setEvent())},_setEvent:function(){this.$element.find("a.view").on("click",function(){n.write("fly_device","mobile"),i.erase("mobileRedirect"),window.location.reload(!0)})}})}),define("fly/components/modal-1.0",["jquery","version!fly/components/base"],function(t){var e=t.support.touch?"vclick":"click";t.widget("fly.modal",t.fly.base,{options:{content:null,position:"absolute",classModal:"modal",classBackdrop:"modal-backdrop",classShow:"show",classFixed:"fixed",enableKeyEvents:!0,openOnInit:!1,template:null},$modal:null,$backdrop:null,$body:null,isOpen:!1,eventData:{},_create:function(){var i=this.options,n="fixed"===i.position?" "+i.classFixed:"",s={},a={};this._setup(),this.$modal=this.$element.addClass(i.classModal+n),this.$backdrop=t("<div>").addClass(i.classBackdrop+n),this.$body=t(document.body),this.top=parseInt(this.$modal.css("top"),10),i.content&&this.setContent(i.content),this.eventData={$modal:this.$modal,$backdrop:this.$backdrop},s[e]="_handleClose",a[e+' [data-close="modal"]']="_handleClose",this._on(this.$backdrop,s),this._on(this.$modal,a)},_init:function(){this.options.openOnInit&&this.open()},_handleKeyboard:function(t){27==t.keyCode&&this.close()},_handleClose:function(t){t.preventDefault(),this.close()},open:function(){var t=this.options;this.isOpen||!1!==this._trigger("open",null,this.eventData)&&(this.$backdrop.addClass(t.classShow).appendTo(this.$body),this.$modal.addClass(t.classShow).appendTo(this.$body),this.position(),t.enableKeyEvents&&this._on(this.$document,{keyup:"_handleKeyboard"}),this.isOpen=!0,this._trigger("opened",null,this.eventData))},close:function(){var t=this.options;this.isOpen&&!1!==this._trigger("close",null,this.eventData)&&(this.$backdrop.removeClass(t.classShow),this.$modal.removeClass(t.classShow),this._off(this.$document,"keyup"),this.isOpen=!1,this._trigger("closed",null,this.eventData))},setContent:function(e){var i,n=this.options,s=this,a=t(e);a.hasClass(n.classModal)&&(a.removeClass(n.classModal),i=a.prop("attributes"),t.each(i,function(){"class"===this.name?s.$modal.addClass(this.value):s.$modal.attr(this.name,this.value)}),a=a.children()),this.$modal.empty().append(a),this._trigger("contentSet",null,t.extend({},this.eventData,{$modal:this.$modal,$content:a}))},position:function(){var t=this.options,e=this.$window.height(),i=isNaN(this.top)?(e-this.$modal.outerHeight())/3:this.top;i<20&&(i=20),"absolute"==t.position&&(i+=this.$window.scrollTop(),this.$backdrop.css({height:this.$document.height()})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal})},_destroy:function(){this.$backdrop.remove()}}),t(document).on(e+".modal-api.data-api",'[data-open="modal"]',function(e){var i=t(this),n=i.data(),s=n.$modal;e.preventDefault(),s||(s=t(n.target||i.attr("href")),i.data("$modal",s)),s.length&&s.modal().modal("open")})}),define("components/global-modal",["jquery","managers/tealium","managers/page-vars","version!fly/managers/components","version!fly/components/modal"],function(t,e,i,n){t.widget("cnet.globalModal",t.fly.modal,{options:{modalTemplate:'<svg class="close" data-close="modal"><use xlink:href="#close" /></svg>{{content}}',container:null,setContentOnInit:!0,trackModal:null},_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},_create:function(){var i=this,n=null;this.options.setContentOnInit||(n=this.options.content,this.options.content=null),this._super(),this.options.setContentOnInit||(this.options.content=n,this.$element.on("modalopen",function(){if(!i.options.setContentOnInit&&i.options.content&&(i.setContent(i.options.content),i.options.trackModal)){var n=t.extend({},i._baseTrackingData,{clickGenericText:i.options.trackModal+"|open"});e.trackCustomEvent("modalTracking",n,"trackClick")}})),this.$body=this.options.container?t(this.options.container):this.$body},close:function(){if(this._super(),this.options.trackModal){var i=t.extend({},this._baseTrackingData,{clickGenericText:this.options.trackModal+"|close"});e.trackCustomEvent("modalTracking",i,"trackClick")}},setContent:function(e){var i,s=this.options,a=this;if("string"==typeof e){var r=t(e);this.$modal.html(s.modalTemplate.replace("{{content}}",null!=r.context?r.html():e))}else e.hasClass(s.classModal)&&(e.removeClass(s.classModal),i=e.prop("attributes"),t.each(i,function(){"class"===this.name?a.$modal.addClass(this.value):a.$modal.attr(this.name,this.value)}),e=s.modalTemplate.replace("{{content}}",e.html())),this.$modal.empty().append(e),this._trigger("contentSet",null,t.extend({},this.eventData,{$modal:this.$modal,$content:e}));n.process(this.$element)},position:function(){var e,i,n,s,a,r,o=this.options;this.$body.is(t(document.body))?(e=this.$window.height(),n=this.$window.scrollTop(),a=this.$document.height(),r=this.$window.width()/2,s=this.$window.scrollLeft()):(e=this.$body.height(),n=this.$body.scrollTop(),a=e,r=this.$body.width()/2,s=this.$body.scrollLeft()),(i=isNaN(this.top)?(e-this.$modal.outerHeight())/2:this.top)<20&&(i=20),"absolute"==o.position&&(i+=n,this.$backdrop.css({height:a})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal}),this.$element.css("left",r+s-this.$element.outerWidth()/2)}})}),define("fly/components/modal-iframe-1.0",["jquery","version!fly/utils/object-helper","version!fly/utils/url-helper","version!fly/components/modal","version!fly/components/loading"],function(t,e,i){t.support.touch;t.widget("fly.modalIframe",t.fly.modal,{options:{url:null,requestData:{},messages:{},loader:{disabled:!1}},messenger:null,_create:function(){this._super(),this._setupLoader()},_setupLoader:function(){var e=this;this.loader=t.fly.loading(t.extend(this.options.loader,{shown:function(){e.$element.addClass(e.loader.options.classes.loading)},hidden:function(){e.$element.removeClass(e.loader.options.classes.loading)}})),this.loader.$element.appendTo(this.$element)},open:function(){this.isOpen||(this.loader.add(),this.loadContent(),this._super())},_getUrl:function(){var e=this.options,i=e.url;return e.requestData&&(i=i+(i.indexOf("?")>0?"&":"?")+t.param(e.requestData)),i},loadContent:function(){var e=this.options,i=this;this.messenger=this.$element.iframeMessenger({remoteUrl:this._getUrl(),receivableMessages:t.extend({},e.messages,{ready:function(){i._trigger("iframeReady"),i.loader.remove()},closeModal:function(){i.close()},scroll:function(e){var n=i.$element.offset().top+e.offset;n-=i.$window.height()/6,t("html, body").animate({scrollTop:n},"fast")}})})}})}),define("components/modal-iframe",["jquery","version!fly/managers/debug","version!fly/components/modal-iframe","components/loading"],function(t,e){e=e.init("modalIframe"),t.widget("fly.modalIframe",t.fly.modalIframe,{options:{modalTemplate:'<svg class="close" data-close="modal"><use xlink:href="#close" /></svg>{{content}}',loader:{classes:{loading:"loadingCircle"}}},$body:null,_create:function(){this._super(),this.$body=t(document.body),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){var e=this;this.loader=t.cnet.loading(t.extend(this.options.loader,{shown:function(){e.$element.addClass(e.loader.options.classes.loading)},hidden:function(){e.$element.removeClass(e.loader.options.classes.loading)}})),this.loader.$element.appendTo(this.$element)},open:function(){this.isOpen||(this.loader.add(),this.loadContent(),this._super(),this.centerHorizontally())},loadContent:function(){var e=this.options,i=this;this.messenger=this.$element.iframeMessenger({remoteUrl:this._getUrl(),receivableMessages:t.extend({},e.messages,{ready:function(){i._trigger("iframeReady"),i.loader.remove(),setTimeout(i.centerHorizontally.bind(i),250)},closeModal:function(){i.close()}})})},centerHorizontally:function(){this.$element.css("margin-left",-this.$element.width()/2)},position:function(){var t=this.options,e=this.$window.height(),i=isNaN(this.top)?(e-this.$modal.outerHeight())/3:this.top;i<20&&(i=20),"absolute"==t.position&&(i+=this.$window.scrollTop(),this.$backdrop.css({height:this.$document.height()})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal})}})}),define("managers/user",["jquery","components/authentication"],function(t){return t.cnet.authentication()}),define("translations/modal-email",["managers/edition"],function(t){return t.getTranslation({en:{confirmation:"Your e-mail was sent successfully!",incorrectCaptcha:"The response you entered was incorrect.  Please try again.",notice:"Keep your friends up to date on your wish list.",messageA:"Click the",messageB:"to share the products you want with your friends.",ok:"OK, Got it"},es:{confirmation:"Tu email fue enviado exitosamente!",incorrectCaptcha:"La Captcha no es correcta. Por favor, inténtalo otra vez.",notice:"Mantén a tus amigos informados sobre tu lista.",messageA:"Haz clic en el",messageB:"para que tus amigos vean los productos que quieres.",ok:"De acuerdo"}})}),define("components/modal-email",["jquery","version!fly/managers/debug","version!fly/managers/components","managers/edition","managers/user","translations/modal-email","components/global-modal","components/loading","version!fly/components/form-validate"],function(t,e,i,n,s,a){e=e.init("modalEmail"),t.widget("cnet.modalEmail",t.cnet.globalModal,{options:{emailType:"friend",pageTitle:function(){return document.title},pageUrl:function(){return window.location.href},recipientId:null,recipientName:"",messageThankYou:a.confirmation},emailTypes:{friend:{url:{us:"/email/friend/",es:"/es/email/friend/"},requireUsername:!1},friendRoadshow:{url:{us:"/email/friend/roadshow/",es:"/es/email/friend/roadshow/"},requireUsername:!1},member:{url:{us:"/email/member/",es:"/es/email/member/"},requireUsername:!0},editor:{url:{us:"/email/editor/",es:"/es/email/editor/"},requireUsername:!1},flag:{url:{us:"/email/flag/",es:"/es/email/flag/"},requireUsername:!0},video:{url:{us:"/email/video-feedback/",es:"/es/email/video-feedback/"},requireUsername:!1}},errorMessages:{"cnet.notsent":"There was an error attempting to send your e-mail.  Please try again.","cnet.nousername":"You must have a valid username to send an e-mail.","cnet.notloggedin":"You must be logged in to send an e-mail.","cnet_recaptcha.incorrect-captcha-sol":a.incorrectCaptcha,"cnet_recaptcha.missing-input-response":a.incorrectCaptcha},_create:function(){this._super(),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){this.loader=t.cnet.loading(),this.loader.$element.addClass("modal-content")},open:function(){var t=this,e=this.emailTypes[this.options.emailType];this.isOpen||(e.requireUsername?(s.hasAccess({requireUsername:!0,nextAction:function(i){t._openEmailType(e)}}),t._super()):(this._openEmailType(e),t._super()))},_openEmailType:function(e){var s=this;this.setContent(""),this.loader.$element.appendTo(this.$element),this.loader.add(),t.ajax({url:e.url[n.getEdition()],data:this.options.recipientId?{regId:this.options.recipientId}:null,dataType:"text"}).done(function(e){s.loader.remove(),s.setContent(e),s.position(),s._setupEvents(),t("[data-email-var]",s.$element).each(function(e,i){var n=t(i),a=n.data("emailVar");"pageTitle"===a?n.text(s.options.pageTitle):"recipientName"===a&&n.text(s.options.recipientName)}),t('input[name="emailFriend[pageTitle]"]',s.$element).val(s.options.pageTitle);var n="string"==typeof s.options.pageUrl?s.options.pageUrl:s.options.pageUrl();t('input[name="emailFriend[pageUrl]"]',s.$element).val(n),i.process(s.$element)}).always(function(){s.loader.remove()})},_setupEvents:function(){var e=this,i=t("form",this.$element),n=t('[data-component="recaptcha"], .g-recaptcha',e.$element),s=t('[data-email-var="error"]',i);i.formValidate({success:function(a){a.preventDefault(),t.ajax({dataType:"json",type:"POST",url:i.attr("action"),data:i.serialize()}).done(function(t){"success"===t.status?(i.html(e.options.messageThankYou),e.position()):(t.errors?s.text(t.errors[0]):s.text(e.errorMessages[t.message]),n.recaptcha("reload"))})}})}}),t(document).on("click.modalEmail-api.data-api",'[data-open="modalEmail"]',function(e){var i,n=t(this),s=n.data().$modal;e.preventDefault(),s?s.open():(i=n.data("modalEmailOptions")||n.dataPrefix("modalEmail"),n.data("$modal",t.cnet.modalEmail(t.extend(i,{openOnInit:!0,destroy:function(){n.data("$modal",null)}}))))})}),define("components/urban-airship",["jquery","version!fly/managers/debug","managers/edition","managers/page-vars","managers/global-functions","managers/tealium","managers/recommendation-data","managers/user","version!fly/components/base"],function(t,e,i,n,s,a,r,o){e=e.init("urbanAirship");var l={trackEvent:function(t,e){let i=localStorage.getItem("CnetNotificationPromptTimer");if("message"===t){if(i&&!(Date.now()-i>18e5))return;localStorage.setItem("CnetNotificationPromptTimer",Date.now())}var s=n.tracking.data;a.trackCustomEvent(t,{pageViewGuid:s.pageViewGuid,_dwAnonId:s._dwAnonId,articleId:s.articleId,clickGenericText:e,pageType:s.pageType,siteEdition:s.siteEdition,siteHier:s.siteHier,siteSection:s.siteSection},"trackClick")}};return n.services.urban_airship&&n.services.urban_airship.enabled&&s.gdprConsentCallback("script_urban_airship",function(){!function(t,e,i,n,s){var a,r,o=[],l=[],d={then:h,catch:function(t){return h(!1,t)},_async_setup:function(t){var e;try{e=t(s)}catch(t){return r=t,void c(l,t)}e.then(function(t){c(o,a=t)}).catch(function(t){r=t,c(defferedErrors,r)})}};t.UA=d;var u=e.createElement("script");function c(t,e){for(var i=0;i<t.length;i++)p(t[i],e)}function h(t,e){return t&&(a?p(t,a):o.push(t)),e&&(r?p(e,r):l.push(e)),d}function p(e,i){t.setTimeout(function(){e(i)},0)}u.src="https://aswpsdkus.com/notify/v1/ua-sdk.min.js",u.async=!0,u.id="_uasdk",u.rel="UA",e.head.appendChild(u)}(window,document,0,0,{workerUrl:"/bundles/cnetjs/js/libs/ua-push-worker.js",websitePushId:"web.com.cnet.urbanairship",appKey:"vfB_rNe6QmqG3FM6u3fQ_w",token:"MTp2ZkJfck5lNlFtcUczRk02dTNmUV93OjF4amNnZWVGZFpKeHd3R1hSSzF6N2xaZkw5clQ1ME4tQWpHUFpDRGU2Ujg",vapidPublicKey:"BLjW5aAAExzAsGPWMgbTHPM+L7ShRKV5kbcp7aCqB0VCql/4QhAKiEHVZaTMX1wDmp5OdFcnFVAJrR5rK1x173g="}),t.widget("cnet.urbanAirship",t.fly.base,{options:{},urbanAirship:null,_create:function(){var t=this;this._setup(),window.UA.then(function(e){t.urbanAirship=e,t._setupEvents(e);var s=e.permission;"default"===s&&l.trackEvent("message","notification"),t.urbanAirship.register().then(function(a){if("default"===s&&"default"!==e.permission){var d="granted"===e.permission?"opt-in":"opt-out";l.trackEvent("tap","notification|"+d)}a&&a.tags&&(i.isEspanol()?a.tags.add("Edition_ES",r.getTagGroupByInterest("general")):a.tags.add("Edition_US",r.getTagGroupByInterest("general")),a.optedIn&&a.tags&&(a.tags.add("EDITORSPICKS",r.getTagGroupByInterest("general")),"roadshow"===n.tracking.data.brand&&(a.tags.add("CARS",r.getTagGroupByInterest("broad")),r.getExplicitInterests().some(function(t){return t.implicit&&"CARS"===t.interest_name&&"broad"===t.type})||o.getUserData(function(e,i){var n=r.createNewViewEvent(i);n.broad_interest="CARS";var s=r.createImplicitInterestObject(n);t._trackEvent("background","add_interest|broad_interest|CARS"),r.writeExplicitInterestToLocalStorage(s),r.sendInterestsToBackend([s])}))))}).catch(function(){"default"===s&&"denied"===Notification.permission&&l.trackEvent("tap","notification|opt-out")})})},_setupEvents:function(e){t(window).trigger("urban-airship-loaded"),o.getUserData(function(t,e){var i=r.getViewEvents();r.triggerPeriodicBackfillSync(e,i)})}})},{},"targeting"),l}),define("managers/components.desktop",["jquery","version!fly/managers/components","version!fly/managers/debug","managers/tealium","managers/page-vars","components/authentication","components/tabs-modal","components/site-header","components/auto-suggest","components/lazyload-component","components/taboola","components/mobile-footer-link","components/global-modal","components/modal-iframe","components/modal-email","components/urban-airship"],function(t,e,i,n,s){i=i.init("componentManager");var a="uvpjs_upgrade"===s.tracking.data.testName&&"test"===s.tracking.data.testGroup;return e.register({authentication:{},tabsModal:{},siteHeader:{},autoSuggest:{},lazyloadComponent:{},taboola:{},mobileFooterLink:{},globalModal:{},modalIframe:{},modalEmail:{},accordion:{require:"version!fly/components/accordion"},addthisevent:{require:"components/add-this-event"},alert:{require:"version!fly/components/alert"},amazonAd:{require:"components/amazon-ad"},article:{require:"components/article"},audioPlayer:{require:"components/audio-player"},autoLocalPricing:{require:"components/auto-local-pricing"},backgroundVideo:{require:"components/background-video"},bestFitVideoPromo:{require:"components/best-fit-video-promo"},bestList:{require:"components/best-list"},bestListing:{require:"components/best-listing"},breakingNews:{require:"components/breaking-news"},interest:{require:"components/interest"},buyingProgram:{require:"components/buyingProgram"},carFinder:{require:"components/car-finder"},carousel:{require:"version!fly/components/carousel",options:{slidechanged:function(e){t(window).trigger("scroll")}}},carouselDesktop:{require:"components/carousel.desktop"},carouselFull:{require:"components/carousel-full"},cbsiFeedWidget:{require:"components/cbsi-feed-widget"},clipboard:{require:"components/clipboard"},commands:{require:"components/commands"},commentDownloader:{require:"components/comment-downloader"},connectComponent:{require:"components/connect-es-component"},contactUs:{require:"components/contact-us"},couponsDesktop:{require:"components/coupons-page.desktop"},dropdown:{require:"components/dropdown"},dealsActivator:{require:"components/deals-activator.desktop"},dealsUpdater:{require:"components/deals-updater"},dfllActivator:{require:"components/dfll-activator.desktop"},dfllActivatorV2:{require:"components/dfll-activator-v2.desktop"},dfllUpdater:{require:"components/dfll-updater.desktop"},dfllUpdaterV2:{require:"components/dfll-updater-v2.desktop"},displayCookie:{require:"components/display-cookie"},disqusCount:{require:"components/disqus-count"},editorsChoiceToggle:{require:"components/editors-choice-toggle"},ellipsis:{require:"components/ellipsis"},expando:{require:"components/expando"},fadeOnScroll:{require:"components/fade-on-scroll"},inlineProductCarousel:{require:"components/inline-product-carousel"},topStories:{require:"components/top-stories"},errorModal:{require:"components/error-modal"},expiredDealModal:{require:"components/expired-deal-modal.desktop"},externalLink:{require:"components/external-link"},autoCalcIframe:{require:"components/auto-calc-iframe"},fixate:{require:"components/fixate"},formAjax:{require:"components/form-ajax"},formTrim:{require:"components/form-trim"},formValidate:{require:"components/form-validate"},forumsBestAnswer:{require:"components/forums-best-answer"},forumsEditPost:{require:"components/forums-edit-post"},forumsMarkAsRead:{require:"components/forums-mark-as-read"},forumsRealtime:{require:"components/forums-realtime"},forumsPostToggle:{require:"components/forums-post-toggle"},forumsPostPreview:{require:"components/forums-post-preview"},forumsPostFlag:{require:"components/forums-post-flag"},forumsPermalink:{require:"components/forums-permalink"},forumsLoadForm:{require:"components/forums-load-form"},forumsSearchUpdater:{require:"components/forums-search-updater"},forumsTools:{require:"components/forums-tools"},forumsTrack:{require:"components/forums-track"},forumsVote:{require:"components/forums-vote"},fullScreenSlides:{require:"components/full-screen-slides"},genericTracker:{require:"components/generic-tracker"},googleCsa:{require:"components/google-csa"},howlerAudioPlayer:{require:"components/howler-audio-player"},iframeAdTracker:{require:"components/iframe-ad-tracker"},iframeHoverFix:{require:"components/iframe-hover-fix"},imageGallery:{require:"components/image-gallery"},imageGalleryAuto:{require:"components/image-gallery-auto"},imageGalleryModal:{require:"components/image-gallery-modal"},indepthReview:{require:"components/indepth-review"},instagramFetcher:{require:"components/instagram-fetcher"},interactiveFloorPlans:{require:"components/interactive-floor-plans"},interactiveFloorPlansV2:{require:"components/interactive-floor-plans-v2"},interactiveVideoPlayer:{require:"components/interactive-video-player"},inviewElement:{require:"quantum/inviewElement"},joinCnet:{require:"components/join-cnet"},lazyloadImages:{require:"components/lazyload-images"},lazyloadElement:{require:"components/lazyload-element"},leadsTracker:{require:"components/leads-tracker"},linkCallback:{require:"components/link-callback"},linkTracker:{require:"components/link-tracker"},liveStreamPlayer:{require:"components/live-stream-player"},loading:{require:"components/loading"},loadMore:{require:"components/load-more"},loadNewest:{require:"components/load-newest",options:{clickGenericText:"refresh-river"}},longform:{require:"components/longform"},modal:{require:"version!fly/components/modal"},modalEnlargeImage:{require:"components/modal-enlarge-image"},modalNewsletter:{require:"components/modal-newsletter"},moduleAssetTracker:{require:"components/module-asset-tracker"},mostPopularDeal:{require:"components/most-popular-deal.desktop"},mostPopularDealListing:{require:"components/most-popular-deal-listing.desktop",options:{contentSet:function(t){e.process(t.$content)}}},newsletterSubscription:{require:"components/newsletter-subscription"},newsCarousel:{require:"components/news-carousel"},page:{require:"components/page"},pageHeader:{require:"components/page-header"},parallaxReveal:{require:"components/parallax-reveal"},personalizedRecommendations:{require:"components/personalized-recommendations"},poll:{require:"components/poll"},pricesByZip:{require:"components/prices-by-zip"},productMediaCarousel:{require:"components/product-media-carousel"},productSeriesModal:{require:"components/product-series",options:{contentSet:function(t,i){e.process(i.$content)}}},productSpecs:{require:"components/product-specs"},productReviewVideo:{require:"components/product-review-video"},profileReauth:{require:"components/profile-reauth"},progressiveAd:{require:"components/progressive-ad"},popOnScroll:{require:"components/pop-on-scroll"},profileSubscriptions:{require:"components/profile-subscriptions",options:{contentSet:function(t){e.process(t.$content)}}},profileModal:{require:"components/profile-modal",options:{contentSet:function(t){e.process(t.$content)}}},profileUpdate:{require:"components/profile-update",options:{contentSet:function(t){e.process(t.$content)}}},profileUgc:{require:"components/profile-ugc",options:{contentSet:function(t){e.process(t.$content)}}},profileDiscussions:{require:"components/profile-discussions"},radio:{require:"components/radio"},readMore:{require:"components/read-more"},realtimeData:{require:"components/realtime-data"},realtimeDrawer:{require:"components/realtime-drawer"},realtimeTicker:{require:"components/realtime-ticker"},recaptcha:{require:"components/recaptcha"},reposition:{require:"components/reposition"},resetPassword:{require:"components/reset-password"},scrollbarArea:{require:"components/scrollbar-area"},scrollTracking:{require:"components/scroll-tracking"},searchBar:{require:"components/search-bar"},searchPagination:{require:"components/search-paginator",options:{contentSet:function(t){e.process(t.$content)}}},searchSort:{require:"components/search-sort"},selfishScroll:{require:"components/selfish-scroll"},sharebar:{require:"components/sharebar"},shortcodeGallery:{require:"components/shortcode-gallery"},shortcodeGalleryController:{require:"components/shortcode-gallery-controller"},showcaseHeroTabs:{require:"components/showcase-hero-tabs"},showcaseRailBody:{require:"components/showcase-rail-body"},showcaseVideos:{require:"components/showcase-videos"},sideNav:{require:"components/side-nav"},sideqik:{require:"components/sideqik"},slider:{require:"components/slider"},slidingElement:{require:"components/sliding-element"},snappyCarousel:{require:"quantum/snappyCarousel"},stacklaEvents:{require:"components/stackla-events"},uiSlider:{require:"version!libs/jquery/ui/jquery.ui.slider"},socialButton:{require:"version!fly/components/social-button"},socialCounts:{require:"components/social-counts"},socialMenu:{require:"components/social-menu"},socialTracking:{require:"components/social-tracking"},stickyColumn:{require:"components/sticky-column"},stickyElement:{require:"components/sticky-element"},stickyLeader:{require:"components/sticky-leader"},subratingModalToggle:{require:"components/subrating-modal-toggle"},swipeAway:{require:"quantum/swipeAway"},tableSorter:{require:"components/table-sorter"},tabs:{require:"version!fly/components/tabs"},tabsAsync:{require:"components/tabs-async",options:{contentSet:function(t){e.process(t.$content)}}},tabsRefresh:{require:"components/tabs-refresh"},tagLetterSorter:{require:"components/tag-letter-sorter"},textCounter:{require:"components/text-counter"},tileSpecialNav:{require:"components/tile-special-nav"},tocNav:{require:"components/toc-nav"},toggle:{require:"components/toggle"},tooltip:{require:"components/tooltip"},touchMenuHover:{require:"components/touch-menu-hover"},trackDownload:{require:"components/track-download"},trackImpression:{require:"components/track-impression"},tvFeature:{require:"components/tv-feature"},twitterFetcher:{require:"components/twitter-fetcher"},updateArea:{require:"components/update-area"},videoPlaceholder:{require:"components/video-placeholder"},videoPlayer:{require:a?"quantum/videoPlayer_upgrade":"quantum/videoPlayer"},videoListing:{require:"components/video-listing"},videoPlaylistConnector:{require:"components/video-playlist-connector"},videoShowGallery:{require:"components/video-show-gallery"},waypointPromo:{require:"component/waypoint-promo"},zipCode:{require:"components/zip-code"},zoom:{require:"quantum/zoom"},profileNewsletterSubscription:{require:"components/profile-newsletter-subscription"},bandwidthMeterBar:{require:"components/bandwidth-meter-bar"}}),e}),define("managers/edition-notifications",["jquery","version!fly/managers/debug","managers/device","components/global-modal"],function(t,e,i,n){return e=e.init("editionNotifications"),{init:function(){if(i.isDesktop()){var e=t("body").data("edition-redirect-alert");e&&e.length>0&&t.cnet.globalModal({content:e,openOnInit:!0})}}}}),define("managers/promotionals.desktop",["jquery","version!fly/managers/debug","managers/client-storage","utils/cookie","managers/edition","managers/global-functions","managers/page-vars","managers/user","version!libs/modernizr.custom"],function(t,e,i,n,s,a,r,o){(e=e.init("promotionals")).log("promos here");var l=null,d={cookiesNotification:{limit:3,isActive:function(){return!1},init:function(){require(["components/cookies-notification.desktop"],function(){t.cnet.cookiesNotification(),l.cookiesNotification++,i.write("promotionalSettings",l),i.write("suppressCookiesNotification",!0,!0)})}},espanolPromo:{limit:2,isActive:function(){var t=(window.navigator.userLanguage||window.navigator.language).indexOf("es")>=0;return t||(t="es"===n.read("fly_default_edition")),!s.isEspanol()&&t&&!i.read("suppressEspanolPromo",!0)&&l.espanolPromo<d.espanolPromo.limit},init:function(){require(["components/espanol-promo.desktop"],function(){t.cnet.espanolPromo(),l.espanolPromo++,i.write("promotionalSettings",l),i.write("suppressEspanolPromo",!0,!0)})}},espanolMatch:{limit:1,isActive:function(){var t=(window.navigator.userLanguage||window.navigator.language).indexOf("es")>=0;t||(t="es"===n.read("fly_default_edition"));var e=n.read("fly_geo")?JSON.parse(n.read("fly_geo")):"",a=!!n.read("fly_esMatchShown");return!s.isEspanol()&&t&&"us"==e.countryCode&&!a&&!i.read("suppressEspanolMatch",!0)},init:function(){require(["components/espanol-match"],function(){var e=t("[data-espanol-match-options]");e.espanolMatch(e.data("espanolMatchOptions")),l.espanolMatch++,i.write("promotionalSettings",l),n.write("fly_esMatchShown","true",{expires:1})})}},autoSocialPromo:{limit:4,isActive:function(){return"front_door"==r.tracking.data._pageType&&r.tracking.data.slug,l.autoSocialPromo,d.autoSocialPromo.limit,!1},init:function(){require(["components/waypoint-promo"],function(){t.cnet.waypointPromo()})}},urbanAirshipPromo:{isActive:function(){return!0},init:function(){require(["components/urban-airship"],function(){try{a.gdprConsentCallback("script_urban_airship_promo",function(){t.cnet.urbanAirship()},{},"targeting")}catch(t){e.log("UrbanAirship component not available")}})}}};return{init:function(){var e=function(){!1===t.cnet.breakingNewsActive&&(d.cookiesNotification.isActive()?d.cookiesNotification.init():d.espanolPromo.isActive()&&d.espanolPromo.init())};for(var n in l=i.read("promotionalSettings")||{},d)d.hasOwnProperty(n)&&(l[n]=l[n]||0);d.autoSocialPromo.isActive()&&d.autoSocialPromo.init(),d.urbanAirshipPromo.isActive()&&d.urbanAirshipPromo.init(),d.espanolMatch.isActive()&&d.espanolMatch.init(),void 0===t.cnet.breakingNewsActive?t(window).on("breakingNewsComplete",function(){e()}):e()},suppress:function(t){l[t]=d[t].limit,i.write("promotionalSettings",l)},increment:function(t){l[t]++,i.write("promotionalSettings",l)}}}),define("managers/third-party/social",["version!fly/managers/debug","managers/page-vars","managers/global-functions"],function(t,e,i){t=t.init("social");var n={linkedIn:"managers/third-party/linked-in",pinterest:"managers/third-party/pinterest",twitter:"managers/third-party/twitter",disqus:"managers/third-party/disqus"};function s(t){"string"==typeof n[t]&&i.gdprConsentCallback("script_"+t,function(){require([n[t]],function(e){n[t]=e,e.init()})},{},"social")}return{init:function(){e.services.linkedin.enabled&&$('[data-social="linkedIn"]').length>0&&s("linkedIn"),e.services.pinterest.enabled&&$('[data-social="pinterest"]').length>0&&s("pinterest"),e.services.twitterwidget.enabled&&$('[data-social="twitter"]').length>0&&s("twitter"),e.services.disqus.enabled&&$('[data-social="disqus"]').length>0&&"comments_permalink"==e.pageType&&s("disqus")},parse:function(t){t=t||null,e.services.linkedin.enabled&&$('[data-social="linkedIn"]',t).length>0&&("string"==typeof n.linkedIn?s("linkedIn"):n.linkedIn.parse(t)),e.services.pinterest.enabled&&$('[data-social="pinterest"]',t).length>0&&"string"==typeof n.pinterest&&s("pinterest"),e.services.twitterwidget.enabled&&$('[data-social="twitter"]',t).length>0&&("string"==typeof n.twitter?s("twitter"):n.twitter.parse()),e.services.disqus.enabled&&$('[data-social="disqus"]',t).length>0&&("string"==typeof n.disqus?s("disqus"):n.disqus.parse(t))}}}),function(t){"use strict";void 0===t&&(t={}),void 0===t.performance?t.performance={}:"performance"in t&&t.performance&&t.performance.setResourceTimingBufferSize&&performance.setResourceTimingBufferSize(400),t._perfRefForUserTimingPolyfill=t.performance,t.performance.userTimingJsNow=!1,t.performance.userTimingJsNowPrefixed=!1,t.performance.userTimingJsUserTiming=!1,t.performance.userTimingJsUserTimingPrefixed=!1,t.performance.userTimingJsPerformanceTimeline=!1,t.performance.userTimingJsPerformanceTimelinePrefixed=!1;var e,i,n=[],s=[],a=null;if("function"!=typeof t.performance.now){for(t.performance.userTimingJsNow=!0,s=["webkitNow","msNow","mozNow"],e=0;e<s.length;e++)if("function"==typeof t.performance[s[e]]){t.performance.now=t.performance[s[e]],t.performance.userTimingJsNowPrefixed=!0;break}var r=+new Date;t.performance.timing&&t.performance.timing.navigationStart&&(r=t.performance.timing.navigationStart),"function"!=typeof t.performance.now&&(Date.now?t.performance.now=function(){return Date.now()-r}:t.performance.now=function(){return+new Date-r})}var o=function(){},l=function(){},d=[],u=!1,c=!1;if("function"!=typeof t.performance.getEntries||"function"!=typeof t.performance.mark){for("function"==typeof t.performance.getEntries&&"function"!=typeof t.performance.mark&&(c=!0),t.performance.userTimingJsPerformanceTimeline=!0,n=["webkit","moz"],s=["getEntries","getEntriesByName","getEntriesByType"],e=0;e<s.length;e++)for(i=0;i<n.length;i++)a=n[i]+s[e].substr(0,1).toUpperCase()+s[e].substr(1),"function"==typeof t.performance[a]&&(t.performance[s[e]]=t.performance[a],t.performance.userTimingJsPerformanceTimelinePrefixed=!0);o=function(t){d.push(t),"measure"===t.entryType&&(u=!0)};var h=function(){u&&(d.sort(function(t,e){return t.startTime-e.startTime}),u=!1)};if(l=function(t,i){for(e=0;e<d.length;)d[e].entryType===t&&(void 0===i||d[e].name===i)?d.splice(e,1):e++},"function"!=typeof t.performance.getEntries||c){var p=t.performance.getEntries;t.performance.getEntries=function(){h();var e=d.slice(0);return c&&p&&(Array.prototype.push.apply(e,p.call(t.performance)),e.sort(function(t,e){return t.startTime-e.startTime})),e}}if("function"!=typeof t.performance.getEntriesByType||c){var g=t.performance.getEntriesByType;t.performance.getEntriesByType=function(i){if(void 0===i||"mark"!==i&&"measure"!==i)return c&&g?g.call(t.performance,i):[];"measure"===i&&h();var n=[];for(e=0;e<d.length;e++)d[e].entryType===i&&n.push(d[e]);return n}}if("function"!=typeof t.performance.getEntriesByName||c){var f=t.performance.getEntriesByName;t.performance.getEntriesByName=function(i,n){if(n&&"mark"!==n&&"measure"!==n)return c&&f?f.call(t.performance,i,n):[];void 0!==n&&"measure"===n&&h();var s=[];for(e=0;e<d.length;e++)void 0!==n&&d[e].entryType!==n||d[e].name===i&&s.push(d[e]);return c&&f&&(Array.prototype.push.apply(s,f.call(t.performance,i,n)),s.sort(function(t,e){return t.startTime-e.startTime})),s}}}if("function"!=typeof t.performance.mark){for(t.performance.userTimingJsUserTiming=!0,n=["webkit","moz","ms"],s=["mark","measure","clearMarks","clearMeasures"],e=0;e<s.length;e++)for(i=0;i<n.length;i++)a=n[i]+s[e].substr(0,1).toUpperCase()+s[e].substr(1),"function"==typeof t.performance[a]&&(t.performance[s[e]]=t.performance[a],t.performance.userTimingJsUserTimingPrefixed=!0);var v={};"function"!=typeof t.performance.mark&&(t.performance.mark=function(e){var i=t.performance.now();if(void 0===e)throw new SyntaxError("Mark name must be specified");if(t.performance.timing&&e in t.performance.timing)throw new SyntaxError("Mark name is not allowed");v[e]||(v[e]=[]),v[e].push(i),o({entryType:"mark",name:e,startTime:i,duration:0})}),"function"!=typeof t.performance.clearMarks&&(t.performance.clearMarks=function(t){t?v[t]=[]:v={},l("mark",t)}),"function"!=typeof t.performance.measure&&(t.performance.measure=function(e,i,n){var s=t.performance.now();if(void 0===e)throw new SyntaxError("Measure must be specified");if(i){var a=0;if(t.performance.timing&&i in t.performance.timing){if("navigationStart"!==i&&0===t.performance.timing[i])throw new Error(i+" has a timing of 0");a=t.performance.timing[i]-t.performance.timing.navigationStart}else{if(!(i in v))throw new Error(i+" mark not found");a=v[i][v[i].length-1]}var r=s;if(n)if(r=0,t.performance.timing&&n in t.performance.timing){if("navigationStart"!==n&&0===t.performance.timing[n])throw new Error(n+" has a timing of 0");r=t.performance.timing[n]-t.performance.timing.navigationStart}else{if(!(n in v))throw new Error(n+" mark not found");r=v[n][v[n].length-1]}o({entryType:"measure",name:e,startTime:a,duration:r-a})}else o({entryType:"measure",name:e,startTime:0,duration:s})}),"function"!=typeof t.performance.clearMeasures&&(t.performance.clearMeasures=function(t){l("measure",t)})}"undefined"!=typeof define&&define.amd?define("libs/usertiming-0.1.6",[],function(){return t.performance}):"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=t.performance)}("undefined"!=typeof window?window:void 0),define("utils/function-natives",["version!libs/usertiming"],function(){Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,i=arguments.length>1?arguments.slice(1):null,n=function(){},s=function(){var a=t,r=arguments.length;this instanceof s&&(n.prototype=e.prototype,a=new n);var o=i||r?e.apply(a,i&&r?i.concat(arguments.slice()):i||arguments):e.call(a);return a==t?o:a};return s}),Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,i=Object(this),n=i.length>>>0,s=arguments[1],a=0;a<n;a++)if(e=i[a],t.call(s,e,a,i))return e})}),function(t,e,i){"function"==typeof define&&define.amd?define("libs/jquery/mobile-1.4.0a1",["jquery"],function(n){return i(n,t,e),n.mobile}):i(t.jQuery,t,e)}(this,document,function(t,e,i,n){!function(t,e,i,n){var s,a,r="virtualMouseBindings",o="virtualTouchID",l="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),d="clientX clientY pageX pageY screenX screenY".split(" "),u=t.event.mouseHooks?t.event.mouseHooks.props:[],c=t.event.props.concat(u),h={},p=0,g=0,f=0,v=!1,m=[],_=!1,E=!1,A="addEventListener"in i,y=t(i),b=1,S=0;function T(t){for(;t&&void 0!==t.originalEvent;)t=t.originalEvent;return t}function C(e){for(var i,n,s={};e;){for(n in i=t.data(e,r))i[n]&&(s[n]=s.hasVirtualBinding=!0);e=e.parentNode}return s}function I(){E=!0}function D(){E=!1}function R(){P(),p=setTimeout(function(){p=0,S=0,m.length=0,_=!1,I()},t.vmouse.resetTimerDuration)}function P(){p&&(clearTimeout(p),p=0)}function w(e,i,s){var a;return(s&&s[e]||!s&&function(e,i){for(var n;e;){if((n=t.data(e,r))&&(!i||n[i]))return e;e=e.parentNode}return null}(i.target,e))&&(a=function(e,i){var s,a,r,o,l,u,h,p,g,f=e.type;if((e=t.Event(e)).type=i,s=e.originalEvent,a=t.event.props,f.search(/^(mouse|click)/)>-1&&(a=c),s)for(h=a.length;h;)e[o=a[--h]]=s[o];if(f.search(/mouse(down|up)|click/)>-1&&!e.which&&(e.which=1),-1!==f.search(/^touch/)&&(f=(r=T(s)).touches,l=r.changedTouches,u=f&&f.length?f[0]:l&&l.length?l[0]:n))for(p=0,g=d.length;p<g;p++)e[o=d[p]]=u[o];return e}(i,e),t(i.target).trigger(a)),a}function k(e){var i,n=t.data(e.target,o);_||S&&S===n||(i=w("v"+e.type,e))&&(i.isDefaultPrevented()&&e.preventDefault(),i.isPropagationStopped()&&e.stopPropagation(),i.isImmediatePropagationStopped()&&e.stopImmediatePropagation())}function M(e){var i,n,s,a=T(e).touches;a&&1===a.length&&(n=C(i=e.target)).hasVirtualBinding&&(S=b++,t.data(i,o,S),P(),D(),v=!1,s=T(e).touches[0],g=s.pageX,f=s.pageY,w("vmouseover",e,n),w("vmousedown",e,n))}function O(t){E||(v||w("vmousecancel",t,C(t.target)),v=!0,R())}function L(e){if(!E){var i=T(e).touches[0],n=v,s=t.vmouse.moveDistanceThreshold,a=C(e.target);(v=v||Math.abs(i.pageX-g)>s||Math.abs(i.pageY-f)>s)&&!n&&w("vmousecancel",e,a),w("vmousemove",e,a),R()}}function N(t){if(!E){I();var e,i,n=C(t.target);w("vmouseup",t,n),v||(e=w("vclick",t,n))&&e.isDefaultPrevented()&&(i=T(t).changedTouches[0],m.push({touchID:S,x:i.clientX,y:i.clientY}),_=!0),w("vmouseout",t,n),v=!1,R()}}function U(e){var i,n=t.data(e,r);if(n)for(i in n)if(n[i])return!0;return!1}function B(){}function j(e){var i=e.substr(1);return{setup:function(){U(this)||t.data(this,r,{}),t.data(this,r)[e]=!0,h[e]=(h[e]||0)+1,1===h[e]&&y.bind(i,k),t(this).bind(i,B),A&&(h.touchstart=(h.touchstart||0)+1,1===h.touchstart&&y.bind("touchstart",M).bind("touchend",N).bind("touchmove",L).bind("scroll",O))},teardown:function(){--h[e],h[e]||y.unbind(i,k),A&&(--h.touchstart,h.touchstart||y.unbind("touchstart",M).unbind("touchmove",L).unbind("touchend",N).unbind("scroll",O));var n=t(this),s=t.data(this,r);s&&(s[e]=!1),n.unbind(i,B),U(this)||n.removeData(r)}}}for(t.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},a=0;a<l.length;a++)t.event.special[l[a]]=j(l[a]);A&&i.addEventListener("click",function(e){var i,n,a,r,l,d=m.length,u=e.target;if(d)for(i=e.clientX,n=e.clientY,s=t.vmouse.clickDistanceThreshold,a=u;a;){for(r=0;r<d;r++)if(l=m[r],0,a===u&&Math.abs(l.x-i)<s&&Math.abs(l.y-n)<s||t.data(a,o)===l.touchID)return e.preventDefault(),void e.stopPropagation();a=a.parentNode}},!0)}(t,0,i),t.mobile={},function(t,e){var n={touch:"ontouchend"in i};t.mobile.support=t.mobile.support||{},t.extend(t.support,n),t.extend(t.mobile.support,n)}(t),function(t,e,n){var s=t(i),a=t.mobile.support.touch,r=a?"touchstart":"mousedown",o=a?"touchend":"mouseup",l=a?"touchmove":"mousemove";function d(e,i,n){var s=n.type;n.type=i,t.event.dispatch.call(e,n),n.type=s}t.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(e,i){t.fn[i]=function(t){return t?this.bind(i,t):this.trigger(i)},t.attrFn&&(t.attrFn[i]=!0)}),t.event.special.scrollstart={enabled:!0,setup:function(){var e,i,n=this;function s(t,i){d(n,(e=i)?"scrollstart":"scrollstop",t)}t(n).bind("touchmove scroll",function(n){t.event.special.scrollstart.enabled&&(e||s(n,!0),clearTimeout(i),i=setTimeout(function(){s(n,!1)},50))})},teardown:function(){t(this).unbind("touchmove scroll")}},t.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var e=this,i=t(e),n=!1;i.bind("vmousedown",function(a){if(n=!1,a.which&&1!==a.which)return!1;var r,o=a.target;function l(){clearTimeout(r)}function u(){l(),i.unbind("vclick",c).unbind("vmouseup",l),s.unbind("vmousecancel",u)}function c(t){u(),n||o!==t.target?n&&t.stopPropagation():d(e,"tap",t)}i.bind("vmouseup",l).bind("vclick",c),s.bind("vmousecancel",u),r=setTimeout(function(){t.event.special.tap.emitTapOnTaphold&&(n=!0),d(e,"taphold",t.Event("taphold",{target:o}))},t.event.special.tap.tapholdThreshold)})},teardown:function(){t(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),s.unbind("vmousecancel")}},t.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:10,verticalDistanceThreshold:75,start:function(e){var i=e.originalEvent.touches?e.originalEvent.touches[0]:e;return{time:(new Date).getTime(),coords:[i.pageX,i.pageY],origin:t(e.target)}},stop:function(t){var e=t.originalEvent.touches?t.originalEvent.touches[0]:t;return{time:(new Date).getTime(),coords:[e.pageX,e.pageY]}},handleSwipe:function(e,i,n,s){if(i.time-e.time<t.event.special.swipe.durationThreshold&&Math.abs(e.coords[0]-i.coords[0])>t.event.special.swipe.horizontalDistanceThreshold&&Math.abs(e.coords[1]-i.coords[1])<t.event.special.swipe.verticalDistanceThreshold){var a=e.coords[0]>i.coords[0]?"swipeleft":"swiperight";return d(n,"swipe",t.Event("swipe",{target:s,swipestart:e,swipestop:i})),d(n,a,t.Event(a,{target:s,swipestart:e,swipestop:i})),!0}return!1},setup:function(){var e=this,i=t(e);i.bind(r,function(n){var s,a=t.event.special.swipe.start(n),r=n.target,d=!1;i.bind(l,function(i){a&&(s=t.event.special.swipe.stop(i),d||(d=t.event.special.swipe.handleSwipe(a,s,e,r)),Math.abs(a.coords[0]-s.coords[0])>t.event.special.swipe.scrollSupressionThreshold&&i.preventDefault())}).one(o,function(){d=!0})})},teardown:function(){t(this).unbind(r).unbind(l).unbind(o)}},t.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe",swiperight:"swipe"},function(e,i){t.event.special[e]={setup:function(){t(this).bind(i,t.noop)},teardown:function(){t(this).unbind(i)}}})}(t)}),define("main.desktop",["jquery","managers/client-storage","managers/components.desktop","managers/device","managers/edition-notifications","managers/page-vars","managers/promotionals.desktop","managers/third-party/social","managers/tracking","managers/tealium","version!libs/modernizr.custom","version!fly/utils/data-prefix","utils/function-natives","version!libs/jquery/mobile","managers/user"],function(t,e,i,n,s,a,r,o,l){t(document).ready(function(){l.resetTrackingData(a.tracking.data),n.init(a.device),e.init(),i.process(t("body")),r.init(),s.init(),o.init()})}),define("managers/recommendation",["jquery","managers/page-vars","managers/global-functions","managers/tealium","managers/user","managers/recommendation-data","version!fly/managers/debug","version!fly/libs/jquery.throttle-debounce"],function(t,e,i,n,s,a,r){var o="CnetUnfollowList";function l(t){var i=JSON.parse(localStorage.getItem(o));i&&(i.forEach(function(t){var e=a.createMockExplicitInterestObject(t);a.writeExplicitInterestToLocalStorage(e)}),localStorage.removeItem(o));var s=a.getExplicitInterests();if(s.length)for(var l=0;l<s.length;l++)if(s[l].type===t.interest.type&&s[l].interest_name===t.interest.name.toUpperCase()&&"unfollow"===s[l].action)return void r.log("Did not add tag "+s[l].interest_name+" due to being explicitly unfollowed");window.UA.then(function(i){if(i.channel){var s=t.interest.name.toUpperCase(),o=a.getTagGroupByInterest(t.interest.type);if(!i.channel.tags.has(s,o)){r.log("Adding interests in UA API: "+s),i.channel.tags.add(s,o);var l=e.tracking.data;n.trackCustomEvent("background",{pageViewGuid:l.pageViewGuid,_dwAnonId:l._dwAnonId,articleId:l.articleId,clickGenericText:"add_interest|"+t.interest.type+"_interest|"+t.interest.name.toUpperCase(),pageType:l.pageType,siteEdition:l.siteEdition,siteHier:l.siteHier,siteSection:l.siteSection},"trackClick")}t.ua_channel_id=i.channel.id}}),a.sendInterestsToBackend([a.createImplicitInterestObject(t)])}function d(t,i,s){var a=e.tracking.data;n.trackCustomEvent("tap",{pageViewGuid:a.pageViewGuid,_dwAnonId:a._dwAnonId,articleId:a.articleId,clickGenericText:(s?"add":"remove")+"_interest|"+i+"_interest|"+t,pageType:a.pageType,siteEdition:a.siteEdition,siteHier:a.siteHier,siteSection:a.siteSection},"trackClick")}return r=r.init("recommendationManager"),{registerPageView:function(){if(a.testForLocalStorage()&&"us"===e.tracking.data.siteEdition){var n=a.getViewEvents();s.getUserData(function(e,s){var r=a.createNewViewEvent(s);n.push(r),function(e,n){var s=function(t){var e={},i=Date.now()-2592e6;return t.forEach(function(t){!(t=a.normalizeView(t)).interest||"none"===t.interest.id||!t.date_created||i>t.date_created||(e[t.user_id]||(e[t.user_id]={}),e[t.user_id][t.interest.type]||(e[t.user_id][t.interest.type]={}),e[t.user_id][t.interest.type][t.interest.name]?e[t.user_id][t.interest.type][t.interest.name].push(t):e[t.user_id][t.interest.type][t.interest.name]=[t])}),e}(e);"none"!==n.interest.id&&s&&s[n.user_id]&&s[n.user_id][n.interest.type]&&s[n.user_id][n.interest.type][n.interest.name]&&s[n.user_id][n.interest.type][n.interest.name].length>=2&&i.gdprConsentCallback("UAInterestAdd",function(){window.UA?l(n):t(window).on("urban-airship-loaded",function(){l(n)})},{},"targeting")}(n=a.pruneViews(n,r),r),a.writeViewsArray(n)})}},registerOnScroll:function(e){var i=this;e||(e=window);var n=t(e);n.on("scroll.recommendationManager",t.throttle(500,function(){i.registerPageView(),n.off("scroll.recommendationManager")}))},onVideoComplete:function(){s.getUserData(function(e,i){var n=a.createNewViewEvent(i);"none"!==n.interest.id&&(window.UA?l(n):t(window).on("urban-airship-loaded",function(){l(n)}))})},addExplicitInterest:function(t,e){s.getUserData(function(i,n){var s=a.createExplicitInterestObject("follow",e,n);if(t.channel){var o=a.getTagGroupByInterest(s.type);r.log("Adding "+s.interest_name+" to UA"),t.channel.tags.add(s.interest_name.toUpperCase(),o),d(s.interest_name.toUpperCase(),s.type,!0)}return a.writeExplicitInterestToLocalStorage(s),a.sendInterestsToBackend([s],function(t){r.log("Successfully added follow interest "+s.interest_name+" to DB")}),s})},removeExplicitInterest:function(t,e){s.getUserData(function(i,n){var s=a.createExplicitInterestObject("unfollow",e,n);if(t.channel){var o=a.getTagGroupByInterest(s.type);r.log("Removing UA interest "+s.interest_name.toUpperCase()),t.channel.tags.remove(s.interest_name.toUpperCase(),o),d(s.interest_name.toUpperCase(),s.type,!1)}return a.writeExplicitInterestToLocalStorage(s),a.sendInterestsToBackend([s],function(t){r.log("Successfully added unfollow interest "+s.interest_name+" to DB")}),s})}}}),define("fly/components/fixate-1.0",["jquery","version!fly/components/base"],function(t){t.widget("fly.fixate",t.fly.base,{options:{classFixed:"fixed",classUnfixed:"unfixed",primaryEdge:"top",offset:{top:20,bottom:20},stickToLeft:!1,stickToRight:!1,guideTop:null,guideBottom:null,guideLeft:null,guideRight:null},hasEvents:!1,isFixed:!1,boundary:{top:-1,bottom:-1,left:-1,right:-1},$element:null,$window:t(window),$document:t(document),_create:function(){this._super("_create"),this._setBoundaries(),this._addEvents(),this.checkPosition()},_addEvents:function(){this.options;this.hasEvents||this.disabled||(this.hasEvents=!0,this.$window.on("scroll.fixate",t.proxy(this.checkPosition,this)),this.$window.on("resize.fixate",t.proxy(this.checkPosition,this)))},_removeEvents:function(){this.hasEvents=!1},_setBoundaries:function(){var e=this.options,i=null,n=null,s=null,a=null;this.boundary={top:-1,bottom:-1,left:-1,right:-1},e.guideTop&&(i=(n=t(e.guideTop)).offset(),this.boundary.top=i.top+n.outerHeight()),e.guideBottom&&(i=t(e.guideBottom).offset(),this.boundary.bottom=i.top),e.guideLeft&&(i=(s=t(e.guideLeft)).offset(),e.stickToLeft&&((this.boundary.top<0||i.top>this.boundary.top)&&(this.boundary.top=i.top),(this.boundary.bottom<0||i.top+s.outerHeight()<this.boundary.bottom)&&(this.boundary.bottom=i.top+s.outerHeight()))),e.guideRight&&(i=(a=t(e.guideRight)).offset(),e.stickToRight&&((this.boundary.top<0||i.top>this.boundary.top)&&(this.boundary.top=i.top),(this.boundary.bottom<0||i.top+a.outerHeight()<this.boundary.bottom)&&(this.boundary.bottom=i.top+a.outerHeight())))},_fix:function(){var t=this.options;this.isFixed=!0,this.$element.addClass(t.classFixed).removeClass(t.classUnfixed),"top"===t.primaryEdge?this.$element.css("top",t.offset.top):this.$element.css("top",this.$window.height()-t.offset.bottom-this.$element.height()),this._placeHorizontally()},_unfix:function(t){var e=this.options;this.isFixed=!1,this.$element.addClass(e.classUnfixed).removeClass(e.classFixed),"top"===t?this.$element.css("top",this.boundary.top+e.offset.top-this.$window.scrollTop()):this.$element.css("top",this.boundary.bottom-e.offset.bottom-this.$element.height()-this.$window.scrollTop()),this._placeHorizontally()},_placeHorizontally:function(){var e=this.options,i=this.$window.scrollLeft(),n=null,s=null;e.guideLeft?(n=t(e.guideLeft),this.$element.css("left",n.offset().left+n.outerWidth()-i)):e.guideRight&&(s=t(e.guideRight),this.$element.css("left",s.offset().left-this.$element.width()-i))},checkPosition:function(){var t=this.options,e=this.$window.scrollTop(),i=e+this.$window.height(),n=this.$element.height();this._setBoundaries(),"top"===t.primaryEdge?e<this.boundary.top?this._unfix("top"):this.boundary.bottom>=0&&e+t.offset.top+n+t.offset.bottom>this.boundary.bottom?this._unfix("bottom"):this._fix():i>this.boundary.bottom?this._unfix("bottom"):i-t.offset.bottom-n-t.offset.top<this.boundary.top?this._unfix("top"):this._fix()},destroy:function(){this._removeEvents(),this._super("destroy")}})}),define("components/fixate",["jquery","version!fly/managers/debug","version!fly/components/fixate"],function(t,e){e=e.init("fixate"),t.widget("fly.fixate",t.fly.fixate,{options:{classFixedParent:"fixed-parent",guideContainer:null,guideTopPlus:null,innerGuideLeft:null,classTop:"top",classBottom:"bottom",offset:{topPlus:0},minHeight:null},_create:function(){this._super();var e=this.options,i=null;if(e.guideBottom&&e.minHeight){i=t(e.guideBottom).offset();var n=this.$element.offset();i.top-n.top<e.minHeight&&this.$element.addClass("cancelfix")}},_setBoundaries:function(){this._super();var e=this.options,i=null;this.options.guideContainer&&(this.options.guideContainer=t(this.options.guideContainer),i=this.options.guideContainer.offset(),(this.boundary.top<0||i.top>this.boundary.top)&&(this.boundary.top=i.top),(this.boundary.bottom<0||i.top+this.options.guideContainer.outerHeight()<this.boundary.bottom)&&(this.boundary.bottom=i.top+this.options.guideContainer.outerHeight())),e.guideTopPlus&&(e.guideTopPlus=t(e.guideTopPlus),i=e.guideTopPlus.offset(),this.boundary.top=i.top+e.guideTopPlus.outerHeight()-e.offset.topPlus)},_fix:function(){var t=this.options;this.isFixed=!0,this.$element.addClass(t.classFixed).removeClass(t.classUnfixed).removeClass(t.classBottom).removeClass(t.classTop),"top"===t.primaryEdge?this.$element.css("top",t.offset.top):this.$element.css("top",this.$window.height()-t.offset.bottom-this.$element.height()),this._placeHorizontally(),this.$element.parent().addClass(this.options.classFixedParent)},_unfix:function(t){var e=this.options;this.isFixed=!1,this.$element.addClass(e.classUnfixed).removeClass(e.classFixed),"top"===t?(this.$element.css("top",this.boundary.top-this.$window.scrollTop()),this.$element.addClass(e.classTop).removeClass(e.classBottom)):(this.$element.css("top",this.boundary.bottom-this.$element.height()-this.$window.scrollTop()),this.$element.addClass(e.classBottom).removeClass(e.classTop)),this._placeHorizontally(),this.$element.parent().removeClass(this.options.classFixedParent)},_placeHorizontally:function(){var e=this.options,i=null,n=this.$window.scrollLeft();e.innerGuideLeft&&(i=t(e.innerGuideLeft),this.$element.css("left",i.offset().left-n))}})}),define("components/iframe-hover-fix",["jquery","version!fly/managers/debug","version!fly/components/base"],function(t,e){e=e.init("iframeHoverFix"),t.widget("cnet.iframeHoverFix",t.fly.base,{options:{},_create:function(){var e=this;this._setup(),t.browser.msie&&(this.$element.live("mouseenter",function(){e.$element.addClass("hover")}),this.$element.find("iframe").live("hover",function(){e.$element.addClass("hover")}),this.$element.live("mouseleave",function(){e.$element.removeClass("hover")}))}})}),define("libs/waypoints/inview-3.1.1",["version!libs/waypoints/jquery.waypoints"],function(){"use strict";function t(){}var e=window.Waypoint;function i(t){this.options=e.Adapter.extend({},i.defaults,t),this.axis=this.options.horizontal?"horizontal":"vertical",this.waypoints=[],this.createWaypoints()}i.prototype.createWaypoints=function(){for(var t={vertical:[{down:"enter",up:"exited",offset:"100%"},{down:"entered",up:"exit",offset:"bottom-in-view"},{down:"exit",up:"entered",offset:-1},{down:"exited",up:"enter",offset:function(){return-this.adapter.outerHeight()}}],horizontal:[{right:"enter",left:"exited",offset:"100%"},{right:"entered",left:"exit",offset:"right-in-view"},{right:"exit",left:"entered",offset:0},{right:"exited",left:"enter",offset:function(){return-this.adapter.outerWidth()}}]},e=0,i=t[this.axis].length;e<i;e++){var n=t[this.axis][e];this.createWaypoint(n)}},i.prototype.createWaypoint=function(t){var i=this;this.waypoints.push(new e({element:this.options.element,handler:function(t){return function(e){i.options[t[e]].call(this,e)}}(t),offset:t.offset,horizontal:this.options.horizontal}))},i.prototype.destroy=function(){for(var t=0,e=this.waypoints.length;t<e;t++)this.waypoints[t].destroy();this.waypoints=[]},i.defaults={enter:t,entered:t,exit:t,exited:t},e.Inview=i}),define("components/toc-nav",["jquery","version!fly/managers/debug","managers/page-vars","managers/tealium","managers/waypoints","version!libs/jquery/mobile","version!libs/waypoints/inview"],function(t,e,i,n,s){var a=e.init("tocNav");s.init(),t.widget("cnet.tocNav",t.fly.base,{options:{applyClassOnHover:!0,closeOnSelect:!0,isIntegratedWithHeader:!0,isExpandableOnHover:!0,isExpandableOnSwipe:!1,isExpandableOnClick:!0,isVisibleOnLoad:!1,stopTouchPropagation:!1,adjustHeight:!1},$header:null,$body:null,_create:function(){a.log("Initializing"),this._setup(),this.$body=t("body"),this.$header=t("#rbHeader .fixation, #cesHeaderWrap.fixation, .headerContainer, #specialHeader .fixation"),this._setupEvents(),this.options.isVisibleOnLoad||this.options.isIntegratedWithHeader&&(t("img[data-original]").each(function(e,i){i.src=t(i).data("original")}),this.$header.hasClass("fixed"))},_setupEvents:function(){var e=this;this.options.isIntegratedWithHeader&&(this.$header.on("stickyElementStuck",function(){}),this.$header.on("stickyElementUnstuck",function(){e.$body.removeClass("tocNavOpen"),e.$body.removeClass("tocNavVisible")})),this.options.isExpandableOnHover&&this.$element.hover(function(){e._trackCustomEvent("expandToc","expandToc"),e.$header.hasClass("fixed")||!e.options.isIntegratedWithHeader?(e.options.applyClassOnHover&&e.$body.addClass("tocNavOpen"),e._trigger("open")):(e.options.applyClassOnHover&&e.$body.removeClass("tocNavOpen"),e._trigger("closed"))},function(){e.options.applyClassOnHover&&e.$body.removeClass("tocNavOpen"),e._trigger("closed")}),this.options.isExpandableOnSwipe&&(this.$element.on("swiperight",function(){e.$body.addClass("tocNavOpen"),e._trigger("open"),e._trackCustomEvent("expandToc","expandToc")}),this.$element.on("swipeleft",function(){e.$body.removeClass("tocNavOpen"),e._trigger("closed")})),this.options.isExpandableOnClick&&t(".expand",this.$element).click(function(){e.$body.hasClass("tocNavOpen")?(e.$body.removeClass("tocNavOpen"),e._trigger("closed")):(e.$body.addClass("tocNavOpen"),e._trigger("open")),e._trackCustomEvent("expandToc","expandToc"),e.$body.on("click.tocNav",function(i){0===t(i.target).closest(e.$element).length&&(e.$body.removeClass("tocNavOpen"),e._trigger("closed"),e.$body.off("click.tocNav"))})}),t("[data-toc-asset-options]",this.$element).click(function(i){i.preventDefault();var n=t(this);if(n.parent().hasClass("selected"))a.log("Element already selected; ignoring click.");else{var s=n.data("toc-asset-options").id;a.log("Firing event to request asset "+s),e.$element.trigger("tocNavRequest",{assetId:s})}e.options.closeOnSelect&&(e.$body.removeClass("tocNavOpen"),e._trigger("closed"))}),this.$element.on("tocNavSelection",function(i,n){a.log("Updating selected asset to #"+n.index),t("li.selected",e.$element).removeClass("selected");var s=t(t("[data-toc-asset-options]",e.$element)[n.index]).parent("li");s.addClass("selected");var r=s.parent("ul"),o=r.scrollTop()+s.position().top;r.animate({scrollTop:o},500)}),this.options.stopTouchPropagation&&this.$element.on("touchmove",function(t){t.stopPropagation()}),this.options.adjustHeight&&new Waypoint.Inview({element:t("#rbFooter")[0],enter:function(i){e.$element.height(t(window).height()-85),window.setTimeout(function(){e.$element.find("ul").first().scrollTop(e.$element.find(".selected").position().top)},500)},exited:function(t){e.$element.height("100%")}})},_trackCustomEvent:function(t,e){a.log("Track custom event: "+t);var s=i.tracking.data;n.trackCustomEvent(t,{articleTitle:s.articleTitle,articleType:s.articleType,articleId:s.articleId,_authorPrimaryName:s._authorPrimaryName,_pageType:s.pageType,brand:s.brand,pageNum:s.pageNum,_test:s._test,siteEdition:s._siteEdition,siteSection:s._siteSection,_siteTypeDevice:s._siteTypeDevice,_siteHier:s._siteHier,_pageViewGuid:s._pageViewGuid,browserTitle:document.title,topicId:s.topicId,collectionId:s.collectionId?s.collectionId:"",articleAuthorName:s.articleAuthorName,articleAuthorGuid:s.articleAuthorId,clickGenericText:e},"trackClick")}})}),define("fly/components/dropdown-1.0",["jquery","version!fly/components/base"],function(t){var e="ontouchstart"in window||"onmsgesturechange"in window,i=t.mobile?"vclick":"click";t.widget("fly.dropdown",t.fly.base,{options:{classSelected:"selected",event:"click",selectorTrigger:'[data-item="trigger"]'},$element:null,$trigger:null,enterTimeout:null,leaveTimeout:null,_create:function(){var t=this.options,n={};this._setup(),e&&(t.event="click"),this.$element=this.$element,this.$trigger=this.$element.find(t.selectorTrigger).first(),"click"===t.event?(n[i]="_handleClick",this._on(this.$trigger,n)):"hover"===t.event&&this._on(this.$element,{mouseenter:"_handleMouseEnter",mouseleave:"_handleMouseLeave"})},_handleClick:function(t){t.preventDefault(),this.toggle()},_handleMouseEnter:function(t){var e=this;clearTimeout(this.leaveTimeout),this.enterTimeout=setTimeout(function(){e.show()},50)},_handleMouseLeave:function(t){var e=this;clearTimeout(this.enterTimeout),this.leaveTimeout=setTimeout(function(){e.hide()},150)},_handleDocClick:function(e){var i=t(e.target);0===this.$element.has(i).length&&t.contains(document.documentElement,i[0])&&this.hide()},show:function(){var t=this,e=this.options,n={};this.$element.addClass(e.classSelected),setTimeout(function(){n[i]="_handleDocClick",t._on(t.$document,n)},1),this._trigger("shown",null,{$element:this.$element,$trigger:this.$trigger})},hide:function(){var t=this.options;this.$element.removeClass(t.classSelected),this._off(this.$document,i),this._trigger("hidden",null,{$element:this.$element,$trigger:this.$trigger})},toggle:function(){var t=this.options;this[this.$element.hasClass(t.classSelected)?"hide":"show"]()}})}),define("components/dropdown",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/dropdown"],function(t,e,i,n){(e=e.init("dropdown")).log("dropdown"),t.widget("cnet.dropdown",t.fly.dropdown,{options:{trackingOptions:{trackDropdown:!1,dropdownIndex:null,trackNameShow:"show",trackNameHide:"hide",ariaExpand:'[data-item="ariaDropdown"]'},disableClose:!1,disableCloseOutsideElement:null},$ariaExpand:null,_create:function(){e.log("create");var t=this.options,i={};this._setup(),("ontouchstart"in window||"onmsgesturechange"in window)&&(t.event="click"),this.$trigger=this.$element.find(t.selectorTrigger).first(),this.$ariaExpand=this.$element.find(t.ariaExpand).first(),"click"===t.event?(i.tap="_handleClick",e.log("this.$trigger",this.$trigger,i),this._on(this.$trigger,i)):"hover"===t.event&&this._on(this.$element,{mouseenter:"_handleMouseEnter",mouseleave:"_handleMouseLeave"})},_handleDocClick:function(i){var n=t(i.target);e.log("handleDocClick",n,this.$element,this),e.log("disabledCloseOutsideElement",t(this.options.disableCloseOutsideElement)),this.options.disableCloseOutsideElement?1===t(this.options.disableCloseOutsideElement).has(n).length&&(e.log("Click inside target element"),this.hide()):0===this.$element.has(n).length&&t.contains(document.documentElement,n[0])&&!this.options.disableClose&&(e.log("Click inside DOM"),this.hide())},show:function(){e.log("show",this.$element);var t=this,i=this.options,n={};this.$element.addClass(i.classSelected),setTimeout(function(){n.tap="_handleDocClick",t._on(t.$document,n)},1),this._trigger("shown",null,{$element:this.$element,$trigger:this.$trigger}),this.toggleAriaState(!0),i.trackingOptions.trackDropdown&&this._trackToggle("show")},hide:function(){e.log("hide:");var t=this.options;this.$element.removeClass(t.classSelected),this._off(this.$document,"tap"),this._trigger("hidden",null,{$element:this.$element,$trigger:this.$trigger}),this.toggleAriaState(!1),t.trackingOptions.trackDropdown&&this._trackToggle("hide")},toggleAriaState:function(t){e.log("toggleAS"),this.$trigger.attr("aria-expanded",t),this.$ariaExpand.attr("aria-hidden",!t)},_trackToggle:function(t){e.log("trackToggle");var s="",a=this.options;s="show"==t?a.trackingOptions.trackNameShow:a.trackingOptions.trackNameHide,a.trackingOptions.dropdownIndex&&(s+="."+a.trackingOptions.dropdownIndex),e.log("Track dropdown event: "+s),trackingData=n.tracking.data,i.trackCustomEvent("dropdownEvent",{siteEdition:trackingData.siteEdition,siteHier:trackingData.siteHier,pageType:trackingData.pageType,articleTitle:trackingData.articleTitle,articleType:trackingData.articleType,topicId:trackingData.topicId,pageViewGuid:trackingData.pageViewGuid,collectionId:trackingData.collectionId,_dwAnonId:trackingData._dwAnonId,clickGenericText:s},"trackClick")}})}),define("components/toggle",["jquery","version!fly/managers/debug","components/dropdown"],function(t,e){e=e.init("toggle"),t.widget("cnet.toggle",t.cnet.dropdown,{options:{closeOnUrlChange:!1,openOnInit:!1,scrollToToggle:!1},_create:function(){var t=this;this._super(),this.options.closeOnUrlChange&&this.$window.on("urlChanged",function(){t.hide()}),this.options.openOnInit&&this.show()},show:function(){this.$element.addClass(this.options.classSelected),this._trigger("shown",null,{$element:this.$element,$trigger:this.$trigger}),this.options.trackingOptions.trackDropdown&&this._trackToggle("show")},hide:function(){this._super(),this.options.scrollToToggle&&t("html, body").animate({scrollTop:this.$element.offset().top},1e3)}})}),define("components/touch-menu-hover",["jquery","version!fly/managers/debug","managers/device","managers/page-vars","version!fly/components/base"],function(t,e,i,n){e=e.init("touchMenuHover"),t.widget("cnet.touchMenuHover",t.fly.base,{options:{hoverClass:"hover",moreButton:"moreButton",header:!1},_create:function(){this._setup(),"mobile"!=n.tracking.data.deviceType&&navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&t(".social-login").css("display","none"),Modernizr.touch&&this._setupEvents()},_setupEvents:function(){var n=this,s=n.$element,a=t('[data-trigger="menu"]',s);0===a.length&&(a=s),a.on(i.getImmediateClickType(),function(a){t(":cnet-touchMenuHover").not(s).removeClass(n.options.hoverClass),n.options.header&&(t("#rbHeader").removeClass("passthru intentionalHover"),t("#rbHeader").addClass("fadeOut")),s.hasClass(n.options.hoverClass)?s.hasClass(n.options.moreButton)?(e.log("Link click on active more share menu : leaving hover class"),t(document).on(i.getImmediateClickType(),null,{self:n},n._handleClickOutsideMenu)):(s.removeClass(n.options.hoverClass),e.log("Link click on active : removing hover class"),n.options.header&&(t("#rbHeader").removeClass("passthru intentionalHover"),t("#rbHeader").addClass("fadeOut")),t(document).off(i.getImmediateClickType(),null,n._handleClickOutsideMenu)):(a.preventDefault(),s.addClass(n.options.hoverClass),n.options.header&&(t("#rbHeader").removeClass("fadeOut"),t("#rbHeader").addClass("passthru intentionalHover")),e.log("Link click on non-active : preventing link and adding hover class"),t(document).on(i.getImmediateClickType(),null,{self:n},n._handleClickOutsideMenu))})},_handleClickOutsideMenu:function(n){var s=n.data.self;0===t(n.target).parents(":cnet-touchMenuHover").length&&(e.log("Body click : removing hover class"),s.$element.removeClass(s.options.hoverClass),s.options.header&&(t("#rbHeader").removeClass("passthru intentionalHover"),t("#rbHeader").addClass("fadeOut")),t(document).off(i.getImmediateClickType(),null,s._handleClickOutsideMenu))}})}),define("components/sticky-element",["jquery","version!fly/managers/debug","managers/waypoints","version!fly/components/base","version!libs/waypoints/inview"],function(t,e,i){e=e.init("stickyElement"),i.init(),t.widget("cnet.stickyElement",t.fly.base,{options:{classFixed:"fixed",classHidden:"hidden",classPlaceholder:"sticky-element-placeholder",offset:0,primaryEdge:"top",selectorElementHide:"",selectorPageBottom:"",hideDirection:"top",unstickAtPageBottom:!1},$placeholder:null,waypoint:null,endWaypoint:null,_create:function(){this._setup(),this._setupPlaceholder(),this._setupEvents()},_setupPlaceholder:function(){this.$placeholder=t('<div class="'+this.options.classPlaceholder+" "+this.options.classHidden+'"></div>'),this.$placeholder.height(this.$element.outerHeight(!0)),"top"===this.options.primaryEdge?this.$element.before(this.$placeholder):"bottom"===this.options.primaryEdge&&this.$element.after(this.$placeholder)},_setupEvents:function(){var e=this;e.pauseFlag=!1,0===this.options.offset?this.waypoint=new Waypoint.Inview({element:this.$placeholder[0],entered:function(t){"top"===e.options.primaryEdge&&"up"===t?e._unstick():"bottom"===e.options.primaryEdge&&"down"===t&&(e._stick(),e.pauseFlag=!0)},exit:function(t){"top"===e.options.primaryEdge&&"down"===t?e._stick():"bottom"===e.options.primaryEdge&&"up"===t&&e._unstick()}}):e.options.selectorElementHide||(this.waypoint=new Waypoint({element:this.$placeholder[0],handler:function(t){"top"===e.options.primaryEdge&&"up"===t||"bottom"===e.options.primaryEdge&&"down"===t?e._unstick():e._stick()},offset:this.options.offset})),e.options.selectorElementHide&&(this.endWaypoint=new Waypoint({element:e.$element.closest(e.options.selectorElementHide),handler:function(t){"top"==e.options.hideDirection?1==e.pauseFlag&&"down"==t?e._unstick():e._stick():1==e.pauseFlag&&"down"==t?e._stick():e._unstick()},offset:"bottom-in-view"})),e.options.selectorPageBottom&&(this.endWaypoint=new Waypoint.Inview({element:t(e.options.selectorPageBottom),entered:function(t){"top"===e.options.primaryEdge&&"down"===t&&e._unstick()},exit:function(t){"top"===e.options.primaryEdge&&"up"===t&&e._stick()}})),e.options.unstickAtPageBottom&&(this.endWaypoint=new Waypoint({element:e.$element.parents("[data-page-options]").find(".pageBottom"),handler:function(t){"down"==t?e._unstick():"up"==t&&e._stick()},offset:t(".shortLeader").length?76:100}))},_stick:function(){this.$placeholder.removeClass(this.options.classHidden),this.$element.addClass(this.options.classFixed),this.$element.trigger("stickyElementStuck")},_unstick:function(){this.$placeholder.addClass(this.options.classHidden),this.$element.removeClass(this.options.classFixed),this.$element.trigger("stickyElementUnstuck")}})}),define("components/form-trim",["jquery","version!fly/managers/debug","version!fly/components/base"],function(t,e){e=e.init("formTrim"),t.widget("cnet.formTrim",t.fly.base,{options:{},_create:function(){var e=this;e._setup(),e.$element.on("submit",t.proxy(function(i){t("input[type=text]",e.$element).each(function(){t(this).val(t(this).val().replace(/\s+/g," ").trim())})},this))}})}),function(t,e,i,n){var s=t(e);t.fn.lazyload=function(n){var a,r=this,o={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:e,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};function l(){var e=0;r.each(function(){var i=t(this);if(!o.skip_invisible||i.is(":visible"))if(t.abovethetop(this,o)||t.leftofbegin(this,o));else if(t.belowthefold(this,o)||t.rightoffold(this,o)){if(++e>o.failure_limit)return!1}else i.trigger("appear"),e=0})}return n&&(void 0!==n.failurelimit&&(n.failure_limit=n.failurelimit,delete n.failurelimit),void 0!==n.effectspeed&&(n.effect_speed=n.effectspeed,delete n.effectspeed),t.extend(o,n)),a=void 0===o.container||o.container===e?s:t(o.container),0===o.event.indexOf("scroll")&&a.bind(o.event,function(){return l()}),this.each(function(){var e=this,i=t(e);e.loaded=!1,void 0!==i.attr("src")&&!1!==i.attr("src")||i.is("img")&&i.attr("src",o.placeholder),i.one("appear",function(){if(!this.loaded){if(o.appear){var n=r.length;o.appear.call(e,n,o)}t("<img />").bind("load",function(){var n=i.attr("data-"+o.data_attribute);i.hide(),i.is("img")?i.attr("src",n):i.css("background-image","url('"+n+"')"),i[o.effect](o.effect_speed),e.loaded=!0;var s=t.grep(r,function(t){return!t.loaded});if(r=t(s),o.load){var a=r.length;o.load.call(e,a,o)}}).attr("src",i.attr("data-"+o.data_attribute))}}),0!==o.event.indexOf("scroll")&&i.bind(o.event,function(){e.loaded||i.trigger("appear")})}),s.bind("resize",function(){l()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&s.bind("pageshow",function(e){e.originalEvent&&e.originalEvent.persisted&&r.each(function(){t(this).trigger("appear")})}),t(i).ready(function(){l()}),this},t.belowthefold=function(i,n){return(void 0===n.container||n.container===e?(e.innerHeight?e.innerHeight:s.height())+s.scrollTop():t(n.container).offset().top+t(n.container).height())<=t(i).offset().top-n.threshold},t.rightoffold=function(i,n){return(void 0===n.container||n.container===e?s.width()+s.scrollLeft():t(n.container).offset().left+t(n.container).width())<=t(i).offset().left-n.threshold},t.abovethetop=function(i,n){return(void 0===n.container||n.container===e?s.scrollTop():t(n.container).offset().top)>=t(i).offset().top+n.threshold+t(i).height()},t.leftofbegin=function(i,n){return(void 0===n.container||n.container===e?s.scrollLeft():t(n.container).offset().left)>=t(i).offset().left+n.threshold+t(i).width()},t.inviewport=function(e,i){return!(t.rightoffold(e,i)||t.leftofbegin(e,i)||t.belowthefold(e,i)||t.abovethetop(e,i))},t.extend(t.expr[":"],{"below-the-fold":function(e){return t.belowthefold(e,{threshold:0})},"above-the-top":function(e){return!t.belowthefold(e,{threshold:0})},"right-of-screen":function(e){return t.rightoffold(e,{threshold:0})},"left-of-screen":function(e){return!t.rightoffold(e,{threshold:0})},"in-viewport":function(e){return t.inviewport(e,{threshold:0})},"above-the-fold":function(e){return!t.belowthefold(e,{threshold:0})},"right-of-fold":function(e){return t.rightoffold(e,{threshold:0})},"left-of-fold":function(e){return!t.rightoffold(e,{threshold:0})}})}(jQuery,window,document),define("libs/jquery/lazyload-1.9.3",function(){}),define("components/lazyload-images",["jquery","version!fly/components/base","version!libs/jquery/lazyload"],function(t){t.widget("cnet.lazyloadImages",t.fly.base,{options:{threshold:200,skip_invisible:!1},_create:function(){this._super(),this._setupEvents(),this._lazyLoadImages()},_setupEvents:function(){this._on(this.$element,{ajaxStop:this._lazyLoadImages})},_lazyLoadImages:function(){window.HTMLImageElement&&"loading"in window.HTMLImageElement.prototype?this.$element.find("img.lazy").each(function(e){var i=t(this);i.attr("src",i.attr("data-original")),i.attr("data-original",null),i.attr("loading","lazy")}):this.$element.find("img.lazy").lazyload(this.options).removeClass("lazy")}})}),define("components/modal-enlarge-image",["jquery","managers/page-vars","managers/tealium","version!fly/components/base","components/global-modal"],function(t,e,i){t.widget("cnet.modalEnlargeImage",t.cnet.globalModal,{options:{},_create:function(){this._super();var n=this.$element.data().target;this._on(t(n),{modalopened:function(e){t("body").addClass("modalImage")},modalclosed:function(e){t("body").removeClass("modalImage")}}),this.$element.on("click",function(){var t=e.tracking.data;i.trackCustomEvent("trackClickToEnlarge",{_articleTitle:t.articleTitle,articleTitle:t.articleTitle,_articleId:t.articleId,articleId:t.articleId,_authorPrimaryName:t._authorPrimaryName,articleType:t.articleType,_articleType:t.articleType,_pageType:t.pageType,siteSection:t.siteSection,_test:t._test,_topicPrimaryId:t.topicId.toString(),siteEdition:t._siteEdition,_siteTypeDevice:t._siteTypeDevice,_siteHier:t._siteHier,pageViewGuid:t._pageViewGuid,_pageViewGuid:t._pageViewGuid,_dwAnonId:t._dwAnonId,dwAnonId:t._dwAnonId,_collectionPrimaryId:t._collectionPrimaryId,viewguid:t.pageViewGuid,clickGenericText:"click-to-enlarge"},"trackClick")})}})}),define("components/article",["jquery","version!fly/managers/debug","managers/client-storage","managers/page-vars","version!fly/utils/url-helper","version!fly/components/base"],function(t,e,i,n,s){e=e.init("article"),t.widget("cnet.article",t.fly.base,{options:{autoplayVideo:!1},data:null,_create:function(){this._setup(),this._autoplayVideo()},_autoplayVideo:function(){if(e.info("Autoplay video",i.read("autoplayEnabled"),this.options.autoplayVideo),"off"!=i.read("autoplayEnabled")&&!1!==this.options.autoplayVideo&&"off"!==s.getParam("autoplayEnabled")){var n=t('.video.shortcode .videoPlayer[data-component^="cnetVideo"], #featuredVideo .videoPlayer[data-component^="cnetVideo"]').first(),a=n.find(".videoPromo");if(e.log("Autoplay video",n,a),n.length>0)try{e.log("Check popout"),this._isInViewport(n)?e.log("no popout"):(n.parent().addClass("popOut"),e.log("do popout",n)),n.cnetVideo("inited")&&(a.trigger("click",{autoplay:!0}),e.log("Click triggered",a))}catch(t){e.warn("Video not ready",t),n.on("onVideoPlayerReady",function(t){e.log("Video ready. Trigger click",t),a.trigger("click",{autoplay:!0})})}else e.info("No video to autoplay");e.log("/Autoplay")}},_isInViewport:function(e){e=t(e);var i=this.$window.scrollTop(),n=i+this.$window.height(),s=e.offset().top,a=s+e.outerHeight();return s<n&&a>i}})}),define("fly/managers/history-2.0",["jquery","version!fly/utils/string-vars"],function(t,e){"use strict";var i=window.history,n=t(window),s=0,a="pushState"in i&&"replaceState"in i&&!(window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window),r=function(t,e){t=t||{},s+=1,this.id="history-"+s,this.title=t.title,this.route=t.route,this.originalTitle=document.title,e&&this.navigate(e,{replace:!0})};return r.prototype={constructor:r,navigate:function(n,s){if(!a)return!1;t.extend(!0,n,{historyId:this.id});var r=(s=s||{}).title||this.title,o=s.url||this.route;r=e.compile(t.isFunction(r)?r(n):r,t.extend({title:this.originalTitle},n)),o=e.compile(t.isFunction(o)?o(n):o,n),i[s.replace?"replaceState":"pushState"](n,r,o),r&&(document.title=r)},stateChange:function(e){if(!a)return!1;var s=this;n.on("popstate."+this.id,function(){var n=i.state||{};n.historyId===s.id&&t.isFunction(e)&&e(n)})},stop:function(){if(!a)return!1;n.off("popstate."+this.id)}},{init:function(t,e){return new r(t,e)}}}),define("managers/trackonomics",["jquery","version!fly/managers/debug"],function(t,e){var i=e.get("trackonomics");return{refreshTrackonomics:function(){try{if("object"==typeof window.trx){i.log("reload trackonomics");var t=window.trx;t.magicLinksEngine=new t.MagicLinks(!1),t.magicLinksEngine.run(!0)}}catch(t){i.log("trackonomics error: "+t)}}}}),define("components/page",["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/managers/history","managers/waypoints","managers/tracking","managers/tealium","managers/trackonomics","managers/ad","managers/guid","managers/page-vars","version!fly/utils/url-helper","version!fly/utils/string-helper","version!fly/components/base","version!libs/waypoints/inview"],function(t,e,i,n,s,a,r,o,l,d,u,c,h){e=e.init("page"),s.init();var p=!1;t.widget("cnet.page",t.fly.base,{options:{ajaxOffset:0,ajaxUrl:null,allowAds:!1,amlTrackingCallback:null,browserTitle:null,browserUrl:null,chartbeatTracking:!0,classCurrent:"current",cmsUrl:null,dwPostPend:"",dwTagOverride:null,hasSubPages:!1,initialPage:!1,limit:-1,loadParentAd:!1,manuallyRefreshClearedAds:!0,manuallyRefreshUnclearedAds:!0,onlyViewPageOnce:!0,preserveQueryString:!0,redirectUrl:null,refreshViewGuid:!0,replaceState:!1,resetAdPosition:!1,taboolaElement:null,trackingEventData:null,trackingPageLoadData:null,trackPageChange:!1,unloadAdsOutOfView:!1,trackScroll25:!1,trackScroll50:!1,trackScroll75:!1,trackScroll100:!1},$parentPage:null,adData:null,adInterval:null,adsCleared:!1,adsInitialized:!0,ajaxWaypoint:null,destructorWaypoints:null,inviewWaypoints:null,inviewWaypointTriggered:!1,loaded:!1,scrollPercentageWaypoints:null,trackingData:null,viewed:!1,_create:function(){this._setup(),this._initHistoryManager(),this.options.chartbeatTracking||(u.services.chartbeat_tracking.enabled=!1),this.viewed=this.options.initialPage,this.loaded=!this.options.ajaxUrl,this.$parentPage=this.$element.parents("[data-page-options]"),this.$parentPage.length>0&&this.$parentPage.data("page")&&!this.$parentPage.data("page").adsInitialized&&(this.adsInitialized=!1),this.adData=u.ads.data,this._initWaypoints()},_initHistoryManager:function(){window.history.scrollRestoration="manual",this.history=n.init(),this.history.stateChange(function(e){if(e.id){var i=t("#"+e.id);i.length>0&&(p=!0,t("html, body").animate({scrollTop:i.offset().top},250,function(){p=!1}))}})},_initWaypoints:function(){var t=this;if(this.options.redirectUrl?this.ajaxWaypoint=new Waypoint({element:this.$element[0],handler:function(e){t._redirect()},offset:this.options.ajaxOffset}):this.options.ajaxUrl&&(this.ajaxWaypoint=new Waypoint({element:this.$element[0],handler:function(e){t._ajaxContent(),this.destroy()},offset:this.options.ajaxOffset})),this.inviewWaypoints=[],this.inviewWaypoints.push(new Waypoint({enabled:!this.loaded||this.$parentPage.length>0,element:this.$element[0],handler:function(e){"down"===e&&(t.inviewWaypointTriggered=!0,t.loaded&&t._viewPage(e))},offset:function(){var e=.5*window.innerHeight;return t.$parentPage.length>0&&(e=window.innerHeight),e}})),this.inviewWaypoints.push(new Waypoint({enabled:!this.loaded||this.$parentPage.length>0,element:this.$element[0],handler:function(e){"up"===e&&(t.inviewWaypointTriggered=!0,t.loaded&&t._viewPage(e))},offset:function(){var e=.5*window.innerHeight-this.element.clientHeight;return t.$parentPage.length>0&&(e=-this.element.clientHeight),e}})),this.options.ajaxUrl||this._initTrackingWaypoints(),"gallery"===u.tracking.data.testName&&"control"!==u.tracking.data.testGroup&&u.tracking.data.maxSlide,this.loaded)for(var e=0;e<this.inviewWaypoints.length;e++)this.inviewWaypoints[e].enable();this.options.unloadAdsOutOfView&&(this.destructorWaypoints=[],this.destructorWaypoints.push(new Waypoint({element:this.$element[0],handler:function(e){"down"===e&&t._unloadAds(t.$element)},offset:"-200%"})),this.destructorWaypoints.push(new Waypoint({element:this.$element[0],handler:function(e){"up"===e&&t._unloadAds(t.$element)},offset:"200%"})))},_initTrackingWaypoints:function(){this.scrollPercentageWaypoints=[],this.options.trackScroll25&&this._setupScrollTrackingWayPoint(.25,"scroll25"),this.options.trackScroll50&&this._setupScrollTrackingWayPoint(.5,"scroll50"),this.options.trackScroll75&&this._setupScrollTrackingWayPoint(.75,"scroll75"),this.options.trackScroll100&&this._setupScrollTrackingWayPoint(1,"scroll100")},_setupGalleryWaypoint:function(){var e=t(".stickyColumnElement .ad-mpu-top").parent(),i=t(".ad-leader-top").parent(),n=new Waypoint.Inview({element:t(".image-gallery .ad-flex-incontent-ad-bottom"),enter:function(t){n&&"none"!==n.options.element.css("display")&&(i.addClass("hidden"),e.addClass("hidden"))},exit:function(t){n&&"none"!==n.options.element.css("display")&&(i.addClass("hidden"),e.addClass("hidden"))},exited:function(t){n&&"none"!==n.options.element.css("display")&&(i.removeClass("hidden"),e.removeClass("hidden"))}})},_setupScrollTrackingWayPoint:function(t,e){var i=this;this.scrollPercentageWaypoints.push(new Waypoint({element:this.$element[0],offset:function(){return-this.element.clientHeight*t+window.innerHeight},handler:function(t){"down"===t&&(i._customTrackingCall("percentageScrollTracking",e),this.destroy())}}))},_redirect:function(){var e=this.options.redirectUrl;if(this.options.preserveQueryString){var i=t.extend({},c.getAllParams(),c.getAllParams(this.options.ajaxUrl));e=c.buildUrl("",c.getPath(e),i)}window.location=e},_ajaxContent:function(){var n=this,s=this.options.ajaxUrl;if(this.options.preserveQueryString){var a=t.extend({},c.getAllParams(),c.getAllParams(this.options.ajaxUrl));s=c.buildUrl("",c.getPath(s),a)}e.log("Loading new page: "+s),t.ajax({dataType:"json",url:s}).done(function(s){if(s.template){n.loaded=!0,n.adData=s.adData,n.adsInitialized=!1,n.trackingData=s.trackingData,n.$element.html(s.template),s.featureFlags&&(u.services=s.featureFlags),i.process(n.$element),window.cbsoptanon&&(window.cbsoptanon.onIframesReady(function(){window.cbsoptanon.tags.load("IFRAME")}),window.cbsoptanon.onScriptsReady(function(){window.cbsoptanon.ot.getState(function(e,i,s,a){n.$element.find("[class^=optanon-category-]").each(function(){var n=!1;switch(parseInt(t(this).prop("className").slice(-1))){case 2:n=i;break;case 3:n=s;break;case 4:n=e;break;case 5:n=a}if(n&&"SCRIPT"===t(this).prop("tagName")&&"text/plain"===t(this).attr("type")){t(this).attr("type","application/javascript");var r=t(this).clone();t(this).html(r)}})})})),n.inviewWaypointTriggered&&n._viewPage("down"),n._initTrackingWaypoints();var a=t("[data-page-options]").filter(function(e,i){return 0===t(i).parent().closest("[data-page-options]").length});if(s.after&&(n.options.limit<0||a.length<n.options.limit)){var r=t(s.after);n.$element.after(r),i.process(r)}}else e.log("No content template found.")})},_viewPage:function(e){var i=this;if(this._updateUrl(),!this.options.onlyViewPageOnce||!this.viewed){if(this.viewed=!0,this.options.hasSubPages)this.options.trackingEventData&&this._trackEvent(e);else{if(this._updatePageVars(),this.options.trackingPageLoadData&&this._trackPV(e),this.options.allowAds){var n=this.options.loadParentAd?this.$parentPage:this.$element;this._loadAds(n)}if("gallery"===u.tracking.data.testName&&"a"===u.tracking.data.testGroup){var s=l.getAdUnits(u.ads.data.gpt.containerId,null,["mpu-top"]);i.adInterval=setInterval(function(){clearInterval(i.adInterval),i.$element.hasClass("current")&&1!==i.$element.data("slide-num")&&l.loadAds(s,this.adData,{})},100)}}this.options.amlTrackingCallback&&t.ajax(this.options.amlTrackingCallback)}this.options.trackPageChange&&this.options.trackingEventData&&this._trackEvent(e)},_loadAds:function(i){var n=!1,s=t.extend({},this.adData);t.extend(s.gpt.targeting,i.data("customAdVars")),this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").adsInitialized&&(this.adsInitialized=!0);var a=u.services.skybox&&u.services.skybox.enabled,r=t(window.document.body).hasClass("skybox-loaded"),d=[];if(a&&r&&(d=l.getAdUnits(null,null,["nav-ad-plus","mobile-nav-ad-plus","nav-ad-plus-leader"])),!this.adsInitialized){e.log("loading all ads for the current container/page");var c=l.getAdUnits(u.ads.data.gpt.containerId).concat(d);l.loadAds(c,s,{resetIncrementalPosition:this.options.resetAdPosition,excludeDisabled:!0,incrementPageView:!0}),this.adsInitialized=!0,n=!0,this.$parentPage.length>0&&this.$parentPage.data("page")&&(this.$parentPage.data("page").adsInitialized=!0)}(this.options.manuallyRefreshClearedAds&&this.adsCleared||this.options.manuallyRefreshUnclearedAds&&!this.adsCleared)&&(e.log("refreshing all ads contained within the page",i),c=l.getAdUnits(null,null,null,i.get(0)).concat(d).filter(function(e){var i=t(e),s=u.ads.data.gpt.adConfig.adUnits[h.toCamelCase(i.data("ad"))],a=s.disableInitialLoad||s.delayLoad||!0===i.data("disableInitialLoad");return!0!==n||a}),l.loadAds(c,s,{resetIncrementalPosition:this.options.resetAdPosition,incrementPageView:!0!==n}),this.adsCleared=!1),this._initTaboola(),o.refreshTrackonomics()},_initTaboola:function(){if(u.services.taboola.enabled){var e=t("#"+this.options.taboolaElement);e.length>0&&e.taboola(e.data("taboola"))}},_unloadAds:function(t){this.adsInitialized&&(e.log("Unloading all ads contained within",t),l.removeAds(l.getAdUnits(null,null,null,t.get(0)),!1),this.adsCleared=!0)},_updatePageVars:function(){this.trackingData?a.resetTrackingData(this.trackingData):this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").trackingData&&(this.trackingData=t.extend(!0,{},u.tracking.data,this.$parentPage.data("page").trackingData),a.resetTrackingData(this.trackingData)),this.adData?u.ads.data=this.adData:this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").adData&&(u.ads.data=this.adData=this.$parentPage.data("page").adData),this.options.refreshViewGuid&&d.resetViewGuid()},_updateUrl:function(){if(this.options.browserUrl&&!p){var e=this.options.browserUrl;if(this.options.preserveQueryString){var i=t.extend({},c.getAllParams(),c.getAllParams(this.options.browserUrl));e=c.buildUrl("",c.getPath(e),i)}this.history.navigate({id:this.$element.attr("id")},{title:this.options.browserTitle||document.title,url:e,replace:this.options.replaceState}),t("[data-page-options]").removeClass(this.options.classCurrent),this.$element.addClass(this.options.classCurrent),this.options.cmsUrl&&t("body").attr("data-cms-edit",'{"url":"'+this.options.cmsUrl+'"}'),this.$window.trigger("urlChanged")}},_trackEvent:function(e){var i=e+"."+(t("[data-page-options]").filter(function(e,i){return 0===t(i).parent().closest("[data-page-options]").length}).index(this.$element)+("up"===e?1:0));this._customTrackingCall("trackPageEvent",i)},_trackPV:function(e){var i=u.tracking.data,n=t("[data-page-options]").filter(function(e,i){return 0===t(i).parent().closest("[data-page-options]").length}).index(this.$element)+("up"===e?1:0),s="";this.options.dwTagOverride?s=this.options.dwTagOverride:n>=0&&(s=e+"."+n+this.options.dwPostPend),r.trackPageLoad(t.extend(!0,{articleId:i.articleId,articleTitle:i.articleTitle,articleType:i.articleType,articleAuthorName:i.articleAuthorName,brand:i.brand,clickGenericText:"",collectionId:i.collectionId,dwLinkTag:s,event:"log",mfr:i.mfr,pageTitle:i.articleTitle,riaevent:"view",siteEdition:i.siteEdition,siteHier:i.siteHier,siteSection:i.siteSection,_pageFindingMethods:"",_pageViewGuid:i.pageViewGuid,_siteEdition:i.siteEdition,_topicPrimaryId:i.topicId?i.topicId[0]:null},this.options.trackingPageLoadData||{}))},_customTrackingCall:function(e,i){var n=u.tracking.data;r.trackCustomEvent(e,t.extend(!0,{articleId:n.articleId,articleTitle:n.articleTitle,articleType:n.articleType,clickGenericText:i,collectionId:n.collectionId,pageTitle:n.photoGalleryTitle,pageType:n.pageType,pageViewGuid:n.pageViewGuid,siteEdition:n.siteEdition,siteHier:n.siteHier,siteSection:n.siteSection,topicId:n.topicId,_dwAnonId:n._dwAnonId},this.options.trackingEventData||{}),"trackClick")}})}),define("components/sliding-element",["jquery","version!fly/managers/debug","managers/waypoints","version!fly/components/base"],function(t,e,i){e=e.init("slidingElement"),i.init(),t.widget("cnet.slidingElement",t.fly.base,{options:{classFixed:"fixed",classReady:"ready",offset:0,offsetGuideParallelBottom:0,offsetGuideParallelTop:0,selectorGuideBottom:null,selectorGuideParallel:null,selectorGuideTop:null,stickTo:"top"},$guideBottom:null,$guideParallel:null,$guideTop:null,$html:null,boundaryBottom:0,boundaryTop:0,stickToBottom:!1,waypoints:null,_create:function(){this._setup(),this.stickToBottom="bottom"===this.options.stickTo,this._setupElements(),this._setupEvents(),this.$element.addClass(this.options.classReady)},_setupElements:function(){this.$html=t("html"),this.options.selectorGuideBottom&&(this.$guideBottom=t(this.options.selectorGuideBottom)),this.options.selectorGuideParallel&&(this.$guideParallel=t(this.options.selectorGuideParallel)),this.options.selectorGuideTop&&(this.$guideTop=t(this.options.selectorGuideTop)),this.$guideParallel&&!this.$guideTop&&(this.boundaryTop="string"==typeof this.options.offsetGuideParallelTop?parseInt(this.options.offsetGuideParallelTop,10)*this.$guideParallel.outerHeight()/100:this.options.offsetGuideParallelTop,this.$element.css({top:this.boundaryTop+"px"}))},_setupEvents:function(){var t=this;this.waypoints=[],this.$guideTop?this.waypoints.push(new Waypoint({element:this.$guideTop,handler:this._topWaypointHandler.bind(this),offset:function(){var e=t.$html.css("zoom")||1,i=t.options.offset-t.$guideTop.outerHeight();return t.stickToBottom&&(i=(i-t.$element.outerHeight())*e+t.$window.height()),i}})):this.$guideParallel&&this.waypoints.push(new Waypoint({element:this.$guideParallel,handler:this._topWaypointHandler.bind(this),offset:function(){var e=t.$html.css("zoom")||1,i=t.options.offset-t.boundaryTop;return t.stickToBottom&&(i=(i-t.$element.outerHeight())*e+t.$window.height()),i}})),this.$guideBottom?this.waypoints.push(new Waypoint({element:this.$guideBottom,handler:this._bottomWaypointHandler.bind(this),offset:function(){var e=t.$html.css("zoom")||1,i=t.options.offset+t.$element.outerHeight();return t.stickToBottom&&(i=(i-t.$element.outerHeight())*e+t.$window.height()),i}})):this.$guideParallel&&this.waypoints.push(new Waypoint({element:this.$guideParallel,handler:this._bottomWaypointHandler.bind(this),offset:function(){var e=t.$html.css("zoom")||1;t.boundaryBottom=t.$guideParallel.outerHeight()-t.$element.outerHeight()-("string"==typeof t.options.offsetGuideParallelBottom?parseInt(t.options.offsetGuideParallelBottom,10)*t.$guideParallel.outerHeight()/100:t.options.offsetGuideParallelBottom);var i=t.options.offset-t.boundaryBottom;return t.stickToBottom&&(i=(i-t.$element.outerHeight())*e+t.$window.height()),i}}))},_topWaypointHandler:function(t){if("down"===t)this.$element.addClass(this.options.classFixed);else{var e=this.boundaryTop;if(this.$guideTop){var i=this.$guideTop.offset(),n=this.$element.parent().offset();e=i.top+this.$guideTop.outerHeight()-n.top}this.$element.removeClass(this.options.classFixed).css({top:e+"px"})}},_bottomWaypointHandler:function(t){if("down"===t){var e=this.boundaryBottom;if(this.$guideBottom){var i=this.$guideBottom.offset(),n=this.$element.parent().offset();e=i.top-n.top-this.$element.outerHeight()}this.$element.removeClass(this.options.classFixed).css({top:e+"px"})}else this.$element.addClass(this.options.classFixed)}})}),define("managers/events",["jquery","version!fly/managers/debug"],function(t,e){e=e.init("events");var i={};return{publish:function(t,e){for(var n=0;n<t.length;n++)if(i[t[n]]&&i[t[n]][e])for(var s=0;s<i[t[n]][e].length;s++)i[t[n]][e][s]()},subscribe:function(t,e){for(var n in e)if(e.hasOwnProperty(n))for(var s in i[n]=i[n]||{},e[n])e[n].hasOwnProperty(s)&&(i[n][s]=i[n][s]||[],i[n][s].push(t[e[n][s]].bind(t)))}}}),define("components/sticky-column",["jquery","managers/tealium","managers/events","version!fly/managers/debug","managers/waypoints","version!fly/libs/jquery.throttle-debounce","version!fly/components/base"],function(t,e,i,n,s){n=n.init("stickyColumn"),s.init(),t.widget("cnet.stickyColumn",t.fly.base,{options:{classFixed:"fixed",classReady:"ready",enableWaypoints:!0,minimumGap:250,offset:0,selectorHeightConstraint:"",selectorHideElement:"",eventChannels:null,eventSubscriptions:null},$constraint:null,divisionSize:0,height:0,waypoints:null,$fixedChild:null,_create:function(){this._setup();var e=this;e._setupElements(),e._setupEvents(),n.log("First sticky column setup"),t(window).on("resize",t.throttle(250,function(){e._resizeStickyCol(),n.log("Resized sticky column setup")})),this.$constraint.find("img.lazy[loading='lazy']").on("load",function(){e._resizeStickyCol(),n.log("lazy image sticky column setup")})},_resizeStickyCol:function(){t(this.waypoints).each(function(){this.destroy()}),this._clearHeight(),this._setupElements(),this._setupEvents()},_setupElements:function(){this.$constraint=this.$element.closest(this.options.selectorHeightConstraint),0===this.$constraint.length&&(this.$constraint=t(this.options.selectorHeightConstraint).first()),this._setHeight(),this._hideExtraOptionalElements(),this._createElementDivisions(),this.$element.addClass(this.options.classReady)},_setHeight:function(){var e=this.$element.children('[data-meta*="type":"static"], [data-meta*="type":"required"]'),i=(e.length-1)*this.options.minimumGap;e.each(function(e,n){var s=t(n);i+=s.data("meta").height||s.outerHeight()}),this.height=Math.max(i,this.$constraint.outerHeight()),this.$element.height(this.height),n.log("Height: ",this.height),n.log("Min-height: ",i),n.log("Required children: ",e.length)},_clearHeight:function(){this.height=0,this.$element.height("auto")},_hideExtraOptionalElements:function(){var e=this.$element.children(),i=e.filter('[data-meta*="type":"optional"]');if(i.length>0){var s=(e.length-1)*this.options.minimumGap;for(e.each(function(e,i){var n=t(i);s+=n.data("meta").height||n.outerHeight()});s>this.height&&i&&i.length>0;){var a=i.last();s-=a.outerHeight()+this.options.minimumGap,i=i.slice(0,-1),a.remove()}}n.log("Opt. children: ",i.length)},_createElementDivisions:function(){var e=this.$element.children();this.divisionSize=this.height/e.length,this.options.selectorHideElement&&(this.divisionSize=t(this.options.selectorHideElement).offset().top-this.options.offset);for(var i=1;i<e.length;i++){var s=i*this.divisionSize,a=e.eq(i),r=e.eq(i-1),o=a.data("meta")&&a.data("meta").height?a.data("meta").height:a.outerHeight(),l=r.data("meta")&&r.data("meta").height?r.data("meta").height:r.outerHeight();l+=r.position().top;var d=o-this.divisionSize;d>0?s-=d:l>s&&(s=l),a.css("top",s+"px")}n.log("Division size: ",this.divisionSize)},_setupEvents:function(){if(this.options.enableWaypoints){var i=this.$element.children();this.waypoints=[];for(var s=this,a=0;a<i.length;a++){var r=i.eq(a);if(r.data("meta")&&"static"!==r.data("meta").type){var o=r.data("meta").height||r.outerHeight(),l=a*this.divisionSize,d=(a+1)*this.divisionSize-o,u=a+1===i.length;this.divisionSize>o&&(this.waypoints.push(new Waypoint({element:this.$element,handler:this._topWaypointHandler.bind(this,r,l),offset:this.options.offset-l})),this.waypoints.push(new Waypoint({element:this.$element,handler:this._bottomWaypointHandler.bind(this,r,d,o,u),offset:u?this._getLastBottomOffset.bind(this,o):this.options.offset-d})))}}new Waypoint({element:this.$element,handler:function(n){if("down"===n)for(var s=0;s<i.length;s++){var a=i.eq(s);if(a.data("meta")&&a.data("meta").trackingData){var r=t.extend(!0,{},this._baseTrackingData,a.data("meta").trackingData);e.trackCustomEvent("impression",r,"trackClick")}}},offset:"100%"}),""!==this.options.selectorHideElement&&(new Waypoint({element:t(this.options.selectorHideElement),group:"hideElement",handler:function(t){s.$fixedChild&&("down"===t?(n.log("tophandle - down"),s.$element.children(".fixed").addClass("hidden")):(n.log("tophandle - up"),s.$element.children(".hidden").removeClass("hidden")))},offset:function(){return s.$fixedChild?s.$fixedChild.offset().top-t(window).scrollTop()+s.$fixedChild.height():"0"}}),new Waypoint({element:t(this.options.selectorHideElement),group:"hideElement",handler:function(t){s.$fixedChild&&("down"===t?(n.log("bottomhandle - down"),s.$element.children(".hidden").removeClass("hidden")):(n.log("bottomhandle - up"),s.$element.children(".fixed").addClass("hidden")))},offset:function(){return s.$fixedChild?s.$fixedChild.offset().top-t(window).scrollTop()-t(s.options.selectorHideElement).height():"0"}}))}},_topWaypointHandler:function(t,e,i){"down"===i?(t.addClass(this.options.classFixed),this.$fixedChild=t):(t.removeClass(this.options.classFixed).css({top:e+"px"}),this.$fixedChild=null)},_bottomWaypointHandler:function(t,e,i,n,s){n&&(e=this.$constraint.outerHeight()-i),"down"===s?(t.removeClass(this.options.classFixed).css({top:e+"px"}),this.$fixedChild=null):(t.addClass(this.options.classFixed),this.$fixedChild=t)},_getLastBottomOffset:function(t){var e=this.$constraint.outerHeight()-t;return n.log("Bottom offset: ",this.options.offset-e),this.options.offset-e}})}),define("components/selfish-scroll",["jquery","version!fly/managers/debug","version!fly/components/base"],function(t,e){e=e.init("selfishScroll"),t.widget("cnet.selfishScroll",t.fly.base,{options:{threshold:5},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var t=this;this.$element.on("scroll wheel",function(){var e=t.options.threshold<5?5:t.options.threshold,i=e,n=this.scrollHeight-e;Math.floor(this.scrollTop)<=i?this.scrollTop=i:Math.ceil(this.scrollTop+this.clientHeight)>=n&&(this.scrollTop=n-this.clientHeight)})}})}),define("components/update-area",["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/components/base"],function(t,e,i){e=e.init("updateArea"),t.widget("cnet.updateArea",t.fly.base,{options:{url:""},_create:function(){this._super(),this._setupEvents()},_setupEvents:function(){this.options.url.length>0&&this.doAjax(this.options.url)},doAjax:function(e){var i=this;t.ajax({url:e,dataType:"json"}).done(function(e){t.each(e.pageElements,function(t){var n=e.pageElements[t].html;i.updateView(n,t)})})},updateView:function(e,n){var s=t("[data-update-area="+n+"]");s.html(e),i.process(s);var a=s.find("[data-video-playlist]");a.length>0&&require(["quantum/videoPlayer","quantum/inviewElement"],function(){t("body").hasClass("videoPlayerReady")?t(window).trigger("appendPlaylist",{data:a.data("videoPlaylist")}):t('[data-component="videoPlayer"]').one("onVideoPlayerReady",function(){t(window).trigger("appendPlaylist",{data:a.data("videoPlaylist")})})})}})}),define("components/sticky-leader",["jquery","version!fly/managers/debug","managers/page-vars","components/sticky-element","version!libs/waypoints/jquery.waypoints"],function(t,e,i){e=e.init("stickyLeader"),t.widget("cnet.stickyLeader",t.cnet.stickyElement,{options:{classFadeOut:"fadeOut",duration:0,selectorUnstick:null,topOffset:null,bottomOffset:-60,alwaysSticky:!1},beginWaypoint:null,endWaypoint:null,_create:function(){this._super()},_setupEvents:function(){var e=this,i=this.$placeholder[0];this.beginWaypoint=new Waypoint({element:i,handler:function(t){"down"===t?(e.$placeholder.removeClass(e.options.classHidden),e.$element.addClass(e.options.classFixed)):(e.$placeholder.addClass(e.options.classHidden),e.$element.removeClass(e.options.classFixed))},offset:e.options.topOffset}),e.options.duration>0?setTimeout(function(){e.beginWaypoint.disable(),e.$element.addClass(e.options.classFadeOut),setTimeout(function(){e.$placeholder.addClass(e.options.classHidden),e.$element.removeClass(e.options.classFixed+" "+e.options.classFadeOut)},500)},e.options.duration):this.options.selectorUnstick?this.endWaypoint=new Waypoint({element:t(this.options.selectorUnstick),handler:function(t){"down"===t&&(e.beginWaypoint.disable(),e.endWaypoint.disable(),e.$element.addClass(e.options.classFadeOut),setTimeout(function(){e.$placeholder.addClass(e.options.classHidden),e.$element.removeClass(e.options.classFixed+" "+e.options.classFadeOut)},500))},offset:0}):0==e.options.alwaysSticky&&(this.endWaypoint=new Waypoint({element:i,handler:function(t){"down"===t&&(e.beginWaypoint.disable(),e.endWaypoint&&e.endWaypoint.disable(),e.$element.addClass("fadeOut"),setTimeout(function(){e.$placeholder.addClass(e.options.classHidden),e.$element.removeClass(e.options.classFixed+" fadeOut")},500))},offset:e.options.bottomOffset}))}})}),define("components/track-download",["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(t,e,i,n){e=e.init("trackDownload"),t.widget("cnet.trackDownload",t.fly.base,{options:{},_create:function(){this._super(),this.$element.on("click",function(){i.trackCustomEvent("trackDownload",{clickGenericText:"HeadertoDL",_siteSection:n.tracking.data.siteSection,siteEdition:n.tracking.data.siteEdition,_siteTypeDevice:n.tracking.data.deviceType,_pageType:n.tracking.data.pageType},"trackClick")})}})}),define("components/social-tracking",["jquery","version!fly/managers/debug","managers/tealium","version!fly/components/base"],function(t,e,i){e=e.init("socialTracking"),t.widget("cnet.socialTracking",t.fly.base,{options:{socialSite:"notSet"},_create:function(){this._setup(),this._setupTracking()},_setupTracking:function(){e.log("Setting up social tracking");var n=this.options;t(this.$element).on("click",function(s){e.log("Social Element Clicked, Tracking Now");var a=n.socialSite,r=i.getDwTag(t(s.target));i.trackSocial({socialService:a,event:"share",eventt:"socialsite",socialId:{facebooksend:1,facebook:2,googlePlus:3,linkedin:21,pinterest:5,reddit:6,stumbleupon:7,twitter:8,twitterfollow:9,email:10,delicious:12,tumblr:14}[a],wd:"sharelink",dwLinkTag:r,sharebarSection:r}),e.log("Social Element Tracked")})}})}),define("components/external-link",["jquery","version!fly/managers/debug","version!fly/components/base","managers/tealium"],function(t,e,i){var n=e.init("tracking");t.widget("cnet.externalLink",t.fly.base,{options:{},_create:function(){this._setup(),this.$element.click(function(t){i.trackExternalLink({clickGenericText:"trackExternalLink"}),n.log("External link clicked.")}.bind(this))}})}),define("translations/video",["managers/edition"],function(t){return t.getTranslation({en:{resume:"Your video will resume in ",resumeShortly:"Your video will resume shortly",seconds:" seconds",adBlock:{title:"Sorry about that",message:"It looks like you're using an ad blocker. We know you don't love ads. But they allow us to pay the writers, editors and producers who work to make your favorite CNET videos. To watch this video, please disable your ad blocker and refresh the page. Thanks for tuning in. You're the best."},firefoxUpgrade:{title:"Your version of Firefox is no longer supported.",message:'<a href="http://download.cnet.com/s/firefox/" target="_blank">Click here to download the latest version.</a>'},videoNotAvailable:{title:"We're sorry, but this video is no longer available.",message:"Please watch this next video instead."},upnext:"up next",autoplay:"Autoplay",on:"on",off:"off",cannotPlay:"This device is unable to play the requested video.",by:"by",playSound:"Play Sound"},es:{resume:"El vídeo se reanudará en ",resumeShortly:"El vídeo se reanudará en breve",seconds:" segundos",adBlock:{title:"Lo sentimos",message:"Parece que estás usando un software para bloquear anuncios. Sabemos que a mucha gente no lo encantan los anuncios, pero nos ayudan a pagarle a nuestro equipo de profesionales que hacen tus videos favoritos. Para ver este video, por favor desactiva el software y vuelve a cargar la página. ¡Mil gracias!"},firefoxUpgrade:{title:"La versión de Firefox que usas no está actualizada.",message:'<a href="http://download.cnet.com/s/firefox/" target="_blank">Por favor descarga la versión más reciente.</a>'},videoNotAvailable:{title:"Lo sentimos, pero este video ya no está disponible.",message:"Por favor, vea el siguiente video en su lugar."},upnext:"Siguiente",autoplay:"Autoplay",on:"Sí",off:"No",cannotPlay:"Este dispositivo no puede reproducir el video solicitado.",by:"por",playSound:"¿Reproducir sonido?"}})}),function(){var t,e,n,s,a,r;(function(){var t,e=200,i="Expected a function",n="__lodash_hash_undefined__",s=500,a="__lodash_placeholder__",r=1,o=2,l=4,d=1,u=2,c=1,h=2,p=4,g=8,f=16,v=32,m=64,_=128,E=512,A=800,y=16,b=1,S=2,T=1/0,C=9007199254740991,I=1.7976931348623157e308,D=NaN,R=4294967295,P=[["ary",_],["bind",c],["bindKey",h],["curry",g],["curryRight",f],["flip",E],["partial",v],["partialRight",m],["rearg",256]],w="[object Arguments]",k="[object Array]",M="[object AsyncFunction]",O="[object Boolean]",L="[object Date]",N="[object DOMException]",U="[object Error]",B="[object Function]",j="[object GeneratorFunction]",x="[object Map]",F="[object Number]",G="[object Null]",V="[object Object]",H="[object Proxy]",$="[object RegExp]",q="[object Set]",W="[object String]",K="[object Symbol]",z="[object Undefined]",Y="[object WeakMap]",X="[object ArrayBuffer]",Q="[object DataView]",J="[object Float32Array]",Z="[object Float64Array]",tt="[object Int8Array]",et="[object Int16Array]",it="[object Int32Array]",nt="[object Uint8Array]",st="[object Uint8ClampedArray]",at="[object Uint16Array]",rt="[object Uint32Array]",ot=/\b__p \+= '';/g,lt=/\b(__p \+=) '' \+/g,dt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ut=/[&<>"']/g,ct=RegExp(ut.source),ht=/<%=([\s\S]+?)%>/g,pt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,gt=/^\w*$/,ft=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,vt=/^\s+|\s+$/g,mt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,_t=/\{\n\/\* \[wrapped with (.+)\] \*/,Et=/,? & /,At=/\\(\\)?/g,yt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,bt=/\w*$/,St=/^[-+]0x[0-9a-f]+$/i,Tt=/^0b[01]+$/i,Ct=/^\[object .+?Constructor\]$/,It=/^0o[0-7]+$/i,Dt=/^(?:0|[1-9]\d*)$/,Rt=/($^)/,Pt=/['\n\r\u2028\u2029\\]/g,wt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",kt="[\\ud800-\\udfff]",Mt="["+wt+"]",Ot="\\ud83c[\\udffb-\\udfff]",Lt="[^\\ud800-\\udfff]",Nt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ut="[\\ud800-\\udbff][\\udc00-\\udfff]",Bt="(?:"+Mt+"|"+Ot+")"+"?",jt="[\\ufe0e\\ufe0f]?"+Bt+("(?:\\u200d(?:"+[Lt,Nt,Ut].join("|")+")[\\ufe0e\\ufe0f]?"+Bt+")*"),xt="(?:"+[Lt+Mt+"?",Mt,Nt,Ut,kt].join("|")+")",Ft=RegExp(Ot+"(?="+Ot+")|"+xt+jt,"g"),Gt=RegExp("[\\u200d\\ud800-\\udfff"+wt+"\\ufe0e\\ufe0f]"),Vt=-1,Ht={};Ht[J]=Ht[Z]=Ht[tt]=Ht[et]=Ht[it]=Ht[nt]=Ht[st]=Ht[at]=Ht[rt]=!0,Ht[w]=Ht[k]=Ht[X]=Ht[O]=Ht[Q]=Ht[L]=Ht[U]=Ht[B]=Ht[x]=Ht[F]=Ht[V]=Ht[$]=Ht[q]=Ht[W]=Ht[Y]=!1;var $t={};$t[w]=$t[k]=$t[X]=$t[Q]=$t[O]=$t[L]=$t[J]=$t[Z]=$t[tt]=$t[et]=$t[it]=$t[x]=$t[F]=$t[V]=$t[$]=$t[q]=$t[W]=$t[K]=$t[nt]=$t[st]=$t[at]=$t[rt]=!0,$t[U]=$t[B]=$t[Y]=!1;var qt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Wt=parseInt,Kt="object"==typeof global&&global&&global.Object===Object&&global,zt="object"==typeof self&&self&&self.Object===Object&&self,Yt=Kt||zt||Function("return this")(),Xt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Qt=Xt&&"object"==typeof module&&module&&!module.nodeType&&module,Jt=Qt&&Qt.exports===Xt,Zt=Jt&&Kt.process,te=function(){try{return Zt&&Zt.binding&&Zt.binding("util")}catch(t){}}(),ee=te&&te.isDate,ie=te&&te.isMap,ne=te&&te.isSet,se=te&&te.isTypedArray;function ae(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function re(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}function oe(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function le(t,e){for(var i=-1,n=null==t?0:t.length,s=0,a=[];++i<n;){var r=t[i];e(r,i,t)&&(a[s++]=r)}return a}function de(t,e){return!!(null==t?0:t.length)&&ve(t,e,0)>-1}function ue(t,e,i){for(var n=-1,s=null==t?0:t.length;++n<s;)if(i(e,t[n]))return!0;return!1}function ce(t,e){for(var i=-1,n=null==t?0:t.length,s=Array(n);++i<n;)s[i]=e(t[i],i,t);return s}function he(t,e){for(var i=-1,n=e.length,s=t.length;++i<n;)t[s+i]=e[i];return t}function pe(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}var ge=Ee("length");function fe(t,e,i,n){for(var s=t.length,a=i+(n?1:-1);n?a--:++a<s;)if(e(t[a],a,t))return a;return-1}function ve(t,e,i){return e==e?function(t,e,i){var n=i-1,s=t.length;for(;++n<s;)if(t[n]===e)return n;return-1}(t,e,i):fe(t,_e,i)}function me(t,e,i,n){for(var s=i-1,a=t.length;++s<a;)if(n(t[s],e))return s;return-1}function _e(t){return t!=t}function Ee(e){return function(i){return null==i?t:i[e]}}function Ae(t){return function(e){return t(e)}}function ye(t,e){return ce(e,function(e){return t[e]})}function be(t,e){return t.has(e)}var Se,Te=(Se={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(e){return null==Se?t:Se[e]});function Ce(t){return"\\"+qt[t]}function Ie(t){return Gt.test(t)}function De(t){var e=-1,i=Array(t.size);return t.forEach(function(t,n){i[++e]=[n,t]}),i}function Re(t,e){return function(i){return t(e(i))}}function Pe(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function we(t){return Ie(t)?function(t){var e=Ft.lastIndex=0;for(;Ft.test(t);)++e;return e}(t):ge(t)}function ke(t){return Ie(t)?function(t){return t.match(Ft)||[]}(t):function(t){return t.split("")}(t)}var Me,Oe=Array.prototype,Le=Function.prototype,Ne=Object.prototype,Ue=Yt["__core-js_shared__"],Be=Le.toString,je=Ne.hasOwnProperty,xe=(Me=/[^.]+$/.exec(Ue&&Ue.keys&&Ue.keys.IE_PROTO||""))?"Symbol(src)_1."+Me:"",Fe=Ne.toString,Ge=Be.call(Object),Ve=Yt._,He=RegExp("^"+Be.call(je).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$e=Jt?Yt.Buffer:t,qe=Yt.Symbol,We=Yt.Uint8Array,Ke=$e?$e.allocUnsafe:t,ze=Re(Object.getPrototypeOf,Object),Ye=Object.create,Xe=Ne.propertyIsEnumerable,Qe=Oe.splice,Je=qe?qe.isConcatSpreadable:t,Ze=qe?qe.iterator:t,ti=qe?qe.toStringTag:t,ei=function(){try{var t=Bn(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),ii=Math.ceil,ni=Math.floor,si=Object.getOwnPropertySymbols,ai=$e?$e.isBuffer:t,ri=Re(Object.keys,Object),oi=Math.max,li=Math.min,di=Date.now,ui=Oe.reverse,ci=Bn(Yt,"DataView"),hi=Bn(Yt,"Map"),pi=Bn(Yt,"Promise"),gi=Bn(Yt,"Set"),fi=Bn(Yt,"WeakMap"),vi=Bn(Object,"create"),mi=fi&&new fi,_i={},Ei=ss(ci),Ai=ss(hi),yi=ss(pi),bi=ss(gi),Si=ss(fi),Ti=qe?qe.prototype:t,Ci=Ti?Ti.valueOf:t,Ii=Ti?Ti.toString:t;function Di(t){if(Ls(t)&&!Cs(t)&&!(t instanceof ki)){if(t instanceof wi)return t;if(je.call(t,"__wrapped__"))return as(t)}return new wi(t)}var Ri=function(){function e(){}return function(i){if(!Os(i))return{};if(Ye)return Ye(i);e.prototype=i;var n=new e;return e.prototype=t,n}}();function Pi(){}function wi(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=t}function ki(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=R,this.__views__=[]}function Mi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Oi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Li(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ni(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Li;++e<i;)this.add(t[e])}function Ui(t){var e=this.__data__=new Oi(t);this.size=e.size}function Bi(t,e){var i=Cs(t),n=!i&&Ts(t),s=!i&&!n&&Rs(t),a=!i&&!n&&!s&&Gs(t),r=i||n||s||a,o=r?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],l=o.length;for(var d in t)!e&&!je.call(t,d)||r&&("length"==d||s&&("offset"==d||"parent"==d)||a&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||Hn(d,l))||o.push(d);return o}function ji(e,i,n){var s=e[i];je.call(e,i)&&Ss(s,n)&&(n!==t||i in e)||Fi(e,i,n)}function xi(t,e){for(var i=t.length;i--;)if(Ss(t[i][0],e))return i;return-1}function Fi(t,e,i){"__proto__"==e&&ei?ei(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function Gi(e,i,n){return e==e&&(n!==t&&(e=e<=n?e:n),i!==t&&(e=e>=i?e:i)),e}function Vi(e,i,n,s,a,d){var u,c=i&r,h=i&o,p=i&l;if(n&&(u=a?n(e,s,a,d):n(e)),u!==t)return u;if(!Os(e))return e;var g=Cs(e);if(g){if(u=function(t){var e=t.length,i=new t.constructor(e);e&&"string"==typeof t[0]&&je.call(t,"index")&&(i.index=t.index,i.input=t.input);return i}(e),!c)return In(e,u)}else{var f=Fn(e),v=f==B||f==j;if(Rs(e))return function(t,e){if(e)return t.slice();var i=t.length,n=Ke?Ke(i):new t.constructor(i);return t.copy(n),n}(e,c);if(f==V||f==w||v&&!a){if(u=h||v?{}:function(t){return"function"!=typeof t.constructor||Wn(t)?{}:Ri(ze(t))}(e),!c)return h?function(t,e){return Dn(t,xn(t),e)}(e,function(t,e){return t&&Dn(e,Zs(e),t)}(u,e)):function(t,e){return Dn(t,jn(t),e)}(e,function(t,e){return t&&Dn(e,Js(e),t)}(u,e))}else{if(!$t[f])return a?e:{};u=function(t,e,i){var n=t.constructor;switch(e){case X:return Tn(t);case O:case L:return new n(+t);case Q:return function(t,e){var i=e?Tn(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case J:case Z:case tt:case et:case it:case nt:case st:case at:case rt:return function(t,e){var i=e?Tn(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}(t,i);case x:return new n;case F:case W:return new n(t);case $:return(r=new(a=t).constructor(a.source,bt.exec(a))).lastIndex=a.lastIndex,r;case q:return new n;case K:return s=t,Ci?Object(Ci.call(s)):{}}var s;var a,r}(e,f,c)}}d||(d=new Ui);var m=d.get(e);if(m)return m;if(d.set(e,u),js(e))return e.forEach(function(t){u.add(Vi(t,i,n,t,e,d))}),u;if(Ns(e))return e.forEach(function(t,s){u.set(s,Vi(t,i,n,s,e,d))}),u;var _=g?t:(p?h?On:Mn:h?Zs:Js)(e);return re(_||e,function(t,s){_&&(t=e[s=t]),ji(u,s,Vi(t,i,n,s,e,d))}),u}Di.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:ht,variable:"",imports:{_:Di}},Di.prototype=Pi.prototype,Di.prototype.constructor=Di,wi.prototype=Ri(Pi.prototype),wi.prototype.constructor=wi,ki.prototype=Ri(Pi.prototype),ki.prototype.constructor=ki,Mi.prototype.clear=function(){this.__data__=vi?vi(null):{},this.size=0},Mi.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Mi.prototype.get=function(e){var i=this.__data__;if(vi){var s=i[e];return s===n?t:s}return je.call(i,e)?i[e]:t},Mi.prototype.has=function(e){var i=this.__data__;return vi?i[e]!==t:je.call(i,e)},Mi.prototype.set=function(e,i){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=vi&&i===t?n:i,this},Oi.prototype.clear=function(){this.__data__=[],this.size=0},Oi.prototype.delete=function(t){var e=this.__data__,i=xi(e,t);return!(i<0||(i==e.length-1?e.pop():Qe.call(e,i,1),--this.size,0))},Oi.prototype.get=function(e){var i=this.__data__,n=xi(i,e);return n<0?t:i[n][1]},Oi.prototype.has=function(t){return xi(this.__data__,t)>-1},Oi.prototype.set=function(t,e){var i=this.__data__,n=xi(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this},Li.prototype.clear=function(){this.size=0,this.__data__={hash:new Mi,map:new(hi||Oi),string:new Mi}},Li.prototype.delete=function(t){var e=Un(this,t).delete(t);return this.size-=e?1:0,e},Li.prototype.get=function(t){return Un(this,t).get(t)},Li.prototype.has=function(t){return Un(this,t).has(t)},Li.prototype.set=function(t,e){var i=Un(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},Ni.prototype.add=Ni.prototype.push=function(t){return this.__data__.set(t,n),this},Ni.prototype.has=function(t){return this.__data__.has(t)},Ui.prototype.clear=function(){this.__data__=new Oi,this.size=0},Ui.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Ui.prototype.get=function(t){return this.__data__.get(t)},Ui.prototype.has=function(t){return this.__data__.has(t)},Ui.prototype.set=function(t,i){var n=this.__data__;if(n instanceof Oi){var s=n.__data__;if(!hi||s.length<e-1)return s.push([t,i]),this.size=++n.size,this;n=this.__data__=new Li(s)}return n.set(t,i),this.size=n.size,this};var Hi,$i,qi=(Hi=Yi,function(t,e){if(null==t)return t;if(!Is(t))return Hi(t,e);for(var i=t.length,n=$i?i:-1,s=Object(t);($i?n--:++n<i)&&!1!==e(s[n],n,s););return t});function Wi(t,e){var i=!0;return qi(t,function(t,n,s){return i=!!e(t,n,s)}),i}function Ki(t,e,i,n,s){var a=-1,r=t.length;for(i||(i=Vn),s||(s=[]);++a<r;){var o=t[a];e>0&&i(o)?e>1?Ki(o,e-1,i,n,s):he(s,o):n||(s[s.length]=o)}return s}var zi=function(t){return function(e,i,n){for(var s=-1,a=Object(e),r=n(e),o=r.length;o--;){var l=r[t?o:++s];if(!1===i(a[l],l,a))break}return e}}();function Yi(t,e){return t&&zi(t,e,Js)}function Xi(t,e){return le(e,function(e){return ks(t[e])})}function Qi(e,i){for(var n=0,s=(i=bn(i,e)).length;null!=e&&n<s;)e=e[ns(i[n++])];return n&&n==s?e:t}function Ji(t,e,i){var n=e(t);return Cs(t)?n:he(n,i(t))}function Zi(e){return null==e?e===t?z:G:ti&&ti in Object(e)?function(e){var i=je.call(e,ti),n=e[ti];try{e[ti]=t;var s=!0}catch(t){}var a=Fe.call(e);s&&(i?e[ti]=n:delete e[ti]);return a}(e):function(t){return Fe.call(t)}(e)}function tn(t,e){return null!=t&&je.call(t,e)}function en(t,e){return null!=t&&e in Object(t)}function nn(e,i,n){var s=null==(e=function(t,e){return e.length<2?t:Qi(t,_n(e,0,-1))}(e,i=bn(i,e)))?e:e[ns(ls(i))];return null==s?t:ae(s,e,n)}function sn(t){return Ls(t)&&Zi(t)==w}function an(e,i,n,s,a){return e===i||(null==e||null==i||!Ls(e)&&!Ls(i)?e!=e&&i!=i:function(e,i,n,s,a,r){var o=Cs(e),l=Cs(i),c=o?k:Fn(e),h=l?k:Fn(i),p=(c=c==w?V:c)==V,g=(h=h==w?V:h)==V,f=c==h;if(f&&Rs(e)){if(!Rs(i))return!1;o=!0,p=!1}if(f&&!p)return r||(r=new Ui),o||Gs(e)?kn(e,i,n,s,a,r):function(t,e,i,n,s,a,r){switch(i){case Q:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case X:return!(t.byteLength!=e.byteLength||!a(new We(t),new We(e)));case O:case L:case F:return Ss(+t,+e);case U:return t.name==e.name&&t.message==e.message;case $:case W:return t==e+"";case x:var o=De;case q:var l=n&d;if(o||(o=Pe),t.size!=e.size&&!l)return!1;var c=r.get(t);if(c)return c==e;n|=u,r.set(t,e);var h=kn(o(t),o(e),n,s,a,r);return r.delete(t),h;case K:if(Ci)return Ci.call(t)==Ci.call(e)}return!1}(e,i,c,n,s,a,r);if(!(n&d)){var v=p&&je.call(e,"__wrapped__"),m=g&&je.call(i,"__wrapped__");if(v||m){var _=v?e.value():e,E=m?i.value():i;return r||(r=new Ui),a(_,E,n,s,r)}}if(!f)return!1;return r||(r=new Ui),function(e,i,n,s,a,r){var o=n&d,l=Mn(e),u=l.length,c=Mn(i).length;if(u!=c&&!o)return!1;for(var h=u;h--;){var p=l[h];if(!(o?p in i:je.call(i,p)))return!1}var g=r.get(e);if(g&&r.get(i))return g==i;var f=!0;r.set(e,i),r.set(i,e);for(var v=o;++h<u;){p=l[h];var m=e[p],_=i[p];if(s)var E=o?s(_,m,p,i,e,r):s(m,_,p,e,i,r);if(!(E===t?m===_||a(m,_,n,s,r):E)){f=!1;break}v||(v="constructor"==p)}if(f&&!v){var A=e.constructor,y=i.constructor;A!=y&&"constructor"in e&&"constructor"in i&&!("function"==typeof A&&A instanceof A&&"function"==typeof y&&y instanceof y)&&(f=!1)}return r.delete(e),r.delete(i),f}(e,i,n,s,a,r)}(e,i,n,s,an,a))}function rn(t){return!(!Os(t)||(e=t,xe&&xe in e))&&(ks(t)?He:Ct).test(ss(t));var e}function on(e){return"function"==typeof e?e:null==e?ra:"object"==typeof e?Cs(e)?function(e,i){if(qn(e)&&Kn(i))return zn(ns(e),i);return function(n){var s=Xs(n,e);return s===t&&s===i?Qs(n,e):an(i,s,d|u)}}(e[0],e[1]):function(e){var i=function(t){var e=Js(t),i=e.length;for(;i--;){var n=e[i],s=t[n];e[i]=[n,s,Kn(s)]}return e}(e);if(1==i.length&&i[0][2])return zn(i[0][0],i[0][1]);return function(n){return n===e||function(e,i,n,s){var a=n.length,r=a,o=!s;if(null==e)return!r;for(e=Object(e);a--;){var l=n[a];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++a<r;){var c=(l=n[a])[0],h=e[c],p=l[1];if(o&&l[2]){if(h===t&&!(c in e))return!1}else{var g=new Ui;if(s)var f=s(h,p,c,e,i,g);if(!(f===t?an(p,h,d|u,s,g):f))return!1}}return!0}(n,e,i)}}(e):ua(e)}function ln(t){if(!Wn(t))return ri(t);var e=[];for(var i in Object(t))je.call(t,i)&&"constructor"!=i&&e.push(i);return e}function dn(t){if(!Os(t))return function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}(t);var e=Wn(t),i=[];for(var n in t)("constructor"!=n||!e&&je.call(t,n))&&i.push(n);return i}function un(t,e){return t<e}function cn(t,e){var i=-1,n=Is(t)?Array(t.length):[];return qi(t,function(t,s,a){n[++i]=e(t,s,a)}),n}function hn(t,e,i){var n=-1;return e=ce(e.length?e:[ra],Ae(Nn())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(cn(t,function(t,i,s){return{criteria:ce(e,function(e){return e(t)}),index:++n,value:t}}),function(t,e){return function(t,e,i){var n=-1,s=t.criteria,a=e.criteria,r=s.length,o=i.length;for(;++n<r;){var l=Cn(s[n],a[n]);if(l){if(n>=o)return l;var d=i[n];return l*("desc"==d?-1:1)}}return t.index-e.index}(t,e,i)})}function pn(t,e){var i="";if(!t||e<1||e>C)return i;do{e%2&&(i+=t),(e=ni(e/2))&&(t+=t)}while(e);return i}function gn(t,e){return Qn(Yn(t,e,ra),t+"")}function fn(e,i,n,s){if(!Os(e))return e;for(var a=-1,r=(i=bn(i,e)).length,o=r-1,l=e;null!=l&&++a<r;){var d=ns(i[a]),u=n;if(a!=o){var c=l[d];(u=s?s(c,d,l):t)===t&&(u=Os(c)?c:Hn(i[a+1])?[]:{})}ji(l,d,u),l=l[d]}return e}var vn=mi?function(t,e){return mi.set(t,e),t}:ra,mn=ei?function(t,e){return ei(t,"toString",{configurable:!0,enumerable:!1,value:aa(e),writable:!0})}:ra;function _n(t,e,i){var n=-1,s=t.length;e<0&&(e=-e>s?0:s+e),(i=i>s?s:i)<0&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0;for(var a=Array(s);++n<s;)a[n]=t[n+e];return a}function En(t,e){var i;return qi(t,function(t,n,s){return!(i=e(t,n,s))}),!!i}function An(t){if("string"==typeof t)return t;if(Cs(t))return ce(t,An)+"";if(Fs(t))return Ii?Ii.call(t):"";var e=t+"";return"0"==e&&1/t==-T?"-0":e}function yn(t,e){var i=t;return i instanceof ki&&(i=i.value()),function(t,e,i,n){var s=-1,a=null==t?0:t.length;for(n&&a&&(i=t[++s]);++s<a;)i=e(i,t[s],s,t);return i}(e,function(t,e){return e.func.apply(e.thisArg,he([t],e.args))},i)}function bn(t,e){return Cs(t)?t:qn(t,e)?[t]:is(Ws(t))}function Sn(e,i,n){var s=e.length;return n=n===t?s:n,!i&&n>=s?e:_n(e,i,n)}function Tn(t){var e=new t.constructor(t.byteLength);return new We(e).set(new We(t)),e}function Cn(e,i){if(e!==i){var n=e!==t,s=null===e,a=e==e,r=Fs(e),o=i!==t,l=null===i,d=i==i,u=Fs(i);if(!l&&!u&&!r&&e>i||r&&o&&d&&!l&&!u||s&&o&&d||!n&&d||!a)return 1;if(!s&&!r&&!u&&e<i||u&&n&&a&&!s&&!r||l&&n&&a||!o&&a||!d)return-1}return 0}function In(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}function Dn(e,i,n,s){var a=!n;n||(n={});for(var r=-1,o=i.length;++r<o;){var l=i[r],d=s?s(n[l],e[l],l,n,e):t;d===t&&(d=e[l]),a?Fi(n,l,d):ji(n,l,d)}return n}function Rn(e){return gn(function(i,n){var s=-1,a=n.length,r=a>1?n[a-1]:t,o=a>2?n[2]:t;for(r=e.length>3&&"function"==typeof r?(a--,r):t,o&&$n(n[0],n[1],o)&&(r=a<3?t:r,a=1),i=Object(i);++s<a;){var l=n[s];l&&e(i,l,s,r)}return i})}function Pn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=Ri(t.prototype),n=t.apply(i,e);return Os(n)?n:i}}function wn(e,i,n,s){return e===t||Ss(e,Ne[n])&&!je.call(s,n)?i:e}function kn(e,i,n,s,a,r){var o=n&d,l=e.length,c=i.length;if(l!=c&&!(o&&c>l))return!1;var h=r.get(e);if(h&&r.get(i))return h==i;var p=-1,g=!0,f=n&u?new Ni:t;for(r.set(e,i),r.set(i,e);++p<l;){var v=e[p],m=i[p];if(s)var _=o?s(m,v,p,i,e,r):s(v,m,p,e,i,r);if(_!==t){if(_)continue;g=!1;break}if(f){if(!pe(i,function(t,e){if(!be(f,e)&&(v===t||a(v,t,n,s,r)))return f.push(e)})){g=!1;break}}else if(v!==m&&!a(v,m,n,s,r)){g=!1;break}}return r.delete(e),r.delete(i),g}function Mn(t){return Ji(t,Js,jn)}function On(t){return Ji(t,Zs,xn)}var Ln=mi?function(t){return mi.get(t)}:da;function Nn(){var t=Di.iteratee||oa;return t=t===oa?on:t,arguments.length?t(arguments[0],arguments[1]):t}function Un(t,e){var i,n,s=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?s["string"==typeof e?"string":"hash"]:s.map}function Bn(e,i){var n=function(e,i){return null==e?t:e[i]}(e,i);return rn(n)?n:t}var jn=si?function(t){return null==t?[]:(t=Object(t),le(si(t),function(e){return Xe.call(t,e)}))}:ca,xn=si?function(t){for(var e=[];t;)he(e,jn(t)),t=ze(t);return e}:ca,Fn=Zi;function Gn(t,e,i){for(var n=-1,s=(e=bn(e,t)).length,a=!1;++n<s;){var r=ns(e[n]);if(!(a=null!=t&&i(t,r)))break;t=t[r]}return a||++n!=s?a:!!(s=null==t?0:t.length)&&Ms(s)&&Hn(r,s)&&(Cs(t)||Ts(t))}function Vn(t){return Cs(t)||Ts(t)||!!(Je&&t&&t[Je])}function Hn(t,e){var i=typeof t;return!!(e=null==e?C:e)&&("number"==i||"symbol"!=i&&Dt.test(t))&&t>-1&&t%1==0&&t<e}function $n(t,e,i){if(!Os(i))return!1;var n=typeof e;return!!("number"==n?Is(i)&&Hn(e,i.length):"string"==n&&e in i)&&Ss(i[e],t)}function qn(t,e){if(Cs(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Fs(t))||(gt.test(t)||!pt.test(t)||null!=e&&t in Object(e))}function Wn(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ne)}function Kn(t){return t==t&&!Os(t)}function zn(e,i){return function(n){return null!=n&&(n[e]===i&&(i!==t||e in Object(n)))}}function Yn(e,i,n){return i=oi(i===t?e.length-1:i,0),function(){for(var t=arguments,s=-1,a=oi(t.length-i,0),r=Array(a);++s<a;)r[s]=t[i+s];s=-1;for(var o=Array(i+1);++s<i;)o[s]=t[s];return o[i]=n(r),ae(e,this,o)}}(ci&&Fn(new ci(new ArrayBuffer(1)))!=Q||hi&&Fn(new hi)!=x||pi&&"[object Promise]"!=Fn(pi.resolve())||gi&&Fn(new gi)!=q||fi&&Fn(new fi)!=Y)&&(Fn=function(e){var i=Zi(e),n=i==V?e.constructor:t,s=n?ss(n):"";if(s)switch(s){case Ei:return Q;case Ai:return x;case yi:return"[object Promise]";case bi:return q;case Si:return Y}return i});var Xn=Jn(vn),Qn=Jn(mn);function Jn(e){var i=0,n=0;return function(){var s=di(),a=y-(s-n);if(n=s,a>0){if(++i>=A)return arguments[0]}else i=0;return e.apply(t,arguments)}}var Zn,ts,es,is=(Zn=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(ft,function(t,i,n,s){e.push(n?s.replace(At,"$1"):i||t)}),e},ts=ys(Zn,function(t){return es.size===s&&es.clear(),t}),es=ts.cache,ts);function ns(t){if("string"==typeof t||Fs(t))return t;var e=t+"";return"0"==e&&1/t==-T?"-0":e}function ss(t){if(null!=t){try{return Be.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function as(t){if(t instanceof ki)return t.clone();var e=new wi(t.__wrapped__,t.__chain__);return e.__actions__=In(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function rs(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=null==i?0:$s(i);return s<0&&(s=oi(n+s,0)),fe(t,Nn(e,3),s)}function os(t){return(null==t?0:t.length)?Ki(t,1):[]}function ls(e){var i=null==e?0:e.length;return i?e[i-1]:t}var ds=gn(us);function us(t,e){return t&&t.length&&e&&e.length?function(t,e,i,n){var s=n?me:ve,a=-1,r=e.length,o=t;for(t===e&&(e=In(e)),i&&(o=ce(t,Ae(i)));++a<r;)for(var l=0,d=e[a],u=i?i(d):d;(l=s(o,u,l,n))>-1;)o!==t&&Qe.call(o,l,1),Qe.call(t,l,1);return t}(t,e):t}function cs(t){return null==t?t:ui.call(t)}var hs=gn(function(t,i){return Ds(t)?function(t,i,n,s){var a=-1,r=de,o=!0,l=t.length,d=[],u=i.length;if(!l)return d;n&&(i=ce(i,Ae(n))),s?(r=ue,o=!1):i.length>=e&&(r=be,o=!1,i=new Ni(i));t:for(;++a<l;){var c=t[a],h=null==n?c:n(c);if(c=s||0!==c?c:0,o&&h==h){for(var p=u;p--;)if(i[p]===h)continue t;d.push(c)}else r(i,h,s)||d.push(c)}return d}(t,i):[]});function ps(t){var e=Di(t);return e.__chain__=!0,e}function gs(t,e){return e(t)}!function(e){Qn(Yn(e,t,os),e+"")}(function(e){var i=e.length,n=i?e[0]:0,s=this.__wrapped__,a=function(i){return function(e,i){for(var n=-1,s=i.length,a=Array(s),r=null==e;++n<s;)a[n]=r?t:Xs(e,i[n]);return a}(i,e)};return!(i>1||this.__actions__.length)&&s instanceof ki&&Hn(n)?((s=s.slice(n,+n+(i?1:0))).__actions__.push({func:gs,args:[a],thisArg:t}),new wi(s,this.__chain__).thru(function(e){return i&&!e.length&&e.push(t),e})):this.thru(a)});var fs,vs=(fs=rs,function(e,i,n){var s=Object(e);if(!Is(e)){var a=Nn(i,3);e=Js(e),i=function(t){return a(s[t],t,s)}}var r=fs(e,i,n);return r>-1?s[a?e[r]:r]:t});function ms(t,e){return(Cs(t)?re:qi)(t,Nn(e,3))}var _s=gn(function(t,e){if(null==t)return[];var i=e.length;return i>1&&$n(t,e[0],e[1])?e=[]:i>2&&$n(e[0],e[1],e[2])&&(e=[e[0]]),hn(t,Ki(e,1),[])}),Es=function(){return Yt.Date.now()};function As(e,n,s){var a,r,o,l,d,u,c=0,h=!1,p=!1,g=!0;if("function"!=typeof e)throw new TypeError(i);function f(i){var n=a,s=r;return a=r=t,c=i,l=e.apply(s,n)}function v(e){var i=e-u;return u===t||i>=n||i<0||p&&e-c>=o}function m(){var t=Es();if(v(t))return _(t);d=setTimeout(m,function(t){var e=n-(t-u);return p?li(e,o-(t-c)):e}(t))}function _(e){return d=t,g&&a?f(e):(a=r=t,l)}function E(){var e=Es(),i=v(e);if(a=arguments,r=this,u=e,i){if(d===t)return function(t){return c=t,d=setTimeout(m,n),h?f(t):l}(u);if(p)return d=setTimeout(m,n),f(u)}return d===t&&(d=setTimeout(m,n)),l}return n=qs(n)||0,Os(s)&&(h=!!s.leading,o=(p="maxWait"in s)?oi(qs(s.maxWait)||0,n):o,g="trailing"in s?!!s.trailing:g),E.cancel=function(){d!==t&&clearTimeout(d),c=0,a=u=r=d=t},E.flush=function(){return d===t?l:_(Es())},E}function ys(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var i=arguments,s=e?e.apply(this,i):i[0],a=n.cache;if(a.has(s))return a.get(s);var r=t.apply(this,i);return n.cache=a.set(s,r)||a,r};return n.cache=new(ys.Cache||Li),n}function bs(t){if("function"!=typeof t)throw new TypeError(i);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Ss(t,e){return t===e||t!=t&&e!=e}ys.Cache=Li;var Ts=sn(function(){return arguments}())?sn:function(t){return Ls(t)&&je.call(t,"callee")&&!Xe.call(t,"callee")},Cs=Array.isArray;function Is(t){return null!=t&&Ms(t.length)&&!ks(t)}function Ds(t){return Ls(t)&&Is(t)}var Rs=ai||ha,Ps=ee?Ae(ee):function(t){return Ls(t)&&Zi(t)==L};function ws(t){if(!Ls(t))return!1;var e=Zi(t);return e==U||e==N||"string"==typeof t.message&&"string"==typeof t.name&&!Bs(t)}function ks(t){if(!Os(t))return!1;var e=Zi(t);return e==B||e==j||e==M||e==H}function Ms(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=C}function Os(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Ls(t){return null!=t&&"object"==typeof t}var Ns=ie?Ae(ie):function(t){return Ls(t)&&Fn(t)==x};function Us(t){return"number"==typeof t||Ls(t)&&Zi(t)==F}function Bs(t){if(!Ls(t)||Zi(t)!=V)return!1;var e=ze(t);if(null===e)return!0;var i=je.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&Be.call(i)==Ge}var js=ne?Ae(ne):function(t){return Ls(t)&&Fn(t)==q};function xs(t){return"string"==typeof t||!Cs(t)&&Ls(t)&&Zi(t)==W}function Fs(t){return"symbol"==typeof t||Ls(t)&&Zi(t)==K}var Gs=se?Ae(se):function(t){return Ls(t)&&Ms(t.length)&&!!Ht[Zi(t)]};function Vs(t){if(!t)return[];if(Is(t))return xs(t)?ke(t):In(t);if(Ze&&t[Ze])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[Ze]());var e=Fn(t);return(e==x?De:e==q?Pe:ea)(t)}function Hs(t){return t?(t=qs(t))===T||t===-T?(t<0?-1:1)*I:t==t?t:0:0===t?t:0}function $s(t){var e=Hs(t),i=e%1;return e==e?i?e-i:e:0}function qs(t){if("number"==typeof t)return t;if(Fs(t))return D;if(Os(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Os(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(vt,"");var i=Tt.test(t);return i||It.test(t)?Wt(t.slice(2),i?2:8):St.test(t)?D:+t}function Ws(t){return null==t?"":An(t)}var Ks=Rn(function(t,e){if(Wn(e)||Is(e))Dn(e,Js(e),t);else for(var i in e)je.call(e,i)&&ji(t,i,e[i])}),zs=Rn(function(t,e){Dn(e,Zs(e),t)}),Ys=Rn(function(t,e,i,n){Dn(e,Zs(e),t,n)});function Xs(e,i,n){var s=null==e?t:Qi(e,i);return s===t?n:s}function Qs(t,e){return null!=t&&Gn(t,e,en)}function Js(t){return Is(t)?Bi(t):ln(t)}function Zs(t){return Is(t)?Bi(t,!0):dn(t)}function ta(t,e){if(null==t)return{};var i=ce(On(t),function(t){return[t]});return e=Nn(e),function(t,e,i){for(var n=-1,s=e.length,a={};++n<s;){var r=e[n],o=Qi(t,r);i(o,r)&&fn(a,bn(r,t),o)}return a}(t,i,function(t,i){return e(t,i[0])})}function ea(t){return null==t?[]:ye(t,Js(t))}var ia,na=(ia="toUpperCase",function(e){var i=Ie(e=Ws(e))?ke(e):t,n=i?i[0]:e.charAt(0),s=i?Sn(i,1).join(""):e.slice(1);return n[ia]()+s}),sa=gn(function(e,i){try{return ae(e,t,i)}catch(t){return ws(t)?t:new Error(t)}});function aa(t){return function(){return t}}function ra(t){return t}function oa(t){return on("function"==typeof t?t:Vi(t,r))}function la(t,e,i){var n=Js(e),s=Xi(e,n);null!=i||Os(e)&&(s.length||!n.length)||(i=e,e=t,t=this,s=Xi(e,Js(e)));var a=!(Os(i)&&"chain"in i&&!i.chain),r=ks(t);return re(s,function(i){var n=e[i];t[i]=n,r&&(t.prototype[i]=function(){var e=this.__chain__;if(a||e){var i=t(this.__wrapped__);return(i.__actions__=In(this.__actions__)).push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,he([this.value()],arguments))})}),t}function da(){}function ua(t){return qn(t)?Ee(ns(t)):function(t){return function(e){return Qi(e,t)}}(t)}function ca(){return[]}function ha(){return!1}var pa,ga=function(t){var e=Math[t];return function(t,i){if(t=qs(t),i=null==i?0:li($s(i),292)){var n=(Ws(t)+"e").split("e");return+((n=(Ws(e(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return e(t)}}("round");Di.assign=Ks,Di.assignIn=zs,Di.assignInWith=Ys,Di.chain=ps,Di.compact=function(t){for(var e=-1,i=null==t?0:t.length,n=0,s=[];++e<i;){var a=t[e];a&&(s[n++]=a)}return s},Di.constant=aa,Di.debounce=As,Di.drop=function(e,i,n){var s=null==e?0:e.length;return s?_n(e,(i=n||i===t?1:$s(i))<0?0:i,s):[]},Di.flatten=os,Di.iteratee=oa,Di.keys=Js,Di.keysIn=Zs,Di.map=function(t,e){return(Cs(t)?ce:cn)(t,Nn(e,3))},Di.memoize=ys,Di.mixin=la,Di.negate=bs,Di.omitBy=function(t,e){return ta(t,bs(Nn(e)))},Di.pickBy=ta,Di.property=ua,Di.pull=ds,Di.pullAll=us,Di.reverse=cs,Di.sortBy=_s,Di.tap=function(t,e){return e(t),t},Di.throttle=function(t,e,n){var s=!0,a=!0;if("function"!=typeof t)throw new TypeError(i);return Os(n)&&(s="leading"in n?!!n.leading:s,a="trailing"in n?!!n.trailing:a),As(t,e,{leading:s,maxWait:e,trailing:a})},Di.thru=gs,Di.toArray=Vs,Di.values=ea,Di.without=hs,Di.extend=zs,Di.extendWith=Ys,la(Di,Di),Di.attempt=sa,Di.capitalize=function(t){return na(Ws(t).toLowerCase())},Di.clone=function(t){return Vi(t,l)},Di.cloneDeep=function(t){return Vi(t,r|l)},Di.endsWith=function(e,i,n){e=Ws(e),i=An(i);var s=e.length,a=n=n===t?s:Gi($s(n),0,s);return(n-=i.length)>=0&&e.slice(n,a)==i},Di.eq=Ss,Di.escape=function(t){return(t=Ws(t))&&ct.test(t)?t.replace(ut,Te):t},Di.every=function(e,i,n){var s=Cs(e)?oe:Wi;return n&&$n(e,i,n)&&(i=t),s(e,Nn(i,3))},Di.find=vs,Di.findIndex=rs,Di.forEach=ms,Di.forOwn=function(t,e){return t&&Yi(t,Nn(e,3))},Di.get=Xs,Di.has=function(t,e){return null!=t&&Gn(t,e,tn)},Di.hasIn=Qs,Di.identity=ra,Di.includes=function(t,e,i,n){t=Is(t)?t:ea(t),i=i&&!n?$s(i):0;var s=t.length;return i<0&&(i=oi(s+i,0)),xs(t)?i<=s&&t.indexOf(e,i)>-1:!!s&&ve(t,e,i)>-1},Di.indexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=null==i?0:$s(i);return s<0&&(s=oi(n+s,0)),ve(t,e,s)},Di.inRange=function(e,i,n){return i=Hs(i),n===t?(n=i,i=0):n=Hs(n),function(t,e,i){return t>=li(e,i)&&t<oi(e,i)}(e=qs(e),i,n)},Di.isArguments=Ts,Di.isArray=Cs,Di.isArrayLike=Is,Di.isArrayLikeObject=Ds,Di.isBoolean=function(t){return!0===t||!1===t||Ls(t)&&Zi(t)==O},Di.isBuffer=Rs,Di.isDate=Ps,Di.isEmpty=function(t){if(null==t)return!0;if(Is(t)&&(Cs(t)||"string"==typeof t||"function"==typeof t.splice||Rs(t)||Gs(t)||Ts(t)))return!t.length;var e=Fn(t);if(e==x||e==q)return!t.size;if(Wn(t))return!ln(t).length;for(var i in t)if(je.call(t,i))return!1;return!0},Di.isError=ws,Di.isFunction=ks,Di.isLength=Ms,Di.isMap=Ns,Di.isNaN=function(t){return Us(t)&&t!=+t},Di.isNull=function(t){return null===t},Di.isNumber=Us,Di.isObject=Os,Di.isObjectLike=Ls,Di.isPlainObject=Bs,Di.isSet=js,Di.isString=xs,Di.isSymbol=Fs,Di.isTypedArray=Gs,Di.isUndefined=function(e){return e===t},Di.last=ls,Di.min=function(e){return e&&e.length?function(e,i,n){for(var s=-1,a=e.length;++s<a;){var r=e[s],o=i(r);if(null!=o&&(l===t?o==o&&!Fs(o):n(o,l)))var l=o,d=r}return d}(e,ra,un):t},Di.stubArray=ca,Di.stubFalse=ha,Di.noConflict=function(){return Yt._===this&&(Yt._=Ve),this},Di.noop=da,Di.now=Es,Di.padStart=function(e,i,n){e=Ws(e);var s=(i=$s(i))?we(e):0;return i&&s<i?function(e,i){var n=(i=i===t?" ":An(i)).length;if(n<2)return n?pn(i,e):i;var s=pn(i,ii(e/we(i)));return Ie(i)?Sn(ke(s),0,e).join(""):s.slice(0,e)}(i-s,n)+e:e},Di.round=ga,Di.some=function(e,i,n){var s=Cs(e)?pe:En;return n&&$n(e,i,n)&&(i=t),s(e,Nn(i,3))},Di.startsWith=function(t,e,i){return t=Ws(t),i=null==i?0:Gi($s(i),0,t.length),e=An(e),t.slice(i,i+e.length)==e},Di.template=function(e,i,n){var s=Di.templateSettings;n&&$n(e,i,n)&&(i=t),e=Ws(e),i=Ys({},i,s,wn);var a,r,o=Ys({},i.imports,s.imports,wn),l=Js(o),d=ye(o,l),u=0,c=i.interpolate||Rt,h="__p += '",p=RegExp((i.escape||Rt).source+"|"+c.source+"|"+(c===ht?yt:Rt).source+"|"+(i.evaluate||Rt).source+"|$","g"),g="//# sourceURL="+("sourceURL"in i?i.sourceURL:"lodash.templateSources["+ ++Vt+"]")+"\n";e.replace(p,function(t,i,n,s,o,l){return n||(n=s),h+=e.slice(u,l).replace(Pt,Ce),i&&(a=!0,h+="' +\n__e("+i+") +\n'"),o&&(r=!0,h+="';\n"+o+";\n__p += '"),n&&(h+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=l+t.length,t}),h+="';\n";var f=i.variable;f||(h="with (obj) {\n"+h+"\n}\n"),h=(r?h.replace(ot,""):h).replace(lt,"$1").replace(dt,"$1;"),h="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(r?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var v=sa(function(){return Function(l,g+"return "+h).apply(t,d)});if(v.source=h,ws(v))throw v;return v},Di.toFinite=Hs,Di.toInteger=$s,Di.toNumber=qs,Di.toString=Ws,Di.upperFirst=na,Di.each=ms,la(Di,(pa={},Yi(Di,function(t,e){je.call(Di.prototype,e)||(pa[e]=t)}),pa),{chain:!1}),Di.VERSION="4.17.5",re(["drop","take"],function(e,i){ki.prototype[e]=function(n){n=n===t?1:oi($s(n),0);var s=this.__filtered__&&!i?new ki(this):this.clone();return s.__filtered__?s.__takeCount__=li(n,s.__takeCount__):s.__views__.push({size:li(n,R),type:e+(s.__dir__<0?"Right":"")}),s},ki.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),re(["filter","map","takeWhile"],function(t,e){var i=e+1,n=i==b||3==i;ki.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Nn(t,3),type:i}),e.__filtered__=e.__filtered__||n,e}}),re(["head","last"],function(t,e){var i="take"+(e?"Right":"");ki.prototype[t]=function(){return this[i](1).value()[0]}}),re(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");ki.prototype[t]=function(){return this.__filtered__?new ki(this):this[i](1)}}),ki.prototype.compact=function(){return this.filter(ra)},ki.prototype.find=function(t){return this.filter(t).head()},ki.prototype.findLast=function(t){return this.reverse().find(t)},ki.prototype.invokeMap=gn(function(t,e){return"function"==typeof t?new ki(this):this.map(function(i){return nn(i,t,e)})}),ki.prototype.reject=function(t){return this.filter(bs(Nn(t)))},ki.prototype.slice=function(e,i){e=$s(e);var n=this;return n.__filtered__&&(e>0||i<0)?new ki(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==t&&(n=(i=$s(i))<0?n.dropRight(-i):n.take(i-e)),n)},ki.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},ki.prototype.toArray=function(){return this.take(R)},Yi(ki.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),s=/^(?:head|last)$/.test(i),a=Di[s?"take"+("last"==i?"Right":""):i],r=s||/^find/.test(i);a&&(Di.prototype[i]=function(){var i=this.__wrapped__,o=s?[1]:arguments,l=i instanceof ki,d=o[0],u=l||Cs(i),c=function(t){var e=a.apply(Di,he([t],o));return s&&h?e[0]:e};u&&n&&"function"==typeof d&&1!=d.length&&(l=u=!1);var h=this.__chain__,p=!!this.__actions__.length,g=r&&!h,f=l&&!p;if(!r&&u){i=f?i:new ki(this);var v=e.apply(i,o);return v.__actions__.push({func:gs,args:[c],thisArg:t}),new wi(v,h)}return g&&f?e.apply(this,o):(v=this.thru(c),g?s?v.value()[0]:v.value():v)})}),re(["pop","push","shift","sort","splice","unshift"],function(t){var e=Oe[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);Di.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var s=this.value();return e.apply(Cs(s)?s:[],t)}return this[i](function(i){return e.apply(Cs(i)?i:[],t)})}}),Yi(ki.prototype,function(t,e){var i=Di[e];if(i){var n=i.name+"";(_i[n]||(_i[n]=[])).push({name:e,func:i})}}),_i[function e(i,n,s,r,o,l,d,u,A,y){var b=n&_,S=n&c,T=n&h,C=n&(g|f),I=n&E,D=T?t:Pn(i);return function f(){for(var _=arguments.length,E=Array(_),R=_;R--;)E[R]=arguments[R];if(C)var w=function(t){return(je.call(Di,"placeholder")?Di:t).placeholder}(f),k=function(t,e){for(var i=t.length,n=0;i--;)t[i]===e&&++n;return n}(E,w);if(r&&(E=function(t,e,i,n){for(var s=-1,a=t.length,r=i.length,o=-1,l=e.length,d=oi(a-r,0),u=Array(l+d),c=!n;++o<l;)u[o]=e[o];for(;++s<r;)(c||s<a)&&(u[i[s]]=t[s]);for(;d--;)u[o++]=t[s++];return u}(E,r,o,C)),l&&(E=function(t,e,i,n){for(var s=-1,a=t.length,r=-1,o=i.length,l=-1,d=e.length,u=oi(a-o,0),c=Array(u+d),h=!n;++s<u;)c[s]=t[s];for(var p=s;++l<d;)c[p+l]=e[l];for(;++r<o;)(h||s<a)&&(c[p+i[r]]=t[s++]);return c}(E,l,d,C)),_-=k,C&&_<y){var M=function(t,e){for(var i=-1,n=t.length,s=0,r=[];++i<n;){var o=t[i];o!==e&&o!==a||(t[i]=a,r[s++]=i)}return r}(E,w);return function(e,i,n,s,a,r,o,l,d,u){var f=i&g;i|=f?v:m,(i&=~(f?m:v))&p||(i&=~(c|h));var _=[e,i,a,f?r:t,f?o:t,f?t:r,f?t:o,l,d,u],E=n.apply(t,_);return function(t){var e=function(t){for(var e=t.name+"",i=_i[e],n=je.call(_i,e)?i.length:0;n--;){var s=i[n],a=s.func;if(null==a||a==t)return s.name}return e}(t),i=Di[e];if("function"!=typeof i||!(e in ki.prototype))return!1;if(t===i)return!0;var n=Ln(i);return!!n&&t===n[0]}(e)&&Xn(E,_),E.placeholder=s,function(t,e,i){var n=e+"";return Qn(t,function(t,e){var i=e.length;if(!i)return t;var n=i-1;return e[n]=(i>1?"& ":"")+e[n],e=e.join(i>2?", ":" "),t.replace(mt,"{\n/* [wrapped with "+e+"] */\n")}(n,function(t,e){return re(P,function(i){var n="_."+i[0];e&i[1]&&!de(t,n)&&t.push(n)}),t.sort()}(function(t){var e=t.match(_t);return e?e[1].split(Et):[]}(n),i)))}(E,e,i)}(i,n,e,f.placeholder,s,E,M,u,A,y-_)}var O=S?s:this,L=T?O[i]:i;return _=E.length,u?E=function(e,i){for(var n=e.length,s=li(i.length,n),a=In(e);s--;){var r=i[s];e[s]=Hn(r,n)?a[r]:t}return e}(E,u):I&&_>1&&E.reverse(),b&&A<_&&(E.length=A),this&&this!==Yt&&this instanceof f&&(L=D||Pn(L)),L.apply(O,E)}}(t,h).name]=[{name:"wrapper",func:t}],ki.prototype.clone=function(){var t=new ki(this.__wrapped__);return t.__actions__=In(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=In(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=In(this.__views__),t},ki.prototype.reverse=function(){if(this.__filtered__){var t=new ki(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},ki.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=Cs(t),n=e<0,s=i?t.length:0,a=function(t,e,i){for(var n=-1,s=i.length;++n<s;){var a=i[n],r=a.size;switch(a.type){case"drop":t+=r;break;case"dropRight":e-=r;break;case"take":e=li(e,t+r);break;case"takeRight":t=oi(t,e-r)}}return{start:t,end:e}}(0,s,this.__views__),r=a.start,o=a.end,l=o-r,d=n?o:r-1,u=this.__iteratees__,c=u.length,h=0,p=li(l,this.__takeCount__);if(!i||!n&&s==l&&p==l)return yn(t,this.__actions__);var g=[];t:for(;l--&&h<p;){for(var f=-1,v=t[d+=e];++f<c;){var m=u[f],_=m.iteratee,E=m.type,A=_(v);if(E==S)v=A;else if(!A){if(E==b)continue t;break t}}g[h++]=v}return g},Di.prototype.chain=function(){return ps(this)},Di.prototype.commit=function(){return new wi(this.value(),this.__chain__)},Di.prototype.next=function(){this.__values__===t&&(this.__values__=Vs(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?t:this.__values__[this.__index__++]}},Di.prototype.plant=function(e){for(var i,n=this;n instanceof Pi;){var s=as(n);s.__index__=0,s.__values__=t,i?a.__wrapped__=s:i=s;var a=s;n=n.__wrapped__}return a.__wrapped__=e,i},Di.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof ki){var i=e;return this.__actions__.length&&(i=new ki(this)),(i=i.reverse()).__actions__.push({func:gs,args:[cs],thisArg:t}),new wi(i,this.__chain__)}return this.thru(cs)},Di.prototype.toJSON=Di.prototype.valueOf=Di.prototype.value=function(){return yn(this.__wrapped__,this.__actions__)},Di.prototype.first=Di.prototype.head,Ze&&(Di.prototype[Ze]=function(){return this}),Qt?((Qt.exports=Di)._=Di,Xt._=Di):Yt._=Di}).call(this),"undefined"!=typeof window&&(e=this,n=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=11)}([function(t,e,i){"use strict";i.d(e,"a",function(){return u}),i.d(e,"b",function(){return c});var n=i(4),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function a(){}var r={trace:a,debug:a,log:a,warn:a,info:a,error:a},o=r;var l=Object(n.a)();function d(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];i.forEach(function(e){o[e]=t[e]?t[e].bind(t):function(t){var e=l.console[t];return e?function(){for(var i=arguments.length,n=Array(i),s=0;s<i;s++)n[s]=arguments[s];n[0]&&(n[0]=function(t,e){return e="["+t+"] > "+e}(t,n[0])),e.apply(l.console,n)}:a}(e)})}var u=function(t){if(!0===t||"object"===(void 0===t?"undefined":s(t))){d(t,"debug","log","info","warn","error");try{o.log()}catch(t){o=r}}else o=r},c=o},function(t,e,i){"use strict";e.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(t,e,i){"use strict";i.d(e,"b",function(){return n}),i.d(e,"a",function(){return s});var n={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},s={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)}},function(t,e,i){"use strict";e.a=function(){return"undefined"==typeof window?self:window}},function(t,e,i){var n,s,a,r,o;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,s=/^([^\/;?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var n=this.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}var a=this.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):e;var r=this.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");if(!r.netLoc&&r.path&&"/"!==r.path[0]){var l=s.exec(r.path);r.netLoc=l[1],r.path=l[2]}r.netLoc&&!r.path&&(r.path="/");var d={scheme:r.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=r.netLoc,"/"!==a.path[0]))if(a.path){var u=r.path,c=u.substring(0,u.lastIndexOf("/")+1)+a.path;d.path=o.normalizePath(c)}else d.path=r.path,a.params||(d.params=r.params,a.query||(d.query=r.query));return null===d.path&&(d.path=i.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(d)},parseURL:function(t){var e=n.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(a,"");t.length!==(t=t.replace(r,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=o},function(t,e,i){"use strict";i.d(e,"b",function(){return s});var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,i){for(var n=i,s=0;t.isHeader(e,i);){s+=10,s+=t._readSize(e,i+6),t.isFooter(e,i+10)&&(s+=10),i+=s}if(s>0)return e.subarray(n,n+s)},t._readSize=function(t,e){var i=0;return i=(127&t[e])<<21,i|=(127&t[e+1])<<14,i|=(127&t[e+2])<<7,i|=127&t[e+3]},t.getTimeStamp=function(e){for(var i=t.getID3Frames(e),n=0;n<i.length;n++){var s=i[n];if(t.isTimeStampFrame(s))return t._readTimeStamp(s)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var i=String.fromCharCode(e[0],e[1],e[2],e[3]),n=t._readSize(e,4);return{type:i,size:n,data:e.subarray(10,10+n)}},t.getID3Frames=function(e){for(var i=0,n=[];t.isHeader(e,i);){for(var s=t._readSize(e,i+6),a=(i+=10)+s;i+8<a;){var r=t._getFrameData(e.subarray(i)),o=t._decodeFrame(r);o&&n.push(o),i+=r.size+10}t.isFooter(e,i)&&(i+=10)}return n},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),i=1&e[3],n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,i&&(n+=47721858.84),Math.round(n)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var i=t._utf8ArrayToStr(e.data,!0),n=new Uint8Array(e.data.subarray(i.length+1));return{key:e.type,info:i,data:n.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var i=1,n=t._utf8ArrayToStr(e.data.subarray(i));i+=n.length+1;var s=t._utf8ArrayToStr(e.data.subarray(i));return{key:e.type,info:n,data:s}}var a=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:a}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var i=1,n=t._utf8ArrayToStr(e.data.subarray(i));i+=n.length+1;var s=t._utf8ArrayToStr(e.data.subarray(i));return{key:e.type,info:n,data:s}}var a=t._utf8ArrayToStr(e.data);return{key:e.type,data:a}},t._utf8ArrayToStr=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.length,n=void 0,s=void 0,a=void 0,r="",o=0;o<i;){if(0===(n=t[o++])&&e)return r;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(n);break;case 12:case 13:s=t[o++],r+=String.fromCharCode((31&n)<<6|63&s);break;case 14:s=t[o++],a=t[o++],r+=String.fromCharCode((15&n)<<12|(63&s)<<6|(63&a)<<0)}}return r},t}(),s=n._utf8ArrayToStr;e.a=n},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function s(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,r,o,l,d;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}if(a(i=this._events[t]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(s(i))for(o=Array.prototype.slice.call(arguments,1),r=(d=i.slice()).length,l=0;l<r;l++)d[l].apply(this,o);return!0},i.prototype.addListener=function(t,e){var r;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(r=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){if(!n(e))throw TypeError("listener must be a function");var i=!1;function s(){this.removeListener(t,s),i||(i=!0,e.apply(this,arguments))}return s.listener=e,this.on(t,s),this},i.prototype.removeListener=function(t,e){var i,a,r,o;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=(i=this._events[t]).length,a=-1,i===e||n(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(i)){for(o=r;o-- >0;)if(i[o]===e||i[o].listener&&i[o].listener===e){a=o;break}if(a<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(a,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,i){"use strict";var n=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subtle=e,this.aesIV=i}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}();var s=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subtle=e,this.key=i}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}();var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),i=new Uint32Array(4),n=0;n<4;n++)i[n]=e.getUint32(4*n);return i},t.prototype.initTable=function(){var t=this.sBox,e=this.invSBox,i=this.subMix,n=i[0],s=i[1],a=i[2],r=i[3],o=this.invSubMix,l=o[0],d=o[1],u=o[2],c=o[3],h=new Uint32Array(256),p=0,g=0,f=0;for(f=0;f<256;f++)h[f]=f<128?f<<1:f<<1^283;for(f=0;f<256;f++){var v=g^g<<1^g<<2^g<<3^g<<4;v=v>>>8^255&v^99,t[p]=v,e[v]=p;var m=h[p],_=h[m],E=h[_],A=257*h[v]^16843008*v;n[p]=A<<24|A>>>8,s[p]=A<<16|A>>>16,a[p]=A<<8|A>>>24,r[p]=A,A=16843009*E^65537*_^257*m^16843008*p,l[v]=A<<24|A>>>8,d[v]=A<<16|A>>>16,u[v]=A<<8|A>>>24,c[v]=A,p?(p=m^h[h[h[E^m]]],g^=h[h[g]]):p=g=1}},t.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),i=!0,n=0;n<e.length&&i;)i=e[n]===this.key[n],n++;if(!i){this.key=e;var s=this.keySize=e.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);var a=this.ksRows=4*(s+6+1),r=void 0,o=void 0,l=this.keySchedule=new Uint32Array(a),d=this.invKeySchedule=new Uint32Array(a),u=this.sBox,c=this.rcon,h=this.invSubMix,p=h[0],g=h[1],f=h[2],v=h[3],m=void 0,_=void 0;for(r=0;r<a;r++)r<s?m=l[r]=e[r]:(_=m,r%s==0?(_=u[(_=_<<8|_>>>24)>>>24]<<24|u[_>>>16&255]<<16|u[_>>>8&255]<<8|u[255&_],_^=c[r/s|0]<<24):s>6&&r%s==4&&(_=u[_>>>24]<<24|u[_>>>16&255]<<16|u[_>>>8&255]<<8|u[255&_]),l[r]=m=(l[r-s]^_)>>>0);for(o=0;o<a;o++)r=a-o,_=3&o?l[r]:l[r-4],d[o]=o<4||r<=4?_:p[u[_>>>24]]^g[u[_>>>16&255]]^f[u[_>>>8&255]]^v[u[255&_]],d[o]=d[o]>>>0}},t.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.prototype.decrypt=function(t,e,i,n){for(var s,a,r,o=this.keySize+6,l=this.invKeySchedule,d=this.invSBox,u=this.invSubMix,c=u[0],h=u[1],p=u[2],g=u[3],f=this.uint8ArrayToUint32Array_(i),v=f[0],m=f[1],_=f[2],E=f[3],A=new Int32Array(t),y=new Int32Array(A.length),b=void 0,S=void 0,T=void 0,C=void 0,I=void 0,D=void 0,R=void 0,P=void 0,w=void 0,k=void 0,M=void 0,O=void 0,L=void 0,N=void 0,U=this.networkToHostOrderSwap;e<A.length;){for(w=U(A[e]),k=U(A[e+1]),M=U(A[e+2]),O=U(A[e+3]),I=w^l[0],D=O^l[1],R=M^l[2],P=k^l[3],L=4,N=1;N<o;N++)b=c[I>>>24]^h[D>>16&255]^p[R>>8&255]^g[255&P]^l[L],S=c[D>>>24]^h[R>>16&255]^p[P>>8&255]^g[255&I]^l[L+1],T=c[R>>>24]^h[P>>16&255]^p[I>>8&255]^g[255&D]^l[L+2],C=c[P>>>24]^h[I>>16&255]^p[D>>8&255]^g[255&R]^l[L+3],I=b,D=S,R=T,P=C,L+=4;b=d[I>>>24]<<24^d[D>>16&255]<<16^d[R>>8&255]<<8^d[255&P]^l[L],S=d[D>>>24]<<24^d[R>>16&255]<<16^d[P>>8&255]<<8^d[255&I]^l[L+1],T=d[R>>>24]<<24^d[P>>16&255]<<16^d[I>>8&255]<<8^d[255&D]^l[L+2],C=d[P>>>24]<<24^d[I>>16&255]<<16^d[D>>8&255]<<8^d[255&R]^l[L+3],L+=3,y[e]=U(b^v),y[e+1]=U(C^m),y[e+2]=U(T^_),y[e+3]=U(S^E),v=w,m=k,_=M,E=O,e+=4}return n?(s=y.buffer,a=s.byteLength,(r=a&&new DataView(s).getUint8(a-1))?s.slice(0,a-r):s):y.buffer},t.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}(),r=i(2),o=i(0),l=i(1),d=i(4);var u=Object(d.a)(),c=function(){function t(e,i){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).removePKCS7Padding,s=void 0===n||n;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.logEnabled=!0,this.observer=e,this.config=i,this.removePKCS7Padding=s,s)try{var a=u.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}return t.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.prototype.decrypt=function(t,e,i,r){var l=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(o.b.log("JS AES decrypt"),this.logEnabled=!1);var d=this.decryptor;d||(this.decryptor=d=new a),d.expandKey(e),r(d.decrypt(t,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(o.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var u=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new s(u,e)),this.fastAesKey.expandKey().then(function(s){new n(u,i).decrypt(t,s).catch(function(n){l.onWebCryptoError(n,t,e,i,r)}).then(function(t){r(t)})}).catch(function(n){l.onWebCryptoError(n,t,e,i,r)})}},t.prototype.onWebCryptoError=function(t,e,i,n,s){this.config.enableSoftwareAES?(o.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,i,n,s)):(o.b.error("decrypting error : "+t.message),this.observer.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},t.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}();e.a=c},function(t,e,i){"use strict";var n=i(0),s=i(1);var a=Math.pow(2,32)-1,r=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.remuxer=i}return t.prototype.resetTimeStamp=function(t){this.initPTS=t},t.prototype.resetInitSegment=function(e,i,n,a){if(e&&e.byteLength){var r=this.initData=t.parseInitSegment(e);null==i&&(i="mp4a.40.5"),null==n&&(n="avc1.42e01e");var o={};r.audio&&r.video?o.audiovideo={container:"video/mp4",codec:i+","+n,initSegment:a?e:null}:(r.audio&&(o.audio={container:"audio/mp4",codec:i,initSegment:a?e:null}),r.video&&(o.video={container:"video/mp4",codec:n,initSegment:a?e:null})),this.observer.trigger(s.a.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else i&&(this.audioCodec=i),n&&(this.videoCodec=n)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint16=function(t,e){t.data&&(e+=t.start,t=t.data);var i=t[e]<<8|t[e+1];return i<0?65536+i:i},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var i=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return i<0?4294967296+i:i},t.writeUint32=function(t,e,i){t.data&&(e+=t.start,t=t.data),t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=255&i},t.findBox=function(e,i){var n=[],s=void 0,a=void 0,r=void 0,o=void 0,l=void 0,d=void 0;if(e.data?(l=e.start,r=e.end,e=e.data):(l=0,r=e.byteLength),!i.length)return null;for(s=l;s<r;)d=(a=t.readUint32(e,s))>1?s+a:r,t.bin2str(e.subarray(s+4,s+8))===i[0]&&(1===i.length?n.push({data:e,start:s+8,end:d}):(o=t.findBox({data:e,start:s+8,end:d},i.slice(1))).length&&(n=n.concat(o))),s=d;return n},t.parseSegmentIndex=function(e){var i=t.findBox(e,["moov"])[0],n=i?i.end:null,s=0,a=t.findBox(e,["sidx"]),r=void 0;if(!a||!a[0])return null;r=[];var o=(a=a[0]).data[0];s=0===o?8:16;var l=t.readUint32(a,s);s+=4;s+=0===o?8:16,s+=2;var d=a.end+0,u=t.readUint16(a,s);s+=2;for(var c=0;c<u;c++){var h=s,p=t.readUint32(a,h);h+=4;var g=2147483647&p;if(1===(2147483648&p)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var f=t.readUint32(a,h);h+=4,r.push({referenceSize:g,subsegmentDuration:f,info:{duration:f/l,start:d,end:d+g-1}}),d+=g,s=h+=4}return{earliestPresentationTime:0,timescale:l,version:o,referencesCount:u,references:r,moovEndOffset:n}},t.parseInitSegment=function(e){var i=[];return t.findBox(e,["moov","trak"]).forEach(function(e){var s=t.findBox(e,["tkhd"])[0];if(s){var a=s.data[s.start],r=0===a?12:20,o=t.readUint32(s,r),l=t.findBox(e,["mdia","mdhd"])[0];if(l){r=0===(a=l.data[l.start])?12:20;var d=t.readUint32(l,r),u=t.findBox(e,["mdia","hdlr"])[0];if(u){var c={soun:"audio",vide:"video"}[t.bin2str(u.data.subarray(u.start+8,u.start+12))];if(c){var h=t.findBox(e,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var p=t.bin2str(h.data.subarray(h.start+12,h.start+16));n.b.log("MP4Demuxer:"+c+":"+p+" found")}i[o]={timescale:d,type:c},i[c]={timescale:d,id:o}}}}}}),i},t.getStartDTS=function(e,i){var n,s,a=void 0;return a=t.findBox(i,["moof","traf"]),n=[].concat.apply([],a.map(function(i){return t.findBox(i,["tfhd"]).map(function(n){var s,a;return s=t.readUint32(n,4),a=e[s].timescale||9e4,t.findBox(i,["tfdt"]).map(function(e){var i,n=void 0;return i=e.data[e.start],n=t.readUint32(e,4),1===i&&(n*=Math.pow(2,32),n+=t.readUint32(e,8)),n})[0]/a})})),s=Math.min.apply(null,n),isFinite(s)?s:0},t.offsetStartDTS=function(e,i,n){t.findBox(i,["moof","traf"]).map(function(i){return t.findBox(i,["tfhd"]).map(function(s){var r=t.readUint32(s,4),o=e[r].timescale||9e4;t.findBox(i,["tfdt"]).map(function(e){var i=e.data[e.start],s=t.readUint32(e,4);if(0===i)t.writeUint32(e,4,s-n*o);else{s*=Math.pow(2,32),s+=t.readUint32(e,8),s-=n*o,s=Math.max(s,0);var r=Math.floor(s/(a+1)),l=Math.floor(s%(a+1));t.writeUint32(e,4,r),t.writeUint32(e,8,l)}})})})},t.prototype.append=function(e,i,n,a){var r=this.initData;r||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),r=this.initData);var o,l=this.initPTS;if(void 0===l){var d=t.getStartDTS(r,e);this.initPTS=l=d-i,this.observer.trigger(s.a.INIT_PTS_FOUND,{initPTS:l})}t.offsetStartDTS(r,e,l),o=t.getStartDTS(r,e),this.remuxer.remux(r.audio,r.video,null,null,o,n,a,e)},t.prototype.destroy=function(){},t}();e.a=r},function(t,e,i){"use strict";var n=i(1),s=i(2),a=i(8),r=i(3),o=i(0),l=i(4);function d(t,e){return 255===t[e]&&240==(246&t[e+1])}function u(t,e){return 1&t[e+1]?7:9}function c(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function h(t,e){return!!(e+1<t.length&&d(t,e))}function p(t,e){if(e+1<t.length&&d(t,e)){var i=u(t,e);e+5<t.length&&(i=c(t,e));var n=e+i;if(n===t.length||n+1<t.length&&d(t,n))return!0}return!1}function g(t,e,i,a,r){if(!t.samplerate){var l=function(t,e,i,a){var r,l=void 0,d=void 0,u=void 0,c=void 0,h=navigator.userAgent.toLowerCase(),p=a,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(l=1+((192&e[i+2])>>>6),!((r=(60&e[i+2])>>>2)>g.length-1))return u=(1&e[i+2])<<2,u|=(192&e[i+3])>>>6,o.b.log("manifest codec:"+a+",ADTS data:type:"+l+",sampleingIndex:"+r+"["+g[r]+"Hz],channelConfig:"+u),/firefox/i.test(h)?r>=6?(l=5,c=new Array(4),d=r-3):(l=2,c=new Array(2),d=r):-1!==h.indexOf("android")?(l=2,c=new Array(2),d=r):(l=5,c=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&r>=6?d=r-3:((a&&-1!==a.indexOf("mp4a.40.2")&&(r>=6&&1===u||/vivaldi/i.test(h))||!a&&1===u)&&(l=2,c=new Array(2)),d=r)),c[0]=l<<3,c[0]|=(14&r)>>1,c[1]|=(1&r)<<7,c[1]|=u<<3,5===l&&(c[1]|=(14&d)>>1,c[2]=(1&d)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:g[r],channelCount:u,codec:"mp4a.40."+l,manifestCodec:p};t.trigger(n.a.ERROR,{type:s.b.MEDIA_ERROR,details:s.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+r})}(e,i,a,r);t.config=l.config,t.samplerate=l.samplerate,t.channelCount=l.channelCount,t.codec=l.codec,t.manifestCodec=l.manifestCodec,o.b.log("parsed codec:"+t.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)}}function f(t){return 9216e4/t}function v(t,e,i,n,s){var a=function(t,e,i,n,s){var a,r=void 0,o=t.length;if(a=u(t,e),r=c(t,e),(r-=a)>0&&e+a+r<=o)return{headerLength:a,frameLength:r,stamp:i+n*s}}(e,i,n,s,f(t.samplerate));if(a){var r=a.stamp,o=a.headerLength,l=a.frameLength,d={unit:e.subarray(i+o,i+o+l),pts:r,dts:r};return t.samples.push(d),t.len+=l,{sample:d,length:l+o}}}var m=i(6);var _=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.config=n,this.remuxer=i}return t.prototype.resetInitSegment=function(t,e,i,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:n,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){if(!t)return!1;for(var e=(m.a.getID3Data(t,0)||[]).length,i=t.length;e<i;e++)if(p(t,e))return o.b.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(t,e,i,n){for(var s=this._audioTrack,a=m.a.getID3Data(t,0)||[],l=m.a.getTimeStamp(a),d=Object(r.a)(l)?90*l:9e4*e,u=0,c=d,p=t.length,f=a.length,_=[{pts:c,dts:c,data:a}];f<p-1;)if(h(t,f)&&f+5<p){g(s,this.observer,t,f,s.manifestCodec);var E=v(s,t,f,d,u);if(!E){o.b.log("Unable to parse AAC frame");break}f+=E.length,c=E.sample.pts,u++}else m.a.isHeader(t,f)?(a=m.a.getID3Data(t,f),_.push({pts:c,dts:c,data:a}),f+=a.length):f++;this.remuxer.remux(s,{samples:[]},{samples:_,inputTimeScale:9e4},{samples:[]},e,i,n)},t.prototype.destroy=function(){},t}(),E=i(9),A={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,i,n,s){if(!(i+24>e.length)){var a=this.parseHeader(e,i);if(a&&i+a.frameLength<=e.length){var r=n+s*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:e.subarray(i,i+a.frameLength),pts:r,dts:r};return t.config=[],t.channelCount=a.channelCount,t.samplerate=a.sampleRate,t.samples.push(o),t.len+=a.frameLength,{sample:o,length:a.frameLength}}}},parseHeader:function(t,e){var i=t[e+1]>>3&3,n=t[e+1]>>1&3,s=t[e+2]>>4&15,a=t[e+2]>>2&3,r=t[e+2]>>1&1;if(1!==i&&0!==s&&15!==s&&3!==a){var o=3===i?3-n:3===n?3:4,l=1e3*A.BitratesMap[14*o+s-1],d=3===i?0:2===i?1:2,u=A.SamplingRateMap[3*d+a],c=t[e+3]>>6==3?1:2,h=A.SamplesCoefficients[i][n],p=A.BytesInSlot[n],g=8*h*p;return{sampleRate:u,channelCount:c,frameLength:parseInt(h*l/u+r,10)*p,samplesPerFrame:g}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var i=this.parseHeader(t,e),n=4;i&&i.frameLength&&(n=i.frameLength);var s=e+n;if(s===t.length||s+1<t.length&&this.isHeaderPattern(t,s))return!0}return!1}},y=A;var b=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,i=t.byteLength-e,n=new Uint8Array(4),s=Math.min(4,e);if(0===s)throw new Error("no bytes available");n.set(t.subarray(i,i+s)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s},t.prototype.skipBits=function(t){var e=void 0;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return t>32&&o.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0&&this.bitsAvailable?i<<e|this.readBits(e):i},t.prototype.skipLZ=function(){var t=void 0;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e=8,i=8,n=void 0;for(n=0;n<t;n++)0!==i&&(i=(e+this.readEG()+256)%256),e=0===i?e:i},t.prototype.readSPS=function(){var t,e,i,n,s=0,a=0,r=0,o=0,l=void 0,d=void 0,u=void 0,c=this.readUByte.bind(this),h=this.readBits.bind(this),p=this.readUEG.bind(this),g=this.readBoolean.bind(this),f=this.skipBits.bind(this),v=this.skipEG.bind(this),m=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if(c(),t=c(),h(5),f(3),c(),m(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var E=p();if(3===E&&f(1),m(),m(),f(1),g())for(d=3!==E?8:12,u=0;u<d;u++)g()&&_(u<6?16:64)}m();var A=p();if(0===A)p();else if(1===A)for(f(1),v(),v(),l=p(),u=0;u<l;u++)v();m(),f(1),e=p(),i=p(),0===(n=h(1))&&f(1),f(1),g()&&(s=p(),a=p(),r=p(),o=p());var y=[1,1];if(g()&&g())switch(c()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[c()<<8|c(),c()<<8|c()]}return{width:Math.ceil(16*(e+1)-2*s-2*a),height:(2-n)*(i+1)*16-(n?2:4)*(r+o),pixelRatio:y}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}();var S=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.decryptdata=n,this.discardEPB=s,this.decrypter=new a.a(e,i,{removePKCS7Padding:!1})}return t.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},t.prototype.decryptAacSample=function(t,e,i,n){var s=t[e].unit,a=s.subarray(16,s.length-s.length%16),r=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(r,function(a){a=new Uint8Array(a),s.set(a,16),n||o.decryptAacSamples(t,e+1,i)})},t.prototype.decryptAacSamples=function(t,e,i){for(;;e++){if(e>=t.length)return void i();if(!(t[e].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(t,e,i,n),!n)return}}},t.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(e),n=0,s=32;s<=t.length-16;s+=160,n+=16)i.set(t.subarray(s,s+16),n);return i},t.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var i=0,n=32;n<=t.length-16;n+=160,i+=16)t.set(e.subarray(i,i+16),n);return t},t.prototype.decryptAvcSample=function(t,e,i,n,s,a){var r=this.discardEPB(s.data),o=this.getAvcEncryptedData(r),l=this;this.decryptBuffer(o.buffer,function(o){s.data=l.getAvcDecryptedUnit(r,o),a||l.decryptAvcSamples(t,e,i+1,n)})},t.prototype.decryptAvcSamples=function(t,e,i,n){for(;;e++,i=0){if(e>=t.length)return void n();for(var s=t[e].units;!(i>=s.length);i++){var a=s[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var r=this.decrypter.isSync();if(this.decryptAvcSample(t,e,i,n,a,r),!r)return}}}},t}();var T={video:1,audio:2,id3:3,text:4},C=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.config=n,this.typeSupported=s,this.remuxer=i,this.sampleAes=null}return t.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new S(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var i=t._syncOffset(e);return!(i<0)&&(i&&o.b.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),!0)},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),i=0;i<e;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:T[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},t.prototype.resetInitSegment=function(e,i,n,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",s),this._audioTrack=t.createTrack("audio",s),this._id3Track=t.createTrack("id3",s),this._txtTrack=t.createTrack("text",s),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=n,this._duration=s},t.prototype.resetTimeStamp=function(){},t.prototype.append=function(e,i,a,r){var l=void 0,d=e.length,u=void 0,c=void 0,h=void 0,p=void 0,g=!1;this.contiguous=a;var f=this.pmtParsed,v=this._avcTrack,m=this._audioTrack,_=this._id3Track,E=v.pid,A=m.pid,y=_.pid,b=this._pmtId,S=v.pesData,T=m.pesData,C=_.pesData,I=this._parsePAT,D=this._parsePMT,R=this._parsePES,P=this._parseAVCPES.bind(this),w=this._parseAACPES.bind(this),k=this._parseMPEGPES.bind(this),M=this._parseID3PES.bind(this),O=t._syncOffset(e);for(d-=(d+O)%188,l=O;l<d;l+=188)if(71===e[l]){if(u=!!(64&e[l+1]),c=((31&e[l+1])<<8)+e[l+2],(48&e[l+3])>>4>1){if((h=l+5+e[l+4])===l+188)continue}else h=l+4;switch(c){case E:u&&(S&&(p=R(S))&&void 0!==p.pts&&P(p,!1),S={data:[],size:0}),S&&(S.data.push(e.subarray(h,l+188)),S.size+=l+188-h);break;case A:u&&(T&&(p=R(T))&&void 0!==p.pts&&(m.isAAC?w(p):k(p)),T={data:[],size:0}),T&&(T.data.push(e.subarray(h,l+188)),T.size+=l+188-h);break;case y:u&&(C&&(p=R(C))&&void 0!==p.pts&&M(p),C={data:[],size:0}),C&&(C.data.push(e.subarray(h,l+188)),C.size+=l+188-h);break;case 0:u&&(h+=e[h]+1),b=this._pmtId=I(e,h);break;case b:u&&(h+=e[h]+1);var L=D(e,h,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(E=L.avc)>0&&(v.pid=E),(A=L.audio)>0&&(m.pid=A,m.isAAC=L.isAAC),(y=L.id3)>0&&(_.pid=y),g&&!f&&(o.b.log("reparse from beginning"),g=!1,l=O-188),f=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=!0}}else this.observer.trigger(n.a.ERROR,{type:s.b.MEDIA_ERROR,details:s.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});S&&(p=R(S))&&void 0!==p.pts?(P(p,!0),v.pesData=null):v.pesData=S,T&&(p=R(T))&&void 0!==p.pts?(m.isAAC?w(p):k(p),m.pesData=null):(T&&T.size&&o.b.log("last AAC PES packet truncated,might overlap between fragments"),m.pesData=T),C&&(p=R(C))&&void 0!==p.pts?(M(p),_.pesData=null):_.pesData=C,null==this.sampleAes?this.remuxer.remux(m,v,_,this._txtTrack,i,a,r):this.decryptAndRemux(m,v,_,this._txtTrack,i,a,r)},t.prototype.decryptAndRemux=function(t,e,i,n,s,a,r){if(t.samples&&t.isAAC){var o=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){o.decryptAndRemuxAvc(t,e,i,n,s,a,r)})}else this.decryptAndRemuxAvc(t,e,i,n,s,a,r)},t.prototype.decryptAndRemuxAvc=function(t,e,i,n,s,a,r){if(e.samples){var o=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){o.remuxer.remux(t,e,i,n,s,a,r)})}else this.remuxer.remux(t,e,i,n,s,a,r)},t.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},t.prototype._parsePMT=function(t,e,i,n){var s,a=void 0,r={audio:-1,avc:-1,id3:-1,isAAC:!0};for(s=e+3+((15&t[e+1])<<8|t[e+2])-4,e+=12+((15&t[e+10])<<8|t[e+11]);e<s;){switch(a=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!n){o.b.log("unkown stream type:"+t[e]);break}case 15:-1===r.audio&&(r.audio=a);break;case 21:-1===r.id3&&(r.id3=a);break;case 219:if(!n){o.b.log("unkown stream type:"+t[e]);break}case 27:-1===r.avc&&(r.avc=a);break;case 3:case 4:i?-1===r.audio&&(r.audio=a,r.isAAC=!1):o.b.log("MPEG audio found, not supported in this browser for now");break;case 36:o.b.warn("HEVC stream type found, not supported for now");break;default:o.b.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return r},t.prototype._parsePES=function(t){var e=0,i=void 0,n=void 0,s=void 0,a=void 0,r=void 0,l=void 0,d=void 0,u=void 0,c=t.data;if(!t||0===t.size)return null;for(;c[0].length<19&&c.length>1;){var h=new Uint8Array(c[0].length+c[1].length);h.set(c[0]),h.set(c[1],c[0].length),c[0]=h,c.splice(1,1)}if(1===((i=c[0])[0]<<16)+(i[1]<<8)+i[2]){if((s=(i[4]<<8)+i[5])&&s>t.size-6)return null;192&(n=i[7])&&((l=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)>4294967295&&(l-=8589934592),64&n?((d=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>4294967295&&(d-=8589934592),l-d>54e5&&(o.b.warn(Math.round((l-d)/9e4)+"s delta between PTS and DTS, align them"),l=d)):d=l),u=(a=i[8])+9,t.size-=u,r=new Uint8Array(t.size);for(var p=0,g=c.length;p<g;p++){var f=(i=c[p]).byteLength;if(u){if(u>f){u-=f;continue}i=i.subarray(u),f-=u,u=0}r.set(i,e),e+=f}return s&&(s-=a+3),{data:r,pts:l,dts:d,len:s}}return null},t.prototype.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var i=e.samples,n=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(n||this.contiguous)?(t.id=n,i.push(t)):e.dropped++}t.debug.length&&o.b.log(t.pts+"/"+t.dts+":"+t.debug)},t.prototype._parseAVCPES=function(t,e){var i=this,n=this._avcTrack,s=this._parseAVCNALu(t.data),a=void 0,r=this.avcSample,o=void 0,l=!1,d=void 0,u=this.pushAccesUnit.bind(this),c=function(t,e,i,n){return{key:t,pts:e,dts:i,units:[],debug:n}};t.data=null,r&&s.length&&!n.audFound&&(u(r,n),r=this.avcSample=c(!1,t.pts,t.dts,"")),s.forEach(function(e){switch(e.type){case 1:o=!0,r||(r=i.avcSample=c(!0,t.pts,t.dts,"")),r.frame=!0;var s=e.data;if(l&&s.length>4){var h=new b(s).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(r.key=!0)}break;case 5:o=!0,r||(r=i.avcSample=c(!0,t.pts,t.dts,"")),r.key=!0,r.frame=!0;break;case 6:o=!0,(a=new b(i.discardEPB(e.data))).readUByte();for(var p=0,g=0,f=!1,v=0;!f&&a.bytesAvailable>1;){p=0;do{p+=v=a.readUByte()}while(255===v);g=0;do{g+=v=a.readUByte()}while(255===v);if(4===p&&0!==a.bytesAvailable){if(f=!0,181===a.readUByte())if(49===a.readUShort())if(1195456820===a.readUInt())if(3===a.readUByte()){var m=a.readUByte(),_=31&m,E=[m,a.readUByte()];for(d=0;d<_;d++)E.push(a.readUByte()),E.push(a.readUByte()),E.push(a.readUByte());i._insertSampleInOrder(i._txtTrack.samples,{type:3,pts:t.pts,bytes:E})}}else if(g<a.bytesAvailable)for(d=0;d<g;d++)a.readUByte()}break;case 7:if(o=!0,l=!0,!n.sps){var A=(a=new b(e.data)).readSPS();n.width=A.width,n.height=A.height,n.pixelRatio=A.pixelRatio,n.sps=[e.data],n.duration=i._duration;var y=e.data.subarray(1,4),S="avc1.";for(d=0;d<3;d++){var T=y[d].toString(16);T.length<2&&(T="0"+T),S+=T}n.codec=S}break;case 8:o=!0,n.pps||(n.pps=[e.data]);break;case 9:o=!1,n.audFound=!0,r&&u(r,n),r=i.avcSample=c(!1,t.pts,t.dts,"");break;case 12:o=!1;break;default:o=!1,r&&(r.debug+="unknown NAL "+e.type+" ")}r&&o&&r.units.push(e)}),e&&r&&(u(r,n),this.avcSample=null)},t.prototype._insertSampleInOrder=function(t,e){var i=t.length;if(i>0){if(e.pts>=t[i-1].pts)t.push(e);else for(var n=i-1;n>=0;n--)if(e.pts<t[n].pts){t.splice(n,0,e);break}}else t.push(e)},t.prototype._getLastNalUnit=function(){var t=this.avcSample,e=void 0;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var n=t.units;e=n[n.length-1]}return e},t.prototype._parseAVCNALu=function(t){var e=0,i=t.byteLength,n=void 0,s=void 0,a=this._avcTrack,r=a.naluState||0,o=r,l=[],d=void 0,u=-1,c=void 0;for(-1===r&&(u=0,c=31&t[0],r=0,e=1);e<i;)if(n=t[e++],r)if(1!==r)if(n)if(1===n){if(u>=0)d={data:t.subarray(u,e-r-1),type:c},l.push(d);else{var h=this._getLastNalUnit();if(h&&(o&&e<=4-o&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-o)),(s=e-r-1)>0)){var p=new Uint8Array(h.data.byteLength+s);p.set(h.data,0),p.set(t.subarray(0,s),h.data.byteLength),h.data=p}}e<i?(u=e,c=31&t[e],r=0):r=-1}else r=0;else r=3;else r=n?0:2;else r=n?0:1;if(u>=0&&r>=0&&(d={data:t.subarray(u,i),type:c,state:r},l.push(d)),0===l.length){var g=this._getLastNalUnit();if(g){var f=new Uint8Array(g.data.byteLength+t.byteLength);f.set(g.data,0),f.set(t,g.data.byteLength),g.data=f}}return a.naluState=r,l},t.prototype.discardEPB=function(t){for(var e,i=t.byteLength,n=[],s=1,a=void 0;s<i-2;)0===t[s]&&0===t[s+1]&&3===t[s+2]?(n.push(s+2),s+=2):s++;if(0===n.length)return t;e=i-n.length,a=new Uint8Array(e);var r=0;for(s=0;s<e;r++,s++)r===n[0]&&(r++,n.shift()),a[s]=t[r];return a},t.prototype._parseAACPES=function(t){var e,i,a=this._audioTrack,r=t.data,l=t.pts,d=this.aacOverFlow,u=this.aacLastPTS,c=void 0,p=void 0,m=void 0;if(d){var _=new Uint8Array(d.byteLength+r.byteLength);_.set(d,0),_.set(r,d.byteLength),r=_}for(p=0,i=r.length;p<i-1&&!h(r,p);p++);if(p){var E=void 0,A=void 0;if(p<i-1?(E="AAC PES did not start with ADTS header,offset:"+p,A=!1):(E="no ADTS header found in AAC PES",A=!0),o.b.warn("parsing error:"+E),this.observer.trigger(n.a.ERROR,{type:s.b.MEDIA_ERROR,details:s.a.FRAG_PARSING_ERROR,fatal:A,reason:E}),A)return}if(g(a,this.observer,r,p,this.audioCodec),c=0,e=f(a.samplerate),d&&u){var y=u+e;Math.abs(y-l)>1&&(o.b.log("AAC: align PTS for overlapping frames by "+Math.round((y-l)/90)),l=y)}for(;p<i;)if(h(r,p)&&p+5<i){var b=v(a,r,p,l,c);if(!b)break;p+=b.length,m=b.sample.pts,c++}else p++;d=p<i?r.subarray(p,i):null,this.aacOverFlow=d,this.aacLastPTS=m},t.prototype._parseMPEGPES=function(t){for(var e=t.data,i=e.length,n=0,s=0,a=t.pts;s<i;)if(y.isHeader(e,s)){var r=y.appendFrame(this._audioTrack,e,s,a,n);if(!r)break;s+=r.length,n++}else s++},t.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},t}();var I=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.config=n,this.remuxer=i}return t.prototype.resetInitSegment=function(t,e,i,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:n,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){var e=void 0,i=void 0,n=m.a.getID3Data(t,0);if(n&&void 0!==m.a.getTimeStamp(n))for(e=n.length,i=Math.min(t.length-1,e+100);e<i;e++)if(y.probe(t,e))return o.b.log("MPEG Audio sync word found !"),!0;return!1},t.prototype.append=function(t,e,i,n){for(var s=m.a.getID3Data(t,0),a=m.a.getTimeStamp(s),r=a?90*a:9e4*e,o=s.length,l=t.length,d=0,u=0,c=this._audioTrack,h=[{pts:r,dts:r,data:s}];o<l;)if(y.isHeader(t,o)){var p=y.appendFrame(c,t,o,r,d);if(!p)break;o+=p.length,u=p.sample.pts,d++}else m.a.isHeader(t,o)?(s=m.a.getID3Data(t,o),h.push({pts:u,dts:u,data:s}),o+=s.length):o++;this.remuxer.remux(c,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},e,i,n)},t.prototype.destroy=function(){},t}();var D=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}();var R=Math.pow(2,32)-1,P=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.init=function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e=void 0;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:i,audio:n};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=a,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var r=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,r,l,r,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,s))},t.box=function(t){for(var e=Array.prototype.slice.call(arguments,1),i=8,n=e.length,s=n,a=void 0;n--;)i+=e[n].byteLength;for((a=new Uint8Array(i))[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(t,4),n=0,i=8;n<s;n++)a.set(e[n],i),i+=e[n].byteLength;return a},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,i){i*=e;var n=Math.floor(i/(R+1)),s=Math.floor(i%(R+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,i,n){return t.box(t.types.moof,t.mfhd(e),t.traf(n,i))},t.moov=function(e){for(var i=e.length,n=[];i--;)n[i]=t.trak(e[i]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(t.mvex(e)))},t.mvex=function(e){for(var i=e.length,n=[];i--;)n[i]=t.trex(e[i]);return t.box.apply(null,[t.types.mvex].concat(n))},t.mvhd=function(e,i){i*=e;var n=Math.floor(i/(R+1)),s=Math.floor(i%(R+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,a)},t.sdtp=function(e){var i=e.samples||[],n=new Uint8Array(4+i.length),s=void 0,a=void 0;for(a=0;a<i.length;a++)s=i[a].flags,n[a+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return t.box(t.types.sdtp,n)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var i=[],n=[],s=void 0,a=void 0,r=void 0;for(s=0;s<e.sps.length;s++)r=(a=e.sps[s]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(a));for(s=0;s<e.pps.length;s++)r=(a=e.pps[s]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(a));var o=t.box(t.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(n))),l=e.width,d=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var i=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var i=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var i=e.id,n=e.duration*e.timescale,s=e.width,a=e.height,r=Math.floor(n/(R+1)),o=Math.floor(n%(R+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,a>>8&255,255&a,0,0]))},t.traf=function(e,i){var n=t.sdtp(e),s=e.id,a=Math.floor(i/(R+1)),r=Math.floor(i%(R+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,r>>24,r>>16&255,r>>8&255,255&r])),t.trun(e,n.length+16+20+8+16+8+8),n)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var i=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,i){var n=e.samples||[],s=n.length,a=12+16*s,r=new Uint8Array(a),o=void 0,l=void 0,d=void 0,u=void 0,c=void 0,h=void 0;for(i+=8+a,r.set([0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,255&s,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),o=0;o<s;o++)d=(l=n[o]).duration,u=l.size,c=l.flags,h=l.cts,r.set([d>>>24&255,d>>>16&255,d>>>8&255,255&d,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*o);return t.box(t.types.trun,r)},t.initSegment=function(e){t.types||t.init();var i=t.moov(e),n=void 0;return(n=new Uint8Array(t.FTYP.byteLength+i.byteLength)).set(t.FTYP),n.set(i,t.FTYP.byteLength),n},t}();var w=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.config=i,this.typeSupported=n;var a=navigator.userAgent;this.isSafari=s&&s.indexOf("Apple")>-1&&a&&!a.match("CriOS"),this.ISGenerated=!1}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},t.prototype.resetInitSegment=function(){this.ISGenerated=!1},t.prototype.remux=function(t,e,i,s,a,r,l){if(this.ISGenerated||this.generateIS(t,e,a),this.ISGenerated){var d=t.samples.length,u=e.samples.length,c=a,h=a;if(d&&u){var p=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale;c+=Math.max(0,p),h+=Math.max(0,-p)}if(d){t.timescale||(o.b.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,a));var g=this.remuxAudio(t,c,r,l);if(u){var f=void 0;g&&(f=g.endPTS-g.startPTS),e.timescale||(o.b.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,a)),this.remuxVideo(e,h,r,f,l)}}else if(u){var v=this.remuxVideo(e,h,r,0,l);v&&t.codec&&this.remuxEmptyAudio(t,c,r,v)}}i.samples.length&&this.remuxID3(i,a),s.samples.length&&this.remuxText(s,a),this.observer.trigger(n.a.FRAG_PARSED)},t.prototype.generateIS=function(t,e,i){var a=this.observer,r=t.samples,l=e.samples,d=this.typeSupported,u="audio/mp4",c={},h={tracks:c},p=void 0===this._initPTS,g=void 0,f=void 0;if(p&&(g=f=1/0),t.config&&r.length&&(t.timescale=t.samplerate,o.b.log("audio sampling rate : "+t.samplerate),t.isAAC||(d.mpeg?(u="audio/mpeg",t.codec=""):d.mp3&&(t.codec="mp3")),c.audio={container:u,codec:t.codec,initSegment:!t.isAAC&&d.mpeg?new Uint8Array:P.initSegment([t]),metadata:{channelCount:t.channelCount}},p&&(g=f=r[0].pts-t.inputTimeScale*i)),e.sps&&e.pps&&l.length){var v=e.inputTimeScale;e.timescale=v,c.video={container:"video/mp4",codec:e.codec,initSegment:P.initSegment([e]),metadata:{width:e.width,height:e.height}},p&&(g=Math.min(g,l[0].pts-v*i),f=Math.min(f,l[0].dts-v*i),this.observer.trigger(n.a.INIT_PTS_FOUND,{initPTS:g}))}Object.keys(c).length?(a.trigger(n.a.FRAG_PARSING_INIT_SEGMENT,h),this.ISGenerated=!0,p&&(this._initPTS=g,this._initDTS=f)):a.trigger(n.a.ERROR,{type:s.b.MEDIA_ERROR,details:s.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.prototype.remuxVideo=function(t,e,i,a,r){var l,d,u,c=8,h=t.timescale,p=void 0,g=void 0,f=void 0,v=void 0,m=t.samples,_=[],E=m.length,A=this._PTSNormalize,y=this._initDTS,b=this.nextAvcDts,S=this.isSafari;if(0!==E){S&&(i|=m.length&&b&&(r&&Math.abs(e-b/h)<.1||Math.abs(m[0].pts-b-y)<h/5)),i||(b=e*h),m.forEach(function(t){t.pts=A(t.pts-y,b),t.dts=A(t.dts-y,b)}),m.sort(function(t,e){var i=t.dts-e.dts,n=t.pts-e.pts;return i||n||t.id-e.id});var T=m.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(T<0){o.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var C=0;C<m.length;C++)m[C].dts+=T}var I=m[0];v=Math.max(I.dts,0),f=Math.max(I.pts,0);var D=Math.round((v-b)/90);i&&D&&(D>1?o.b.log("AVC:"+D+" ms hole between fragments detected,filling it"):D<-1&&o.b.log("AVC:"+-D+" ms overlapping between fragments detected"),v=b,m[0].dts=v,f=Math.max(f-D,b),m[0].pts=f,o.b.log("Video/PTS/DTS adjusted: "+Math.round(f/90)+"/"+Math.round(v/90)+",delta:"+D+" ms")),v,I=m[m.length-1],u=Math.max(I.dts,0),d=Math.max(I.pts,0,u),S&&(p=Math.round((u-v)/(m.length-1)));for(var R=0,w=0,k=0;k<E;k++){for(var M=m[k],O=M.units,L=O.length,N=0,U=0;U<L;U++)N+=O[U].data.length;w+=N,R+=L,M.length=N,M.dts=S?v+k*p:Math.max(M.dts,v),M.pts=Math.max(M.pts,M.dts)}var B=w+4*R+8;try{g=new Uint8Array(B)}catch(t){return void this.observer.trigger(n.a.ERROR,{type:s.b.MUX_ERROR,details:s.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating video mdat "+B})}var j=new DataView(g.buffer);j.setUint32(0,B),g.set(P.types.mdat,4);for(var x=0;x<E;x++){for(var F=m[x],G=F.units,V=0,H=void 0,$=0,q=G.length;$<q;$++){var W=G[$],K=W.data,z=W.data.byteLength;j.setUint32(c,z),c+=4,g.set(K,c),c+=z,V+=4+z}if(S)H=Math.max(0,p*Math.round((F.pts-F.dts)/p));else{if(x<E-1)p=m[x+1].dts-F.dts;else{var Y=this.config,X=F.dts-m[x>0?x-1:x].dts;if(Y.stretchShortVideoTrack){var Q=Y.maxBufferHole,J=Math.floor(Q*h),Z=(a?f+a*h:this.nextAudioPts)-F.pts;Z>J?((p=Z-X)<0&&(p=X),o.b.log("It is approximately "+Z/90+" ms to the next segment; using duration "+p/90+" ms for the last video frame.")):p=X}else p=X}H=Math.round(F.pts-F.dts)}_.push({size:V,duration:p,cts:H,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:F.key?2:1,isNonSync:F.key?0:1}})}this.nextAvcDts=u+p;var tt=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,_.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var et=_[0].flags;et.dependsOn=2,et.isNonSync=0}t.samples=_,l=P.moof(t.sequenceNumber++,v,t),t.samples=[];var it={data1:l,data2:g,startPTS:f/h,endPTS:(d+p)/h,startDTS:v/h,endDTS:this.nextAvcDts/h,type:"video",hasAudio:!1,hasVideo:!0,nb:_.length,dropped:tt};return this.observer.trigger(n.a.FRAG_PARSING_DATA,it),it}},t.prototype.remuxAudio=function(t,e,i,a){var r=t.inputTimeScale,l=t.timescale,d=r/l,u=(t.isAAC?1024:1152)*d,c=this._PTSNormalize,h=this._initDTS,p=!t.isAAC&&this.typeSupported.mpeg,g=void 0,f=void 0,v=void 0,m=void 0,_=void 0,E=void 0,A=void 0,y=t.samples,b=[],S=this.nextAudioPts;if(i|=y.length&&S&&(a&&Math.abs(e-S/r)<.1||Math.abs(y[0].pts-S-h)<20*u),y.forEach(function(t){t.pts=t.dts=c(t.pts-h,e*r)}),0!==(y=y.filter(function(t){return t.pts>=0})).length){if(i||(S=a?e*r:y[0].pts),t.isAAC)for(var T=this.config.maxAudioFramesDrift,C=0,I=S;C<y.length;){var R,w=y[C];R=w.pts-I;var k=Math.abs(1e3*R/r);if(R<=-T*u)o.b.warn("Dropping 1 audio frame @ "+(I/r).toFixed(3)+"s due to "+Math.round(k)+" ms overlap."),y.splice(C,1),t.len-=w.unit.length;else if(R>=T*u&&k<1e4&&I){var M=Math.round(R/u);o.b.warn("Injecting "+M+" audio frame @ "+(I/r).toFixed(3)+"s due to "+Math.round(1e3*R/r)+" ms gap.");for(var O=0;O<M;O++){var L=Math.max(I,0);(v=D.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(o.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),v=w.unit.subarray()),y.splice(C,0,{unit:v,pts:L,dts:L}),t.len+=v.length,I+=u,C++}w.pts=w.dts=I,I+=u,C++}else Math.abs(R),w.pts=w.dts=I,I+=u,C++}for(var N=0,U=y.length;N<U;N++){var B=y[N],j=B.unit,x=B.pts;if(void 0!==A)f.duration=Math.round((x-A)/d);else{var F=Math.round(1e3*(x-S)/r),G=0;if(i&&t.isAAC&&F){if(F>0&&F<1e4)G=Math.round((x-S)/u),o.b.log(F+" ms hole between AAC samples detected,filling it"),G>0&&((v=D.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(v=j.subarray()),t.len+=G*v.length);else if(F<-12){o.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(S/r).toFixed(3)+"s/"+(x/r).toFixed(3)+"s/"+-F+"ms"),t.len-=j.byteLength;continue}x=S}if(E=x,!(t.len>0))return;var V=p?t.len:t.len+8;g=p?0:8;try{m=new Uint8Array(V)}catch(t){return void this.observer.trigger(n.a.ERROR,{type:s.b.MUX_ERROR,details:s.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V})}p||(new DataView(m.buffer).setUint32(0,V),m.set(P.types.mdat,4));for(var H=0;H<G;H++)(v=D.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(o.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),v=j.subarray()),m.set(v,g),g+=v.byteLength,f={size:v.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(f)}m.set(j,g);var $=j.byteLength;g+=$,f={size:$,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(f),A=x}var q=0,W=b.length;if(W>=2&&(q=b[W-2].duration,f.duration=q),W){this.nextAudioPts=S=A+d*q,t.len=0,t.samples=b,_=p?new Uint8Array:P.moof(t.sequenceNumber++,E/d,t),t.samples=[];var K=E/r,z=S/r,Y={data1:_,data2:m,startPTS:K,endPTS:z,startDTS:K,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:W};return this.observer.trigger(n.a.FRAG_PARSING_DATA,Y),Y}return null}},t.prototype.remuxEmptyAudio=function(t,e,i,n){var s=t.inputTimeScale,a=s/(t.samplerate?t.samplerate:s),r=this.nextAudioPts,l=(void 0!==r?r:n.startDTS*s)+this._initDTS,d=n.endDTS*s+this._initDTS,u=1024*a,c=Math.ceil((d-l)/u),h=D.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(o.b.warn("remux empty Audio"),h){for(var p=[],g=0;g<c;g++){var f=l+g*u;p.push({unit:h,pts:f,dts:f}),t.len+=h.length}t.samples=p,this.remuxAudio(t,e,i)}else o.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.prototype.remuxID3=function(t,e){var i=t.samples.length,s=void 0,a=t.inputTimeScale,r=this._initPTS,o=this._initDTS;if(i){for(var l=0;l<i;l++)(s=t.samples[l]).pts=(s.pts-r)/a,s.dts=(s.dts-o)/a;this.observer.trigger(n.a.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],e=e},t.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var i=t.samples.length,s=void 0,a=t.inputTimeScale,r=this._initPTS;if(i){for(var o=0;o<i;o++)(s=t.samples[o]).pts=(s.pts-r)/a;this.observer.trigger(n.a.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],e=e},t.prototype._PTSNormalize=function(t,e){var i=void 0;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=i;return t},t}();var k=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(){},t.prototype.resetInitSegment=function(){},t.prototype.remux=function(t,e,i,s,a,r,o,l){var d=this.observer,u="";t&&(u+="audio"),e&&(u+="video"),d.trigger(n.a.FRAG_PARSING_DATA,{data1:l,startPTS:a,startDTS:a,type:u,hasAudio:!!t,hasVideo:!!e,nb:1,dropped:0}),d.trigger(n.a.FRAG_PARSED)},t}();var M=Object(l.a)().performance,O=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observer=e,this.typeSupported=i,this.config=n,this.vendor=s}return t.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},t.prototype.push=function(t,e,i,s,r,o,l,d,u,c,h,p){if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var g=this.decrypter;null==g&&(g=this.decrypter=new a.a(this.observer,this.config));var f=this,v=void 0;try{v=M.now()}catch(t){v=Date.now()}g.decrypt(t,e.key.buffer,e.iv.buffer,function(t){var a=void 0;try{a=M.now()}catch(t){a=Date.now()}f.observer.trigger(n.a.FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:a}}),f.pushDecrypted(new Uint8Array(t),e,new Uint8Array(i),s,r,o,l,d,u,c,h,p)})}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(i),s,r,o,l,d,u,c,h,p)},t.prototype.pushDecrypted=function(t,e,i,a,r,o,l,d,u,c,h,p){var g=this.demuxer;if(!g||(l||d)&&!this.probe(t)){for(var f=this.observer,v=this.typeSupported,m=this.config,A=[{demux:C,remux:w},{demux:E.a,remux:k},{demux:_,remux:w},{demux:I,remux:w}],y=0,b=A.length;y<b;y++){var S=A[y],T=S.demux.probe;if(T(t)){var D=this.remuxer=new S.remux(f,m,v,this.vendor);g=new S.demux(f,D,m,v),this.probe=T;break}}if(!g)return void f.trigger(n.a.ERROR,{type:s.b.MEDIA_ERROR,details:s.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=g}var R=this.remuxer;(l||d)&&(g.resetInitSegment(i,a,r,c),R.resetInitSegment()),l&&(g.resetTimeStamp(p),R.resetTimeStamp(p)),"function"==typeof g.setDecryptData&&g.setDecryptData(e),g.append(t,o,u,h)},t}();e.a=O},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={};i.d(n,"newCue",function(){return ee});var s=i(5),a=i.n(s),r=i(2),o=i(3),l=i(1),d=i(0),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var c=new Set(["hlsEventGeneric","hlsHandlerDestroying","hlsHandlerDestroyed"]),h=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.hls=e,this.onEvent=this.onEvent.bind(this);for(var i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}return t.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.prototype.onHandlerDestroying=function(){},t.prototype.onHandlerDestroyed=function(){},t.prototype.isEventHandler=function(){return"object"===u(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},t.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if(c.has(t))throw new Error("Forbidden event-name: "+t);this.hls.on(t,this.onEvent)},this)},t.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},t.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},t.prototype.onEventGeneric=function(t,e){try{(function(t,e){var i="on"+t.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,e)}).call(this,t,e).call()}catch(e){d.b.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(l.a.ERROR,{type:r.b.OTHER_ERROR,details:r.a.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},t}(),p=i(9),g=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.method=null,this.key=null,this.iv=null,this._uri=null}return g(t,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=a.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),t}(),v=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var m=function(){function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((e={})[t.ElementaryStreamTypes.AUDIO]=!1,e[t.ElementaryStreamTypes.VIDEO]=!1,e)}return t.prototype.addElementaryStream=function(t){this._elementaryStreams[t]=!0},t.prototype.hasElementaryStream=function(t){return!0===this._elementaryStreams[t]},t.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e},t.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var i=t;return t&&t.method&&t.uri&&!t.iv&&((i=new f).method=t.method,i.baseuri=t.baseuri,i.reluri=t.reluri,i.iv=this.createInitializationVector(e)),i},v(t,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=a.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var t=[];if(this.rawByteRange){var e=this.rawByteRange.split("@",2);if(1===e.length){var i=this.lastByteRangeEndOffset;t[0]=i||0}else t[0]=parseInt(e[1]);t[1]=parseInt(e[0])+t[0],this._byteRange=t}return t}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:"endProgramDateTime",get:function(){if(!Object(o.a)(this.programDateTime))return null;var t=Object(o.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),t}(),_=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var E=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}return _(t,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(o.a)(this.fragments[0].programDateTime))}}]),t}();var A=/^(\d+)x(\d+)$/,y=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function t(e){for(var i in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(i)&&(this[i]=e[i])}return t.prototype.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},t.prototype.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var i=new Uint8Array(e.length/2),n=0;n<e.length/2;n++)i[n]=parseInt(e.slice(2*n,2*n+2),16);return i}return null},t.prototype.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},t.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},t.prototype.enumeratedString=function(t){return this[t]},t.prototype.decimalResolution=function(t){var e=A.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e=void 0,i={};for(y.lastIndex=0;null!==(e=y.exec(t));){var n=e[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[e[1]]=n}return i},t}(),S={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function T(t,e){return window.MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}var C=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,I=/#EXT-X-MEDIA:(.*)/g,D=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),R=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,P=/\.(mp4|m4s|m4v|m4a)$/i,w=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.findGroup=function(t,e){if(!t)return null;for(var i=null,n=0;n<t.length;n++){var s=t[n];s.id===e&&(i=s)}return i},t.convertAVC1ToAVCOTI=function(t){var e=void 0,i=t.split(".");return i.length>2?(e=i.shift()+".",e+=parseInt(i.shift()).toString(16),e+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):e=t,e},t.resolve=function(t,e){return a.a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,i){var n=[],s=void 0;function a(t,e){["video","audio"].forEach(function(i){var n=t.filter(function(t){return function(t,e){var i=S[e];return!!i&&!0===i[t.slice(0,4)]}(t,i)});if(n.length){var s=n.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)});e[i+"Codec"]=s.length>0?s[0]:n[0],t=t.filter(function(t){return-1===n.indexOf(t)})}}),e.unknownCodecs=t}for(C.lastIndex=0;null!=(s=C.exec(e));){var r={},o=r.attrs=new b(s[1]);r.url=t.resolve(s[2],i);var l=o.decimalResolution("RESOLUTION");l&&(r.width=l.width,r.height=l.height),r.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),r.name=o.NAME,a([].concat((o.CODECS||"").split(/[ ,]+/)),r),r.videoCodec&&-1!==r.videoCodec.indexOf("avc1")&&(r.videoCodec=t.convertAVC1ToAVCOTI(r.videoCodec)),n.push(r)}return n},t.parseMasterPlaylistMedia=function(e,i,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=void 0,r=[],o=0;for(I.lastIndex=0;null!==(a=I.exec(e));){var l={},d=new b(a[1]);if(d.TYPE===n){if(l.groupId=d["GROUP-ID"],l.name=d.NAME,l.type=n,l.default="YES"===d.DEFAULT,l.autoselect="YES"===d.AUTOSELECT,l.forced="YES"===d.FORCED,d.URI&&(l.url=t.resolve(d.URI,i)),l.lang=d.LANGUAGE,l.name||(l.name=l.lang),s.length){var u=t.findGroup(s,l.groupId);l.audioCodec=u?u.codec:s[0].codec}l.id=o++,r.push(l)}}return r},t.parseLevelPlaylist=function(t,e,i,n,s){var a=0,r=0,l=new E(e),u=new f,c=0,h=null,p=new m,g=void 0,v=void 0,_=null;for(D.lastIndex=0;null!==(g=D.exec(t));){var A=g[1];if(A){p.duration=parseFloat(A);var y=(" "+g[2]).slice(1);p.title=y||null,p.tagList.push(y?["INF",A,y]:["INF",A])}else if(g[3]){if(Object(o.a)(p.duration)){var S=a++;p.type=n,p.start=r,p.levelkey=u,p.sn=S,p.level=i,p.cc=c,p.urlId=s,p.baseurl=e,p.relurl=(" "+g[3]).slice(1),k(p,h),l.fragments.push(p),h=p,r+=p.duration,p=new m}}else if(g[4]){if(p.rawByteRange=(" "+g[4]).slice(1),h){var T=h.byteRangeEndOffset;T&&(p.lastByteRangeEndOffset=T)}}else if(g[5])p.rawProgramDateTime=(" "+g[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),null===_&&(_=l.fragments.length);else{for(g=g[0].match(R),v=1;v<g.length&&void 0===g[v];v++);var C=(" "+g[v+1]).slice(1),I=(" "+g[v+2]).slice(1);switch(g[v]){case"#":p.tagList.push(I?[C,I]:[C]);break;case"PLAYLIST-TYPE":l.type=C.toUpperCase();break;case"MEDIA-SEQUENCE":a=l.startSN=parseInt(C);break;case"TARGETDURATION":l.targetduration=parseFloat(C);break;case"VERSION":l.version=parseInt(C);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":c++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(C);break;case"KEY":var w=new b(C),M=w.enumeratedString("METHOD"),O=w.URI,L=w.hexadecimalInteger("IV");M&&(u=new f,O&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(M)>=0&&(u.method=M,u.baseuri=e,u.reluri=O,u.key=null,u.iv=L));break;case"START":var N=new b(C).decimalFloatingPoint("TIME-OFFSET");Object(o.a)(N)&&(l.startTimeOffset=N);break;case"MAP":var U=new b(C);p.relurl=U.URI,p.rawByteRange=U.BYTERANGE,p.baseurl=e,p.level=i,p.type=n,p.sn="initSegment",l.initSegment=p,(p=new m).rawProgramDateTime=l.initSegment.rawProgramDateTime;break;default:d.b.warn("line parsed but not handled: "+g)}}}return(p=h)&&!p.relurl&&(l.fragments.pop(),r-=p.duration),l.totalduration=r,l.averagetargetduration=r/l.fragments.length,l.endSN=a-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=c,!l.initSegment&&l.fragments.length&&l.fragments.every(function(t){return P.test(t.relurl)})&&(d.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(p=new m).relurl=l.fragments[0].relurl,p.baseurl=e,p.level=i,p.type=n,p.sn="initSegment",l.initSegment=p,l.needSidxRanges=!0),_&&function(t,e){for(var i=t[e],n=e-1;n>=0;n--){var s=t[n];s.programDateTime=i.programDateTime-1e3*s.duration,i=s}}(l.fragments,_),l},t}();function k(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(o.a)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}var M=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var O=window.performance,L={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},N={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},U=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MANIFEST_LOADING,l.a.LEVEL_LOADING,l.a.AUDIO_TRACK_LOADING,l.a.SUBTITLE_TRACK_LOADING));return n.loaders={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.canHaveQualityLevels=function(t){return t!==L.AUDIO_TRACK&&t!==L.SUBTITLE_TRACK},e.mapContextToLevelType=function(t){switch(t.type){case L.AUDIO_TRACK:return N.AUDIO;case L.SUBTITLE_TRACK:return N.SUBTITLE;default:return N.MAIN}},e.getResponseUrl=function(t,e){var i=t.url;return void 0!==i&&0!==i.indexOf("data:")||(i=e.url),i},e.prototype.createInternalLoader=function(t){var e=this.hls.config,i=e.pLoader,n=e.loader,s=new(i||n)(e);return t.loader=s,this.loaders[t.type]=s,s},e.prototype.getInternalLoader=function(t){return this.loaders[t.type]},e.prototype.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.prototype.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.prototype.destroy=function(){this.destroyInternalLoaders(),t.prototype.destroy.call(this)},e.prototype.onManifestLoading=function(t){this.load(t.url,{type:L.MANIFEST,level:0,id:null})},e.prototype.onLevelLoading=function(t){this.load(t.url,{type:L.LEVEL,level:t.level,id:t.id})},e.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:L.AUDIO_TRACK,level:null,id:t.id})},e.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:L.SUBTITLE_TRACK,level:null,id:t.id})},e.prototype.load=function(t,e){var i=this.hls.config;d.b.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var n=this.getInternalLoader(e);if(n){var s=n.context;if(s&&s.url===t)return d.b.trace("playlist request ongoing"),!1;d.b.warn("aborting previous loader for type: "+e.type),n.abort()}var a=void 0,r=void 0,o=void 0,l=void 0;switch(e.type){case L.MANIFEST:a=i.manifestLoadingMaxRetry,r=i.manifestLoadingTimeOut,o=i.manifestLoadingRetryDelay,l=i.manifestLoadingMaxRetryTimeout;break;case L.LEVEL:a=0,r=i.levelLoadingTimeOut;break;default:a=i.levelLoadingMaxRetry,r=i.levelLoadingTimeOut,o=i.levelLoadingRetryDelay,l=i.levelLoadingMaxRetryTimeout}n=this.createInternalLoader(e),e.url=t,e.responseType=e.responseType||"";var u={timeout:r,maxRetry:a,retryDelay:o,maxRetryDelay:l},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return d.b.debug("Calling internal loader delegate for URL: "+t),n.load(e,u,c),!0},e.prototype.loadsuccess=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i.isSidxRequest)return this._handleSidxRequest(t,i),void this._handlePlaylistLoaded(t,e,i,n);this.resetInternalLoader(i.type);var s=t.data;e.tload=O.now(),0===s.indexOf("#EXTM3U")?s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(t,e,i,n):this._handleMasterPlaylist(t,e,i,n):this._handleManifestParsingError(t,i,"no EXTM3U delimiter",n)},e.prototype.loaderror=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(e,i)},e.prototype.loadtimeout=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(e,i,!0)},e.prototype._handleMasterPlaylist=function(t,i,n,s){var a=this.hls,r=t.data,o=e.getResponseUrl(t,n),u=w.parseMasterPlaylist(r,o);if(u.length){var c=u.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),h=w.parseMasterPlaylistMedia(r,o,"AUDIO",c),p=w.parseMasterPlaylistMedia(r,o,"SUBTITLES");if(h.length){var g=!1;h.forEach(function(t){t.url||(g=!0)}),!1===g&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(d.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main"}))}a.trigger(l.a.MANIFEST_LOADED,{levels:u,audioTracks:h,subtitles:p,url:o,stats:i,networkDetails:s})}else this._handleManifestParsingError(t,n,"no level found in manifest",s)},e.prototype._handleTrackOrLevelPlaylist=function(t,i,n,s){var a=this.hls,r=n.id,d=n.level,u=n.type,c=e.getResponseUrl(t,n),h=Object(o.a)(r)?r:0,p=Object(o.a)(d)?d:h,g=e.mapContextToLevelType(n),f=w.parseLevelPlaylist(t.data,c,p,g,h);if(f.tload=i.tload,u===L.MANIFEST){var v={url:c,details:f};a.trigger(l.a.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:c,stats:i,networkDetails:s})}if(i.tparsed=O.now(),f.needSidxRanges){var m=f.initSegment.url;this.load(m,{isSidxRequest:!0,type:u,level:d,levelDetails:f,id:r,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=f,this._handlePlaylistLoaded(t,i,n,s)},e.prototype._handleSidxRequest=function(t,e){var i=p.a.parseSegmentIndex(new Uint8Array(t.data));i.references.forEach(function(t,i){var n=t.info,s=e.levelDetails.fragments[i];0===s.byteRange.length&&(s.rawByteRange=String(1+n.end-n.start)+"@"+String(n.start))}),e.levelDetails.initSegment.rawByteRange=String(i.moovEndOffset)+"@0"},e.prototype._handleManifestParsingError=function(t,e,i,n){this.hls.trigger(l.a.ERROR,{type:r.b.NETWORK_ERROR,details:r.a.MANIFEST_PARSING_ERROR,fatal:!0,url:t.url,reason:i,networkDetails:n})},e.prototype._handleNetworkError=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];d.b.info("A network error occured while loading a "+t.type+"-type playlist");var n=void 0,s=void 0,a=this.getInternalLoader(t);switch(t.type){case L.MANIFEST:n=i?r.a.MANIFEST_LOAD_TIMEOUT:r.a.MANIFEST_LOAD_ERROR,s=!0;break;case L.LEVEL:n=i?r.a.LEVEL_LOAD_TIMEOUT:r.a.LEVEL_LOAD_ERROR,s=!1;break;case L.AUDIO_TRACK:n=i?r.a.AUDIO_TRACK_LOAD_TIMEOUT:r.a.AUDIO_TRACK_LOAD_ERROR,s=!1;break;default:s=!1}a&&(a.abort(),this.resetInternalLoader(t.type)),this.hls.trigger(l.a.ERROR,{type:r.b.NETWORK_ERROR,details:n,fatal:s,url:a.url,loader:a,context:t,networkDetails:e})},e.prototype._handlePlaylistLoaded=function(t,i,n,s){var a=n.type,r=n.level,o=n.id,d=n.levelDetails;if(d.targetduration)if(e.canHaveQualityLevels(n.type))this.hls.trigger(l.a.LEVEL_LOADED,{details:d,level:r||0,id:o||0,stats:i,networkDetails:s});else switch(a){case L.AUDIO_TRACK:this.hls.trigger(l.a.AUDIO_TRACK_LOADED,{details:d,id:o,stats:i,networkDetails:s});break;case L.SUBTITLE_TRACK:this.hls.trigger(l.a.SUBTITLE_TRACK_LOADED,{details:d,id:o,stats:i,networkDetails:s})}else this._handleManifestParsingError(t,n,"invalid target duration",s)},M(e,null,[{key:"ContextType",get:function(){return L}},{key:"LevelType",get:function(){return N}}]),e}(h);var B=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.FRAG_LOADING));return n.loaders={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){var e=this.loaders;for(var i in e){var n=e[i];n&&n.destroy()}this.loaders={},t.prototype.destroy.call(this)},e.prototype.onFragLoading=function(t){var e=t.frag,i=e.type,n=this.loaders,s=this.hls.config,a=s.fLoader,r=s.loader;e.loaded=0;var l=n[i];l&&(d.b.warn("abort previous fragment loader for type: "+i),l.abort()),l=n[i]=e.loader=s.fLoader?new a(s):new r(s);var u,c,h=void 0;h={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var p=e.byteRangeStartOffset,g=e.byteRangeEndOffset;Object(o.a)(p)&&Object(o.a)(g)&&(h.rangeStart=p,h.rangeEnd=g),u={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},l.load(h,u,c)},e.prototype.loadsuccess=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=t.data,a=i.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(l.a.FRAG_LOADED,{payload:s,frag:a,stats:e,networkDetails:n})},e.prototype.loaderror=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.frag,s=n.loader;s&&s.abort(),this.loaders[n.type]=void 0,this.hls.trigger(l.a.ERROR,{type:r.b.NETWORK_ERROR,details:r.a.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:i})},e.prototype.loadtimeout=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.frag,s=n.loader;s&&s.abort(),this.loaders[n.type]=void 0,this.hls.trigger(l.a.ERROR,{type:r.b.NETWORK_ERROR,details:r.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:i})},e.prototype.loadprogress=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=e.frag;s.loaded=t.loaded,this.hls.trigger(l.a.FRAG_LOAD_PROGRESS,{frag:s,stats:t,networkDetails:n})},e}(h);var j=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.KEY_LOADING));return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},h.prototype.destroy.call(this)},e.prototype.onKeyLoading=function(t){var e=t.frag,i=e.type,n=this.loaders[i],s=e.decryptdata,a=s.uri;if(a!==this.decrypturl||null===this.decryptkey){var r=this.hls.config;n&&(d.b.warn("abort previous key loader for type:"+i),n.abort()),e.loader=this.loaders[i]=new r.loader(r),this.decrypturl=a,this.decryptkey=null;var o,u,c;o={url:a,frag:e,responseType:"arraybuffer"},u={timeout:r.fragLoadingTimeOut,maxRetry:r.fragLoadingMaxRetry,retryDelay:r.fragLoadingRetryDelay,maxRetryDelay:r.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},e.loader.load(o,u,c)}else this.decryptkey&&(s.key=this.decryptkey,this.hls.trigger(l.a.KEY_LOADED,{frag:e}))},e.prototype.loadsuccess=function(t,e,i){var n=i.frag;this.decryptkey=n.decryptdata.key=new Uint8Array(t.data),n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(l.a.KEY_LOADED,{frag:n})},e.prototype.loaderror=function(t,e){var i=e.frag,n=i.loader;n&&n.abort(),this.loaders[e.type]=void 0,this.hls.trigger(l.a.ERROR,{type:r.b.NETWORK_ERROR,details:r.a.KEY_LOAD_ERROR,fatal:!1,frag:i,response:t})},e.prototype.loadtimeout=function(t,e){var i=e.frag,n=i.loader;n&&n.abort(),this.loaders[e.type]=void 0,this.hls.trigger(l.a.ERROR,{type:r.b.NETWORK_ERROR,details:r.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},e}(h);var x="NOT_LOADED",F="APPENDING",G="PARTIAL",V="OK",H=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.BUFFER_APPENDED,l.a.FRAG_BUFFERED,l.a.FRAG_LOADED));return n.bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=i.config,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){this.fragments=null,this.timeRanges=null,this.config=null,h.prototype.destroy.call(this),t.prototype.destroy.call(this)},e.prototype.getBufferedFrag=function(t,e){var i=this.fragments,n=Object.keys(i).filter(function(n){var s=i[n];if(s.body.type!==e)return!1;if(!s.buffered)return!1;var a=s.body;return a.startPTS<=t&&t<=a.endPTS});if(0===n.length)return null;var s=n.pop();return i[s].body},e.prototype.detectEvictedFragments=function(t,e){var i=this,n=void 0,s=void 0;Object.keys(this.fragments).forEach(function(a){var r=i.fragments[a];if(!0===r.buffered){var o=r.range[t];if(o){n=o.time;for(var l=0;l<n.length;l++)if(s=n[l],!1===i.isTimeBuffered(s.startPTS,s.endPTS,e)){i.removeFragment(r.body);break}}}})},e.prototype.detectPartialFragments=function(t){var e=this,i=this.getFragmentKey(t),n=this.fragments[i];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach(function(i){if(t.hasElementaryStream(i)){var s=e.timeRanges[i];n.range[i]=e.getBufferedTimes(t.startPTS,t.endPTS,s)}}))},e.prototype.getBufferedTimes=function(t,e,i){for(var n=[],s=void 0,a=void 0,r=!1,o=0;o<i.length;o++){if(s=i.start(o)-this.bufferPadding,a=i.end(o)+this.bufferPadding,t>=s&&e<=a){n.push({startPTS:Math.max(t,i.start(o)),endPTS:Math.min(e,i.end(o))});break}if(t<a&&e>s)n.push({startPTS:Math.max(t,i.start(o)),endPTS:Math.min(e,i.end(o))}),r=!0;else if(e<=s)break}return{time:n,partial:r}},e.prototype.getFragmentKey=function(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn},e.prototype.getPartialFragment=function(t){var e=this,i=void 0,n=void 0,s=void 0,a=null,r=0;return Object.keys(this.fragments).forEach(function(o){var l=e.fragments[o];e.isPartial(l)&&(n=l.body.startPTS-e.bufferPadding,s=l.body.endPTS+e.bufferPadding,t>=n&&t<=s&&(i=Math.min(t-n,s-t),r<=i&&(a=l.body,r=i)))}),a},e.prototype.getState=function(t){var e=this.getFragmentKey(t),i=this.fragments[e],n=x;return void 0!==i&&(n=i.buffered?!0===this.isPartial(i)?G:V:F),n},e.prototype.isPartial=function(t){return!0===t.buffered&&(void 0!==t.range.video&&!0===t.range.video.partial||void 0!==t.range.audio&&!0===t.range.audio.partial)},e.prototype.isTimeBuffered=function(t,e,i){for(var n=void 0,s=void 0,a=0;a<i.length;a++){if(n=i.start(a)-this.bufferPadding,s=i.end(a)+this.bufferPadding,t>=n&&e<=s)return!0;if(e<=n)return!1}return!1},e.prototype.onFragLoaded=function(t){var e=t.frag;Object(o.a)(e.sn)&&!e.bitrateTest&&(this.fragments[this.getFragmentKey(e)]={body:e,range:Object.create(null),buffered:!1})},e.prototype.onBufferAppended=function(t){var e=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach(function(t){var i=e.timeRanges[t];e.detectEvictedFragments(t,i)})},e.prototype.onFragBuffered=function(t){this.detectPartialFragments(t.frag)},e.prototype.hasFragment=function(t){var e=this.getFragmentKey(t);return void 0!==this.fragments[e]},e.prototype.removeFragment=function(t){var e=this.getFragmentKey(t);delete this.fragments[e]},e.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},e}(h),$={search:function(t,e){for(var i=0,n=t.length-1,s=null,a=null;i<=n;){var r=e(a=t[s=(i+n)/2|0]);if(r>0)i=s+1;else{if(!(r<0))return a;n=s-1}}return null}};var q=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.isBuffered=function(t,e){try{if(t)for(var i=t.buffered,n=0;n<i.length;n++)if(e>=i.start(n)&&e<=i.end(n))return!0}catch(t){}return!1},t.bufferInfo=function(t,e,i){try{if(t){var n=t.buffered,s=[],a=void 0;for(a=0;a<n.length;a++)s.push({start:n.start(a),end:n.end(a)});return this.bufferedInfo(s,e,i)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},t.bufferedInfo=function(t,e,i){var n=[],s=void 0,a=void 0,r=void 0,o=void 0,l=void 0;for(t.sort(function(t,e){var i=t.start-e.start;return i||e.end-t.end}),l=0;l<t.length;l++){var d=n.length;if(d){var u=n[d-1].end;t[l].start-u<i?t[l].end>u&&(n[d-1].end=t[l].end):n.push(t[l])}else n.push(t[l])}for(l=0,s=0,a=r=e;l<n.length;l++){var c=n[l].start,h=n[l].end;if(e+i>=c&&e<h)a=c,s=(r=h)-e;else if(e+i<c){o=c;break}}return{len:s,start:a,end:r,nextStart:o}},t}(),W=i(7),K=i.n(W),z=i(12),Y=i.n(z),X=i(10);function Q(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}var J=i(4);var Z=Object(J.a)(),tt=Q(),et=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.hls=e,this.id=i;var n=this.observer=new K.a,s=e.config;n.trigger=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];n.emit.apply(n,[t,t].concat(i))},n.off=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];n.removeListener.apply(n,[t].concat(i))};var a=function(t,i){(i=i||{}).frag=this.frag,i.id=this.id,e.trigger(t,i)}.bind(this);n.on(l.a.FRAG_DECRYPTED,a),n.on(l.a.FRAG_PARSING_INIT_SEGMENT,a),n.on(l.a.FRAG_PARSING_DATA,a),n.on(l.a.FRAG_PARSED,a),n.on(l.a.ERROR,a),n.on(l.a.FRAG_PARSING_METADATA,a),n.on(l.a.FRAG_PARSING_USERDATA,a),n.on(l.a.INIT_PTS_FOUND,a);var o={mp4:tt.isTypeSupported("video/mp4"),mpeg:tt.isTypeSupported("audio/mpeg"),mp3:tt.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(s.enableWorker&&"undefined"!=typeof Worker){d.b.log("demuxing in webworker");var c=void 0;try{c=this.w=Y()(13),this.onwmsg=this.onWorkerMessage.bind(this),c.addEventListener("message",this.onwmsg),c.onerror=function(t){e.trigger(l.a.ERROR,{type:r.b.OTHER_ERROR,details:r.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},c.postMessage({cmd:"init",typeSupported:o,vendor:u,id:i,config:JSON.stringify(s)})}catch(t){d.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),c&&Z.URL.revokeObjectURL(c.objectURL),this.demuxer=new X.a(n,o,s,u),this.w=void 0}}else this.demuxer=new X.a(n,o,s,u)}return t.prototype.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},t.prototype.push=function(t,e,i,n,s,a,r,l){var u=this.w,c=Object(o.a)(s.startDTS)?s.startDTS:s.start,h=s.decryptdata,p=this.frag,g=!(p&&s.cc===p.cc),f=!(p&&s.level===p.level),v=p&&s.sn===p.sn+1,m=!f&&v;if(g&&d.b.log(this.id+":discontinuity detected"),f&&d.b.log(this.id+":switch detected"),this.frag=s,u)u.postMessage({cmd:"demux",data:t,decryptdata:h,initSegment:e,audioCodec:i,videoCodec:n,timeOffset:c,discontinuity:g,trackSwitch:f,contiguous:m,duration:a,accurateTimeOffset:r,defaultInitPTS:l},t instanceof ArrayBuffer?[t]:[]);else{var _=this.demuxer;_&&_.push(t,h,e,i,n,c,g,f,m,a,r,l)}},t.prototype.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":Z.URL.revokeObjectURL(this.w.objectURL);break;case l.a.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data)}},t}();function it(t,e,i){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(i);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(i)}}function nt(t,e,i){var n=t[e],s=t[i],a=s.startPTS;Object(o.a)(a)?i>e?(n.duration=a-n.start,n.duration<0&&d.b.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(s.duration=n.start-a,s.duration<0&&d.b.warn("negative duration computed for frag "+s.sn+",level "+s.level+", there should be some duration drift between playlist and fragment!")):s.start=i>e?n.start+n.duration:Math.max(n.start-s.duration,0)}function st(t,e,i,n,s,a){var r=i;if(Object(o.a)(e.startPTS)){var l=Math.abs(e.startPTS-i);Object(o.a)(e.deltaPTS)?e.deltaPTS=Math.max(l,e.deltaPTS):e.deltaPTS=l,r=Math.max(i,e.startPTS),i=Math.min(i,e.startPTS),n=Math.max(n,e.endPTS),s=Math.min(s,e.startDTS),a=Math.max(a,e.endDTS)}var d=i-e.start;e.start=e.startPTS=i,e.maxStartPTS=r,e.endPTS=n,e.startDTS=s,e.endDTS=a,e.duration=n-i;var u=e.sn;if(!t||u<t.startSN||u>t.endSN)return 0;var c,h=void 0,p=void 0;for(c=u-t.startSN,(h=t.fragments)[c]=e,p=c;p>0;p--)nt(h,p,p-1);for(p=c;p<h.length-1;p++)nt(h,p,p+1);return t.PTSKnown=!0,d}function at(t,e){var i=Math.max(t.startSN,e.startSN)-e.startSN,n=Math.min(t.endSN,e.endSN)-e.startSN,s=e.startSN-t.startSN,a=t.fragments,r=e.fragments,l=0,u=void 0;if(e.initSegment&&t.initSegment&&(e.initSegment=t.initSegment),n<i)e.PTSKnown=!1;else{for(var c=i;c<=n;c++){var h=a[s+c],p=r[c];p&&h&&(l=h.cc-p.cc,Object(o.a)(h.startPTS)&&(p.start=p.startPTS=h.startPTS,p.endPTS=h.endPTS,p.duration=h.duration,p.backtracked=h.backtracked,p.dropped=h.dropped,u=p))}if(l)for(d.b.log("discontinuity sliding from playlist, take drift into account"),c=0;c<r.length;c++)r[c].cc+=l;if(u)st(e,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS);else if(s>=0&&s<a.length){var g=a[s].start;for(c=0;c<r.length;c++)r[c].start+=g}e.PTSKnown=t.PTSKnown}}var rt={toString:function(t){for(var e="",i=t.length,n=0;n<i;n++)e+="["+t.start(n).toFixed(3)+","+t.end(n).toFixed(3)+"]";return e}};function ot(t,e){e.fragments.forEach(function(e){if(e){var i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}),e.PTSKnown=!0}function lt(t,e,i){!function(t,e,i){if(function(t,e,i){var n=!1;return e&&e.details&&i&&(i.endCC>i.startCC||t&&t.cc<i.startCC)&&(n=!0),n}(t,i,e)){var n=function(t,e){var i=t.fragments,n=e.fragments;if(n.length&&i.length){var s=function(t,e){for(var i=null,n=0;n<t.length;n+=1){var s=t[n];if(s&&s.cc===e){i=s;break}}return i}(i,n[0].cc);if(s&&(!s||s.startPTS))return s;d.b.log("No frag in previous level to align on")}else d.b.log("No fragments to align")}(i.details,e);n&&(d.b.log("Adjusting PTS using last level due to CC increase within current level"),ot(n.start,e))}}(t,i,e),!i.PTSKnown&&e&&function(t,e){if(e&&e.fragments.length){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;var i=e.fragments[0].programDateTime,n=t.fragments[0].programDateTime,s=(n-i)/1e3+e.fragments[0].start;Object(o.a)(s)&&(d.b.log("adjusting PTS using programDateTime delta, sliding:"+s.toFixed(3)),ot(s,t))}}(i,e.details)}var dt=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n=arguments.length,s=Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call.apply(t,[this,i].concat(s)));return r._tickInterval=null,r._tickTimer=null,r._tickCallCount=0,r._boundTick=r.tick.bind(r),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.prototype.hasInterval=function(){return!!this._tickInterval},e.prototype.hasNextTick=function(){return!!this._tickTimer},e.prototype.setInterval=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,t),!0)}),e.prototype.clearInterval=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)}),e.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},e.prototype.doTick=function(){},e}(h);function ut(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments[2],n=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-n<=t?1:i.start-n>t&&i.start?-1:0}function ct(t,e,i){var n=1e3*Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.endProgramDateTime-n>t}var ht=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.media=i,this.fragmentTracker=n,this.hls=s,this.stallReported=!1}return t.prototype.poll=function(t,e){var i=this.config,n=this.media,s=n.currentTime,a=window.performance.now();if(s!==t)return this.stallReported&&(d.b.warn("playback not stuck anymore @"+s+", after "+Math.round(a-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(n.ended||!n.buffered.length||n.readyState>2||n.seeking&&q.isBuffered(n,s))){var r=a-this.stalled,o=q.bufferInfo(n,s,i.maxBufferHole);this.stalled?(r>=1e3&&this._reportStall(o.len),this._tryFixBufferStall(o,r)):this.stalled=a}},t.prototype._tryFixBufferStall=function(t,e){var i=this.config,n=this.fragmentTracker,s=this.media.currentTime,a=n.getPartialFragment(s);a&&this._trySkipBufferHole(a),t.len>.5&&e>1e3*i.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},t.prototype._reportStall=function(t){var e=this.hls,i=this.media;this.stallReported||(this.stallReported=!0,d.b.warn("Playback stalling at @"+i.currentTime+" due to low buffer"),e.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},t.prototype._trySkipBufferHole=function(t){for(var e=this.hls,i=this.media,n=i.currentTime,s=0,a=0;a<i.buffered.length;a++){var o=i.buffered.start(a);if(n>=s&&n<o)return i.currentTime=Math.max(o,i.currentTime+.1),d.b.warn("skipping hole, adjusting currentTime from "+n+" to "+i.currentTime),this.stalled=null,void e.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+i.currentTime,frag:t});s=i.buffered.end(a)}},t.prototype._tryNudgeBuffer=function(){var t=this.config,e=this.hls,i=this.media,n=i.currentTime,s=(this.nudgeRetry||0)+1;if(this.nudgeRetry=s,s<t.nudgeMaxRetry){var a=n+s*t.nudgeOffset;d.b.log("adjust currentTime from "+n+" to "+a),i.currentTime=a,e.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else d.b.error("still stuck in high buffer @"+n+" after "+t.nudgeMaxRetry+", raise fatal error"),e.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.BUFFER_STALLED_ERROR,fatal:!0})},t}(),pt=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var gt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},ft=function(t){function e(i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHED,l.a.MEDIA_DETACHING,l.a.MANIFEST_LOADING,l.a.MANIFEST_PARSED,l.a.LEVEL_LOADED,l.a.KEY_LOADED,l.a.FRAG_LOADED,l.a.FRAG_LOAD_EMERGENCY_ABORTED,l.a.FRAG_PARSING_INIT_SEGMENT,l.a.FRAG_PARSING_DATA,l.a.FRAG_PARSED,l.a.ERROR,l.a.AUDIO_TRACK_SWITCHING,l.a.AUDIO_TRACK_SWITCHED,l.a.BUFFER_CREATED,l.a.BUFFER_APPENDED,l.a.BUFFER_FLUSHED));return s.fragmentTracker=n,s.config=i.config,s.audioCodecSwap=!1,s._state=gt.STOPPED,s.stallReported=!1,s.gapController=null,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function(){this.state=gt.STOPPED,this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},e.prototype.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=i.startLevel;-1===n&&(n=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=n,this.loadedmetadata=!1}e>0&&-1===t&&(d.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=gt.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=gt.STOPPED},e.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=gt.STOPPED,this.forceStartLoad=!1},e.prototype.doTick=function(){switch(this.state){case gt.BUFFER_FLUSHING:this.fragLoadError=0;break;case gt.IDLE:this._doTickIdle();break;case gt.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=gt.IDLE);break;case gt.FRAG_LOADING_WAITING_RETRY:var e=window.performance.now(),i=this.retryDate;(!i||e>=i||this.media&&this.media.seeking)&&(d.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=gt.IDLE);break;case gt.ERROR:case gt.STOPPED:case gt.FRAG_LOADING:case gt.PARSING:case gt.PARSED:case gt.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},e.prototype._doTickIdle=function(){var t=this.hls,e=t.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&e.startFragPrefetch)){var n=void 0;n=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var s=t.nextLoadLevel,a=this.levels[s];if(a){var r=a.bitrate,o=void 0;o=r?Math.max(8*e.maxBufferSize/r,e.maxBufferLength):e.maxBufferLength,o=Math.min(o,e.maxMaxBufferLength);var u=q.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,n,e.maxBufferHole),c=u.len;if(!(c>=o)){d.b.trace("buffer length of "+c.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=s;var h=a.details;if(!h||h.live&&this.levelLastLoaded!==s)this.state=gt.WAITING_LEVEL;else{var p=this.fragPrevious;if(!h.live&&p&&!p.backtracked&&p.sn===h.endSN&&!u.nextStart)if(Math.min(i.duration,p.start+p.duration)-Math.max(u.end,p.start)<=Math.max(.2,p.duration)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(l.a.BUFFER_EOS,g),void(this.state=gt.ENDED)}this._fetchPayloadOrEos(n,u,h)}}}}},e.prototype._fetchPayloadOrEos=function(t,e,i){var n=this.fragPrevious,s=this.level,a=i.fragments,r=a.length;if(0!==r){var o=a[0].start,l=a[r-1].start+a[r-1].duration,u=e.end,c=void 0;if(i.initSegment&&!i.initSegment.data)c=i.initSegment;else if(i.live){var h=this.config.initialLiveManifestSize;if(r<h)return void d.b.warn("Can not start playback of a level, reason: not enough fragments "+r+" < "+h);if(null===(c=this._ensureFragmentAtLivePoint(i,u,o,l,n,a,r)))return}else u<o&&(c=a[0]);c||(c=this._findFragment(o,n,r,a,u,l,i)),c&&(c.encrypted?(d.b.log("Loading key for "+c.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+s),this._loadKey(c)):(d.b.log("Loading "+c.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+s+", currentTime:"+t.toFixed(3)+",bufferEnd:"+u.toFixed(3)),this._loadFragment(c)))}},e.prototype._ensureFragmentAtLivePoint=function(t,e,i,n,s,a,r){var l=this.hls.config,u=this.media,c=void 0,h=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*t.targetduration;if(e<Math.max(i-l.maxFragLookUpTolerance,n-h)){var p=this.liveSyncPosition=this.computeLivePosition(i,t);d.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+p.toFixed(3)),e=p,u&&u.readyState&&u.duration>p&&(u.currentTime=p),this.nextLoadPosition=p}if(t.PTSKnown&&e>n&&u&&u.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(s)if(t.hasProgramDateTime)d.b.log("live playlist, switching playlist, load frag with same PDT: "+s.programDateTime),c=function(t,e,i){if(!Array.isArray(t)||!t.length||!Object(o.a)(e))return null;if(e<t[0].programDateTime)return null;if(e>=t[t.length-1].endProgramDateTime)return null;i=i||0;for(var n=0;n<t.length;++n){var s=t[n];if(ct(e,i,s))return s}return null}(a,s.endProgramDateTime,l.maxFragLookUpTolerance);else{var g=s.sn+1;if(g>=t.startSN&&g<=t.endSN){var f=a[g-t.startSN];s.cc===f.cc&&(c=f,d.b.log("live playlist, switching playlist, load frag with next SN: "+c.sn))}c||(c=$.search(a,function(t){return s.cc-t.cc}))&&d.b.log("live playlist, switching playlist, load frag with same CC: "+c.sn)}c||(c=a[Math.min(r-1,Math.round(r/2))],d.b.log("live playlist, switching playlist, unknown, load middle frag : "+c.sn))}return c},e.prototype._findFragment=function(t,e,i,n,s,a,r){var o=this.hls.config,l=void 0;s<a?l=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=t?e[t.sn-e[0].sn+1]:null;return s&&!ut(i,n,s)?s:$.search(e,ut.bind(null,i,n))}(e,n,s,s>a-o.maxFragLookUpTolerance?0:o.maxFragLookUpTolerance):l=n[i-1];if(l){var u=l.sn-r.startSN,c=e&&l.level===e.level,h=n[u-1],p=n[u+1];if(e&&l.sn===e.sn)if(c&&!l.backtracked)if(l.sn<r.endSN){var g=e.deltaPTS;g&&g>o.maxBufferHole&&e.dropped&&u?(l=h,d.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(l=p,d.b.log("SN just loaded, load next one: "+l.sn,l))}else l=null;else l.backtracked&&(p&&p.backtracked?(d.b.warn("Already backtracked from fragment "+p.sn+", will not backtrack to fragment "+l.sn+". Loading fragment "+p.sn),l=p):(d.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),l.dropped=0,h?(l=h).backtracked=!0:u&&(l=null)))}return l},e.prototype._loadKey=function(t){this.state=gt.KEY_LOADING,this.hls.trigger(l.a.KEY_LOADING,{frag:t})},e.prototype._loadFragment=function(t){var e=this.fragmentTracker.getState(t);this.fragCurrent=t,this.startFragRequested=!0,Object(o.a)(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||e===x||e===G?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.hls.trigger(l.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new et(this.hls,"main")),this.state=gt.FRAG_LOADING):e===F&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},e.prototype.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,U.LevelType.MAIN)},e.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},e.prototype._checkFragmentChanged=function(){var t=void 0,e=void 0,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((e=i.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=e),q.isBuffered(i,e)?t=this.getBufferedFrag(e):q.isBuffered(i,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var n=t;if(n!==this.fragPlaying){this.hls.trigger(l.a.FRAG_CHANGED,{frag:n});var s=n.level;this.fragPlaying&&this.fragPlaying.level===s||this.hls.trigger(l.a.LEVEL_SWITCHED,{level:s}),this.fragPlaying=n}}},e.prototype.immediateLevelSwitch=function(){if(d.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,e=void 0;t?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,q.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},e.prototype.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e,i=void 0,n=void 0;if((e=this.getBufferedFrag(t.currentTime))&&e.startPTS>1&&this.flushMainBuffer(0,e.startPTS-1),t.paused)i=0;else{var s=this.hls.nextLoadLevel,a=this.levels[s],r=this.fragLastKbps;i=r&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*r)+1:0}if((n=this.getBufferedFrag(t.currentTime+i))&&(n=this.followingBufferedFrag(n))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,Number.POSITIVE_INFINITY)}}},e.prototype.flushMainBuffer=function(t,e){this.state=gt.BUFFER_FLUSHING;var i={startOffset:t,endOffset:e};this.altAudio&&(i.type="video"),this.hls.trigger(l.a.BUFFER_FLUSHING,i)},e.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition),this.gapController=new ht(i,e,this.fragmentTracker,this.hls)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(d.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function(){var t=this.media,e=t?t.currentTime:void 0,i=this.config;Object(o.a)(e)&&d.b.log("media seeking to "+e.toFixed(3));var n=this.mediaBuffer?this.mediaBuffer:t,s=q.bufferInfo(n,e,this.config.maxBufferHole);if(this.state===gt.FRAG_LOADING){var a=this.fragCurrent;if(0===s.len&&a){var r=i.maxFragLookUpTolerance,l=a.start-r,u=a.start+a.duration+r;e<l||e>u?(a.loader&&(d.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=gt.IDLE):d.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===gt.ENDED&&(0===s.len&&(this.fragPrevious=0),this.state=gt.IDLE);t&&(this.lastCurrentTime=e),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},e.prototype.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;Object(o.a)(e)&&d.b.log("media seeked to "+e.toFixed(3)),this.tick()},e.prototype.onMediaEnded=function(){d.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestLoading=function(){d.b.log("trigger BUFFER_RESET"),this.hls.trigger(l.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestParsed=function(t){var e=!1,i=!1,n=void 0;t.levels.forEach(function(t){(n=t.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(e=!0),-1!==n.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=e&&i,this.audioCodecSwitch&&d.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;var s=this.config;(s.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(s.startPosition)},e.prototype.onLevelLoaded=function(t){var e=t.details,i=t.level,n=this.levels[this.levelLastLoaded],s=this.levels[i],a=e.totalduration,r=0;if(d.b.log("level "+i+" loaded ["+e.startSN+","+e.endSN+"],duration:"+a),e.live){var u=s.details;u&&e.fragments.length>0?(at(u,e),r=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(r,u),e.PTSKnown&&Object(o.a)(r)?d.b.log("live playlist sliding:"+r.toFixed(3)):(d.b.log("live playlist - outdated PTS, unknown sliding"),lt(this.fragPrevious,n,e))):(d.b.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,lt(this.fragPrevious,n,e))}else e.PTSKnown=!1;if(s.details=e,this.levelLastLoaded=i,this.hls.trigger(l.a.LEVEL_UPDATED,{details:e,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var c=e.startTimeOffset;Object(o.a)(c)?(c<0&&(d.b.log("negative start time offset "+c+", count from end of last fragment"),c=r+a+c),d.b.log("start time offset found in playlist, adjust startPosition to "+c),this.startPosition=c):e.live?(this.startPosition=this.computeLivePosition(r,e),d.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===gt.WAITING_LEVEL&&(this.state=gt.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===gt.KEY_LOADING&&(this.state=gt.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=this.hls,n=this.levels,s=this.media,a=t.frag;if(this.state===gt.FRAG_LOADING&&e&&"main"===a.type&&a.level===e.level&&a.sn===e.sn){var r=t.stats,o=n[e.level],u=o.details;if(this.bitrateTest=!1,this.stats=r,d.b.log("Loaded "+e.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+e.level),a.bitrateTest&&i.nextLoadLevel)this.state=gt.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=window.performance.now(),i.trigger(l.a.FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=gt.IDLE,r.tparsed=r.tbuffered=window.performance.now(),u.initSegment.data=t.payload,i.trigger(l.a.FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.tick();else{d.b.log("Parsing "+e.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+e.level+", cc "+e.cc),this.state=gt.PARSING,this.pendingBuffering=!0,this.appended=!1,a.bitrateTest&&(a.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:a}));var c=!(s&&s.seeking)&&(u.PTSKnown||!u.live),h=u.initSegment?u.initSegment.data:[],p=this._getAudioCodec(o);(this.demuxer=this.demuxer||new et(this.hls,"main")).push(t.payload,h,p,o.videoCodec,e,u.totalduration,c)}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===gt.PARSING){var n=t.tracks,s=void 0,a=void 0;if(n.audio&&this.altAudio&&delete n.audio,a=n.audio){var r=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();r&&this.audioCodecSwap&&(d.b.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===o.indexOf("firefox")&&(r="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==a.container&&(r="mp4a.40.2",d.b.log("Android: force audio codec to "+r)),a.levelCodec=r,a.id=t.id}for(s in(a=n.video)&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=t.id),this.hls.trigger(l.a.BUFFER_CODECS,n),n){a=n[s],d.b.log("main track:"+s+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var u=a.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.a.BUFFER_APPENDING,{type:s,data:u,parent:"main",content:"initSegment"}))}this.tick()}},e.prototype.onFragParsingData=function(t){var e=this,i=this.fragCurrent,n=t.frag;if(i&&"main"===t.id&&n.sn===i.sn&&n.level===i.level&&("audio"!==t.type||!this.altAudio)&&this.state===gt.PARSING){var s=this.levels[this.level],a=i;if(Object(o.a)(t.endPTS)||(t.endPTS=t.startPTS+i.duration,t.endDTS=t.startDTS+i.duration),!0===t.hasAudio&&a.addElementaryStream(m.ElementaryStreamTypes.AUDIO),!0===t.hasVideo&&a.addElementaryStream(m.ElementaryStreamTypes.VIDEO),d.b.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(a.dropped=t.dropped,a.dropped)if(a.backtracked)d.b.warn("Already backtracked on this fragment, appending with the gap",a.sn);else{var r=s.details;if(!r||a.sn!==r.startSN)return d.b.warn("missing video frame(s), backtracking fragment",a.sn),this.fragmentTracker.removeFragment(a),a.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=gt.IDLE,this.fragPrevious=a,void this.tick();d.b.warn("missing video frame(s) on first frag, appending with gap",a.sn)}else a.backtracked=!1;var u=st(s.details,a,t.startPTS,t.endPTS,t.startDTS,t.endDTS),c=this.hls;c.trigger(l.a.LEVEL_PTS_UPDATED,{details:s.details,level:this.level,drift:u,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(i){i&&i.length&&e.state===gt.PARSING&&(e.appended=!0,e.pendingBuffering=!0,c.trigger(l.a.BUFFER_APPENDING,{type:t.type,data:i,parent:"main",content:"data"}))}),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===gt.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=gt.PARSED,this._checkAppendedParsed())},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url,i=t.id;if(!e){if(this.mediaBuffer!==this.media){d.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(d.b.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=gt.IDLE}var s=this.hls;s.trigger(l.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),s.trigger(l.a.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}},e.prototype.onAudioTrackSwitched=function(t){var e=t.id,i=!!this.hls.audioTracks[e].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(d.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},e.prototype.onBufferCreated=function(t){var e=t.tracks,i=void 0,n=void 0,s=!1;for(var a in e){var r=e[a];"main"===r.id?(n=a,i=r,"video"===a&&(this.videoBuffer=e[a].buffer)):s=!0}s&&i?(d.b.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},e.prototype.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==gt.PARSING&&e!==gt.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function(){if(!(this.state!==gt.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;d.b.log("main buffered : "+rt.toString(e.buffered)),this.fragPrevious=t;var i=this.stats;i.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(l.a.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.state=gt.IDLE}this.tick()}},e.prototype.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var i=!!this.media&&q.isBuffered(this.media,this.media.currentTime)&&q.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case r.a.FRAG_LOAD_ERROR:case r.a.FRAG_LOAD_TIMEOUT:case r.a.KEY_LOAD_ERROR:case r.a.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);d.b.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=window.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=gt.FRAG_LOADING_WAITING_RETRY}else d.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=gt.ERROR;break;case r.a.LEVEL_LOAD_ERROR:case r.a.LEVEL_LOAD_TIMEOUT:this.state!==gt.ERROR&&(t.fatal?(this.state=gt.ERROR,d.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==gt.WAITING_LEVEL||(this.state=gt.IDLE));break;case r.a.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==gt.PARSING&&this.state!==gt.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=gt.IDLE):(d.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},e.prototype._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,d.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},e.prototype._checkBuffer=function(){var t=this.media;if(t&&0!==t.readyState){var e=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e)}},e.prototype.onFragLoadEmergencyAborted=function(){this.state=gt.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},e.prototype.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;t&&this.fragmentTracker.detectEvictedFragments(m.ElementaryStreamTypes.VIDEO,t.buffered),this.state=gt.IDLE,this.fragPrevious=null},e.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.prototype.computeLivePosition=function(t,e){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-i)},e.prototype._seekToStartPos=function(){var t=this.media,e=t.currentTime,i=t.seeking?e:this.startPosition;e!==i&&(d.b.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+e+" "),t.currentTime=i)},e.prototype._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(d.b.log("swapping playlist audio codec"),e&&(e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},pt(e,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,d.b.log("main stream:"+e+"->"+t),this.hls.trigger(l.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}]),e}(dt),vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var _t=window.performance,Et=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MANIFEST_LOADED,l.a.LEVEL_LOADED,l.a.AUDIO_TRACK_SWITCHED,l.a.FRAG_LOADED,l.a.ERROR));return n.canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},e.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},e.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},e.prototype.stopLoad=function(){this.canload=!1},e.prototype.onManifestLoaded=function(t){var e=[],i=void 0,n={},s=null,a=!1,o=!1,u=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c=[];if(t.levels.forEach(function(t){t.loadError=0,t.fragmentError=!1,a=a||!!t.videoCodec,o=o||!!t.audioCodec||!(!t.attrs||!t.attrs.AUDIO),u&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),(s=n[t.bitrate])?s.url.push(t.url):(t.url=[t.url],t.urlId=0,n[t.bitrate]=t,e.push(t)),t.attrs&&t.attrs.AUDIO&&it(s||t,"audio",t.attrs.AUDIO),t.attrs&&t.attrs.SUBTITLES&&it(s||t,"text",t.attrs.SUBTITLES)}),a&&o&&(e=e.filter(function(t){return!!t.videoCodec})),e=e.filter(function(t){var e=t.audioCodec,i=t.videoCodec;return(!e||T(e))&&(!i||T(i))}),t.audioTracks&&(c=t.audioTracks.filter(function(t){return!t.audioCodec||T(t.audioCodec,"audio")})).forEach(function(t,e){t.id=e}),e.length>0){i=e[0].bitrate,e.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=e;for(var h=0;h<e.length;h++)if(e[h].bitrate===i){this._firstLevel=h,d.b.log("manifest loaded,"+e.length+" level(s) found, first bitrate:"+i);break}this.hls.trigger(l.a.MANIFEST_PARSED,{levels:e,audioTracks:c,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:a,altAudio:c.length>0&&a})}else this.hls.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},e.prototype.setLevelInternal=function(t){var e=this._levels,i=this.hls;if(t>=0&&t<e.length){if(this.clearTimer(),this.currentLevelIndex!==t){d.b.log("switching to level "+t),this.currentLevelIndex=t;var n=e[t];n.level=t,i.trigger(l.a.LEVEL_SWITCHING,n)}var s=e[t],a=s.details;if(!a||a.live){var o=s.urlId;i.trigger(l.a.LEVEL_LOADING,{url:s.url[o],level:t,id:o})}}else i.trigger(l.a.ERROR,{type:r.b.OTHER_ERROR,details:r.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},e.prototype.onError=function(t){if(t.fatal)t.type===r.b.NETWORK_ERROR&&this.clearTimer();else{var e=!1,i=!1,n=void 0;switch(t.details){case r.a.FRAG_LOAD_ERROR:case r.a.FRAG_LOAD_TIMEOUT:case r.a.KEY_LOAD_ERROR:case r.a.KEY_LOAD_TIMEOUT:n=t.frag.level,i=!0;break;case r.a.LEVEL_LOAD_ERROR:case r.a.LEVEL_LOAD_TIMEOUT:n=t.context.level,e=!0;break;case r.a.REMUX_ALLOC_ERROR:n=t.level,e=!0}void 0!==n&&this.recoverLevel(t,n,e,i)}},e.prototype.recoverLevel=function(t,e,i,n){var s=this,a=this.hls.config,r=t.details,o=this._levels[e],l=void 0,u=void 0,c=void 0;if(o.loadError++,o.fragmentError=n,i){if(!(this.levelRetryCount+1<=a.levelLoadingMaxRetry))return d.b.error("level controller, cannot recover from "+r+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);u=Math.min(Math.pow(2,this.levelRetryCount)*a.levelLoadingRetryDelay,a.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return s.loadLevel()},u),t.levelRetry=!0,this.levelRetryCount++,d.b.warn("level controller, "+r+", retry in "+u+" ms, current retry count is "+this.levelRetryCount)}(i||n)&&((l=o.url.length)>1&&o.loadError<l?(o.urlId=(o.urlId+1)%l,o.details=void 0,d.b.warn("level controller, "+r+" for level "+e+": switching to redundant URL-id "+o.urlId)):-1===this.manualLevelIndex?(c=0===e?this._levels.length-1:e-1,d.b.warn("level controller, "+r+": switch to "+c),this.hls.nextAutoLevel=this.currentLevelIndex=c):n&&(d.b.warn("level controller, "+r+": reload a fragment"),this.currentLevelIndex=null))},e.prototype.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var i=this._levels[e.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},e.prototype.onLevelLoaded=function(t){var e=this,i=t.level;if(i===this.currentLevelIndex){var n=this._levels[i];n.fragmentError||(n.loadError=0,this.levelRetryCount=0);var s=t.details;if(s.live){var a=1e3*(s.averagetargetduration?s.averagetargetduration:s.targetduration),r=a,o=n.details;o&&s.endSN===o.endSN&&(r/=2,d.b.log("same live playlist, reload twice faster")),r-=_t.now()-t.stats.trequest,r=Math.max(a/2,Math.round(r)),d.b.log("live playlist, reload in "+Math.round(r)+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},r)}else this.clearTimer()}},e.prototype.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){var n=i.audioGroupIds.findIndex(function(t){return t===e});n!==i.urlId&&(i.urlId=n,this.startLoad())}},e.prototype.loadLevel=function(){if(d.b.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var t=this._levels[this.currentLevelIndex];if("object"===(void 0===t?"undefined":vt(t))&&t.url.length>0){var e=this.currentLevelIndex,i=t.urlId,n=t.url[i];d.b.log("Attempt loading level index "+e+" with URL-id "+i),this.hls.trigger(l.a.LEVEL_LOADING,{url:n,level:e,id:i})}}},mt(e,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),e}(h),At=i(6);function yt(t,e){var i=null;try{i=new window.Event("addtrack")}catch(t){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)}function bt(t){if(t&&t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}var St=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHED,l.a.MEDIA_DETACHING,l.a.FRAG_PARSING_METADATA));return n.id3Track=void 0,n.media=void 0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){h.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){this.media=t.media,this.media},e.prototype.onMediaDetaching=function(){bt(this.id3Track),this.id3Track=void 0,this.media=void 0},e.prototype.getID3Track=function(t){for(var e=0;e<t.length;e++){var i=t[e];if("metadata"===i.kind&&"id3"===i.label)return yt(i,this.media),i}return this.media.addTextTrack("metadata","id3")},e.prototype.onFragParsingMetadata=function(t){var e=t.frag,i=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,s=0;s<i.length;s++){var a=At.a.getID3Frames(i[s].data);if(a){var r=i[s].pts,o=s<i.length-1?i[s+1].pts:e.endPTS;r===o&&(o+=1e-4);for(var l=0;l<a.length;l++){var d=a[l];if(!At.a.isTimeStampFrame(d)){var u=new n(r,o,"");u.value=d,this.id3Track.addCue(u)}}}}},e}(h);var Tt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return t.prototype.sample=function(t,e){var i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t},t.prototype.getTotalWeight=function(){return this.totalWeight_},t.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},t}();var Ct=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.hls=e,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Tt(i),this.fast_=new Tt(n)}return t.prototype.sample=function(t,e){var i=8e3*e/(t=Math.max(t,this.minDelayMs_)),n=t/1e3;this.fast_.sample(n,i),this.slow_.sample(n,i)},t.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},t.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.prototype.destroy=function(){},t}(),It=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var Dt=window.performance,Rt=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.FRAG_LOADING,l.a.FRAG_LOADED,l.a.FRAG_BUFFERED,l.a.ERROR));return n.lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=i,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){this.clearTimer(),h.prototype.destroy.call(this)},e.prototype.onFragLoading=function(t){var e=t.frag;if("main"===e.type&&(this.timer||(this.fragCurrent=e,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var i=this.hls,n=i.config,s=e.level,a=void 0,r=void 0;i.levels[s].details.live?(a=n.abrEwmaFastLive,r=n.abrEwmaSlowLive):(a=n.abrEwmaFastVoD,r=n.abrEwmaSlowVoD),this._bwEstimator=new Ct(i,r,a,n.abrEwmaDefaultEstimate)}},e.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,i=this.fragCurrent;if(i){var n=i.loader,s=t.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return d.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var a=n.stats;if(e&&a&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&i.autoLevel&&i.level){var r=Dt.now()-a.trequest,o=Math.abs(e.playbackRate);if(r>500*i.duration/o){var u=t.levels,c=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/r),h=u[i.level],p=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,g=a.total?a.total:Math.max(a.loaded,Math.round(i.duration*p/8)),f=e.currentTime,v=(g-a.loaded)/c,m=(q.bufferInfo(e,f,t.config.maxBufferHole).end-f)/o;if(m<2*i.duration/o&&v>m){var _=void 0,E=void 0;for(E=i.level-1;E>s;E--){var A=u[E].realBitrate?Math.max(u[E].realBitrate,u[E].bitrate):u[E].bitrate;if((_=i.duration*A/(6.4*c))<m)break}_<v&&(d.b.warn("loading too slow, abort fragment loading and switch to level "+E+":fragLoadedDelay["+E+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+_.toFixed(1)+"<"+v.toFixed(1)+":"+m.toFixed(1)),t.nextLoadLevel=E,this._bwEstimator.sample(r,a.loaded),n.abort(),this.clearTimer(),t.trigger(l.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:a}))}}}}},e.prototype.onFragLoaded=function(t){var e=t.frag;if("main"===e.type&&Object(o.a)(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[e.level],n=(i.loaded?i.loaded.bytes:0)+t.stats.loaded,s=(i.loaded?i.loaded.duration:0)+t.frag.duration;i.loaded={bytes:n,duration:s},i.realBitrate=Math.round(8*n/s)}if(t.frag.bitrateTest){var a=t.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(t)}}},e.prototype.onFragBuffered=function(t){var e=t.stats,i=t.frag;if(!0!==e.aborted&&"main"===i.type&&Object(o.a)(i.sn)&&(!i.bitrateTest||e.tload===e.tbuffered)){var n=e.tparsed-e.trequest;d.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(n,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},e.prototype.onError=function(t){switch(t.details){case r.a.FRAG_LOAD_ERROR:case r.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},e.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},e.prototype._findBestLevel=function(t,e,i,n,s,a,r,o,l){for(var u=s;u>=n;u--){var c=l[u];if(c){var h=c.details,p=h?h.totalduration/h.fragments.length:e,g=!!h&&h.live,f=void 0;f=u<=t?r*i:o*i;var v=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,m=v*p/f;if(d.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(f)+"/"+v+"/"+p+"/"+a+"/"+m),f>v&&(!m||g&&!this.bitrateTestDelay||m<a))return u}}return-1},It(e,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var i=this._nextABRAutoLevel;return-1!==t&&(i=Math.min(t,i)),i},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,i=t.levels,n=t.config,s=t.minAutoLevel,a=t.media,r=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,h=(q.bufferInfo(a,l,n.maxBufferHole).end-l)/u,p=this._findBestLevel(r,o,c,s,e,h,n.abrBandWidthFactor,n.abrBandWidthUpFactor,i);if(p>=0)return p;d.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay,f=n.abrBandWidthFactor,v=n.abrBandWidthUpFactor;if(0===h){var m=this.bitrateTestDelay;if(m)g=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-m,d.b.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),f=v=1}return p=this._findBestLevel(r,o,c,s,e,h+g,f,v,i),Math.max(p,0)}}]),e}(h);var Pt=Q(),wt=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHING,l.a.MEDIA_DETACHING,l.a.MANIFEST_PARSED,l.a.BUFFER_RESET,l.a.BUFFER_APPENDING,l.a.BUFFER_CODECS,l.a.BUFFER_EOS,l.a.BUFFER_FLUSHING,l.a.LEVEL_PTS_UPDATED,l.a.LEVEL_UPDATED));return n._msDuration=null,n._levelDuration=null,n._live=null,n._objectUrl=null,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){h.prototype.destroy.call(this)},e.prototype.onLevelPtsUpdated=function(t){var e=t.type,i=this.tracks.audio;if("audio"===e&&i&&"audio/mpeg"===i.container){var n=this.sourceBuffer.audio;if(Math.abs(n.timestampOffset-t.start)>.1){var s=n.updating;try{n.abort()}catch(t){s=!0,d.b.warn("can not abort audio buffer: "+t)}s?this.audioTimestampOffset=t.start:(d.b.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+t.start),n.timestampOffset=t.start)}}},e.prototype.onManifestParsed=function(t){var e=t.audio,i=t.video||t.levels.length&&t.altAudio,n=0;t.altAudio&&(e||i)&&(n=(e?1:0)+(i?1:0),d.b.log(n+" sourceBuffer(s) expected")),this.sourceBufferNb=n},e.prototype.onMediaAttaching=function(t){var e=this.media=t.media;if(e){var i=this.mediaSource=new Pt;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),e.src=window.URL.createObjectURL(i),this._objectUrl=e.src}},e.prototype.onMediaDetaching=function(){d.b.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){d.b.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):d.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(l.a.MEDIA_DETACHED)},e.prototype.onMediaSourceOpen=function(){d.b.log("media source opened"),this.hls.trigger(l.a.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},e.prototype.checkPendingTracks=function(){var t=this.pendingTracks,e=Object.keys(t).length;e&&(this.sourceBufferNb<=e||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},e.prototype.onMediaSourceClose=function(){d.b.log("media source closed")},e.prototype.onMediaSourceEnded=function(){d.b.log("media source ended")},e.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;d.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e=this.parent,i=this.segments.reduce(function(t,i){return i.parent===e?t+1:t},0),n={},s=this.sourceBuffer;for(var a in s)n[a]=s[a].buffered;this.hls.trigger(l.a.BUFFER_APPENDED,{parent:e,pending:i,timeRanges:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},e.prototype.onSBUpdateError=function(t){d.b.error("sourceBuffer error:",t),this.hls.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var i=t[e];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},e.prototype.onBufferCodecs=function(t){if(0===Object.keys(this.sourceBuffer).length){for(var e in t)this.pendingTracks[e]=t[e];var i=this.mediaSource;i&&"open"===i.readyState&&this.checkPendingTracks()}},e.prototype.createSourceBuffers=function(t){var e=this.sourceBuffer,i=this.mediaSource;for(var n in t)if(!e[n]){var s=t[n],a=s.levelCodec||s.codec,o=s.container+";codecs="+a;d.b.log("creating sourceBuffer("+o+")");try{var u=e[n]=i.addSourceBuffer(o);u.addEventListener("updateend",this.onsbue),u.addEventListener("error",this.onsbe),this.tracks[n]={codec:a,container:s.container},s.buffer=u}catch(t){d.b.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:o})}}this.hls.trigger(l.a.BUFFER_CREATED,{tracks:t})},e.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},e.prototype.onBufferAppendFail=function(t){d.b.error("sourceBuffer error:",t.event),this.hls.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferEos=function(t){var e=this.sourceBuffer,i=t.type;for(var n in e)i&&n!==i||e[n].ended||(e[n].ended=!0,d.b.log(n+" sourceBuffer now EOS"));this.checkEos()},e.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(e&&"open"===e.readyState){for(var i in t){var n=t[i];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}d.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){d.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},e.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},e.prototype.onLevelUpdated=function(t){var e=t.details;e.fragments.length>0&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._live=e.live,this.updateMediaElementDuration())},e.prototype.updateMediaElementDuration=function(){var t,e=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer)if(!0===this.sourceBuffer[i].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(d.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!Object(o.a)(t))&&(d.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},e.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,i=this.sourceBuffer;try{for(var n in i)e+=i[n].buffered.length}catch(t){d.b.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(l.a.BUFFER_FLUSHED)}},e.prototype.doAppending=function(){var t=this.hls,e=this.sourceBuffer,i=this.segments;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void d.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(i&&i.length){var n=i.shift();try{var s=e[n.type];s?s.updating?i.unshift(n):(s.ended=!1,this.parent=n.parent,s.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){d.b.error("error while trying to append buffer:"+e.message),i.unshift(n);var a={type:r.b.MEDIA_ERROR,parent:n.parent};22!==e.code?(this.appendError?this.appendError++:this.appendError=1,a.details=r.a.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry?(d.b.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i=[],a.fatal=!0,t.trigger(l.a.ERROR,a)):(a.fatal=!1,t.trigger(l.a.ERROR,a))):(this.segments=[],a.details=r.a.BUFFER_FULL_ERROR,a.fatal=!1,t.trigger(l.a.ERROR,a))}}}},e.prototype.flushBuffer=function(t,e,i){var n=void 0,s=void 0,a=void 0,r=void 0,o=void 0,l=void 0,u=this.sourceBuffer;if(Object.keys(u).length){if(d.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var c in u)if(!i||c===i){if((n=u[c]).ended=!1,n.updating)return d.b.warn("cannot flush, sb updating in progress"),!1;try{for(s=0;s<n.buffered.length;s++)if(a=n.buffered.start(s),r=n.buffered.end(s),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&e===Number.POSITIVE_INFINITY?(o=t,l=e):(o=Math.max(a,t),l=Math.min(r,e)),Math.min(l,r)-o>.5)return this.flushBufferCounter++,d.b.log("flush "+c+" ["+o+","+l+"], of ["+a+","+r+"], pos:"+this.media.currentTime),n.remove(o,l),!1}catch(t){d.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else d.b.warn("abort flushing too many retries");d.b.log("buffer flushed")}return!0},e}(h),kt=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var Mt=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.FPS_DROP_LEVEL_CAPPING,l.a.MEDIA_ATTACHING,l.a.MANIFEST_PARSED,l.a.BUFFER_CODECS,l.a.MEDIA_DETACHING));return n.autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},e.prototype.onFpsDropLevelCapping=function(t){e.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},e.prototype.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},e.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&(t.video||t.levels.length&&t.altAudio)&&this._startCapping()},e.prototype.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this._startCapping()},e.prototype.onLevelsUpdated=function(t){this.levels=t.levels},e.prototype.onMediaDetaching=function(){this._stopCapping()},e.prototype.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},e.prototype.getMaxLevel=function(t){var i=this;if(!this.levels)return-1;var n=this.levels.filter(function(n,s){return e.isLevelAllowed(s,i.restrictedLevels)&&s<=t});return e.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},e.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},e.isLevelAllowed=function(t){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(t)},e.getMaxLevelByMediaSize=function(t,e,i){if(!t||t&&!t.length)return-1;for(var n,s,a=t.length-1,r=0;r<t.length;r+=1){var o=t[r];if((o.width>=e||o.height>=i)&&(n=o,!(s=t[r+1])||n.width!==s.width||n.height!==s.height)){a=r;break}}return a},kt(e,[{key:"mediaWidth",get:function(){var t=void 0,i=this.media;return i&&(t=i.width||i.clientWidth||i.offsetWidth,t*=e.contentScaleFactor),t}},{key:"mediaHeight",get:function(){var t=void 0,i=this.media;return i&&(t=i.height||i.clientHeight||i.offsetHeight,t*=e.contentScaleFactor),t}}],[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}]),e}(h);var Ot=window.performance,Lt=function(t){function e(i){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHING))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},e.prototype.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof window.HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},e.prototype.checkFPS=function(t,e,i){var n=Ot.now();if(e){if(this.lastTime){var s=n-this.lastTime,a=i-this.lastDroppedFrames,r=e-this.lastDecodedFrames,o=1e3*a/s,u=this.hls;if(u.trigger(l.a.FPS_DROP,{currentDropped:a,currentDecoded:r,totalDroppedFrames:i}),o>0&&a>u.config.fpsDroppedMonitoringThreshold*r){var c=u.currentLevel;d.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=c)&&(c-=1,u.trigger(l.a.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,u.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=e}},e.prototype.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},e}(h);var Nt=window,Ut=Nt.performance,Bt=Nt.XMLHttpRequest,jt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return t.prototype.destroy=function(){this.abort(),this.loader=null},t.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.prototype.load=function(t,e,i){this.context=t,this.config=e,this.callbacks=i,this.stats={trequest:Ut.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},t.prototype.loadInternal=function(){var t=void 0,e=this.context;t=this.loader=new Bt;var i=this.stats;i.tfirst=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(t,e.url)}catch(i){t.open("GET",e.url,!0),n(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(i){return void this.callbacks.onError({code:t.status,text:i.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.prototype.readystatechange=function(t){var e=t.currentTarget,i=e.readyState,n=this.stats,s=this.context,a=this.config;if(!n.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(Ut.now(),n.trequest)),4===i){var r=e.status;if(r>=200&&r<300){n.tload=Math.max(n.tfirst,Ut.now());var o=void 0,l=void 0;l="arraybuffer"===s.responseType?(o=e.response).byteLength:(o=e.responseText).length,n.loaded=n.total=l;var u={url:e.responseURL,data:o};this.callbacks.onSuccess(u,n,s,e)}else n.retry>=a.maxRetry||r>=400&&r<499?(d.b.error(r+" while loading "+s.url),this.callbacks.onError({code:r,text:e.statusText},s,e)):(d.b.warn(r+" while loading "+s.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout)},t.prototype.loadtimeout=function(){d.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.prototype.loadprogress=function(t){var e=t.currentTarget,i=this.stats;i.loaded=t.loaded,t.lengthComputable&&(i.total=t.total);var n=this.callbacks.onProgress;n&&n(i,this.context,null,e)},t}(),xt=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var Ft=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MANIFEST_LOADING,l.a.MANIFEST_PARSED,l.a.AUDIO_TRACK_LOADED,l.a.AUDIO_TRACK_SWITCHED,l.a.LEVEL_LOADED,l.a.ERROR));return n._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},e.prototype.onManifestParsed=function(t){var e=this.tracks=t.audioTracks||[];this.hls.trigger(l.a.AUDIO_TRACKS_UPDATED,{audioTracks:e})},e.prototype.onAudioTrackLoaded=function(t){if(t.id>=this.tracks.length)d.b.warn("Invalid audio track id:",t.id);else{if(d.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()){var e=1e3*t.details.targetduration;this.setInterval(e)}!t.details.live&&this.hasInterval()&&this.clearInterval()}},e.prototype.onAudioTrackSwitched=function(t){var e=this.tracks[t.id].groupId;e&&this.audioGroupId!==e&&(this.audioGroupId=e)},e.prototype.onLevelLoaded=function(t){var e=this.hls.levels[t.level];if(e.audioGroupIds){var i=e.audioGroupIds[e.urlId];this.audioGroupId!==i&&(this.audioGroupId=i,this._selectInitialAudioTrack())}},e.prototype.onError=function(t){t.type===r.b.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===r.a.AUDIO_TRACK_LOAD_ERROR&&(d.b.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},e.prototype._setAudioTrack=function(t){if(this._trackId===t&&this.tracks[this._trackId].details)d.b.debug("Same id as current audio-track passed, and track details available -> no-op");else if(t<0||t>=this.tracks.length)d.b.warn("Invalid id passed to audio-track controller");else{var e=this.tracks[t];d.b.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t;var i=e.url,n=e.type,s=e.id;this.hls.trigger(l.a.AUDIO_TRACK_SWITCHING,{id:s,type:n,url:i}),this._loadTrackDetailsIfNeeded(e)}},e.prototype.doTick=function(){this._updateTrack(this._trackId)},e.prototype._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var i=this.tracks[this._trackId],n=null;if(i&&(n=i.name),this._selectDefaultTrack){var s=e.filter(function(t){return t.default});s.length?e=s:d.b.warn("No default audio tracks defined")}var a=!1,o=function(){e.forEach(function(e){a||t.audioGroupId&&e.groupId!==t.audioGroupId||n&&n!==e.name||(t._setAudioTrack(e.id),a=!0)})};o(),a||(n=null,o()),a||(d.b.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:r.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},e.prototype._needsTrackLoading=function(t){var e=t.details;return!e||(!!e.live||void 0)},e.prototype._loadTrackDetailsIfNeeded=function(t){if(this._needsTrackLoading(t)){var e=t.url,i=t.id;d.b.log("loading audio-track playlist for id: "+i),this.hls.trigger(l.a.AUDIO_TRACK_LOADING,{url:e,id:i})}},e.prototype._updateTrack=function(t){if(!(t<0||t>=this.tracks.length)){this.clearInterval(),this._trackId=t,d.b.log("trying to update audio-track "+t);var e=this.tracks[t];this._loadTrackDetailsIfNeeded(e)}},e.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],i=e.name,n=e.language,s=e.groupId;d.b.warn("Loading failed on audio track id: "+t+", group-id: "+s+', name/language: "'+i+'" / "'+n+'"');for(var a=t,r=0;r<this.tracks.length;r++){if(!this.trackIdBlacklist[r])if(this.tracks[r].name===i){a=r;break}}a!==t?(d.b.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)):d.b.warn('No fallback audio-track found for name/language: "'+i+'" / "'+n+'"')},xt(e,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1}}]),e}(dt),Gt=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var Vt=window.performance,Ht={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},$t=function(t){function e(i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHED,l.a.MEDIA_DETACHING,l.a.AUDIO_TRACKS_UPDATED,l.a.AUDIO_TRACK_SWITCHING,l.a.AUDIO_TRACK_LOADED,l.a.KEY_LOADED,l.a.FRAG_LOADED,l.a.FRAG_PARSING_INIT_SEGMENT,l.a.FRAG_PARSING_DATA,l.a.FRAG_PARSED,l.a.ERROR,l.a.BUFFER_RESET,l.a.BUFFER_CREATED,l.a.BUFFER_APPENDED,l.a.BUFFER_FLUSHED,l.a.INIT_PTS_FOUND));return s.fragmentTracker=n,s.config=i.config,s.audioCodecSwap=!1,s._state=Ht.STOPPED,s.initPTS=[],s.waitingFragment=null,s.videoTrackCC=null,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function(){this.state=Ht.STOPPED,this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},e.prototype.onInitPtsFound=function(t){var e=t.id,i=t.frag.cc,n=t.initPTS;"main"===e&&(this.initPTS[i]=n,this.videoTrackCC=i,d.b.log("InitPTS for cc: "+i+" found from video track: "+n),this.state===Ht.WAITING_INIT_PTS&&this.tick())},e.prototype.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(d.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=Ht.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=Ht.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=Ht.STOPPED},e.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Ht.STOPPED},e.prototype.doTick=function(){var t=void 0,e=void 0,i=void 0,n=this.hls,s=n.config;switch(this.state){case Ht.ERROR:case Ht.PAUSED:case Ht.BUFFER_FLUSHING:break;case Ht.STARTING:this.state=Ht.WAITING_TRACK,this.loadedmetadata=!1;break;case Ht.IDLE:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!s.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var r=this.mediaBuffer?this.mediaBuffer:this.media,u=this.videoBuffer?this.videoBuffer:this.media,c=q.bufferInfo(r,t,s.maxBufferHole),h=q.bufferInfo(u,t,s.maxBufferHole),p=c.len,g=c.end,f=this.fragPrevious,v=Math.min(s.maxBufferLength,s.maxMaxBufferLength),m=Math.max(v,h.len),_=this.audioSwitch,E=this.trackId;if((p<m||_)&&E<a.length){if(void 0===(i=a[E].details)){this.state=Ht.WAITING_TRACK;break}if(!_&&!i.live&&f&&f.sn===i.endSN&&!c.nextStart&&(!this.media.seeking||this.media.duration-g<f.duration/2)){this.hls.trigger(l.a.BUFFER_EOS,{type:"audio"}),this.state=Ht.ENDED;break}var A=i.fragments,y=A.length,b=A[0].start,S=A[y-1].start+A[y-1].duration,T=void 0;if(_)if(i.live&&!i.PTSKnown)d.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),g=0;else if(g=t,i.PTSKnown&&t<b){if(!(c.end>b||c.nextStart))return;d.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=b+.05}if(i.initSegment&&!i.initSegment.data)T=i.initSegment;else if(g<=b){if(T=A[0],null!==this.videoTrackCC&&T.cc!==this.videoTrackCC&&(T=function(t,e){return $.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})}(A,this.videoTrackCC)),i.live&&T.loadIdx&&T.loadIdx===this.fragLoadIdx){var C=c.nextStart?c.nextStart:b;return d.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(C+.05)),void(this.media.currentTime=C+.05)}}else{var I=void 0,D=s.maxFragLookUpTolerance,R=f?A[f.sn-A[0].sn+1]:void 0,P=function(t){var e=Math.min(D,t.duration);return t.start+t.duration-e<=g?1:t.start-e>g&&t.start?-1:0};g<S?(g>S-D&&(D=0),I=R&&!P(R)?R:$.search(A,P)):I=A[y-1],I&&(T=I,b=I.start,f&&T.level===f.level&&T.sn===f.sn&&(T.sn<i.endSN?(T=A[T.sn+1-i.startSN],d.b.log("SN just loaded, load next one: "+T.sn)):T=null))}T&&(T.encrypted?(d.b.log("Loading key for "+T.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+E),this.state=Ht.KEY_LOADING,n.trigger(l.a.KEY_LOADING,{frag:T})):(d.b.log("Loading "+T.sn+", cc: "+T.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+E+", currentTime:"+t+",bufferEnd:"+g.toFixed(3)),(_||this.fragmentTracker.getState(T)===x)&&(this.fragCurrent=T,this.startFragRequested=!0,Object(o.a)(T.sn)&&(this.nextLoadPosition=T.start+T.duration),n.trigger(l.a.FRAG_LOADING,{frag:T}),this.state=Ht.FRAG_LOADING)))}break;case Ht.WAITING_TRACK:(e=this.tracks[this.trackId])&&e.details&&(this.state=Ht.IDLE);break;case Ht.FRAG_LOADING_WAITING_RETRY:var w=Vt.now(),k=this.retryDate,M=(r=this.media)&&r.seeking;(!k||w>=k||M)&&(d.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=Ht.IDLE);break;case Ht.WAITING_INIT_PTS:var O=this.videoTrackCC;if(void 0===this.initPTS[O])break;var L=this.waitingFragment;if(L){var N=L.frag.cc;O!==N?(e=this.tracks[this.trackId]).details&&e.details.live&&(d.b.warn("Waiting fragment CC ("+N+") does not match video track CC ("+O+")"),this.waitingFragment=null,this.state=Ht.IDLE):(this.state=Ht.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=Ht.IDLE;break;case Ht.STOPPED:case Ht.FRAG_LOADING:case Ht.PARSING:case Ht.PARSED:case Ht.ENDED:}},e.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(d.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function(){this.state===Ht.ENDED&&(this.state=Ht.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),this.tick()},e.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.prototype.onAudioTracksUpdated=function(t){d.b.log("audio tracks updated"),this.tracks=t.audioTracks},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=Ht.PAUSED,this.waitingFragment=null,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=Ht.IDLE),this.tick()},e.prototype.onAudioTrackLoaded=function(t){var e=t.details,i=t.id,n=this.tracks[i],s=e.totalduration,a=0;if(d.b.log("track "+i+" loaded ["+e.startSN+","+e.endSN+"],duration:"+s),e.live){var r=n.details;r&&e.fragments.length>0?(at(r,e),a=e.fragments[0].start,e.PTSKnown?d.b.log("live audio playlist sliding:"+a.toFixed(3)):d.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,d.b.log("live audio playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(n.details=e,!this.startFragRequested){if(-1===this.startPosition){var l=e.startTimeOffset;Object(o.a)(l)?(d.b.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===Ht.WAITING_TRACK&&(this.state=Ht.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===Ht.KEY_LOADING&&(this.state=Ht.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag;if(this.state===Ht.FRAG_LOADING&&e&&"audio"===i.type&&i.level===e.level&&i.sn===e.sn){var n=this.tracks[this.trackId],s=n.details,a=s.totalduration,r=e.level,o=e.sn,u=e.cc,c=this.config.defaultAudioCodec||n.audioCodec||"mp4a.40.2",h=this.stats=t.stats;if("initSegment"===o)this.state=Ht.IDLE,h.tparsed=h.tbuffered=Vt.now(),s.initSegment.data=t.payload,this.hls.trigger(l.a.FRAG_BUFFERED,{stats:h,frag:e,id:"audio"}),this.tick();else{this.state=Ht.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new et(this.hls,"audio"));var p=this.initPTS[u],g=s.initSegment?s.initSegment.data:[];if(s.initSegment||void 0!==p){this.pendingBuffering=!0,d.b.log("Demuxing "+o+" of ["+s.startSN+" ,"+s.endSN+"],track "+r);this.demuxer.push(t.payload,g,c,null,e,a,!1,p)}else d.b.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+o+" of ["+s.startSN+" ,"+s.endSN+"],track "+r),this.waitingFragment=t,this.state=Ht.WAITING_INIT_PTS}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===Ht.PARSING){var n=t.tracks,s=void 0;if(n.video&&delete n.video,s=n.audio){s.levelCodec=s.codec,s.id=t.id,this.hls.trigger(l.a.BUFFER_CODECS,n),d.b.log("audio track:audio,container:"+s.container+",codecs[level/parsed]=["+s.levelCodec+"/"+s.codec+"]");var a=s.initSegment;if(a){var r={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[r]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.a.BUFFER_APPENDING,r))}this.tick()}}},e.prototype.onFragParsingData=function(t){var e=this,i=this.fragCurrent,n=t.frag;if(i&&"audio"===t.id&&"audio"===t.type&&n.sn===i.sn&&n.level===i.level&&this.state===Ht.PARSING){var s=this.trackId,a=this.tracks[s],u=this.hls;Object(o.a)(t.endPTS)||(t.endPTS=t.startPTS+i.duration,t.endDTS=t.startDTS+i.duration),i.addElementaryStream(m.ElementaryStreamTypes.AUDIO),d.b.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),st(a.details,i,t.startPTS,t.endPTS);var c=this.audioSwitch,h=this.media,p=!1;if(c&&h)if(h.readyState){var g=h.currentTime;d.b.log("switching audio track : currentTime:"+g),g>=t.startPTS&&(d.b.log("switching audio track : flushing all audio"),this.state=Ht.BUFFER_FLUSHING,u.trigger(l.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),p=!0,this.audioSwitch=!1,u.trigger(l.a.AUDIO_TRACK_SWITCHED,{id:s}))}else this.audioSwitch=!1,u.trigger(l.a.AUDIO_TRACK_SWITCHED,{id:s});var f=this.pendingData;if(!f)return d.b.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void u.trigger(l.a.ERROR,{type:r.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&f.push({type:t.type,data:e,parent:"audio",content:"data"})}),!p&&f.length&&(f.forEach(function(t){e.state===Ht.PARSING&&(e.pendingBuffering=!0,e.hls.trigger(l.a.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===Ht.PARSING&&(this.stats.tparsed=Vt.now(),this.state=Ht.PARSED,this._checkAppendedParsed())},e.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},e.prototype.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==Ht.PARSING&&e!==Ht.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function(){if(!(this.state!==Ht.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,i=this.hls;if(t){this.fragPrevious=t,e.tbuffered=Vt.now(),i.trigger(l.a.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;d.b.log("audio buffered : "+rt.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(l.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Ht.IDLE}this.tick()}},e.prototype.onError=function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case r.a.FRAG_LOAD_ERROR:case r.a.FRAG_LOAD_TIMEOUT:var i=t.frag;if(i&&"audio"!==i.type)break;if(!t.fatal){var n=this.fragLoadError;n?n++:n=1;var s=this.config;if(n<=s.fragLoadingMaxRetry){this.fragLoadError=n;var a=Math.min(Math.pow(2,n-1)*s.fragLoadingRetryDelay,s.fragLoadingMaxRetryTimeout);d.b.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=Vt.now()+a,this.state=Ht.FRAG_LOADING_WAITING_RETRY}else d.b.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Ht.ERROR}break;case r.a.AUDIO_TRACK_LOAD_ERROR:case r.a.AUDIO_TRACK_LOAD_TIMEOUT:case r.a.KEY_LOAD_ERROR:case r.a.KEY_LOAD_TIMEOUT:this.state!==Ht.ERROR&&(this.state=t.fatal?Ht.ERROR:Ht.IDLE,d.b.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case r.a.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===Ht.PARSING||this.state===Ht.PARSED)){var o=this.mediaBuffer,u=this.media.currentTime;if(o&&q.isBuffered(o,u)&&q.isBuffered(o,u+.5)){var c=this.config;c.maxMaxBufferLength>=c.maxBufferLength&&(c.maxMaxBufferLength/=2,d.b.warn("AudioStreamController: reduce max buffer length to "+c.maxMaxBufferLength+"s")),this.state=Ht.IDLE}else d.b.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Ht.BUFFER_FLUSHING,this.hls.trigger(l.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},e.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(d.b.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(e){t.hls.trigger(l.a.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=Ht.PARSED):(this.state=Ht.IDLE,this.fragPrevious=null,this.tick())},Gt(e,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,d.b.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}]),e}(dt),qt=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var t="auto",e={"":!0,lr:!0,rl:!0},i={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(t){return"string"==typeof t&&(!!i[t.toLowerCase()]&&t.toLowerCase())}function s(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function a(i,a,r){var o=this,l=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),d={};l?o=document.createElement("custom"):d.enumerable=!0,o.hasBeenReset=!1;var u="",c=!1,h=i,p=a,g=r,f=null,v="",m=!0,_="auto",E="start",A=50,y="middle",b=50,S="middle";if(Object.defineProperty(o,"id",s({},d,{get:function(){return u},set:function(t){u=""+t}})),Object.defineProperty(o,"pauseOnExit",s({},d,{get:function(){return c},set:function(t){c=!!t}})),Object.defineProperty(o,"startTime",s({},d,{get:function(){return h},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",s({},d,{get:function(){return p},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",s({},d,{get:function(){return g},set:function(t){g=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",s({},d,{get:function(){return f},set:function(t){f=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",s({},d,{get:function(){return v},set:function(t){var i=function(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");v=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",s({},d,{get:function(){return m},set:function(t){m=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",s({},d,{get:function(){return _},set:function(e){if("number"!=typeof e&&e!==t)throw new SyntaxError("An invalid number or illegal string was specified.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",s({},d,{get:function(){return E},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",s({},d,{get:function(){return A},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");A=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",s({},d,{get:function(){return y},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",s({},d,{get:function(){return b},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",s({},d,{get:function(){return S},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");S=e,this.hasBeenReset=!0}})),o.displayState=void 0,l)return o}return a.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},a}(),Wt=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};function Kt(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Wt,this.regionList=[]}function zt(){this.values=Object.create(null)}function Yt(t,e,i,n){var s=n?t.split(n):[t];for(var a in s)if("string"==typeof s[a]){var r=s[a].split(i);if(2===r.length)e(r[0],r[1])}}zt.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,i){for(var n=0;n<i.length;++n)if(e===i[n]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var Xt=new qt(0,0,0),Qt="middle"===Xt.align?"middle":"center";function Jt(t,e,i){var n=t;function s(){var e=function(t){function e(t,e,i,n){return 3600*(0|t)+60*(0|e)+(0|i)+(0|n)/1e3}var i=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?e(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?e(i[1],i[2],0,i[4]):e(0,i[1],i[2],i[4]):null}(t);if(null===e)throw new Error("Malformed timestamp: "+n);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function a(){t=t.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);t=t.substr(3),a(),e.endTime=s(),a(),function(t,e){var n=new zt;Yt(t,function(t,e){switch(t){case"region":for(var s=i.length-1;s>=0;s--)if(i[s].id===e){n.set(t,i[s].region);break}break;case"vertical":n.alt(t,e,["rl","lr"]);break;case"line":var a=e.split(","),r=a[0];n.integer(t,r),n.percent(t,r)&&n.set("snapToLines",!1),n.alt(t,r,["auto"]),2===a.length&&n.alt("lineAlign",a[1],["start",Qt,"end"]);break;case"position":a=e.split(","),n.percent(t,a[0]),2===a.length&&n.alt("positionAlign",a[1],["start",Qt,"end","line-left","line-right","auto"]);break;case"size":n.percent(t,e);break;case"align":n.alt(t,e,["start",Qt,"end","left","right"])}},/:/,/\s/),e.region=n.get("region",null),e.vertical=n.get("vertical","");var s=n.get("line","auto");"auto"===s&&-1===Xt.line&&(s=-1),e.line=s,e.lineAlign=n.get("lineAlign","start"),e.snapToLines=n.get("snapToLines",!0),e.size=n.get("size",100),e.align=n.get("align",Qt);var a=n.get("position","auto");"auto"===a&&50===Xt.position&&(a="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=a}(t,e)}function Zt(t){return t.replace(/<br(?: \/)?>/gi,"\n")}Kt.prototype={parse:function(t){var e=this;function i(){var t=e.buffer,i=0;for(t=Zt(t);i<t.length&&"\r"!==t[i]&&"\n"!==t[i];)++i;var n=t.substr(0,i);return"\r"===t[i]&&++i,"\n"===t[i]&&++i,e.buffer=t.substr(i),n}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var n=void 0;if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var s=(n=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var a=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(a?a=!1:n=i(),e.state){case"HEADER":/:/.test(n)?Yt(n,function(t,e){},/:/):n||(e.state="ID");continue;case"NOTE":n||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){e.state="NOTE";break}if(!n)continue;if(e.cue=new qt(0,0,""),e.state="CUE",-1===n.indexOf("--\x3e")){e.cue.id=n;continue}case"CUE":try{Jt(n,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var r=-1!==n.indexOf("--\x3e");if(!n||r&&(a=!0)){e.oncue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}e.cue.text&&(e.cue.text+="\n"),e.cue.text+=n;continue;case"BADCUE":n||(e.state="ID");continue}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return this.onflush&&this.onflush(),this}};var te=Kt;function ee(t,e,i,n){for(var s=void 0,a=void 0,r=void 0,o=void 0,l=void 0,d=window.VTTCue||window.TextTrackCue,u=0;u<n.rows.length;u++)if(r=!0,o=0,l="",!(s=n.rows[u]).isEmpty()){for(var c=0;c<s.chars.length;c++)s.chars[c].uchar.match(/\s/)&&r?o++:(l+=s.chars[c].uchar,r=!1);s.cueStartTime=e,e===i&&(i+=1e-4),a=new d(e,i,Zt(l.trim())),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?a.line=u+1:a.line=u>7?u-2:u+1,a.align="left",a.position=Math.max(0,Math.min(100,o/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(a)}}function ie(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var ne={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},se=function(t){var e=t;return ne.hasOwnProperty(t)&&(e=ne[t]),String.fromCharCode(e)},ae=15,re=100,oe={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},le={17:2,18:4,21:6,22:8,23:10,19:13,20:15},de={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ue={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ce=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],he={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){this.verboseFilter[t];this.verboseLevel}},pe=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e},ge=function(){function t(e,i,n,s,a){ie(this,t),this.foreground=e||"white",this.underline=i||!1,this.italics=n||!1,this.background=s||"black",this.flash=a||!1}return t.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var n=e[i];t.hasOwnProperty(n)&&(this[n]=t[n])}},t.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},t.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},t.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),fe=function(){function t(e,i,n,s,a,r){ie(this,t),this.uchar=e||" ",this.penState=new ge(i,n,s,a,r)}return t.prototype.reset=function(){this.uchar=" ",this.penState.reset()},t.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},t.prototype.setPenState=function(t){this.penState.copy(t)},t.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},t.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},t.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),ve=function(){function t(){ie(this,t),this.chars=[];for(var e=0;e<re;e++)this.chars.push(new fe);this.pos=0,this.currPenState=new ge}return t.prototype.equals=function(t){for(var e=!0,i=0;i<re;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<re;e++)this.chars[e].copy(t.chars[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<re;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},t.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(he.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>re&&(he.log("ERROR","Too large cursor position "+this.pos),this.pos=re)},t.prototype.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)},t.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.prototype.insertChar=function(t){t>=144&&this.backSpace();var e=se(t);this.pos>=re?he.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},t.prototype.clearFromPos=function(t){var e=void 0;for(e=t;e<re;e++)this.chars[e].reset()},t.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.prototype.getTextString=function(){for(var t=[],e=!0,i=0;i<re;i++){var n=this.chars[i].uchar;" "!==n&&(e=!1),t.push(n)}return e?"":t.join("")},t.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),me=function(){function t(){ie(this,t),this.rows=[];for(var e=0;e<ae;e++)this.rows.push(new ve);this.currRow=ae-1,this.nrRollUpRows=null,this.reset()}return t.prototype.reset=function(){for(var t=0;t<ae;t++)this.rows[t].clear();this.currRow=ae-1},t.prototype.equals=function(t){for(var e=!0,i=0;i<ae;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<ae;e++)this.rows[e].copy(t.rows[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<ae;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},t.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},t.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},t.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},t.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},t.prototype.setCursor=function(t){he.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},t.prototype.setPAC=function(t){he.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<ae;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var a=s.rows[n].cueStartTime;if(a&&a<he.time)for(var r=0;r<this.nrRollUpRows;r++)this.rows[e-this.nrRollUpRows+r+1].copy(s.rows[n+r])}}this.currRow=e;var o=this.rows[this.currRow];if(null!==t.indent){var l=t.indent,d=Math.max(l-1,0);o.setCursor(t.indent),t.color=o.chars[d].penState.foreground}var u={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(u)},t.prototype.setBkgData=function(t){he.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},t.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},t.prototype.rollUp=function(){if(null!==this.nrRollUpRows){he.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),he.log("INFO","Rolling up")}else he.log("DEBUG","roll_up but nrRollUpRows not set yet")},t.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],i="",n=-1,s=0;s<ae;s++){var a=this.rows[s].getTextString();a&&(n=s+1,t?e.push("Row "+n+": '"+a+"'"):e.push(a.trim()))}return e.length>0&&(i=t?"["+e.join(" | ")+"]":e.join("\n")),i},t.prototype.getTextAndFormat=function(){return this.rows},t}(),_e=function(){function t(e,i){ie(this,t),this.chNr=e,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new me,this.nonDisplayedMemory=new me,this.lastOutputScreen=new me,this.currRollUpRow=this.displayedMemory.rows[ae-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return t.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[ae-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},t.prototype.getHandler=function(){return this.outputFilter},t.prototype.setHandler=function(t){this.outputFilter=t},t.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},t.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},t.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,he.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},t.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";he.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(he.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.prototype.ccRCL=function(){he.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.prototype.ccBS=function(){he.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.prototype.ccAOF=function(){},t.prototype.ccAON=function(){},t.prototype.ccDER=function(){he.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.prototype.ccRU=function(t){he.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},t.prototype.ccFON=function(){he.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.prototype.ccRDC=function(){he.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.prototype.ccTR=function(){he.log("INFO","TR"),this.setMode("MODE_TEXT")},t.prototype.ccRTD=function(){he.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.prototype.ccEDM=function(){he.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.prototype.ccCR=function(){he.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.prototype.ccENM=function(){he.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.prototype.ccEOC=function(){if(he.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,he.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.prototype.ccTO=function(t){he.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},t.prototype.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var i=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}he.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},t.prototype.outputDataUpdate=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=he.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},t.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),Ee=function(){function t(e,i,n){ie(this,t),this.field=e||1,this.outputs=[i,n],this.channels=[new _e(1,i),new _e(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return t.prototype.getHandler=function(t){return this.channels[t].getHandler()},t.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},t.prototype.addData=function(t,e){var i=void 0,n=void 0,s=void 0,a=!1;this.lastTime=t,he.setTime(t);for(var r=0;r<e.length;r+=2)if(n=127&e[r],s=127&e[r+1],0!==n||0!==s){if(he.log("DATA","["+pe([e[r],e[r+1]])+"] -> ("+pe([n,s])+")"),(i=this.parseCmd(n,s))||(i=this.parseMidrow(n,s)),i||(i=this.parsePAC(n,s)),i||(i=this.parseBackgroundAttributes(n,s)),!i)if(a=this.parseChars(n,s))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(a);else he.log("WARNING","No channel found yet. TEXT-MODE?");i?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,he.log("WARNING","Couldn't parse cleaned data "+pe([n,s])+" orig: "+pe([e[r],e[r+1]])))}else this.dataCounters.padding+=2},t.prototype.parseCmd=function(t,e){var i=null;if(!((20===t||28===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=33&&e<=35))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,he.log("DEBUG","Repeated command ("+pe([t,e])+") is dropped"),!0;i=20===t||23===t?1:2;var n=this.channels[i-1];return 20===t||28===t?32===e?n.ccRCL():33===e?n.ccBS():34===e?n.ccAOF():35===e?n.ccAON():36===e?n.ccDER():37===e?n.ccRU(2):38===e?n.ccRU(3):39===e?n.ccRU(4):40===e?n.ccFON():41===e?n.ccRDC():42===e?n.ccTR():43===e?n.ccRTD():44===e?n.ccEDM():45===e?n.ccCR():46===e?n.ccENM():47===e&&n.ccEOC():n.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},t.prototype.parseMidrow=function(t,e){var i=null;return(17===t||25===t)&&e>=32&&e<=47&&((i=17===t?1:2)!==this.currChNr?(he.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(e),he.log("DEBUG","MIDROW ("+pe([t,e])+")"),!0))},t.prototype.parsePAC=function(t,e){var i,n=null;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127)&&!((16===t||24===t)&&e>=64&&e<=95))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=t<=23?1:2,n=e>=64&&e<=95?1===i?oe[t]:de[t]:1===i?le[t]:ue[t];var s=this.interpretPAC(n,e);return this.channels[i-1].setPAC(s),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},t.prototype.interpretPAC=function(t,e){var i=e,n={color:null,italics:!1,indent:null,underline:!1,row:t};return i=e>95?e-96:e-64,n.underline=1==(1&i),i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},t.prototype.parseChars=function(t,e){var i=null,n=null,s=null;if(t>=25?(i=2,s=t-8):(i=1,s=t),s>=17&&s<=19){var a=e;a=17===s?e+80:18===s?e+112:e+144,he.log("INFO","Special char '"+se(a)+"' in channel "+i),n=[a]}else t>=32&&t<=127&&(n=0===e?[t]:[t,e]);if(n){var r=pe(n);he.log("DEBUG","Char codes =  "+r.join(",")),this.lastCmdA=null,this.lastCmdB=null}return n},t.prototype.parseBackgroundAttributes=function(t,e){var i,n=void 0,s=void 0;return((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47)&&(n={},16===t||24===t?(s=Math.floor((e-32)/2),n.background=ce[s],e%2==1&&(n.background=n.background+"_semi")):45===e?n.background="transparent":(n.foreground="black",47===e&&(n.underline=!0)),i=t<24?1:2,this.channels[i-1].setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,!0)},t.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},t.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},t}();var Ae=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.timelineController=e,this.trackName=i,this.startTime=null,this.endTime=null,this.screen=null}return t.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},t.prototype.newCue=function(t,e,i){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},t}(),ye=function(t,e,i){return t.substr(i||0,e.length)===e},be=function(t){for(var e=5381,i=t.length;i;)e=33*e^t.charCodeAt(--i);return(e>>>0).toString()},Se={parse:function(t,e,i,n,s,a){var r=Object(At.b)(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),l="00:00.000",d=0,u=0,c=0,h=[],p=void 0,g=!0,f=new te;f.oncue=function(t){var e=i[n],s=i.ccOffset;e&&e.new&&(void 0!==u?s=i.ccOffset=e.start:function(t,e,i){var n=t[e],s=t[n.prevCC];if(!s||!s.new&&n.new)return t.ccOffset=t.presentationOffset=n.start,void(n.new=!1);for(;s&&s.new;)t.ccOffset+=n.start-s.start,n.new=!1,s=t[(n=s).prevCC];t.presentationOffset=i}(i,n,c)),c&&(s=c+i.ccOffset-i.presentationOffset),t.startTime+=s-u,t.endTime+=s-u,t.id=be(t.startTime.toString())+be(t.endTime.toString())+be(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),t.endTime>0&&h.push(t)},f.onparsingerror=function(t){p=t},f.onflush=function(){p&&a?a(p):s(h)},r.forEach(function(t){if(g){if(ye(t,"X-TIMESTAMP-MAP=")){g=!1,t.substr(16).split(",").forEach(function(t){ye(t,"LOCAL:")?l=t.substr(6):ye(t,"MPEGTS:")&&(d=parseInt(t.substr(7)))});try{d-=e=e<0?e+8589934592:e,i=l,n=parseInt(i.substr(-3)),s=parseInt(i.substr(-6,2)),a=parseInt(i.substr(-9,2)),r=i.length>9?parseInt(i.substr(0,i.indexOf(":"))):0,u=(Object(o.a)(n)&&Object(o.a)(s)&&Object(o.a)(a)&&Object(o.a)(r)?(n+=1e3*s,n+=6e4*a,n+=36e5*r):-1)/1e3,c=d/9e4,-1===u&&(p=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){p=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(g=!1)}var i,n,s,a,r;f.parse(t+"\n")}),f.flush()}};var Te=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHING,l.a.MEDIA_DETACHING,l.a.FRAG_PARSING_USERDATA,l.a.FRAG_DECRYPTED,l.a.MANIFEST_LOADING,l.a.MANIFEST_LOADED,l.a.FRAG_LOADED,l.a.LEVEL_SWITCHING,l.a.INIT_PTS_FOUND));if(n.hls=i,n.config=i.config,n.enabled=!0,n.Cues=i.config.cueHandler,n.textTracks=[],n.tracks=[],n.unparsedVttFrags=[],n.initPTS=void 0,n.cueRanges=[],n.captionsTracks={},n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode}},n.config.enableCEA708Captions){var s=new Ae(n,"textTrack1"),a=new Ae(n,"textTrack2");n.cea608Parser=new Ee(0,s,a)}return n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.addCues=function(t,e,i,n){for(var s,a,r,o,l=this.cueRanges,d=!1,u=l.length;u--;){var c=l[u],h=(s=c[0],a=c[1],r=e,o=i,Math.min(a,o)-Math.max(s,r));if(h>=0&&(c[0]=Math.min(c[0],e),c[1]=Math.max(c[1],i),d=!0,h/(i-e)>.5))return}d||l.push([e,i]),this.Cues.newCue(this.captionsTracks[t],e,i,n)},e.prototype.onInitPtsFound=function(t){var e=this;void 0===this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){e.onFragLoaded(t)}),this.unparsedVttFrags=[])},e.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var n=e.textTracks[i];if(n[t])return n}return null},e.prototype.createCaptionsTrack=function(t){var e=this.captionsProperties[t],i=e.label,n=e.languageCode,s=this.captionsTracks;if(!s[t]){var a=this.getExistingTrack(t);if(a)s[t]=a,bt(s[t]),yt(s[t],this.media);else{var r=this.createTextTrack("captions",i,n);r&&(r[t]=!0,s[t]=r)}}},e.prototype.createTextTrack=function(t,e,i){var n=this.media;if(n)return n.addTextTrack(t,e,i)},e.prototype.destroy=function(){h.prototype.destroy.call(this)},e.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},e.prototype.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){bt(t[e]),delete t[e]})},e.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},e.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var i=0;i<e.length;i++)bt(e[i])}},e.prototype.onManifestLoaded=function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=t.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,n){var s=void 0;if(n<i.length){var a=i[n];(function(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)})(a,t)&&(s=a)}s||(s=e.createTextTrack("subtitles",t.name,t.lang)),t.default?s.mode=e.hls.subtitleDisplay?"showing":"hidden":s.mode="disabled",e.textTracks.push(s)})}},e.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},e.prototype.onFragLoaded=function(t){var e=t.frag,i=t.payload;if("main"===e.type){var n=e.sn;if(n!==this.lastSn+1){var s=this.cea608Parser;s&&s.reset()}this.lastSn=n}else if("subtitle"===e.type)if(i.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);var a=e.decryptdata;null!=a&&null!=a.key&&"AES-128"===a.method||this._parseVTTs(e,i)}else this.hls.trigger(l.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},e.prototype._parseVTTs=function(t,e){var i=this.vttCCs;i[t.cc]||(i[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var n=this.textTracks,s=this.hls;Se.parse(e,this.initPTS,i,t.cc,function(e){var i=n[t.trackId];"disabled"!==i.mode?(e.forEach(function(t){if(!i.cues.getCueById(t.id))try{i.addCue(t)}catch(n){var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,i.addCue(e)}}),s.trigger(l.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})):s.trigger(l.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},function(e){d.b.log("Failed to parse VTT cue: "+e),s.trigger(l.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},e.prototype.onFragDecrypted=function(t){var e=t.payload,i=t.frag;if("subtitle"===i.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);this._parseVTTs(i,e)}},e.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var i=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,i)}},e.prototype.extractCea608Data=function(t){for(var e=31&t[0],i=2,n=void 0,s=void 0,a=void 0,r=[],o=0;o<e;o++)n=t[i++],s=127&t[i++],a=127&t[i++],0===s&&0===a||0!=(4&n)&&0===(3&n)&&(r.push(s),r.push(a));return r},e}(h),Ce=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function Ie(t){for(var e=[],i=0;i<t.length;i++)"subtitles"===t[i].kind&&e.push(t[i]);return e}var De=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHED,l.a.MEDIA_DETACHING,l.a.MANIFEST_LOADING,l.a.MANIFEST_LOADED,l.a.SUBTITLE_TRACK_LOADED));return n.tracks=[],n.trackId=-1,n.media=null,n.subtitleDisplay=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=Ie(this.media.textTracks),i=0;i<e.length;i++)if("hidden"===e[i].mode)t=i;else if("showing"===e[i].mode){t=i;break}this.subtitleTrack=t}},e.prototype.destroy=function(){h.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},e.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},e.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},e.prototype.onManifestLoaded=function(t){var e=this,i=t.subtitles||[];this.tracks=i,this.trackId=-1,this.hls.trigger(l.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},e.prototype.onTick=function(){var t=this.trackId,e=this.tracks[t];if(e){var i=e.details;i&&!i.live||(d.b.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(l.a.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))}},e.prototype.onSubtitleTrackLoaded=function(t){var e=this;t.id<this.tracks.length&&(d.b.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&this._stopTimer())},e.prototype.setSubtitleTrackInternal=function(t){var e=this.hls,i=this.tracks;if(!("number"!=typeof t||t<-1||t>=i.length)&&(this._stopTimer(),this.trackId=t,d.b.log("switching to subtitle track "+t),e.trigger(l.a.SUBTITLE_TRACK_SWITCH,{id:t}),-1!==t)){var n=i[t],s=n.details;s&&!s.live||(d.b.log("(re)loading playlist for subtitle track "+t),e.trigger(l.a.SUBTITLE_TRACK_LOADING,{url:n.url,id:t}))}},e.prototype._stopTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},e.prototype._toggleTrackModes=function(t){var e=this.media,i=this.subtitleDisplay,n=this.trackId;if(e){var s=Ie(e.textTracks);if(-1===t)[].slice.call(s).forEach(function(t){t.mode="disabled"});else{var a=s[n];a&&(a.mode="disabled")}var r=s[t];r&&(r.mode=i?"showing":"hidden")}},Ce(e,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this.setSubtitleTrackInternal(t))}}]),e}(h),Re=i(8);var Pe=window.performance,we={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},ke=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHED,l.a.ERROR,l.a.KEY_LOADED,l.a.FRAG_LOADED,l.a.SUBTITLE_TRACKS_UPDATED,l.a.SUBTITLE_TRACK_SWITCH,l.a.SUBTITLE_TRACK_LOADED,l.a.SUBTITLE_FRAG_PROCESSED));return n.config=i.config,n.vttFragSNsProcessed={},n.vttFragQueues=void 0,n.currentlyProcessing=null,n.state=we.STOPPED,n.currentTrackId=-1,n.decrypter=new Re.a(i.observer,i.config),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onHandlerDestroyed=function(){this.state=we.STOPPED},e.prototype.clearVttFragQueues=function(){var t=this;this.vttFragQueues={},this.tracks.forEach(function(e){t.vttFragQueues[e.id]=[]})},e.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=t,this.hls.trigger(l.a.FRAG_LOADING,{frag:t}),this.state=we.FRAG_LOADING}},e.prototype.onSubtitleFragProcessed=function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.state=we.IDLE,this.nextFrag()},e.prototype.onMediaAttached=function(){this.state=we.IDLE},e.prototype.onError=function(t){var e=t.frag;e&&"subtitle"!==e.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},e.prototype.doTick=function(){var t=this;switch(this.state){case we.IDLE:var e,i=this.tracks,n=this.currentTrackId,s=this.vttFragSNsProcessed[n],a=this.vttFragQueues[n],r=this.currentlyProcessing?this.currentlyProcessing.sn:-1;if(!i)break;if(n<i.length&&(e=i[n].details),void 0===e)break;e.fragments.forEach(function(e){(function(t){return s.indexOf(t.sn)>-1})(e)||e.sn===r||function(t){return a.some(function(e){return e.sn===t.sn})}(e)||(e.encrypted?(d.b.log("Loading key for "+e.sn),t.state=we.KEY_LOADING,t.hls.trigger(l.a.KEY_LOADING,{frag:e})):(e.trackId=n,a.push(e),t.nextFrag()))})}},e.prototype.onSubtitleTracksUpdated=function(t){var e=this;d.b.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){e.vttFragSNsProcessed[t.id]=[]})},e.prototype.onSubtitleTrackSwitch=function(t){if(this.currentTrackId=t.id,this.tracks&&-1!==this.currentTrackId){var e=this.tracks[this.currentTrackId];e&&e.details&&this.tick()}},e.prototype.onSubtitleTrackLoaded=function(){this.tick()},e.prototype.onKeyLoaded=function(){this.state===we.KEY_LOADING&&(this.state=we.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag.decryptdata,n=t.frag,s=this.hls;if(this.state===we.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&t.payload.byteLength>0&&null!=i&&null!=i.key&&"AES-128"===i.method){var a=void 0;try{a=Pe.now()}catch(t){a=Date.now()}this.decrypter.decrypt(t.payload,i.key.buffer,i.iv.buffer,function(t){var e=void 0;try{e=Pe.now()}catch(t){e=Date.now()}s.trigger(l.a.FRAG_DECRYPTED,{frag:n,payload:t,stats:{tstart:a,tdecrypt:e}})})}},e}(dt),Me=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var Oe=window.XMLHttpRequest,Le="com.widevine.alpha",Ne="com.microsoft.playready",Ue=function(t){function e(i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,l.a.MEDIA_ATTACHED,l.a.MANIFEST_PARSED));return n._widevineLicenseUrl=i.config.widevineLicenseUrl,n._licenseXhrSetup=i.config.licenseXhrSetup,n._emeEnabled=i.config.emeEnabled,n._requestMediaKeySystemAccess=i.config.requestMediaKeySystemAccessFunc,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._isMediaEncrypted=!1,n._requestLicenseFailureCount=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getLicenseServerUrl=function(t){var e=void 0;switch(t){case Le:e=this._widevineLicenseUrl;break;default:e=null}return e||(d.b.error('No license server URL configured for key-system "'+t+'"'),this.hls.trigger(l.a.ERROR,{type:r.b.KEY_SYSTEM_ERROR,details:r.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),e},e.prototype._attemptKeySystemAccess=function(t,e,i){var n=this,s=function(t,e,i){switch(t){case Le:return function(t,e,i){var n={videoCapabilities:[]};return e.forEach(function(t){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"'})}),[n]}(0,i);default:throw Error("Unknown key-system: "+t)}}(t,0,i);s?(d.b.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(t,s).then(function(e){n._onMediaKeySystemAccessObtained(t,e)}).catch(function(e){d.b.error('Failed to obtain key-system "'+t+'" access:',e)})):d.b.warn("Can not create config for key-system (maybe because platform is not supported):",t)},e.prototype._onMediaKeySystemAccessObtained=function(t,e){var i=this;d.b.log('Access for key-system "'+t+'" obtained');var n={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(n),e.createMediaKeys().then(function(e){n.mediaKeys=e,d.b.log('Media-keys created for key-system "'+t+'"'),i._onMediaKeysCreated()}).catch(function(t){d.b.error("Failed to create media-keys:",t)})},e.prototype._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},e.prototype._onNewMediaKeySession=function(t){var e=this;d.b.log("New key-system session "+t.sessionId),t.addEventListener("message",function(i){e._onKeySessionMessage(t,i.message)},!1)},e.prototype._onKeySessionMessage=function(t,e){d.b.log("Got EME message event, creating license request"),this._requestLicense(e,function(e){d.b.log("Received license data, updating key-session"),t.update(e)})},e.prototype._onMediaEncrypted=function(t,e){d.b.log('Media is encrypted using "'+t+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=t,this._mediaEncryptionInitData=e,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},e.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return d.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(l.a.ERROR,{type:r.b.KEY_SYSTEM_ERROR,details:r.a.KEY_SYSTEM_NO_KEYS,fatal:!0});d.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},e.prototype._generateRequestWithPreferredKeySession=function(){var t=this,e=this._mediaKeysList[0];if(!e)return d.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(l.a.ERROR,{type:r.b.KEY_SYSTEM_ERROR,details:r.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)d.b.warn("Key-Session already initialized but requested again");else{var i=e.mediaKeysSession;i||(d.b.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(l.a.ERROR,{type:r.b.KEY_SYSTEM_ERROR,details:r.a.KEY_SYSTEM_NO_SESSION,fatal:!0}));var n=this._mediaEncryptionInitDataType,s=this._mediaEncryptionInitData;d.b.log('Generating key-session request for "'+n+'" init data type'),e.mediaKeysSessionInitialized=!0,i.generateRequest(n,s).then(function(){d.b.debug("Key-session generation succeeded")}).catch(function(e){d.b.error("Error generating key-session request:",e),t.hls.trigger(l.a.ERROR,{type:r.b.KEY_SYSTEM_ERROR,details:r.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},e.prototype._createLicenseXhr=function(t,e,i){var n=new Oe,s=this._licenseXhrSetup;try{if(s)try{s(n,t)}catch(e){n.open("POST",t,!0),s(n,t)}n.readyState||n.open("POST",t,!0)}catch(t){return d.b.error("Error setting up key-system license XHR",t),void this.hls.trigger(l.a.ERROR,{type:r.b.KEY_SYSTEM_ERROR,details:r.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,t,e,i),n},e.prototype._onLicenseRequestReadyStageChange=function(t,e,i,n){switch(t.readyState){case 4:if(200===t.status)this._requestLicenseFailureCount=0,d.b.log("License request succeeded"),n(t.response);else{if(d.b.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=3){var s=3-this._requestLicenseFailureCount+1;return d.b.warn("Retrying license request, "+s+" attempts left"),void this._requestLicense(i,n)}this.hls.trigger(l.a.ERROR,{type:r.b.KEY_SYSTEM_ERROR,details:r.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},e.prototype._generateLicenseRequestChallenge=function(t,e){var i=void 0;return t.mediaKeySystemDomain===Ne?d.b.error("PlayReady is not supported (yet)"):t.mediaKeySystemDomain===Le?i=e:d.b.error("Unsupported key-system:",t.mediaKeySystemDomain),i},e.prototype._requestLicense=function(t,e){d.b.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return d.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(l.a.ERROR,{type:r.b.KEY_SYSTEM_ERROR,details:r.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});var n=this.getLicenseServerUrl(i.mediaKeySystemDomain),s=this._createLicenseXhr(n,t,e);d.b.log("Sending license request to URL: "+n),s.send(this._generateLicenseRequestChallenge(i,t))},e.prototype.onMediaAttached=function(t){var e=this;if(this._emeEnabled){var i=t.media;this._media=i,i.addEventListener("encrypted",function(t){e._onMediaEncrypted(t.initDataType,t.initData)})}},e.prototype.onManifestParsed=function(t){if(this._emeEnabled){var e=t.levels.map(function(t){return t.audioCodec}),i=t.levels.map(function(t){return t.videoCodec});this._attemptKeySystemAccess(Le,e,i)}},Me(e,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}(h),Be={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:jt,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Rt,bufferController:wt,capLevelController:Mt,fpsController:Lt,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null};Be.subtitleStreamController=ke,Be.subtitleTrackController=De,Be.timelineController=Te,Be.cueHandler=n,Be.enableCEA708Captions=!0,Be.enableWebVTT=!0,Be.captionsTextTrack1Label="English",Be.captionsTextTrack1LanguageCode="en",Be.captionsTextTrack2Label="Spanish",Be.captionsTextTrack2LanguageCode="es",Be.audioStreamController=$t,Be.audioTrackController=Ft,Be.emeController=Ue;var je=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();i(14);var xe=function(){function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=t.DefaultConfig;if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var s in n)s in i||(i[s]=n[s]);if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(d.a)(i.debug),this.config=i,this._autoLevelCapping=-1;var a=this.observer=new K.a;a.trigger=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];a.emit.apply(a,[t,t].concat(i))},a.off=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];a.removeListener.apply(a,[t].concat(i))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.once=a.once.bind(a),this.trigger=a.trigger.bind(a);var r=this.abrController=new i.abrController(this),o=new i.bufferController(this),l=new i.capLevelController(this),u=new i.fpsController(this),c=new U(this),h=new B(this),p=new j(this),g=new St(this),f=this.levelController=new Et(this),v=new H(this),m=[f,this.streamController=new ft(this,v)],_=i.audioStreamController;_&&m.push(new _(this,v)),this.networkControllers=m;var E=[c,h,p,r,o,l,u,g,v];if(_=i.audioTrackController){var A=new _(this);this.audioTrackController=A,E.push(A)}if(_=i.subtitleTrackController){var y=new _(this);this.subtitleTrackController=y,E.push(y)}if(_=i.emeController){var b=new _(this);this.emeController=b,E.push(b)}[i.subtitleStreamController,i.timelineController].forEach(function(t){t&&E.push(new t(e))}),this.coreComponents=E}return t.isSupported=function(){return t=Q(),e=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,!!i&&!!n;var t,e,i,n},je(t,null,[{key:"version",get:function(){return"0.11.0"}},{key:"Events",get:function(){return l.a}},{key:"ErrorTypes",get:function(){return r.b}},{key:"ErrorDetails",get:function(){return r.a}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:Be},set:function(e){t.defaultConfig=e}}]),t.prototype.destroy=function(){d.b.log("destroy"),this.trigger(l.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},t.prototype.attachMedia=function(t){d.b.log("attachMedia"),this.media=t,this.trigger(l.a.MEDIA_ATTACHING,{media:t})},t.prototype.detachMedia=function(){d.b.log("detachMedia"),this.trigger(l.a.MEDIA_DETACHING),this.media=null},t.prototype.loadSource=function(t){t=a.a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),d.b.log("loadSource:"+t),this.url=t,this.trigger(l.a.MANIFEST_LOADING,{url:t})},t.prototype.startLoad=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;d.b.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},t.prototype.stopLoad=function(){d.b.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},t.prototype.swapAudioCodec=function(){d.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.prototype.recoverMediaError=function(){d.b.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},je(t,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){d.b.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){d.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){d.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){d.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){d.b.log("set startLevel:"+t);-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){d.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this.levels,e=this.config.minAutoBitrate,i=t?t.length:0,n=0;n<i;n++){if((t[n].realBitrate?Math.max(t[n].realBitrate,t[n].bitrate):t[n].bitrate)>e)return n}return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}}]),t}();e.default=xe},function(t,e,i){function n(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var n=i(i.s=ENTRY_MODULE);return n.default||n}var s="[\\.|\\-|\\+|\\w|/|@]+",a="\\((/\\*.*?\\*/)?s?.*?("+s+").*?\\)";function r(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t,e,n){var o={};o[n]=[];var l=e.toString(),d=l.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return o;for(var u,c=d[1],h=new RegExp("(\\\\n|\\W)"+r(c)+a,"g");u=h.exec(l);)"dll-reference"!==u[3]&&o[n].push(u[3]);for(h=new RegExp("\\("+r(c)+'\\("(dll-reference\\s('+s+'))"\\)\\)'+a,"g");u=h.exec(l);)t[u[2]]||(o[n].push(u[1]),t[u[2]]=i(u[1]).m),o[u[2]]=o[u[2]]||[],o[u[2]].push(u[4]);return o}function l(t){return Object.keys(t).reduce(function(e,i){return e||t[i].length>0},!1)}t.exports=function(t,e){e=e||{};var s={main:i.m},a=e.all?{main:Object.keys(s)}:function(t,e){for(var i={main:[e]},n={main:[]},s={main:{}};l(i);)for(var a=Object.keys(i),r=0;r<a.length;r++){var d=a[r],u=i[d].pop();if(s[d]=s[d]||{},!s[d][u]&&t[d][u]){s[d][u]=!0,n[d]=n[d]||[],n[d].push(u);for(var c=o(t,t[d][u],d),h=Object.keys(c),p=0;p<h.length;p++)i[h[p]]=i[h[p]]||[],i[h[p]]=i[h[p]].concat(c[h[p]])}}return n}(s,t),r="";Object.keys(a).filter(function(t){return"main"!==t}).forEach(function(t){for(var e=0;a[t][e];)e++;a[t].push(e),s[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+t+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map(function(e){return JSON.stringify(e)+": "+s[t][e].toString()}).join(",")+"});\n"}),r=r+"("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map(function(t){return JSON.stringify(t)+": "+s.main[t].toString()}).join(",")+"})(self);";var d=new window.Blob([r],{type:"text/javascript"});if(e.bare)return d;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),c=new window.Worker(u);return c.objectURL=u,c}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(1),a=i(0),r=i(7),o=i.n(r);e.default=function(t){var e=new o.a;e.trigger=function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];e.emit.apply(e,[t,t].concat(n))},e.off=function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];e.removeListener.apply(e,[t].concat(n))};var i=function(e,i){t.postMessage({event:e,data:i})};t.addEventListener("message",function(s){var r=s.data;switch(r.cmd){case"init":var o=JSON.parse(r.config);t.demuxer=new n.a(e,r.typeSupported,o,r.vendor);try{Object(a.a)(!0===o.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}i("init",null);break;case"demux":t.demuxer.push(r.data,r.decryptdata,r.initSegment,r.audioCodec,r.videoCodec,r.timeOffset,r.discontinuity,r.trackSwitch,r.contiguous,r.duration,r.accurateTimeOffset,r.defaultInitPTS)}}),e.on(s.a.FRAG_DECRYPTED,i),e.on(s.a.FRAG_PARSING_INIT_SEGMENT,i),e.on(s.a.FRAG_PARSED,i),e.on(s.a.ERROR,i),e.on(s.a.FRAG_PARSING_METADATA,i),e.on(s.a.FRAG_PARSING_USERDATA,i),e.on(s.a.INIT_PTS_FOUND,i),e.on(s.a.FRAG_PARSING_DATA,function(e,i){var n=[],s={event:e,data:i};i.data1&&(s.data1=i.data1.buffer,n.push(i.data1.buffer),delete i.data1),i.data2&&(s.data2=i.data2.buffer,n.push(i.data2.buffer),delete i.data2),t.postMessage(s,n)})}},function(t,e){String.prototype.endsWith||function(){"use strict";var t=function(){try{var t={},e=Object.defineProperty,i=e(t,t,t)&&e}catch(t){}return i}(),e={}.toString,i=function(t){if(null==this)throw TypeError();var i=String(this);if(t&&"[object RegExp]"==e.call(t))throw TypeError();var n=i.length,s=String(t),a=s.length,r=n;if(arguments.length>1){var o=arguments[1];void 0!==o&&(r=o?Number(o):0)!=r&&(r=0)}var l=Math.min(Math.max(r,0),n)-a;if(l<0)return!1;for(var d=-1;++d<a;)if(i.charCodeAt(l+d)!=s.charCodeAt(d))return!1;return!0};t?t(String.prototype,"endsWith",{value:i,configurable:!0,writable:!0}):String.prototype.endsWith=i}()}]).default},"object"==typeof exports&&"object"==typeof module?module.exports=n():"object"==typeof exports?exports.Hls=n():e.Hls=n()),function(e){"use strict";var i,n,s,a,r;e?function(){var t=e.crypto||e.msCrypto;if(!i&&t&&t.getRandomValues)try{var s=new Uint8Array(16);a=i=function(){return t.getRandomValues(s),s},i()}catch(t){}if(!i){var r=new Array(16);n=i=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}():function(){if("function"==typeof t)try{var e=t("crypto").randomBytes;s=i=e&&function(){return e(16)},i()}catch(t){}}();for(var o="function"==typeof Buffer?Buffer:Array,l=[],d={},u=0;u<256;u++)l[u]=(u+256).toString(16).substr(1),d[l[u]]=u;function c(t,e){var i=e||0,n=l;return n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]}var h=i(),p=[1|h[0],h[1],h[2],h[3],h[4],h[5]],g=16383&(h[6]<<8|h[7]),f=0,v=0;function m(t,e,n){var s=e&&n||0;"string"==typeof t&&(e="binary"===t?new o(16):null,t=null);var a=(t=t||{}).random||(t.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var r=0;r<16;r++)e[s+r]=a[r];return e||c(a)}var _=m;_.v1=function(t,e,i){var n=e&&i||0,s=e||[],a=null!=(t=t||{}).clockseq?t.clockseq:g,r=null!=t.msecs?t.msecs:(new Date).getTime(),o=null!=t.nsecs?t.nsecs:v+1,l=r-f+(o-v)/1e4;if(l<0&&null==t.clockseq&&(a=a+1&16383),(l<0||r>f)&&null==t.nsecs&&(o=0),o>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=r,v=o,g=a;var d=(1e4*(268435455&(r+=122192928e5))+o)%4294967296;s[n++]=d>>>24&255,s[n++]=d>>>16&255,s[n++]=d>>>8&255,s[n++]=255&d;var u=r/4294967296*1e4&268435455;s[n++]=u>>>8&255,s[n++]=255&u,s[n++]=u>>>24&15|16,s[n++]=u>>>16&255,s[n++]=a>>>8|128,s[n++]=255&a;for(var h=t.node||p,m=0;m<6;m++)s[n+m]=h[m];return e||c(s)},_.v4=m,_.parse=function(t,e,i){var n=e&&i||0,s=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){s<16&&(e[n+s++]=d[t])});s<16;)e[n+s++]=0;return e},_.unparse=c,_.BufferClass=o,_._rng=i,_._mathRNG=n,_._nodeRNG=s,_._whatwgRNG=a,"undefined"!=typeof module&&module.exports?module.exports=_:(r=e.uuid,_.noConflict=function(){return e.uuid=r,_},e.uuid=_)}("undefined"!=typeof window?window:null),function(){var t,e,i=document.attachEvent,n=!1;if(!i){var s=(e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)},function(t){return e(t)}),a=(t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout,function(e){return t(e)});function r(t){var e=t.__resizeTriggers__,i=e.firstElementChild,n=e.lastElementChild,s=i.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,s.style.width=i.offsetWidth+1+"px",s.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function o(t){var e=this;r(this),this.__resizeRAF__&&a(this.__resizeRAF__),this.__resizeRAF__=s(function(){(function(t){return t.offsetWidth!=t.__resizeLast__.width||t.offsetHeight!=t.__resizeLast__.height})(e)&&(e.__resizeLast__.width=e.offsetWidth,e.__resizeLast__.height=e.offsetHeight,e.__resizeListeners__.forEach(function(i){i.call(e,t)}))})}var l=!1,d="",u="animationstart",c="Webkit Moz O ms".split(" "),h="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),p="",g=document.createElement("fakeelement");if(void 0!==g.style.animationName&&(l=!0),!1===l)for(var f=0;f<c.length;f++)if(void 0!==g.style[c[f]+"AnimationName"]){(p=c[f])+"Animation",d="-"+p.toLowerCase()+"-",u=h[f],l=!0;break}var v="resizeanim",m="@"+d+"keyframes "+v+" { from { opacity: 0; } to { opacity: 0; } } ",_=d+"animation: 1ms "+v+"; "}window.addResizeListener=function(t,e){i?t.attachEvent("onresize",e):(t.__resizeTriggers__||("static"==getComputedStyle(t).position&&(t.style.position="relative"),function(){if(!n){var t=(m||"")+".resize-triggers { "+(_||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i),n=!0}}(),t.__resizeLast__={},t.__resizeListeners__=[],(t.__resizeTriggers__=document.createElement("div")).className="resize-triggers",t.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',t.appendChild(t.__resizeTriggers__),r(t),t.addEventListener("scroll",o,!0),u&&t.__resizeTriggers__.addEventListener(u,function(e){e.animationName==v&&r(t)})),t.__resizeListeners__.push(e))},window.removeResizeListener=function(t,e){i?t.detachEvent("onresize",e):(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||(t.removeEventListener("scroll",o),t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__)))}}(),s=this,a=function(){"use strict";function t(t,e){var i,n=document.createElement(t||"div");for(i in e)n[i]=e[i];return n}function e(t){for(var e=1,i=arguments.length;i>e;e++)t.appendChild(arguments[e]);return t}function i(t,e,i,n){var s=["opacity",e,~~(100*t),i,n].join("-"),a=.01+i/n*100,r=Math.max(1-(1-t)/e*(100-a),t),o=l.substring(0,l.indexOf("Animation")).toLowerCase(),u=o&&"-"+o+"-"||"";return c[s]||(d.insertRule("@"+u+"keyframes "+s+"{0%{opacity:"+r+"}"+a+"%{opacity:"+t+"}"+(a+.01)+"%{opacity:1}"+(a+e)%100+"%{opacity:"+t+"}100%{opacity:"+r+"}}",d.cssRules.length),c[s]=1),s}function n(t,e){var i,n,s=t.style;if(void 0!==s[e=e.charAt(0).toUpperCase()+e.slice(1)])return e;for(n=0;n<u.length;n++)if(void 0!==s[i=u[n]+e])return i}function s(t,e){for(var i in e)t.style[n(t,i)||i]=e[i];return t}function a(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)void 0===t[n]&&(t[n]=i[n])}return t}function r(t,e){return"string"==typeof t?t:t[e%t.length]}function o(t){this.opts=a(t||{},o.defaults,h)}var l,d,u=["webkit","Moz","ms","O"],c={},h={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(o.defaults={},a(o.prototype,{spin:function(e){this.stop();var i=this,n=i.opts,a=i.el=t(null,{className:n.className});if(s(a,{position:n.position,width:0,zIndex:n.zIndex,left:n.left,top:n.top}),e&&e.insertBefore(a,e.firstChild||null),a.setAttribute("role","progressbar"),i.lines(a,i.opts),!l){var r,o=0,d=(n.lines-1)*(1-n.direction)/2,u=n.fps,c=u/n.speed,h=(1-n.opacity)/(c*n.trail/100),p=c/n.lines;!function t(){o++;for(var e=0;e<n.lines;e++)r=Math.max(1-(o+(n.lines-e)*p)%c*h,n.opacity),i.opacity(a,e*n.direction+d,r,n);i.timeout=i.el&&setTimeout(t,~~(1e3/u))}()}return i},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(n,a){function o(e,i){return s(t(),{position:"absolute",width:a.scale*(a.length+a.width)+"px",height:a.scale*a.width+"px",background:e,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*u+a.rotate)+"deg) translate("+a.scale*a.radius+"px,0)",borderRadius:(a.corners*a.scale*a.width>>1)+"px"})}for(var d,u=0,c=(a.lines-1)*(1-a.direction)/2;u<a.lines;u++)d=s(t(),{position:"absolute",top:1+~(a.scale*a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:l&&i(a.opacity,a.trail,c+u*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&e(d,s(o("#000","0 0 4px #000"),{top:"2px"})),e(n,e(d,o(r(a.color,u),"0 0 1px rgba(0,0,0,.1)")));return n},opacity:function(t,e,i){e<t.childNodes.length&&(t.childNodes[e].style.opacity=i)}}),"undefined"!=typeof document){d=function(){var i=t("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}();var p=s(t("group"),{behavior:"url(#default#VML)"});!n(p,"transform")&&p.adj?function(){function i(e,i){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}d.addRule(".spin-vml","behavior:url(#default#VML)"),o.prototype.lines=function(t,n){function a(){return s(i("group",{coordsize:u+" "+u,coordorigin:-d+" "+-d}),{width:u,height:u})}function o(t,o,l){e(h,e(s(a(),{rotation:360/n.lines*t+"deg",left:~~o}),e(s(i("roundrect",{arcsize:n.corners}),{width:d,height:n.scale*n.width,left:n.scale*n.radius,top:-n.scale*n.width>>1,filter:l}),i("fill",{color:r(n.color,t),opacity:n.opacity}),i("stroke",{opacity:0}))))}var l,d=n.scale*(n.length+n.width),u=2*n.scale*d,c=-(n.width+n.length)*n.scale*2+"px",h=s(a(),{position:"absolute",top:c,left:c});if(n.shadow)for(l=1;l<=n.lines;l++)o(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=n.lines;l++)o(l);return e(t,h)},o.prototype.opacity=function(t,e,i,n){var s=t.firstChild;n=n.shadow&&n.lines||0,s&&e+n<s.childNodes.length&&(s=(s=(s=s.childNodes[e+n])&&s.firstChild)&&s.firstChild)&&(s.opacity=i)}}():l=n(p,"animation")}return o},"object"==typeof module&&module.exports?module.exports=a():s.Spinner=a(),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam",SEGMENT:"Segment"},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(t){var e,i,n=t.split("."),s=window,a=n.length;for(e=0;e<a;e++)void 0===s[i=n[e]]&&(s[i]={}),s=s[i];return s},getClass:function(t){var e,i,n,s,a,r;if("string"!=typeof t)return t;for(e=t.split("."),i=window,n=e.length,s="",a=0;a<n;a++){if(s+=r=e[a],void 0===i[r])throw new Error("uvpjs.getClass(): "+s+" is undefined.");a<n-1&&(s+="."),i=i[r]}return i},getObject:function(t){return uvpjs.getClass(t)}},function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(i){var n,s,a,r,o=this.prototype;for(r in t=!0,s=new this,t=!1,n=function(t,e){return function(){var i,n=this._super;return this._super=o[t],i=e.apply(this,arguments),this._super=n,i}},i)i.hasOwnProperty(r)&&(a=i[r],s[r]="function"==typeof a&&"function"==typeof o[r]&&e.test(a)?n(r,a):a);function l(){!t&&this.init&&this.init.apply(this,arguments)}return l.prototype=s,l.prototype.constructor=l,l.subClass=arguments.callee,l}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),uvpjs.register("uvpjs").b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",function(t){"use strict";uvpjs.register("uvpjs").util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(t){return t&&this.xhrMessages[t]||"XHR status: "+t},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(t){var e=document.createElement("a");return e.href=t,{host:e.hostname,pathname:e.pathname,protocol:e.protocol,search:e.search}},objFromQueryStr:function(t){var e,i,n,s="string"==typeof t?t:"",a=(s.indexOf("?")>-1?s.split("?")[1]:s).split("&"),r={};for(i=0,n=a.length;i<n;i++)r[(e=a[i].split("="))[0]]=e[1];return r},queryStrFromObj:function(t,e){var i,n="",s=!1;for(i in t)n+=(s?"&":"")+i+"="+(e?encodeURIComponent(t[i]):t[i]),s=!0;return n},uid8:function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()},getUserStatusForQuery:function(t){var e="";switch(t){case"anon":e="sb=0";break;case"reg;sub;pay":e="sb=1";break;case"reg":e="sb=2";break;case"reg;sub;susp":e="sb=3";break;case"reg;sub;exsub":e="sb=4";break;case"reg;sub;trial":e="sb=5";break;default:if(t.indexOf("|")>-1){var i,n,s,a,r="",o=t.split(","),l=o.length;for(o.sort(),a=0;a<l;a++)2==(i=o[a].split("|")).length&&(n=i[0],s=i[1],r!=n?(e.length>0&&(e+="&"),e+=n+"="+s):e+=","+s,r=n)}}return""==e&&(e="sb=0"),e},firstInt:function(){var t,e,i=arguments.length;for(e=0;e<i;e++)if(t=arguments[e],parseInt(t)===t)return t},inRange:function(t,e,i){return"number"==typeof t&&t>=e&&t<=i},isEmpty:function(t){return null==t||Array.isArray(t)&&0===t.length||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&""===t},isPlainObject:function(t){return t&&"object"==typeof t&&t.constructor===Object},isFunction:function(t){return"function"==typeof t},isDefinedString:function(t){return!!(t&&"string"==typeof t&&t.length>0)},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isDefined:function(t){return void 0!==t},isFlagTrue:function(t){return!0===t||"true"===t||1===t||"1"===t},getDefinedString:function(){var t,e,i=arguments.length;for(e=0;e<i;e++)if(t=arguments[e],this.isDefinedString(t))return t;return""},supportsLocalStorage:function(){var t;if(null===this.isLocalStorageSupported)try{localStorage.setItem("test","1"),t=localStorage.getItem("test"),this.isLocalStorageSupported="1"===t,localStorage.removeItem("test")}catch(t){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},createStyleSheet:function(t,e){var i,n,s,a,r,o,l,d,u,c,h=document.styleSheets,p=h.length;for(u=function(){c||(t(r),c=!0)},i=0;i<p;i++){r=h[i];try{if((r.href&&r.href.replace(/http(s)?:/,""))===e)return void u()}catch(t){null}}n="string"==typeof e&&""!==e,s=uvpjs.mediaCapabilities.isFirefox(),a=!n||s?"style":"link",(r=document.createElement(a)).setAttribute("type","text/css"),r.appendChild(document.createTextNode("")),n&&(r.setAttribute("rel","stylesheet"),r.setAttribute("href",e),r.textContent='@import "'+e+'"'),"function"==typeof t&&(r.onload=u,r.addEventListener&&r.addEventListener("load",u,!1),r.onreadystatechange=function(){"loaded"!==(o=r.readyState)&&"complete"!==o||(link.onreadystatechange=null,u())},l=setInterval(function(){document.styleSheets.length>p&&(u(),clearInterval(l))},10),s&&(d=setInterval(function(){try{r.sheet.cssRules,clearInterval(d),u()}catch(t){}},10)),document.getElementsByTagName("head")[0].appendChild(r))},addCSSObject:function(t,e,i,n){var s,a=uvpjs.util,r="#"+e.id+" "+(n||"");for(s in i)a.addCSSRule(t,r,s,i[s])},addCSSRule:function(t,e,i,n){var s,a,r,o=uvpjs.mediaCapabilities,l="string"==typeof n&&n.match(/NaN(%|px)/);if(!(!t||!t.sheet))if(!l||o.isAndroid()&&o.isChrome()||(n="0"),a=((s=t.sheet).rules||s.cssRules).length,r=i+":"+n+";",s.insertRule)try{s.insertRule(e+"{"+r+"}",a)}catch(t){console.warn("Unable to add CSS rule: "+t.message)}else s.addRule&&s.addRule(e,r,a)},addCSSRules:function(t,e,i){for(var n,s=i.length;s--;)n=i[s],uvpjs.util.addCSSRule(t,e,n.name,n.value)},copyObjectWithKeyMap:function(t){var e=t,i=null;return this.from=function(t){return i=t,this},this.to=function(t){if(!(e&&i&&t))return t;for(var n in e)e.hasOwnProperty(n)&&i.hasOwnProperty(n)&&null!==i[n]&&(t[e[n]]=i[n]);return t},this}}}(),function(t){var e=uvpjs._,i={mediaRefId:/\{mediaReferenceId}/g,partner:/PARTNER/g,ptype:/\{ptype}/g,vguid:/\{VGUID}/g,ptypeAlt:/%7Bptype%7D/g,vguidAlt:/%7BVGUID%7D/g,session:/;/g};t.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(t,n,s,a){var r,o,l,d,u,c,h,p,g=uvpjs.util,f="cust_params",v=t.split("?"),m=v[1],_=t.indexOf("{ptype}")>-1,E=this.getAdParams(n,s,a);return(m=m.replace(i.mediaRefId,E.vid).replace(i.partner,E.partner)).indexOf("VGUID")>-1&&(m=m.replace(_?i.vguidAlt:i.vguid,E.vguid)),m=m.replace(_?i.ptypeAlt:i.ptype,E.ptype),o=g.objFromQueryStr(m),this.isExcludedFromVpaid(n)&&delete o.pp,(l=o[f])&&(r=g.objFromQueryStr(decodeURIComponent(l)),delete o[f]),d=E[f],delete E[f],delete E.partner,delete E.vguid,delete E.ptype,u=e.assign(E,o),c=e.assign(d,r||{}),decodeURIComponent(u.iu).indexOf("/8264/")>=0&&n.isMuteAtPlayStart&&!n.userHasUnmuted&&(u.sz="640x483"),this.removeEmpty(u),this.removeEmpty(c),h=g.queryStrFromObj(u,!1),p=g.queryStrFromObj(c,!1),h+="&"+f+"="+encodeURIComponent(p),v[0]+"?"+h},getAdParams:function(t,i,n){var s,a,r=t.dwPageParams,o=this.getDwViewGuid(t),l=this.getPpidValue(t),d=t.contentVideoState,u=encodeURIComponent(t.sessionOptions.partner),c=r.pagetype||"",h=this.getUserStatusKey(t.getSessionOption("userStatus")),p=""!==d.contPlayState&&!uvpjs.util.isFlagTrue(n)?"1":"0",g=t.getSessionOption("isEmbedded")?"1":"0",f=this.getHost("1"===g,t),v=d.pid,m={cust_params:{}},_=uvpjs.Configuration.env,E=t.getAdCallParams();for(a in s=i?this.getVideoDfpId(t):"",m.vid=s,m.partner=u,m.ptype=c,m.vguid=o,m.cust_params.vguid=o,m.cust_params.embed=g,f&&(m.cust_params.host=f),this.populateCustParamsWithAdSessionValues(m.cust_params,v),d.podsToSkip.length>0&&(m.cust_params.resume=1,m.cust_params.skippod=d.podsToSkip),h)m.cust_params[a]=h[a];if(l&&(m.ppid=l,m.cust_params.ppid=l),"cbs"===u&&(m.cust_params.cpSession=p,m.cust_params.cpPre=p,m.cust_params.sub=e.isEmpty(t.sessionOptions.userId)?"":t.sessionOptions.userId),E&&!uvpjs.util.isEmpty(E.standardParams))for(a in E.standardParams)m[a]=E.standardParams[a];if(E&&!uvpjs.util.isEmpty(E.customParams))for(a in E.customParams)m.cust_params[a]=E.customParams[a];return this.isExcludedFromVpaid(t)?m.pp="ssai":("local"===_||"dev"===_)&&(m.pp="vpaid_js"),m},getVideoDfpId:function(t){return uvpjs.util.isEmpty(t.contentVideoState.dfpMediaId)?t.contentVideoState.cmsRefGuid:t.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(t){return"AA Original"===t.contentVideoState.contentType},getDwViewGuid:function(t){var e=t.dwPageParams;return e&&e.viewguid||e.pguid||""},extractAdInfo:function(t,i){var n,s,a=i===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(t)||!i?(!i&&console.error("No 'context' arg supplied"),null):((n={adId:t.getAdId(),adSystem:t.getAdSystem(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId()}).adPodInfo=this.extractPodInfo(t.getAdPodInfo()),s=this[a](t),e.assign(n,s))},extractAdStateData:function(t,e){var i=t.getAdPodInfo(),n=i.getPodIndex(),s=i.getAdPosition(),a=t.getDuration(),r=0===n?"pre":n>=1?"mid":-1===n?"post":"",o=("mid"!==r?r+"_0":"mid_"+n)+"_"+s,l=e===this.context.IMA,d=l?this.extractIdInfo(t):null,u=this.getAdStateBlank();return u.adPosition=s,u.adBitrate=t.getVastMediaBitrate(),u.adServerName=l?this.context.IMA:this.context.DAI,u.adVideoTitle=t.getTitle(),u.duration=a,u.adType=r,u.adClipID=o,u.wrapperAdId=l&&d.wrapperAdId||"",u.adVideoId=l?d.wrapperAdId||d.adId:t.getAdId(),u.creativeId=l?d.wrapperCreativeId||d.creativeId:t.getCreativeId(),e===this.context.DAI&&(u.sourceWidth=t.getVastMediaWidth(),u.sourceHeight=t.getVastMediaHeight()),u},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(t){var e=t.getWrapperAdIds(),i=t.getWrapperCreativeIds(),n=Array.isArray(e)&&e.length||0,s=Array.isArray(i)&&i.length||0,a=null,r=null,o=t.getAdId()||"",l=t.getCreativeId()||"";return n&&(n>1&&(a=e[1]),o=e[0]),s&&(s>1&&(r=i[1]),l=i[0]),{adId:o,wrapperAdId:a,creativeId:l,wrapperCreativeId:r}},getHost:function(t,e){var i,n;return t?(i=e.getSessionOption("referrer"))&&(n=uvpjs.util.parseUrl(i).host):n=window.location.hostname,n&&""!==n?n:null},getUserStatusKey:function(t){for(var e,i=uvpjs.util.getUserStatusForQuery(t).split("&"),n=i.length,s={};n--;)s[(e=i[n].split("="))[0]]=e[1];return s},trackAd:function(t){var e,i,n,s=t.model,a=t.context,r=s.getAdVideoState(),o=a===this.context.IMA,l=a===this.context.DAI;if(o||l)return i=s.dwPageParams.pagetype||"",e={level1:"",level2:"",level3:r.adVideoId,level4:r.creativeId,slicer1:"vaw-can",slicer2:s.sessionOptions.partner,slicer3:i,moatVASTSystem:r.adServerName,moatVASTAdID:r.wrapperAdId},""!==(n=this.getDwViewGuid(s))&&(e.zMoatVGUID=n),""!==i&&(e.zMoatPT=i),this.initMoatTracking(t.adVideoContainer,e,r.duration,this.MOAT_PARTNER_CODE,null);console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(t){var e=this.getVpaidEventForEvent(t.eventName,t.context);e&&t.trackingHandle.dispatchEvent({type:e,adVolume:t.volume})},checkForAdBlocker:function(t){var e=t.getSessionOption("adBlockerCallback");return e&&e()},populateCustParamsWithAdSessionValues:function(t,e){var n,s,a;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(n=window.getVideoAdSessionValues(e))&&""!==n)for(a in n=n.replace(i.session,"&"),s=uvpjs.util.objFromQueryStr(n))t[a]=s[a]},removeEmpty:function(t){for(var e in t)(null===t[e]||""===t[e])&&delete t[e]},extractAdInfoIma:function(t){return{contentType:t.getContentType(),isLinear:t.isLinear()}},extractAdInfoDai:function(t){return{advertiserName:t.getAdvertiserName(),description:t.getDescription(),duration:t.getDuration(),title:t.getTitle()}},extractPodInfo:function(t){return t?{adPosition:t.getAdPosition(),podIndex:t.getPodIndex(),timeOffset:t.getTimeOffset(),totalAds:t.getTotalAds()}:null},getPpidValue:function(t){var e=t.getSessionOption("userPPID");return uvpjs.util.isDefinedString(e)?e:null},initMoatTracking:function(t,e,i,n,s){var a,r,o,l=document.createElement("script"),d=[];e={adData:{ids:e,duration:i,url:s},dispatchEvent:function(t){this.sendEvent?(d&&(d.push(t),t=d,d=!1),this.sendEvent(t)):d.push(t)}},o="_moatApi"+Math.floor(1e8*Math.random());try{r=(a=t.ownerDocument).defaultView||a.parentWindow}catch(t){r=window}return r[o]=e,l.type="text/javascript",t&&t.insertBefore(l,t.childNodes[0]||null),l.src="https://z.moatads.com/"+n+"/moatvideo.js#"+o,e},getVpaidEventForEvent:function(t,e){var i=this.moatEventMapping[e][t];return uvpjs.util.isEmpty(i)?null:this.vpaidEvents[i]}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.Configuration={env:"production",hostname:"vidtech.cbsinteractive.com",name:"UVPJS",version:"2.9.52",date:"11/13/18 1:00:28 PM (PST)",path:"//vidtech.cbsinteractive.com/uvpjs/2.9.52/",playerName:"CBSI-PLAYER"}}(uvpjs),uvpjs.register("uvpjs").AutoplayDetectionService=uvpjs.Class.subClass({init:function(t){this.mc=t.mediaCapabilities,this.completeCallback=t.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=t.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(t,e){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:t,supportsMutedAutoplay:e})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(t,e){this.killVid(),this.setInfo(t,e),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var t,e;this.vidEl=e=this.createVideoElement(!1),e.load(),void 0===(t=e.play())?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):t.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var t;this.killVid(),this.checkForEarlySafari()?this.finishCheck(!1,!1):(this.vidEl=t=this.createVideoElement(!0),t.load(),t.play().then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1)))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var t=this.mc.getBrowserName()===this.mc.SAFARI,e=this.mc.isDesktop(),i=t&&e?this.mc.getBrowserVersion():null,n=i&&i.split("."),s=n?11===parseInt(n[0])&&0===parseInt(n[1]):null;return null!==i&&s&&(!n[2]||parseInt(n[2])<3)},detectMobileCapabilities:function(){var t=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,t)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var t=this.mc.isIOSTen(),e=t&&this.mc.isSafari(),i=t&&!e&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return e||i},isChromeAutoplayEligible:function(){return parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(t){var e=document.createElement("video");return t&&(e.muted=!0,e.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(e,!0),e.volume=.005,e.style.width="100%",e.style.height="100%",e.src=this.testVidPath,this.testDom.appendChild(e),e},createTestDom:function(){var t=document.createElement("div"),e=t.style,i="-1000px";return e.position="absolute",e.top=i,e.left=i,e.width="320px",e.height="180px",document.body.appendChild(t),t}}),uvpjs.MediaCapabilities=function(){var t,e,i,n,s,a,r,o,l,d,u,c,h,p=uvpjs._,g=uuid.noConflict(),f=!1,v={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLACEHOLDER_MP4_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",MP4_BLANK_FILE:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(e,i){var a=this.systemInfo;return typeof e===this.STRING?(t=e,!0):(t=navigator.userAgent||null,!1),n=document.createElement(this.VIDEO),s=document.createElement(this.AUDIO),typeof i===this.BOOLEAN&&i,m(),y(),O(),f="https:"===location.protocol,a.browser=this.getBrowserName(),a.version=parseInt(this.getBrowserMajorVersion()),a.isMobile=this.isMobile(),a.isDesktop=this.isDesktop(),a.os=this.getOS()+"; ver. "+this.getOSVersion(),a.supportsMse=this.hasMediaSourceSupport(),a.isHlsjsEligible=this.canPlayHLSJS(),a.supportsNativeHls=this.canPlayNativeHLS(),a.supportsMp4=this.canPlayH264(),a.supportsDash=this.canPlayDASH(),this.canUseDataUrl()||(this.PLACEHOLDER_MP4_URL=this.MP4_BLANK_FILE),this},canUseDataUrl:function(){return!1},determineAutoplayCapabilities:function(t){var e;null===this.systemInfo.supportsUnmutedAutoplay?(e=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,t()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:e,testVidPath:this.PLACEHOLDER_MP4_URL})):t()},setTrackingInfo:function(t){var e,i,n=uvpjs.tracking,s={};for(i in n)e=n[i],s[i]=!!t[e];this.systemInfo.trackingAvailability=s},setAutoplayInfo:function(t){this.systemInfo.supportsUnmutedAutoplay=t.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=t.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return g.v1().replace(/-/g,"")},checkBrowserName:function(t){return typeof t===this.STRING&&this.getBrowserName()===t},canPlayHTML5Video:function(){var t=document.createElement(this.VIDEO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var t=document.createElement(this.AUDIO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},getBrowserName:function(){return u},getBrowserVersion:function(){return c},getBrowserMajorVersion:function(){return h},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(t,e){if(typeof e===this.OBJECT){var i=new RegExp(e).exec(this.getUserAgent()),n="",s="";if(typeof i===this.OBJECT&&i.length&&i.length>1){if((n=i[1]||"").indexOf(".")){var a=n.split(".");"object"==typeof a&&a.length&&a.length>0&&(s=a[0])}else s=n;return u=t,c=n,h=s,!0}}return!1},hasTealium:function(){return p.has(window,"utag")||p.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(t){return typeof t===this.STRING&&(this._detectEnvironment(t),!0)},getUserAgent:function(){return t},getMimeTypesObj:function(){return e||(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(e=navigator.mimeTypes),e)},getMimeTypes:function(){if(typeof i===this.OBJECT)return i;var t={length:0},e=this.getMimeTypesObj();if(typeof e===this.OBJECT){for(var n=0;n<this.length;n++){var s=e[n].enabledPlugin&&e[n].enabledPlugin.name?e[n].enabledPlugin.name:"";t[e[n].type]={type:e[n].type,description:e[n].description,suffixes:e[n].suffixes,enabledPlugin:e[n].enabledPlugin,enabledPluginName:s},t.length++}return i=t}},getPlatform:function(){return typeof r===this.STRING?r:null},getOS:function(){return typeof o===this.STRING?o:null},getOSVersion:function(){return typeof l===this.STRING?l:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof d===this.BOOLEAN?d:d=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return b()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var t=window.MediaSource||window.WebKitMediaSource,e=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;this.hasMse=!(!i||!n)}return this.hasMse},canPlayHLSJS:function(t){var e=this.isMobile(),i=!!b(),n=this.hasMediaSourceSupport(),s=this.isFirefox()||this.isChrome(),a=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),r=this.isOpera()&&this.getBrowserMajorVersion()>=30,o=this.isPlaystation();return!(!n||!i||e||o)&&(!!t||(s||a||r))},canPlayNativeHLSAudio:function(){return S()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return b()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return b()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return b()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(t,e){return b()&&this.canPlayMediaType(this.VIDEO,t,e||!1)},canPlayAudioType:function(t,e){return b()&&this.canPlayMediaType(this.AUDIO,t,e||!1)},canPlayMediaType:function(t,e,i){var n=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return i=1==i,!(typeof n!==this.OBJECT||typeof n.canPlayType!==this.FUNCTION||!(i&&n.canPlayType(e)===this.PROBABLY||!i&&""!==n.canPlayType(e)))},canPlayType:function(t,e){e=1==e;var i=/audio\//.test(t)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof i!==this.OBJECT||typeof i.canPlayType!==this.FUNCTION||!(e&&i.canPlayType(t)===this.PROBABLY||!e&&""!==i.canPlayType(t)))},nativeCanPlayType:function(t,e){var i=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof i===this.OBJECT&&typeof i.canPlayType===this.FUNCTION&&i.canPlayType(e)||null},canPlayDASHType:function(t){if(typeof t!==this.STRING||t.length<1)return null;var e=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(t)&&this.hasMSE()&&e.isTypeSupported(t)},canPlayDASH264:function(t){return t=typeof t===this.STRING?t:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(t)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var t=this.getUserAgent();return t&&!(this.isChromecast()||this.isIOS()||t.indexOf("Android 2.")>-1||t.indexOf("Android 4.0")>-1||t.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(t){return(!t||!this.supportsAutoplay())&&(!this.isChromecast()&&!this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(t){return t&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(t){return!t&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(t,e){var i=this.getInlinePlayAttribute(),n=i&&i.name;e&&i?i&&t.setAttribute(n,i.value):!e&&n&&t.removeAttribute(n)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return this.isIOS()?this.PLACEHOLDER_M3U8_URL:this.PLACEHOLDER_MP4_URL},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var t="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return t&&!t.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var t,e;return void 0===this._hasFullscreenApiSupport&&(t=document.createElement("div"),e=uvpjs.util,this._hasFullscreenApiSupport=!!(e.isFunction(t.requestFullscreen)||e.isFunction(t.webkitRequestFullscreen)||e.isFunction(t.mozRequestFullScreen)||e.isFunction(t.msRequestFullscreen))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(t){var e=document,i=this.supportsFullscreenApi()&&(e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled);return!i&&(i=t&&t.webkitSupportsFullscreen),i},getDevice:function(){return a||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var t=this.isIOS();return!t||t&&parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(t){return/\.m3u|assetType=hls/i.test(t)},isDashUrl:function(t){return/\.mpd/i.test(t)},isSecure:function(){return f},setUrlProtocol:function(t){return f?t.replace("http:","https:"):t},getDrmType:function(t){var e="none";return t.enabled?((this.isIOS()||this.isSafari())&&null!==t.fairplay.appCertURL?e="Fairplay":(this.isIE()||this.isEdge())&&null!==t.dash.playreadyURL?e="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==t.dash.widevineURL&&(e="Widevine"),e):e}},m=function(){var t=new RegExp(/\s(\([^)]+\))/).exec(v.getUserAgent());t&&t.length&&t.length>1&&(t=t[1].replace(/_/gi,"."),E(t)||A(t)||_(t)||I(t))},_=function(t){if(-1!==t.indexOf(v.LINUX)||-1!==t.indexOf(v.ANDROID)){if(r=v.LINUX,-1!==t.indexOf(v.ANDROID)){t=new RegExp(/\ Android\ ([^\s]+);/).exec(t),a=v.ANDROID,o=v.ANDROID,l=t&&t[1]?t[1]:""}return!0}return!1},E=function(t){if(-1!==t.indexOf(v.MAC))return r=v.MAC,a=v.DESKTOP,-1!==t.indexOf(v.OSX)&&(t=new RegExp(/Mac\ OS\ X\ ([\d\.]+)/).exec(t),o=v.OSX,l=t&&t[1]?t[1]:null),!0;if(-1!==t.indexOf("like Mac OS X")){r=v.MAC,o=v.IOS;var e=/\sOS\s([^\s]*)\s/.exec(t);if(e&&e[1]&&(l=e[1]),/\(iPhone;/.test(t))a=v.IPHONE;else if(/\(iPad;/.test(t))a=v.IPAD;else{if(!/\(iPod;/.test(t))return!1;a=v.IPOD}return!0}return!1},A=function(t){var e=new RegExp(/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/);if((t=e.exec(v.getUserAgent()))&&t[2])return r=v.WINDOWS,o=v.WINDOWS_PHONE,l=t[2],a=v.PHONE,!0;if((t=(e=new RegExp(/Windows\ NT\ ([^\s]+)[;\)]/)).exec(v.getUserAgent()))&&t[1]){r=v.WINDOWS,o=v.WINDOWS;var i=t[1];return 6==i?o=v.WINDOWS_VISTA:6.1==i?(o=v.WINDOWS7,l=7):6.2==i?(o=v.WINDOWS8,l=8):10==parseInt(i)&&(o=v.WINDOWS10,l=i),a=v.DESKTOP,!0}return!1},y=function(){return!!T()||(!!D()||(!!R()||(!!P()||(!!w()||(!!k()||(!!M()||!!C()))))))},b=function(){return n},S=function(){return s},T=function(){var t=/Chrome\/(\S+)/,e=/CriOS\/(\S+)/,i=v.getUserAgent(),n=e.test(i);return!(!t.test(i)&&!n||/(Opera|OPR)/.test(i)||/Edge/.test(i)||/CrKey/.test(i))&&(v.setBrowserVersion(v.CHROME,n?e:t),!0)},C=function(){var t=/Playstation (\S+)/i;return!!t.test(v.getUserAgent())&&(v.setBrowserVersion(v.PLAYSTATION,t),!0)},I=function(){return null!=v.getUserAgent()&&v.getUserAgent().indexOf(v.CHROMECAST_USER_AGENT)>-1&&(r=v.LINUX,a=v.CHROMECAST,o=v.ANDROID,!0)},D=function(){var t=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,e=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return t.test(v.getUserAgent())?(v.setBrowserVersion(v.IE,t),!0):e.test(v.getUserAgent())?(v.setBrowserVersion(v.EDGE,e),!0):!!i.test(v.getUserAgent())&&(v.setBrowserVersion(v.IE,i),!0)},R=function(){var t=/Firefox\/(\S+)/;return!!t.test(v.getUserAgent())&&(v.setBrowserVersion(v.FIREFOX,t),!0)},P=function(){var t,e=/Version\/(\S+).*Safari\//,i=e.test(v.getUserAgent());return t=o===v.ANDROID?v.ANDROID:v.SAFARI,!!i&&(v.setBrowserVersion(t,e),!0)},w=function(){var t=new RegExp(/Opera|OPR\/(\S+)/).exec(v.getUserAgent());if(t){var e=-1!==t.indexOf("Opera Mini/")||-1!==t.indexOf("Opera Mobi")?v.OPERA_MOBILE:v.OPERA;return v.setBrowserVersion(e,/Opera|OPR\/(\S+)/),!0}return!1},k=function(){return!!/Silk/i.test(v.getUserAgent())&&(v.setBrowserVersion(v.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},M=function(){return!!/Android/.test(v.getUserAgent())&&(u=v.ANDROID_BROWSER,!0)},O=function(){var t=b(),e=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],i=null;t.requestFullscreen?i=e:t.webkitRequestFullscreen?i=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:t.mozRequestFullScreen?i=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:t.msRequestFullscreen?v.getBrowserVersion()<12?i=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(i=e.slice())[5]=null:(v.isIOS()||v.isAndroid())&&(i=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"]),function(t,e){t._fullscreenEventName=e?e[0]:null,t._fullscreenEnterEventName=e?e[1]:null,t._fullscreenExitEventName=e?e[2]:null,t._enterFullscreenMethodName=e?e[3]:null,t._exitFullscreenMethodName=e?e[4]:null,t._isFullscreenPropertyName=e?e[5]:null,t._fullscreenElementName=e?e[6]:null,t._fullscreenErrorEventName=e?e[7]:null}(v,i)};return v},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(t){var e=uvpjs._,i=uvpjs.mediaCapabilities;this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,e.isObject(t)?(this.cookie=this._getCookie(),this.CDO=t,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this.setSessionStartTime()):this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.")},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(t,e,i){this.debugCount++;var n=uvpjs._;if(this.isEnabled||n.isUndefined(this.CDO))if(n.isString(t)&&n.isString(e)&&!n.isUndefined(i)){if(this.showAll||n.isUndefined(this.CDO)||this.isParamEnabled(e)||!0===this.cookie[e]){var s=this.showTimestamps?"["+this._timestamp()+"] ":"",a=n.drop(arguments,3),r=n.isEmpty(a)?"":a,o={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[t]("%sUVPJS %s %s",s,e,i,r);console[t]("%s%cUVPJS %c%s%c %s",s,o.bold,o.underline,e,o.normal,i,r)}}else console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,e)},isParamEnabled:function(t){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,t)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var t=uvpjs._,e=new Date-this.adjustedStartTime,i=e%1e3,n=(e=(e-i)/1e3)%60,s=(e=(e-n)/60)%60,a=(e=(e-s)/60)%24-this.adjustedTimezone;return t.padStart(a,2,"0")+":"+t.padStart(s,2,"0")+":"+t.padStart(n,2,"0")+"."+t.padStart(i,3,"0")},_getCookie:function(){var t=this._readCookie(this.COOKIE_NAME),e={};if(!t)return e;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",t);try{e=JSON.parse(t)}catch(t){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",t)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",e),e},_readCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0,s=i.length;n<s;n++){for(var a=i[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null}},function(t){var e,i=t._;t.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.mc=null,this._createControls=t.createControls,this._createAds=t.createAds,this._useInlinePlayAttribute=t.useInlinePlayAttribute,this._useMutedAttribute=t.useMutedAttribute,this._DOMReadyCB=t.callback,this._useAutoplayAttribute=t.useAutoplayAttribute,this._userAgent=null,this.adClickElement=null,this.dom=e(),this.dom.outer.id=t.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var t=this.dom.video.el;t&&t instanceof HTMLElement&&(t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeEventListener(this.PLAY,this._handleEvent,!1),t.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return i.clone(this.dom)},createAdClickElement:function(){var t={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};for(var e in this.adClickElement=document.createElement("div"),t)this.adClickElement.style[e]=t[e];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(t){this.dom.ad.el&&(this.dom.ad.el.style.display=t?"block":"none")},showAdClickElement:function(t){this.adClickElement&&(this.adClickElement.style.display=t?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var t=this.dom.video.el;t.addEventListener?t.addEventListener("contextmenu",function(t){t.preventDefault()},!1):t.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var t=this.dom;t.outer.el=document.getElementById(t.outer.id),i.isNull(this.dom.outer.el)?this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",t.outer.id):(t.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),t.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),t.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),t.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),t.content.el=this._getOrCreateElement("content"),t.outer.el.insertBefore(t.content.el,t.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),t.ad.el=this._getOrCreateElement("ad"),t.outer.el.insertBefore(t.ad.el,t.content.el.nextSibling)),this._createControls?(t.controls.el=this._getOrCreateElement("controls"),t.outer.el.appendChild(t.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB())},_createVideoElement:function(){var t,e=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),i=document.querySelectorAll(e);if(i instanceof NodeList&&i[0]instanceof HTMLElement&&i[0].id)this._checkVideoTagAttributes(i);else{if(e=[this.dom.outer.id,this.dom.video.id].join(" "),(i=document.querySelectorAll(e))instanceof NodeList&&i[0]instanceof HTMLElement){if(i[0].id)return;return i[0].id=this.dom.video.id,void this.dom.content.el.appendChild(i[0])}t=this._getOrCreateElement("video"),this._checkVideoTagAttributes(t),this.dom.content.el.appendChild(t),this.dom.video.el=t}},_createPlaceholderContent:function(){var t=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||i.isNull(this._userAgent)&&this.mc.isIPhone()?t.innerHTML='<source src="'+this.dom.video.url+'">':t.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),t.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY,this._handleEvent,!1),t.addEventListener(this.PLAY,this._handleEvent,!1),t.addEventListener(this.PAUSE,this._handleEvent,!1),t.style.width="100%",this._DOMReadyCB()},_handleEvent:function(t){var e=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",t),!i.isNull(e)){var n=this._useSeparateTags?e.getElementsByTagName("source")[0]:e;if(!i.isNull(n)){if(t.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,t.target),e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===n.src.indexOf(this.dom.video.url))return e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeEventListener(this.PLAY,this._handleEvent,!1),void e.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",t.type),t.type){case this.CAN_PLAY:e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(e.removeEventListener(this.PLAY,this._handleEvent,!1),e.pause(),!i.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:e.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(t){this._useMutedAttribute&&t.setAttribute("muted","muted"),this._useAutoplayAttribute&&t.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(t,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var t=this.dom.ad.el;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0"}},_getIdByPrefix:function(t){if(!i.isNull(t))return uvpjs.domConstants[t]+this.dom.outer.id},_getOrCreateElement:function(t){var e=this.dom[t],n=document.getElementById(e.id);return i.isNull(n)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+e.type+' id="'+e.id+'">.'),(n=document.createElement(e.type)).id=e.id),n}}),e=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",CDN_TYPE:{AKAMAI:"Akamai",FASTLY:"Fastly"},contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(t,i,n,s){e.isString(t)&&e.isObject(i)&&e.isObject(n)?(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+t),this.vidContId=t,this.cviMgr=i,this.CDO=n,this.sessionOptions=s,this.eventsMgr=i.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN")},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(t){if(e.isPlainObject(t)&&t.target===this.vidContId&&e.isNumber(t.payload.newState)){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+t.payload.newState);var i=t.payload.newState;i!==uvpjs.mediaCapabilities.EMPTY&&i!==uvpjs.mediaCapabilities.LOADING&&i!==uvpjs.mediaCapabilities.STOPPED&&i!==uvpjs.mediaCapabilities.PLAYING&&i!==uvpjs.mediaCapabilities.PAUSED&&i!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=i,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(t){var e=t.payload;t.target===this.vidContId&&(this.isCurrVideoAd=e.isAd,this.playbackState=e.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=e.currentTime,this.adPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.adPlaybackState.duration=e.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=e.playbackStarted,this.adPlaybackState.playbackComplete=e.playbackComplete,this.adPlaybackState.sourceBitrate=e.sourceBitrate,this.adPlaybackState.playbackBitrate=e.playbackBitrate,this.adPlaybackState.errorInfo=e.errorInfo,this.adPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=e.currentTime,this.contentPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=e.playbackStarted,this.contentPlaybackState.playbackComplete=e.playbackComplete,this.contentPlaybackState.sourceBitrate=e.sourceBitrate,this.contentPlaybackState.playbackBitrate=e.playbackBitrate,this.contentPlaybackState.videoFramerate=e.videoFramerate,this.contentPlaybackState.isSeeking=e.isSeeking,this.contentPlaybackState.isHDStreamLive=e.isHDStreamLive,this.contentPlaybackState.isPlayingLive=e.isPlayingLive,this.contentPlaybackState.currentContentSegment=e.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=e.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=e.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.contentPlaybackState.bufferLength=e.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=e.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&e.isNumber(t.payload.vol)&&(this.volume=t.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.isFullscreen=t.payload.isFs)},onContextMetadata:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&e.isPlainObject(t.target.contextMetadata)},onResourceStart:function(t){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){e.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){e.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){e.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(t){this.CDO.setAdCallParams(t)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var t=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof t&&t.length?t:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(t){var i=void 0;return t&&e.isString(t)&&this.hasOwnProperty(t)&&!e.isFunction(this[t])&&(i=this[t]),i},getModule:function(t){if(e.isString(t))return this.CDO.getModule(t)},getModuleParam:function(t,i){if(e.isString(t)&&e.isString(i))return this.CDO.getModuleParam(t,i)},getModules:function(){return this.CDO.getModules()},isModuleEnabled:function(t){return!(!t||!e.isString(t))&&this.CDO.isModuleEnabled(t)},isModuleSet:function(t){return!uvpjs.util.isEmpty(t)&&this.CDO.isModuleSet(t)},getSessionOption:function(t){return t?this.sessionOptions[t]:null},getClass:function(t){if(e.isString(t))return this.CDO.getClass(t)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(t,e){return this.CDO.getClassProperty(t,e)},getClassListItems:function(t){return this.CDO.getClassListItems(t)},getClassListItemProperty:function(t,e,i){return this.CDO.getClassListItemProperty(t,e,i)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var t={};return e.assign(t,this.contentVideoState),t},getAdVideoState:function(){var t={};return e.assign(t,this.adVideoState),t},getContentPlaybackState:function(){var t={};return e.assign(t,this.contentPlaybackState),t},getAdPlaybackState:function(){return e.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(t){this.contentVideoState.abrInfo=t,this.contentPlaybackState.abrInfo=t},setAdVideoState:function(t){this.adVideoState=e.assign({},this.adVideoStateDefaults,t||{})},setContentVideoStateItems:function(t){this._addItemsToInstanceObj("contentVideoState",t)},setContentPlaybackStateItems:function(t){this._addItemsToInstanceObj("contentPlaybackState",t)},setAdVideoStateItems:function(t){this._addItemsToInstanceObj("adVideoState",t)},setAdPlaybackStateItems:function(t){this._addItemsToInstanceObj("adPlaybackState",t)},setNonDefaultContentVideoStateItems:function(t){this.setContentVideoStateItems(this._removeDefaults(t,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(t){this.setAdVideoStateItems(this._removeDefaults(t,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(t){var e=this.VIDEO_PLAYBACK_SETTINGS,i=this.isModuleEnabled(e),n=this.getModuleParam(e,t);if(i&&n)return n},setAbrStartBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==t&&this.setStartBitrate(t)},setAbrMinBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==t&&this.setMinBitrate(t)},setAbrMaxBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==t&&this.setMaxBitrate(t)},setLiveSyncDurationCountFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==t&&this.setLiveSyncDurationCount(t)},setCapLevelToPlayerSizeFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==t&&this.setCapLevelToPlayerSize(t)},setDashJSFastSwitchABRFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==t&&this.setDashJSFastSwitchABR(t)},setStartBitrate:function(t){this.startBitrate=t,this.setContentPlaybackStateItems({startBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(t){this.minBitrate=t,this.setContentPlaybackStateItems({minBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(t){this.maxBitrate=t,this.setContentPlaybackStateItems({maxBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(t){this.liveSyncDurationCount=t,this.setContentPlaybackStateItems({liveSyncDurationCount:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(t){this.capLevelToPlayerSize=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(t){this.enableDashJSFastSwitchABR=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setErrorRecovery:function(t){this.errorRecovery=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(t){this.useDynamicSwitching=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var t=this;e.forOwn(this.sessionOptions,function(i,n){e.isString(i)&&(e.has(t.contentVideoState,n)?t.contentVideoState[n]=i:e.has(t.adVideoState,n)&&(t.adVideoState[n]=i))}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(t,i){return e.omitBy(t,function(e,n){return t[n]===i[n]})},_addItemsToInstanceObj:function(t,i){var n,s,a;if(n=this[t])if(e.isObject(i))for(s in this.debug,n)a=i[s],!i.hasOwnProperty(s)||e.isUndefined(a)||e.isFunction(a)||(n[s]=a);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",i);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+t)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(t,i,n){var s,a;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",t),this.scriptsLoadedCB=i,this.timeout=n||this.REQUEST_TIMEOUT,e.isString(t)&&this.urls.push(t),e.isArray(t)&&(this.urls=t),a=this.urls.length,s=0;s<a;s++)this._getScript(this.urls[s])},_getScript:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",t);var i=this,n=function(t,n){e.isFunction(i._onScriptLoaded)&&!i._onScriptLoaded.done?(i.urls=e.without(i.urls,t),i._onScriptLoaded({url:t,error:n})):i.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript _doCallback callback not a function or already called.")},s=document.createElement("script");s.src=this._setUrlProtocol(t),s.async=!0,s.onreadystatechange=s.onload=function(){s.readyState&&!/loaded|complete/.test(s.readyState)||n(t)},s.onerror=function(e){uvpjs.error(i.DEBUG_ID,"_getScript "+e.target.src+" is not accessible."),n(t,e)},document.querySelector("head").appendChild(s),this.timeoutHandle=setTimeout(function(t){-1===e.indexOf(i.urls,t)||(this.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript request timeout"),n(t,"timeout"))}.bind(this,t),this.timeout)},_onScriptLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var i=e.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),i&&e.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(t))},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return e=this._setUrlProtocol(e),"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(t,e):i=!1,i},loadXHR:function(t,i,n,s){var a,r;if(t=this._setUrlProtocol(t),!1===(a=this.createCORSRequest("GET",t)))return r="loadXHR CORS not supported for url = "+t,uvpjs.warn(this.DEBUG_ID,r),void n(a);s&&!uvpjs.util.isEmpty(s)&&(a.responseType=s),a.timeout=this.REQUEST_TIMEOUT,a.onload=function(){e.inRange(a.status,200,400)?i(a):n(a)},a.onerror=function(){n(a)},a.ontimeout=function(){n(a)},a.send()},loadXML:function(t,e,i){this.loadXHR(t,e,i,"document")},loadArrayBuffer:function(t,e,i){this.loadXHR(t,e,i,"arraybuffer")}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t){var e=t.vidContId;if(!t.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=e,this.eventsMgr=t.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=t.readyCallback,this.cachedOptions={suppressFacadePlay:t.suppressFacadePlay,deferLoadingCaptions:t.playerOptions.deferLoadingCaptions},this.cviModel.initialize(e,this,t.CDO,t.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(t){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(t)},setAdCallParams:function(t){this.cviModel.setAdCallParams(t)},setInitialPlaybackType:function(t,e){this.initialPlaybackInfo.isAutoplay=t,this.initialPlaybackInfo.isMuteAtPlayStart=e},setContextMetadata:function(t){this.cviModel.contentVideoState.contextMetadata=t||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var i=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:i.suppressFacadePlay,p2pClient:t||null,multiCdnClient:e||null,deferLoadingCaptions:i.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:i.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(t){var i=this.cviModel.getSessionOption("adBlockerCallback"),n=!(!i||!i()),s=this.eventsMgr.eventTypes,a=uvpjs.ErrorInfo,r=window.google&&google.ima;if(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+n),n&&this.eventsMgr.dispatchEvent(s.AD_BLOCKED,{errorInfo:new a({eventType:s.AD_BLOCKED,errorCode:a.errorCodes.AD_BLOCKING_DETECTED,message:a.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),n||r){if(r)if(e.isEmpty(this.imaAdDisplayContainer)){this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(t),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer);var o=this.adsLoader.getSettings();o.setAutoPlayAdBreaks(!0),o.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}else this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed")}else this.eventsMgr.dispatchEvent(s.PLAYER_START_ERROR,{errorInfo:new a({eventType:s.PLAYER_START_ERROR,errorCode:a.errorCodes.IMA_SDK_MISSING,message:a.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId)},_createIMAAdDisplayContainer:function(t){var e,i;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId).getElementsByTagName("video")[0],i=new google.ima.AdDisplayContainer(this.adVideoDiv,e,t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",i),i},onAdsManagerLoaded:function(t){var e,i=uvpjs.util,n=i.isEmpty(this.RPM),s=i.isEmpty(this.RPM.currRP),a=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",t),n||s||a)return e="CVI mgr: onAdsManagerLoaded; ",e+=n?"no RPM found":s?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,e),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+e,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(t)},onAdError:function(t){var i=!e.isEmpty(this.RPM)&&this.RPM,n=i&&!e.isEmpty(i.currRP)&&i.currRP;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",t),!i||!n)return this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof n.handleAdsLoaderError&&n.handleAdsLoaderError(t)},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),this.RPM.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,{},this.vidContId)},seekToRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+t),e.isNaN(t)?this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+t):(-1===t&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:t},this.vidContId))},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",t),e.isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:t},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",t),e.isString(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:t},this.vidContId)},showCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},setCaptionsStyleRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",t),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(t):this.captionsMgr.setStyles(t)},setCaptionsCuePropertyRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",t,e),this.captionsMgr.setCueProperty(t,e)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},resizeRequest:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+t+"  height = "+i),!e.isNaN(t)&&!e.isNaN(i)&&t>=0&&i>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:t,height:i},this.vidContId)},fullscreenRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",t),e.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:t},this.vidContId)},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:t},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",t),e.isPlainObject(t)},setNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",t),e.isBoolean(t)&&(this.cviModel.nativeControls=t)},createPauseAdRetriever:function(){var t=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),e={eventsMgr:this.eventsMgr,adCallUrl:t,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};t?uvpjs.PauseAdRetriever?this.pauseAdRetriever=new uvpjs.PauseAdRetriever(e):this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path."):this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+t)},checkForPauseAd:function(){var t=this.cviModel.isModuleEnabled("PauseAd"),e=uvpjs.Configuration.path+"lib/PauseAdRetriever.js";t&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(new uvpjs.CodeLoader).loadScript(e,this.createPauseAdRetriever.bind(this)))}})}(uvpjs.register("uvpjs")),(r=uvpjs.register("uvpjs")).ErrorInfo=uvpjs.Class.subClass({init:function(t){var e=t||{};this.errorCode=e.errorCode||null,this.eventType=e.eventType||null,this.isFatal=!!e.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=e.message||null,this.adInfo=e.adInfo||null,this.serverCode=e.serverCode||null,this.hlsjsErrorCode=null}}),r.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},r.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."},function(t){var e=t._,i=Math.random();t.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(t){this.debug=uvpjs.debug,t&&t===i?(this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance().")},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(t,i){if(t&&e.isString(t)&&i&&e.isFunction(i)){var n=this._returnValidEvtTypeAndNameSpace(t);if(!1!==n){var s=n[0],a=n[1];this.registeredEventsTable[s]||(this.registeredEventsTable[s]={}),this.registeredEventsTable[s][a]?this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",s," ns = ",a):(this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",s," ns = ",a),this.registeredEventsTable[s][a]=i)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+t},this.internalNS)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(t){if(!t||!e.isString(t))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",t),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var i=this._returnValidEvtTypeAndNameSpace(t);if(!1!==i){var n=i[0],s=i[1];this.registeredEventsTable[n]&&this.registeredEventsTable[n][s]?(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",t),delete this.registeredEventsTable[n][s]):this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",t)}else this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",t)},dispatchEvent:function(t,i,n){var s={};if(t&&e.isString(t))if(e.isUndefined(i)||e.isPlainObject(i))if(e.isUndefined(n)||e.isString(n)){var a=this.registeredEventsTable[t];if(a)for(var r in e.isUndefined(i)&&(i={}),e.isUndefined(n)&&(n=""),s.type=t,s.payload=i,s.target=n,a)a.hasOwnProperty(r)&&a[r](s)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+t+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS)},_returnValidEvtTypeAndNameSpace:function(t){var e=[],i=t.split(".");if(i.length<2)return!1;var n=i[0];i.shift();var s=i.join("_");return!(!this._validateEventType(n)||s.indexOf("undefined")>-1)&&(e[0]=n,e[1]=s,e)},_validateEventType:function(t){var e=!1,i=this.eventTypes;for(var n in i)if(i.hasOwnProperty(n)&&i[n]===t){e=!0;break}return e},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(t){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),t)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(t,i,n,s){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",i);var a={};if(t&&e.isNumber(t)&&i&&e.isString(i)&&n&&e.isFunction(n)&&(!s||e.isNumber(s)||!(s>=1||-1===s))){t<this.uvpjsClockInterval&&(t=this.uvpjsClockInterval);var r=i.split(".");a={freq:t,ns:i=r.join("_"),cb:n,rptCnt:-1,nextTime:Date.now()+t},s&&(a.rptCnt=s),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",t),this.timerCBOs.push(a)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeTimedEventCallback:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",t+" ns = "+i),t&&e.isNumber(t)&&i&&e.isString(i)){var n,s,a=i.split(".");for(i=a.join("_"),n=this.timerCBOs.length;n--;)(s=this.timerCBOs[n]).freq===t&&s.ns===i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",s.freq+" CBO.ns = "+s.ns),this.timerCBOs.splice(n,1))}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},uvpClockTick:function(){var t,e;this.sessionMilliseconds=Date.now()-this.sessionStartTime;var i=Date.now();for(t=this.timerCBOs.length-1;t>=0;t--)i>=(e=this.timerCBOs[t]).nextTime&&(e.cb(),e.nextTime=i+e.freq,-1!==e.rptCnt&&(e.rptCnt=e.rptCnt-1,0===e.rptCnt&&this.timerCBOs.splice(t,1)))},eventTypes:{FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),t.EventsManager._instance=null,t.EventsManager.destroyInstance=function(){this._instance=null},t.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(i)),this._instance}}(uvpjs.register("uvpjs")),function(t){t.AbstractId3Parser=uvpjs.Class.subClass({init:function(t){this.findNielsen=t.findNielsen,this.dataCallback=t.dataCallback,this.ownerIds=this.assembleOwnerIds(t.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(t){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(t){for(var e=t.length,i=[];e--;)i[e]=t[e].length;return i},assembleOwnerIds:function(t,e){var i,n,s=[];if("string"==typeof t)for(n=(i=t.split(",")).length;n--;)s.push(i[n].trim());return e&&-1===s.indexOf("www.nielsen.com")&&s.push("www.nielsen.com"),s}})}(uvpjs.register("uvpjs")),function(t){t.FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){var e,i=t.length;for(e=0;e<i;e++)t[e].data&&this.findId3(t[e])},findId3:function(t){var e,i,n,s,a,r,o=0,l=t.data;r=this.readStr(l,o,3),o+=3,"ID3"===r&&(o+=3,e=127&l[o++],i=127&l[o++],n=127&l[o++],s=127&l[o++],a=o+((e<<21)+(i<<14)+(n<<7)+s),this.findId3PrivateFrame(t,o,a))},findId3PrivateFrame:function(t,e,i){for(var n,s=t.data;e+8<=i;)n=this.readStr(s,e,4),e+=4,s[e++]<<24+s[e++]<<16+s[e++]<<8+s[e++],(s[e++]<<8)+s[e++],e,"PRIV"===n&&this.parseFrame(t,e)},parseFrame:function(t,e){for(var i,n,s,a=this.idLengths,r=this.totalIds,o=t.data;r--;)if(s=a[r],(n=this.readStr(o,e,s))===this.ownerIds[r]){e+=s,i="www.nielsen.com"===n?this.parseNielsen(n,o,e):this.readStr(o,++e,o.length),this.dataCallback({name:n,data:i,pts:t.pts});break}},parseNielsen:function(t,e,i){var n=t+this.readStr(e,i,e.length-(i+2));return 249===n.length?n:null},readStr:function(t,e,i){var n="",s=e||0,a=e+i;do{n+=String.fromCharCode(t[s++])}while(s<a);return n}})}(uvpjs.register("uvpjs")),function(t){t.TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){if(1===t.length){var e=t[0];if("PRIV"===e.value.key)for(var i=0;i<this.ownerIds.length;i++){var n=this.ownerIds[i];-1!==e.value.info.indexOf(n)&&this.dataCallback({name:n,data:"www.nielsen.com"===n?e.value.info:String.fromCharCode.apply(null,new Uint8Array(e.value.data)),pts:e.startTime})}}}})}(uvpjs.register("uvpjs")),function(t){t.SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var t={};for(var e in this.historyItems)t[e]=this.historyItems[e];return t},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(t){var e="//79423.analytics.edgesuite.net/js/csma.js";return e=t&&t.getModuleParam("AkamaiQOSPluginJS","libpath")||e,uvpjs.mediaCapabilities.isSecure()?[e.replace("edgesuite","edgekey")]:[e]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===t._.get(ADB,"va.Heartbeat"))},getPath:function(t){var e=uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",i=uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return t.sessionOptions.usesTealium?[i]:[e,i]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}},Segment:{isDefined:function(){return void 0!==window.analytics},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/segment-loader.js"]}}},init:function(t,e){var i=[],n=t.getModules(),s=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.cdo=t,this.initCallback=e,s.isEmpty(n))this.invokeCallbackWithHistory();else{t.getModule("MuxQOSPluginJS")||n.push({name:"MuxQOSPluginJS",enabled:"true"});for(var a=n.length;a--;){var r,o,l=n[a],d=l.name,u=this.sdkModules[l.name];if(l.enabled&&u)if(u.isDefined())this.addToHistory({name:l.name,loaded:!0});else for(o=(r=u.getPath(t)).length;o--;)i.push({name:d,path:r[o]})}s.isEmpty(i)?this.invokeCallbackWithHistory():this.bulkLoad(i)}},invokeCallbackWithHistory:function(){var t=this.initCallback,e=this.getHistory();setTimeout(function(){t(e)},1)},bulkLoad:function(t){var e=t,i=[],n=(this.handleAllLoadResults,function(){var t=e.shift(),s=new uvpjs.CodeLoader;s.loadScript(t.path,function(t,s,a){i.push({name:t,result:a}),s.destroy(),0===e.length?this.handleAllLoadResults(i):n()}.bind(this,t.name,s))}.bind(this));n()},handleAllLoadResults:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",t);for(var e=t.length;e--;){var i=t[e];i.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+i.result.error),this.addToHistory({name:i.name,loaded:!i.result.error})}this.initCallback(this.getHistory())},addToHistory:function(t){t.name?!1!==this.historyItems[t.name]&&(this.historyItems[t.name]=!t.error&&t.loaded):this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",t)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=t.p2pClient||null,this.multiCdnClient=t.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=t.suppressFacadePlay,this.deferLoadingCaptions=t.deferLoadingCaptions,this.playlistPaused=!1,!e.isEmpty(t)&&this.initialize(t.vidContId,t.cviMgr)},initialize:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",t),e.isString(t)&&e.isObject(i)?(this.vidContId=t,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS")},setContainers:function(t){this.containers=t},setCaptionStyle:function(t){!uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(t)},onResourceLoadRequest:function(t){if(t.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",t.payload.rcObj),this.playlistPaused=!1;var e=this._createResourceProvider(t.payload.rcObj);this.rscProviders.unshift(e),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(t){if(t.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",t.payload.rcObjs);var i,n,s=t.payload.rcObjs,a=s.length;for(i=0;i<a;i++)n=this._createResourceProvider(s[i]),this.rscProviders.push(n);e.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(t){if(t.target===this.vidContId){for(var e,i=t.payload.rcObjs,n=i.length,s=this.rscProviders,a=this.usedRPs,r=!1,o=!uvpjs.util.isEmpty(this.currRP);n--;)e=i[n],this.removeFromList(e,s),this.removeFromList(e,a),o&&!r&&(r=this.isMatchingResource(e,this.currRP.rco.rcoSeed));r&&this.advancePlaylist()}},removeFromList:function(t,e){for(var i=e.length;i--;)this.isMatchingResource(t,e[i].rco.rcoSeed)&&e.splice(i,1)},isMatchingResource:function(t,e){var i=uvpjs.util;return t.type===e.type&&(!i.isEmpty(t.pid)&&t.pid===e.pid||!i.isEmpty(t.assetURL)&&t.assetURL===e.assetURL||!i.isEmpty(t.selectorCall)&&t.selectorCall===e.selectorCall)},onResourcePlaylistPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),t.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(t){t.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,e.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),e.isEmpty(this.currRP)||e.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){!e.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),e.isEmpty(this.currRP)||e.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(t){var e,i={rco:t,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",t),t.type){case this.mc.RP_URL:e=new uvpjs.RP_URL(i);break;case this.mc.RP_PLATFORM:e=new uvpjs.RP_Platform(i);break;case this.mc.RP_DAI:e=new(t.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider)(i);break;case this.mc.RP_IMA:e=new uvpjs.RP_IMA(i);break;case this.mc.RP_MDIALOG:e=new uvpjs.RP_Mdialog(i)}return e},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),e.isEmpty(this.currRP)||e.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!e.isObject(this.currRP))return this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(t){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",t.message),this.eventsMgr.dispatchEvent(t.eventType,{errorInfo:t},this.vidContId),this.advancePlaylist()},resourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:t},this.vidContId)},resourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",t),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:t,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!e.isEmpty(this.currRP)&&e.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(t,i,n,s,a){var r=!0===a.skin;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",t),e.isString(t)&&e.isObject(i)&&e.isObject(n)&&e.isFunction(s)?(this.vidContId=t,this.namespace=".vci_"+t,this.eventsMgr=i,this.CDO=n,this.vciReadyCB=s,this._usesIMA=a.usesIMA,this._loadSkinFlag=r,this._isPreviewBtnInternallyManaged=r,this._isUnmutedAutoplay=a.enableUnmutedAutoplay,this._isMutedAutoplay=a.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!a.useBrowserControls,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:t,eventsMgr:i,CDO:n,playerOptions:a,suppressFacadePlay:this.checkNativeAutoplay(a.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,a)})):this.debug&&uvpjs.log(this.DEBUG_ID,"-")},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(t){var e={skin:!0===t.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:t.customCSS,enableReplay:t.enableReplay,previewImage:t.previewImage,themeName:t.themeName,controls:t.controls,template:t.template};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:t.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(t.enableNativeMobileAutoplay),callback:this.onDOMReady.bind(this,e)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(t){},onAdStart:function(t){var e=t.payload.adData;this.DOMMgr.showAdContainer(!0),!this.autoplayRestrictionChecked&&this.checkAutoplayRestriction(e),e.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(t){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){this.handleFirstGesture();var t=this.skinMgr,e=this.mc.PAUSED;setTimeout(function(){t.setPlaystate(e)},200)},setAdCallParams:function(t){this.CVI_Mgr.setAdCallParams(t)},checkAutoplayRestriction:function(t){this.autoplayRestrictionChecked=!0,!this.contentStartReceived&&"pre"===t.adType&&"ima"===t.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(t){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,t,this.vidContId)},prepForRestrictedAutoplay:function(t){var e=this.dom.video.el,i=function(){this.isPreparedForAutoplay=!0,e.removeEventListener("play",i,!1),t&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),e.src=this.mc.getPreferredPlaceholderURL(),e.addEventListener("play",i,!1),e.muted=!0,e.load();var n=e.play();void 0!==n&&n.then(Function.prototype).catch(function(t){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(t){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:t||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(t){this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),this.useBrowserNativeControls||!this._loadSkinFlag?this.onVCIReady():this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:t})},checkNativeAutoplay:function(t){return t&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),this._vciReadySent||(this._autoPlay||!this._isPreviewBtnInternallyManaged||this._previewButtonDone?(this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId))},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),e.isString(t)?this.CVI_Mgr.loadDynamicAdCall(t):this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)")},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(t){if(uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(t)){if(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone)return uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=t,void this.playBlankVideo();uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),t()}else this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function.")},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(t){var e,i;if(!0!==t&&!this.canOverrideUserGesture())return e=uvpjs.ErrorInfo,void(i=this.eventsMgr).dispatchEvent(i.eventTypes.PLAYER_START_ERROR,{errorInfo:new e({eventType:i.eventTypes.PLAYER_START_ERROR,errorCode:e.errorCodes.USER_GESTURE_REQUIRED,message:e.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(t,i){t&&e.isString(t)&&e.isFunction(i)?this.eventsMgr.addEventListener(t,i):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId)},removeEventListener:function(t){t&&e.isString(t)?this.eventsMgr.removeEventListener(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(t){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,t),void this.playBlankVideo();i=this.createResourceConfig(t),e.isObject(i)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:i},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,t),void this.playBlankVideo();if(e.isArray(t)&&t.length>0){var i,n,s=[];for(i in t)n=this.createResourceConfig(t[i]),e.isObject(n)?s.push(n):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);s.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:s},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(t){var e,i,n,s,a,r="",o=!1,l=t.type===this.mc.RP_IMA,d=!1,u=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",t),(a=this.prevalidateRcObj(t)).error)return r="Resource configuration error: "+a.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(r,null),!1;switch(t.type){case this.mc.RP_URL:e=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:e=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(r="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",o=!0),d=!0,e=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:e=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:d=!t.useSsb,e=uvpjs.DaiRco;break;default:r="VCI createResourceConfig "+("Unknown resource type "+t.type)+"; this.vidContId = "+this.vidContId,o=!0}return o?(this.dispatchStartError(r,null),!1):(this.rcoIdIndex++,a=(i=new e(t,this.rcoIdIndex+"_"+this.vidContId,this.vidContId)).getValidationInfo(),d&&this.checkForAdBlocker()?(!0===a.missingSDK&&(u=l?"IMA":"DAI"),this.dispatchAdBlocked(u,!0),!1):a.error?(r="VCI error initializing RCO: "+a.message,n=uvpjs.ErrorInfo.errorCodes,!0===a.missingSDK?(s=l?n.IMA_SDK_MISSING:n.DAI_SDK_MISSING,this.dispatchStartError(r,s)):this.dispatchStartError(r,null),!1):(this._replayRco=t,i))},prevalidateRcObj:function(t){var e=uvpjs.util,i="",n=!1;return e.isPlainObject(t)?e.isDefinedString(t.type)||(i="Invalid resource type encountered",n=!0):(i="Invalid resource config object format",n=!0),{error:n,message:i}},dispatchStartError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:e||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+t,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(t,e){var i=t?" (Missing "+t+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+i,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+i,isFatal:!!e})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(t){e.isArray(t)&&t.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:t},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest()},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",t),isNaN(t)||this.CVI_Mgr.seekToRequest(t)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),e.isEmpty(this.skinMgr)||e.isEmpty(t)||this.skinMgr.disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),e.isEmpty(this.skinMgr)||e.isEmpty(t)||this.skinMgr.enableButton(t)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(t){e.isNaN(t)||this.CVI_Mgr.volumeChangeRequest(t)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",t),e.isString(t)&&this.CVI_Mgr.loadCaptionsRequest(t)},showCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",t),this.CVI_Mgr.setCaptionsStyleRequest(t)},setCaptionsStyleProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",t,e),this.CVI_Mgr.setCaptionsStyleRequest([{name:t,value:e}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",t,e),this.CVI_Mgr.setCaptionsCuePropertyRequest(t,e)},setSize:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+t+"  height = "+i),e.isNumber(t)||e.isNumber(i)||this.CVI_Mgr.resizeRequest(t,i)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),!e.isEmpty(t)&&(e.isArray(t)&&t.length>0||uvpjs.util.isDefinedString(t))&&this.CVI_Mgr.setUserGesture(t)},setQosMetadata:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",i),e.isEmpty(t)||e.isEmpty(i)||!e.isArray(t)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:t,paramsObj:i},this.vidContId))},fullscreen:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",t),e.isBoolean(t)&&this.CVI_Mgr.fullscreenRequest(t)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(t){t&&e.isPlainObject(t)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:t},this.vidContId))},removeNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",t),e.isBoolean(t)&&this.CVI_Mgr.setNativeControls(t)},useDynamicSwitching:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",t),e.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:t},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(t){t&&"number"==typeof t?(this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",t)},switchTo:function(t){var e=null!=t&&"string"==typeof t&&-1!=="up,down".indexOf(t),i=null!=t&&"number"==typeof t&&!isNaN(t);e||i?(this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",t),i?this.switchBitrateTo(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",t,e,i,typeof t)},setMinimumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},setMaximumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},pauseAdRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:t||null,height:e||null},this.vidContId)},_dispatchResizeEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:t},this.vidContId)},liveSegmentStart:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,i={liveSegmentData:t};this.eventsMgr.dispatchEvent(e,i,this.vidContId)},liveSegmentEnd:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,i={liveSegmentData:t};this.eventsMgr.dispatchEvent(e,i,this.vidContId)}})}(uvpjs.register("uvpjs")),function(t){var e=Math.random(),i=t._;t.VideoManager=uvpjs.Class.subClass({init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance?console.warn("UVPJS: An instance of VideoManager has already been created."):(uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1)},destroy:function(){for(var t in this.VCIs)this.destroyVideoPlayer(t);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(t,e,i){var n=uvpjs.Configuration,s=uvpjs.VideoManager._instance,a=uvpjs.DebugManager,r=this.validateParams(t,e,i),o=r.message,l=r.isValid;if(!o||(console[l?"warn":"error"](o),!l&&r.errorCb&&r.errorCb(o),l)){if(s){if(s.isInitializing())return void s.addInitCallback(e);if(s.isReady())return void(uvpjs.util.isFunction(e)&&e(this.mc.systemInfo))}console.log([n.name,n.version,n.date].join(" ")),uvpjs.log=a.log.bind(a),uvpjs.warn=a.warn.bind(a),uvpjs.error=a.error.bind(a),a.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!t.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(e),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",t),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(t,this.onCongfigMgrReady.bind(this))}},validateParams:function(t,e,n){var s=uvpjs.util,a=null,r=!1,o="VideoManager.initialize()",l=s.isFunction(n)?n:null;return t&&i.isPlainObject(t)||(a=o+" was invoked with invalid session options.",r=!0),s.isFunction(e)||(a=o+": A success callback function is required.",r=!0),l||(a=o+" did not receive a valid error callback function.",r=!1),{errorCb:l,message:a,isValid:!r}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(t){var e=this.successCallbacks.length;if(uvpjs.util.isFunction(t)){for(;e--;)if(this.successCallbacks[e]===t)return;this.successCallbacks.push(t)}},onCongfigMgrReady:function(t){i.isObject(t)?(this.CDO=t,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS)},onSdkLoadManagerReady:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",t),uvpjs.mediaCapabilities.setTrackingInfo(t),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(t){var e,i=t.isModuleEnabled("VideoPlaybackSettings")&&t.getModuleParam("VideoPlaybackSettings","forceHlsjs"),n="string"==typeof i,s=n&&i.toLowerCase();i&&!uvpjs.util.isEmpty(i)&&(!0===i||1===i||n&&("1"===s||"y"===s||"yes"===s))&&((e=this.mc.canPlayHLSJS(!0))&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=e)},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(t,e){this.eventsMgr&&(t&&i.isString(t)&&i.isFunction(e)?this.eventsMgr.addEventListener(t,e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS))},removeEventListener:function(t){t&&i.isString(t)?this.eventsMgr.removeEventListener(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS)},getVideoPlayers:function(){var t,e={};for(t in this.VCIs)e[t]=this.VCIs[t];return e},createVideoPlayer:function(t,e,n){if(this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),i.isString(t)&&i.isFunction(e)&&(!n||i.isPlainObject(n))){var s=[t,e];n&&s.push(n),this.createMultipleVideoPlayers([s])}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS)},destroyVideoPlayer:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),i.isString(t)?i.isEmpty(this.VCIs)||!this.VCIs[t]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+t},this.internalNS),!1):(this.VCIs[t].destroy(),delete this.VCIs[t]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(t){var e,n,s,a,r,o,l,d;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!i.isEmpty(this.VCIs)),i.isArray(t)){for(a=t.length,s=0;s<a;s++)if(o=(r=t[s])[0],l=r[1],d=r[2],r.length<2||!i.isString(o)||!i.isFunction(l)||!i.isUndefined(d)&&!i.isPlainObject(d))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),s=0;s<a;s++)o=(r=t[s])[0],l=r[1],d=r[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",o),d=this.CDO.getSessionOptions(d),e=this.validateAutoplay(d),!1===this._allowConcurrentPlayback&&e&&(this._disableAutoplay&&(d.enableMutedAutoplay=!1,d.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),n=new uvpjs.VideoControlInterface,this.VCIs[o]=n,n.initialize(o,this.eventsMgr,this.CDO,l,d);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS)},validateAutoplay:function(t){var e=t.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),i=!!(t.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||e);return e&&(t.enableMutedAutoplay=!1),i||(t.enableMutedAutoplay=!1,t.enableUnmutedAutoplay=!1),i},overrideSessionOptions:function(t){t&&i.isPlainObject(t)&&this.CDO.overrideSessionOptions(t)},onVideoProgress:function(t){if(!(this._allowConcurrentPlayback||!i.isPlainObject(t)||i.isUndefined(t.target)||i.isUndefined(t.payload)||i.isUndefined(t.payload.playbackState)||t.payload.playbackState!==this.mc.PLAYING)){var e=t.target;i.isEmpty(this.currActiveVCI)&&!i.isUndefined(this.VCIs[e])&&(this.currActiveVCI=this.VCIs[e]),e===this.currActiveVCI.vidContId||i.isUndefined(this.VCIs[e])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",e),this.VCIs[e].pauseVideo())}},onVideoPlaybackInitiated:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",t),!this._allowConcurrentPlayback&&i.isPlainObject(t)&&!i.isUndefined(t.target)){var e=t.target;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),i.isEmpty(this.VCIs)||i.isUndefined(this.VCIs[e])||this.currActiveVCI&&this.currActiveVCI.vidContId===e||(this.currActiveVCI=this.VCIs[e],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(t){t?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",t.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(t){t?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",t.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),t.VideoManager._instance=null,t.VideoManager.destroyInstance=function(){this._instance=null},t.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(e)),this._instance}}(uvpjs.register("uvpjs")),function(t){var e,i,n,s,a,r,o,l,d,u,c,h,p,g,f,v=t._;t.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(t){var e=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,t&&(this._cviModel=t.cviModel,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=i(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=e.getCaptionsLineOffset(),this._lineAlign=e.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=t.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._trackMode="hidden",this._disabled=!1,this.ccDisplayRequested=!1,this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=t,!this._ccEl&&this._createCaptionsElement()},showCaptions:function(t){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(t,"showing")},hideCaptions:function(t){this.ccDisplayRequested=!1,this._toggleVisibility(t,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:v.clone(this.styles)},setStyles:function(t){var e,i,n,s=this._pageStyles,a=t.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",t);a--;)n=t[a],e=p(n.name),i=n.value,s[e]=i;this._updateStylesObject(s),this._applyStyles()}},setCueProperty:function(t,e){var i;this._disabled||(i=this._getActiveTrack(),t&&e&&i&&this._supportsVTTCue?(this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",i,t,e),this._props[t]=isNaN(e)?e:Number(e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",t,e))},_addEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace,n=this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners",n),t.addEventListener(e.CONTAINER_RESIZE+i,this._onContainerResize.bind(this)),t.addEventListener(e.CONTROL_LOAD_CAPTIONS+i,this._onControlLoadCaptions.bind(this)),t.addEventListener(e.CONTENT_DATA_LOADED+i,this._onContentDataLoaded.bind(this)),t.addEventListener(e.CONTROL_SHOW_CAPTIONS+i,this.showCaptions.bind(this)),t.addEventListener(e.CONTROL_HIDE_CAPTIONS+i,this.hideCaptions.bind(this)),t.addEventListener(e.CONTENT_FACADE_CREATED+i,this._onContentFacadeCreated.bind(this)),t.addEventListener(e.RESOURCE_END+i,this._onVideoComplete.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this))},_removeEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace;this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.CONTROL_LOAD_CAPTIONS+i),t.removeEventListener(e.CONTENT_DATA_LOADED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CONTENT_FACADE_CREATED+i),t.removeEventListener(e.RESOURCE_END+i),t.removeEventListener(e.VIDEO_PROGRESS+i)},_createTrackElement:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",t);var e=document.createElement("track");e.default=!0,e.kind="captions",e.label="English",e.srclang="en",e.id=this._trackId,e.src=t,this._videoEl.appendChild(e)},_createCaptionsElement:function(){var t=uvpjs.util,e=this._styleEl,i=document.createElement("div"),n=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);i.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),n?(n.appendChild(i),this._ccEl=i,t.addCSSObject(e,i,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),t.addCSSObject(e,i,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),t.addCSSObject(e,i,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container.")},_dispatchCaptionsError:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",t),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:t},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(t){t.target===this._containerId&&this._setRect()},_onVideoComplete:function(t){var e,i,n=t.target,s=this._videoEl;n===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",n),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,s&&s.removeEventListener("loadeddata",this._onLoadedData),s&&s.removeEventListener("timeupdate",this._onTimeUpdate),(i=this._getTextTracks())&&(i.onaddtrack=null),(e=this._getActiveTrack())instanceof window.TextTrack&&o(e)&&(e.mode="disabled",e.oncuechange=null,e.textTrack1&&(e.textTrack1=!1),e.textTrack2&&(e.textTrack2=!1)),this._trackCount++)},_onContentDataLoaded:function(t){var e,i=uvpjs.util,n=t.target,s=t.payload.vidState,a=s.closedCaptionPath;s.isLive;n===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",n),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,(e=this._getTextTracks())&&(e.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),i.isDefinedString(a)&&(this._captionsUrl=a))},_onLoadedData:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",t),this._checkForLiveCaptions()},_onTimeUpdate:function(t){!this.hasDispatchedCaptionsReady&&this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(t)},_onControlLoadCaptions:function(t){var e;t.target===this._containerId&&(e=t.payload.url,v.isString(e)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",t.target),this._loadCaptionsUrl(e)))},_onContentFacadeCreated:function(t){t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",t.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(t){var e=t.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",t);try{e=(e=e.replace(/\n/g,"")).substr(e.indexOf("<?xml"));var i=(new DOMParser).parseFromString(e,"text/xml");this._xmlToCues(i)}catch(t){var n="Error parsing closed captions XML.";this._dispatchCaptionsError(n),this.debug&&uvpjs.error(this.DEBUG_ID,n,t)}},_onLoadError:function(t){var e=t.status,i="Unknown error";switch(e){case 404:i="File not found";break;case 500:i="Server error";break;case 0:i="Request aborted"}i+=" "+e,this._dispatchCaptionsError(i),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",i)},_onAddTrack:function(t){var e=t.track;e.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(e,!1),o(e)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",t)},_syncCCTrackMode:function(t,e){t&&(e?t.mode="disabled":this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(t.mode="showing"):"hidden"!==t.mode&&(t.mode="hidden"))},_onVideoProgress:function(t){var e;if(t.target===this._containerId){var i=this._getActiveTrack();if(this._syncCCTrackMode(i,!1),this._hasCaptions())if(this._liveCaptionsInitalized)if(i&&i.activeCues&&(e=i.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);e--;)t.payload.currentTime-i.activeCues[e].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1);else this._checkForLiveCaptions();else this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!t||!this._liveCaptionsInitalized){try{!t&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(t){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",t),this._dispatchCaptionsError(t)}t&&(this._liveCaptionsInitalized=!0),this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var t=this._getActiveTrack(),e=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),t&&(t.oncuechange=e)||this._videoEl.addEventListener("timeupdate",e)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var t=v.get(this._captionsJson,"tt.head.styling.style");t=v.isArray(t)?t[0]:t,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",t),t?this._inlineStyles={backgroundColor:t["tts:backgroundColor"],color:t["tts:color"],fontFamily:t["tts:fontFamily"],fontSize:t["tts:fontSize"],fontStyle:t["tts:fontStyle"],fontWeight:t["tts:fontWeight"],textAlign:t["tts:textAlign"],textDecoration:t["tts:textDecoration"]}:this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file.")},_applyStyles:function(){var t,i,n,s=uvpjs.util,a=this.styles,r=this._styleSelector,o=[];for(i in this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",a),a){switch(n=a[i],t=!1,i){case"background-opacity":case"font-opacity":t=!0;break;case"text-position":t=!0,this._setPosition(n);break;case"background-color":n=e(n,a["background-opacity"]);break;case"color":case"font-color":i="color",n=e(n,a["font-opacity"]);break;case"text-edge-style":i="text-shadow",n=g(n)}t||(l(i,n)?o.push({name:i,value:n}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",i,n))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",r,o),s.addCSSRules(this._styleEl,r,o)},_updateStylesObject:function(t){var e,i,s;for(e in t){if(!(i=t[e])||!e)return;if((s=p(e))in this.styles){switch(s){case"font-size":i=n(i)}this.styles[s]=i}else this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",s)}},_hasCaptions:function(){return o(this._getActiveTrack())},_loadOrDeferCaptions:function(t){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(t)},_loadCaptionsUrl:function(t){var e=uvpjs.util.isDefinedString(t),i=e&&-1!==t.indexOf(".vtt");e&&!this._cviModel.contentVideoState.isFlash&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),i?this._createTrackElement(t):(new uvpjs.CodeLoader).loadXHR(t,this._onLoadComplete.bind(this),this._onLoadError.bind(this)))},_checkForLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),this._hasCaptions()?(this._finalizeTrackElement(),this._finalizeLiveCaptions()):this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize.")},_clearAllCaptionTracks:function(){var t=this._ccEl,e=this._getTextTracks(),i=e&&e.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",e);i--;)this._clearCaptionTrack(e[i]);t&&(t.innerHTML="")},_clearCaptionTrack:function(t){var e,i;if(o(t)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",t),i=(e=t&&t.cues)&&e.length||0;i--;)t.removeCue(e[i]);this._syncCCTrackMode(t,!0),t.cues=null}},_toggleVisibility:function(t,e){t.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",e),this.showCcContainer("hidden"!==e))},showCcContainer:function(t){this._ccEl&&(this._ccEl.style.display=!1===t?"none":"block")},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var t,e,i,n=this._getTextTracks(),s=n&&n.length||0;for(i=0;i<s;i++)if((e=(t=n[i])&&t.cues)&&e.length&&o(t))return t},enableCaptionsTracks:function(){for(var t,e=this._getTextTracks(),i=e&&e.length||0;i--;)t=e[i],o(t)&&(t.mode="hidden")},_getTrackById:function(t){var e=this._getTextTracks();return e&&e.getTrackById(t||this._trackId)},_getActiveCues:function(){var t=this._getActiveTrack();return t&&t.activeCues},_getAllCues:function(){var t=this._getActiveTrack();return t&&t.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var t,e,i=this._cviModel.getModule(this.CONFIG_MODULE_NAME),n={};this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",i),i?!0===i.enabled?v.isEmpty(i.params)?this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty."):(v.each(i.params,function(i){t=i.name,e=i.value,t&&e&&(p(t),n[t]=e)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(n,null,2)),this._configStyles=n):this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled."):this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found.")},_setPosition:function(t){var e=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"].indexOf(t)>-1?t:"bottom-center-floated";this._setPositionCSS(e)},_setPositionCSS:function(t){var e,i,n,s,a,r=uvpjs.util,o=this._styleEl,l=this._ccEl,d=l&&l.style.marginBottom,u=parseInt(this.BASE_CONTROLS_HEIGHT);o&&l&&(s=(i=t.split("-"))[0],n=i[1],a="inherit"===d?0:parseInt(d),e={top:{top:"0",middle:"50%",bottom:"auto"}[s],bottom:{top:"auto",middle:"auto",bottom:(a>u?10:u-a)+"px"}[s],"text-align":n,transform:"initial"},"middle"===s&&(e.transform="translateY(-50%)"),r.addCSSObject(o,l,e,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var t=this.styles;t&&this._setPosition(t["text-position"])},_setRect:function(){var t,e,i,n,s,a,r,o,l,d,u,c=this._videoEl,h=this._ccEl,p=c&&c.parentNode;function g(){v.assign(c.style,a),h&&(v.assign(h.style,a),this._checkBottomPosition())}c&&p&&(n=c.videoHeight,(s=c.videoWidth)&&n&&(e=c.getBoundingClientRect(),t=p.getBoundingClientRect(),i=e.height/e.width/(n/s),l=t.height-e.height,o=t.width-e.width,u=i<1||0!==o&&0===l,(a=(d=i>1||0===o&&0!==l)?{height:"auto","max-height":"100%",width:"100%",margin:0}:u?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0})&&g.call(this),e=c.getBoundingClientRect(),l=(t=p.getBoundingClientRect()).height-e.height,o=t.width-e.width,d?a={margin:"inherit","margin-top":r=l/2+"px","margin-bottom":r}:u&&(a={margin:"inherit","margin-left":r=o/2+"px","margin-right":r}),h&&(a["font-size"]=this._calculateFontSize(e.width)),a&&g.call(this)))},_calculateFontSize:function(t){var e;try{e=t/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),e=Math.max(e,parseInt(this.MIN_FONT_SIZE))}catch(t){console.error(t)}return e&&e+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(t){var e=t&&t.target,i=e&&e.activeCues||this._getActiveCues();this._setCueProps(i)},_setAllCueProps:function(){var t=this._getAllCues();this._setCueProps(t)},_setCueProps:function(t){this._addCuesToCaptionsElement(t)},_xmlToCues:function(t){var e,i,n,r,o,l,d,c,h,p,g,m=f(t);if(this._captionsJson=m,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",m),!v.isEmpty(m)&&v.isPlainObject(m))if(i=v.get(m,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",i),v.isUndefined(i)||v.isEmpty(i))this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file.");else if(e=this._supportsVTTCue?window.VTTCue:window.TextTrackCue){for((o=this._videoEl.addTextTrack("captions","English","en")).id=this._trackId,p=i.length,c=0;c<p;c++)if(h=c+1,d=i[c],r=i[h],l=d.text,!v.isEmpty(l)){for(l=(l=(l=l.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3")).replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3")).replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),g=s(l),d._lineCountPrev=d._lineCountPrev||0,d._lineCountNext=d._lineCountNext||0;(r&&r.begin)===d.begin;)r._lineCountPrev=g+d._lineCountNext,d._lineCountNext+=s(r.text),r=i[++h];(n=new e(a(d.begin),a(d.end),l))._lineCount=g,n._lineCountPrev=d._lineCountPrev,n._lineCountNext=d._lineCountNext,n._metadata=d.metadata,n=u.call(this,n),o.addCue(n)}this._finalizeCaptions()}else this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions.")},_addCuesToCaptionsElement:function(t){var e,i,n=uvpjs.util,s=this._ccEl,a='<div class="{{cntrClass}}">{{spans}}</div>',r="",o=t&&t.length;if(o){for(e=0;e<o;e++)i=t[e].text,n.isDefinedString(i)&&(r+='<span class="{{txtClass}}">'+(i=i.replace(/(\r\n|\n|\r)/g,"<br/>"))+"</span>",e+1!==o&&(r+="<br/>"));a=(a=(a=a.replace("{{spans}}",r)).replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME)).replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),s&&(s.innerHTML=a)}}}),e=function(t,e){var i=c(t)||r(t)||r(d(t));return i&&e?h(i.r,i.g,i.b,e):t},i=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},n=function(t){var e="100%";return t.indexOf("px")>-1?(e=t.replace("px",""),e=100*(e/=18)+"%"):t.indexOf("%")>-1&&(e=t),e},s=function(t){return t&&(t.match(/\n/g)||[]).length+1},a=function(t){var e,i;if(!v.isNull(t)&&!v.isUndefined(t))return i=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},e=t.split(":"),i(60*Number(e[0])*60+60*Number(e[1])+Number(e[2]),2)},r=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},o=function(t){return t instanceof window.TextTrack&&("captions"===t.kind||"subtitles"===t.kind)},l=function(t,e){if(t&&e)return v.get(window,"CSS.supports")?window.CSS.supports(t,e):"string"==typeof document.createElement("div").style[t]},u=function(t){var e,i=t._metadata;return i&&(t.snapToLines=!0,e=Math.round(i.cccol/35*100),t.position=e,t.align=e<45?"start":e>55?"end":this._lineAlign,t.positionAlign=e<45?"line-left":e>55?"line-right":"center",t.line=i.ccrow-17+this._lineOffset,t._defaults={line:t.line,position:t.position,align:t.align,positionAlign:t.positionAlign}),t},d=function(t){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[t.toLowerCase()]},c=function(t){var e;if(-1!==t.indexOf("rgba"))return{r:(e=t.substr(5,t.length).split(","))[0],g:e[1],b:e[2]}},p=function(t){if(v.isString(t)&&!v.isEmpty(t))return t.replace(/([A-Z])/g,"-$1").toLowerCase()},h=function(t,e,i,n){return"rgba("+[t,e,i,n].join(",")+")"},g=function(t){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[t]||"none"},f=function(t){var e={};if(1===t.nodeType&&t.attributes.length>0)for(var i=0,n=t.attributes.length;i<n;i++){var s=t.attributes.item(i);e[s.nodeName]=s.nodeValue}else 3===t.nodeType&&(e=t.nodeValue);if("p"===t.nodeName&&(e.text="",v.each(t.childNodes,function(t){if("metadata"!==t.nodeName){var i=(new XMLSerializer).serializeToString(t);1===t.nodeType&&(e.text+="br"===t.tagName?"\n":i),3===t.nodeType&&(e.text+=i)}})),t.hasChildNodes())for(var a=0,r=t.childNodes.length;a<r;a++){var o=t.childNodes.item(a),l=o.nodeName;if(void 0!==e[l]){if(void 0===e[l].push){var d=e[l];e[l]=[],e[l].push(d)}e[l].push(f(o))}else e[l]=f(o)}return e}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",controls:null,template:null,allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(t)},initialize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",t),this.overrideSessionOptions(t)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(t){var e;if(!uvpjs.util.isEmpty(t.standardParams)&&null===this.adCallParams.standardParams)for(e in this.adCallParams.standardParams={},t.standardParams)this.adCallParams.standardParams[e]=t.standardParams[e];if(!uvpjs.util.isEmpty(t.customParams)&&null===this.adCallParams.customParams)for(e in this.adCallParams.customParams={},t.customParams)this.adCallParams.customParams[e]=t.customParams[e]},overrideSessionOptions:function(t){var i=this.getSessionOptions(t);i&&e.isPlainObject(i)?this.sessionOptions=i:this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type.")},getSessionOption:function(t){return this.sessionOptions[t]||null},getSessionOptions:function(t){var i,n,s;if(i=e.clone(this.sessionOptions),!t||!e.isPlainObject(t))return i;if((n=t.skinConfig)&&!e.isEmpty(n))for(s in uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object."),n)i.hasOwnProperty(s)&&(i[s]=n[s]);for(s in i)t.hasOwnProperty(s)&&(i[s]=t[s]);return i},getModule:function(t){return n(this.modules,t)},getModules:function(){return this.modules},getModuleParam:function(t,e){var i=n(this.modules,t),s=n(i.params,e);if(s&&s.hasOwnProperty("value"))return s.value},setModule:function(t){r(this.modules,t,"name",this.DEBUG_ID)},isModuleEnabled:function(t){var e=this.getModule(t);if(!e){var i="ConfigDataObject isModuleEnabled module not found: "+t;return this.debug&&uvpjs.log(this.DEBUG_ID,i),!1}return this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+t+":",e.enabled),e.enabled},isModuleSet:function(t){return!!this.getModule(t)},getClass:function(t){return n(this.classes,t)},getClasses:function(){return this.classes},getClassProperty:function(t,e){var i=n(this.classes,t),s=a.call(this,i,"properties",this.DEBUG_ID),r=n(s,e);return a.call(this,r,"value",this.DEBUG_ID)},getClassListItems:function(t){var e=n(this.classes,t);return a.call(this,e,"list",this.DEBUG_ID)},getClassListItemProperty:function(t,e,i){var r=this.getClassListItems(t),o=s(r,e),l=a.call(this,o,"properties",this.DEBUG_ID),d=n(l,i);return a.call(this,d,"value",this.DEBUG_ID)},setClass:function(t){r(this.classes,t,"name",this.DEBUG_ID)},isCAN:function(){return e.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()}});var i=function(t,e,i){for(var n in t)if(t[n][e]==i)return t[n];return!1},n=function(t,e){return i(t,"name",e)},s=function(t,e){return i(t,"id",e)},a=function(t,e,i){return t?t.hasOwnProperty(e)?t[e]:(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",t,e),!1):(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",t),!1)},r=function(t,e,i,n){for(var s in t)if(t[s][i]==e[i])return this.debug&&uvpjs.log(n,"ConfigDataObject _addItemToArray updating existing item",e),void(t[s]=e);this.debug&&uvpjs.log(n,"ConfigDataObject _addItemToArray creating item",e),t.push(e)}}(uvpjs.register("uvpjs")),function(t){var e=t._,i=Math.random();t.ConfigManager=uvpjs.Class.subClass({init:function(t,e,n){this.debug=uvpjs.debug,t&&t===i?(this.initCallback=n,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",e),this.CDO=new uvpjs.ConfigDataObject(e),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.CDO.isCAN()&&this.configSources.push(uvpjs.ConfigManager.CAN_CONFIG_PATH),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance().")},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(this.configSources.length){var t=this.configSources.shift();if(null!=t)switch(t.constructor){case String:if(""===t)break;return void(new uvpjs.CodeLoader).loadXHR(t,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=t.concat(this.configSources);break;case Object:this.updateCDO(t)}this.loadConfig()}else e.isFunction(this.initCallback)&&this.initCallback(this.CDO)},onLoadComplete:function(t){var e,i,n=t.responseText,s=t.getResponseHeader("Content-Type");s.indexOf("application/json")>-1?i=JSON.parse(n):s.indexOf("text/xml")>-1||s.indexOf("application/xml")>-1?(e=(new DOMParser).parseFromString(n,"text/xml"),i=this.xmlToCDO(e)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",s),i&&this.updateCDO(i),this.loadConfig()},onLoadError:function(t){var e="unknown error";switch(t.status){case 0:e="request timeout"}this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",e,t),this.loadConfig()},updateCDO:function(t){e.isEmpty(t)?this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"):["classes","modules"].map(function(e){t.hasOwnProperty(e)&&(this.CDO[e]=n(this.CDO[e],t[e]))},this)},xmlToCDO:function(t){var e={},i=function(t){return"y"===t},n=s(t);return n.hasOwnProperty("player-config")&&(n=n["player-config"]),e.modules=function(){var t,e=[];if(n.modules){for(var s in t=a(n.modules.module)){var r=t[s],o={name:r.name,category:r.category,enabled:i(r.enabled),params:[]};if(t[s].hasOwnProperty("params")){var l=a(r.params.param);for(var d in l){var u=l[d];u.name&&(("y"===(c=u.value)||"n"===c)&&(u.value=i(u.value)),o.params.push(u))}}r.category;e.push(o)}var c;return e}}(),e.classes=function(){var t=a(n.classes),e=[];for(var i in t){var s=t[i];if(s.hasOwnProperty("classDef")&&(s=s.classDef),s.name){var r={name:s.name,className:s.className,properties:[],list:[]};if(s.hasOwnProperty("list")){var o=a(s.list.listitem);for(var l in o){var d=o[l];d.id&&(d.hasOwnProperty("properties")&&(d.properties=d.properties.property),r.list.push(d))}}s.hasOwnProperty("properties")&&(r.properties=s.properties.property),e.push(r)}}return e}(),e},getCDO:function(){return this.CDO}}),t.ConfigManager.CAN_CONFIG_PATH="//can.cbs.com/thunder/player/chrome/smart_tag/config.php?url=http://can.cbs.com/thunder/player/chromeless/uvp/can.xml",t.ConfigManager._instance=null,t.ConfigManager.destroyInstance=function(){this._instance=null},t.ConfigManager.getInstance=function(t,e){return this._instance||(this._instance=new uvpjs.ConfigManager(i,t,e)),this._instance};var n=function(t,e){for(var i in e){var n=!1;for(var s in t)if(t[s].name===e[i].name){n=!0;break}n||t.push(e[i])}return t},s=function(t){var e,i={};if(1===t.nodeType&&t.attributes.length>0){e=t.attributes.length;for(var n=0;n<e;n++){var a=t.attributes.item(n);i[a.nodeName]=a.nodeValue}}if(t.hasChildNodes()){e=t.childNodes.length;for(var r=0;r<e;r++){var o=t.childNodes.item(r),l=o.nodeName;if(3!==o.nodeType)if(void 0!==i[l]){if(void 0===i[l].push){var d=i[l];i[l]=[],i[l].push(d)}i[l].push(s(o))}else i[l]=s(o)}}return i},a=function(t){if(void 0!==t&&t.constructor!==String)return t.constructor===Object&&(t=[t]),t}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=null,i=null,n=t._;t.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1},initialize:function(t){var n=t.resourceProvider,s=n.vidContId;this.resourceProvider=n,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=s,this.assetURL=t.assetURL,this.vidContentId=this.PREFIX_CONTENT+s,this.internalNS="."+s+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+s),this.deferLoadingCaptions=t.deferLoadingCaptions,this._updateVolumeSettings(t),n.createWatermark()&&!t.suppressWatermark&&(e=new uvpjs.Watermark({containerId:s,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),n.is360()&&!t.suppress360&&(i=new uvpjs.Kaleidoscope360({containerId:s,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==t.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){n.isEmpty(this.resourceProvider)?this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."):(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),e&&(e.destroy(),e=null),i&&(i.destroy(),i=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1)},_updateVolumeSettings:function(t){var e=(t=t||{}).volume,i=!0===t.isMuted,n=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",t),uvpjs.util.inRange(e,0,1)&&n.volume!==e&&(n.volume=e),"isMuted"in t&&n.muted!==i&&this.muteVideo(i)},_addHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events"),e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.addEventListener(e[t],this,!1);this.videoTagRef.addEventListener(e[i],this,!1)},_removeHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events"),e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.removeEventListener(e[t],this,!1);this.videoTagRef.removeEventListener(e[i],this,!1)},handleEvent:function(t){var e=this.eventTypes.HTML5;if(this.videoTagRef)switch(t.type){case e.ABORT:break;case e.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(e.CAN_PLAY,this,!1);break;case e.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(e.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.CLICK:case e.DURATION_CHANGE:break;case e.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case e.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case e.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(t.target.error);break;case e.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),n.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case e.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case e.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case e.PLAY:break;case e.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case e.PROGRESS:this.videoLoading();break;case e.RATE_CHANGE:break;case e.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",t);break;case e.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",t),this.seeked(t.target.currentTime);break;case e.STALLED:case e.SUSPEND:break;case e.TIME_UPDATE:this.timeUpdated();break;case e.VOL_CHANGE:this.volumeChanged();break;case e.WAITING:}},seeked:function(t){var e=this.videoTagRef.paused,i=uvpjs.mediaCapabilities;this.playbackStateChange(e?i.PAUSED:i.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:t,paused:e,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:t})},videoLoading:function(){var t;try{t=this.videoTagRef.buffered.end(0)||0}catch(e){t=0}var e={bufferLength:t,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(e)},volumeChanged:function(){var t=this.videoTagRef.volume;!n.isNumber(t)||t<0?t=0:t>1&&(t=1),this.resourceProvider.facadeVolumeChange(t)},timeUpdated:function(){var t=this.videoTagRef.currentTime;"number"==typeof t&&this.resourceProvider.facadeTimeUpdate(t)},error:function(t){var e=uvpjs.ErrorInfo.messages,i=uvpjs.ErrorInfo.errorCodes,s=e.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,a=i.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,r=!0;if(t)switch(t.code){case t.MEDIA_ERR_ABORTED:r=!1,s=e.MEDIA_ERR_ABORTED,a=i.MEDIA_ERR_ABORTED;break;case t.MEDIA_ERR_NETWORK:s=e.MEDIA_ERR_NETWORK,a=i.MEDIA_ERR_NETWORK;break;case t.MEDIA_ERR_DECODE:s=e.MEDIA_ERR_DECODE,a=i.MEDIA_ERR_DECODE;break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:s=e.MEDIA_ERR_SRC_NOT_SUPPORTED,a=i.MEDIA_ERR_SRC_NOT_SUPPORTED}this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+s),n.isEmpty(this.resourceProvider)?this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."):this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:a,message:s,isFatal:r}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var t;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(t=this.videoTagRef.play())&&t.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+t.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(t.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",t),isNaN(t)||this.videoTagRef&&t>=0&&t<this.videoTagRef.duration&&(this.videoTagRef.currentTime=t)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var t=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!isNaN(t)&&t>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=t)}},toggleMute:function(){var t;this.videoTagRef&&(t=!this.videoTagRef.muted,this.muteVideo(t))},setFullscreenState:function(t){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(t){var e=!1!==t;this.videoTagRef&&(this.videoTagRef.muted=e,e&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!e&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(t){this.videoTagRef&&t>=0&&t<=1&&(this.videoTagRef.volume=t)},getDuration:function(){var t=0;return this.videoTagRef&&(t=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(t=this.videoTagRef.seekable.end(0)),t},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(t){(!this.isAbrStreamingSupported()||"boolean"!=typeof t)&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(t,e,i){if(t.length>0){var n=t.length,s=t[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(e>=t[n-1][s])return n-1;for(;n--;){if(e>=t[n][s])return i?n+1:n}}return 0},addSessionIdAndTicketToURL:function(t,e,i){if(!t)return t;var n=function(t){return-1!==t.indexOf("?")?"&":"?"};return e&&-1===t.indexOf("SessionId=")&&(t+=n(t)+"SessionId="+e),i&&-1===t.indexOf("Ticket=")&&(t+=n(t)+"Ticket="+i),t},processResponseHeader:function(t,e){switch(e){case this.responseHeaders.MULTI_CDN:this.resourceProvider.getContentVideoStateCdn()!==t&&this.resourceProvider.setContentVideoStateCdn(t)}},getCdnNameAtStartup:function(t){return this.resourceProvider.cviModel.CDN_TYPE.AKAMAI},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(t,e){},getBuffered:function(){var t,e=this.videoTagRef,i=e&&e.buffered,n=0,s=0;return i&&i.length>0&&(n=i.start&&i.start(0),s=i.end&&i.end(0)),(t=s-n)>0&&t||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(t){if(this.videoTagRef){var e=this.videoTagRef.hasAttribute(this.CONTROLS);t&&!e?this.videoTagRef.setAttribute("controls",this.CONTROLS):!t&&e&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(t){if(t!==this.playbackState){if(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+t),n.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(t)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var t=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!n.isUndefined(t),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,t=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",t),t}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(t){for(var e in t)this.initOptions[e]=t[e];t.suppress360=!0,t.suppressCreatedEvent=!0,this._super(t),this.swfService=t.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){var t;for(t in this.windowLabels)window[this.windowLabels[t]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(t){this.player&&this.player.setVolume(t)},seekTo:function(t){this.player&&this.player.seekTo(t)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(t){this.swfService.resetSize()},loadCaptions:function(t){this.captionsUrl=uvpjs.util.isEmpty(t)?null:t,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(t)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(t){for(var e,i,n,s=Array.isArray(t)&&t.length||0,a=uvpjs.util,r=uvpjs.VPF_Flash.styleTransform;s--;)e=t[s],n=r[i=this.dashToCamel(e.name)]?r[i](e.value):e.value,!a.isEmpty(e.value)&&this.player.setStyleAttribute(i,n)},setId3Options:function(t){this.id3Options=t},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(t){var e=!1===t?"false":"true";this.player.enableDynamicStreaming(e)},switchToBitrate:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&this.player.switchStreamingIndex(e.index)},setMinBitrateAllowed:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&(this.bitrateInfo.min=e.bitrate,this.player.setMinimumStreamingIndex(e.index))},setMaxBitrateAllowed:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&(this.bitrateInfo.max=e.bitrate,this.player.setMaximumStreamingIndex(e.index))},switchUp:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t),i=-1!==e.index&&this.bitrateInfo.bitrates.length;-1!==e.index&&e.index<i-1&&this.player.switchStreamingIndex(e.index+1)},switchDown:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t);-1!==e.index&&e.index>0&&this.player.switchStreamingIndex(e.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var t=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return t?this.bitrateInfo.bitrates[t-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(t){for(var e,i=this.bitrateInfo.bitrates,n=i?i.length:0,s={bitrate:0,delta:1/0,index:-1};n--;)(e=Math.abs(t-i[n]))<s.delta&&(s.bitrate=i[n],s.index=n,s.delta=e);return s},hContentEvent:function(t){var e=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(t){case e.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case e.CONTENT_END:}},hPlaybackEvent:function(t,e){var i,n=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(t){case n.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+e);break;case n.VIDEO_PROGRESS:this.processCvioPayload(e);break;case n.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(e);break;case n.VIDEO_ERROR:this.processCvioPayload(e),this.dispatchError();break;case n.VIDEO_DONE:this.processCvioPayload(e),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case n.VIDEO_TRANSITION_COMPLETE:i=this.parsePayload(e),this.resourceProvider.facadeVideoTransitionComplete(i.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case n.VIDEO_TRANSITION_START:i=this.parsePayload(e),this.pendingSwitchMode=i.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(i.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(t){var e,i,n=this.parsePayload(t,"ContentVIO");if(n){for(e in i=n.ContentVIO)this.currFlashVideoState[e]=this.getCvioValue(i[e]);null===this.bitrateInfo.bitrates&&i.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var t=[],e=[],i=this.player.getContentBitrateInfo(),n="string"==typeof i&&i.split(","),s=Array.isArray(n)?n.length:0;s--;)t[s]=+n[s],e[s]={bitrate:+n[s]};this.bitrateInfo.bitrates=t,this.bitrateInfo.abrInfo=e},processCuepointPayload:function(t){var e=this.parsePayload(t,"Cuepoint"),i=this.id3Options,n={pts:null};!e||!i.dataCallback||e.text.indexOf("syncbak.cc")>=0||(n.name=i.findNielsen&&e.text.indexOf("www.nielsen.com")>-1?"www.nielsen.com":e.name,n.data=e.text,i.dataCallback(n))},getCvioValue:function(t){var e,i,n,s,a;return"boolean"==typeof t||"number"==typeof t?t:"string"==typeof t?(i=!(e="NaN"===t||"null"===t||""===t)&&"true"===t.toLowerCase(),n=!e&&!i&&"false"===t.toLowerCase(),s=!e&&!i&&!n&&parseInt(t),a=isNaN(s)?t:s,e?-1:!!i||!n&&a):void 0},parsePayload:function(t,e){var i=null;if(0===t.indexOf("{")||0===t.indexOf("[")){try{i=JSON.parse(t)}catch(t){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+e+"as JSON; "+t.message),null}return i}return t},addUvpFlashEventListeners:function(){var t,e,i,n,s,a=uvpjs.VPF_Flash.uvpFlashEvent,r={},o=function(t,e,i){return t["h"+(e.charAt(0).toUpperCase()+e.substr(1))+"Event"].bind(t,i)};for(i in a)for(s in e=a[i])r[n=e[s]]=o(this,i,n);for(i in t=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(r))this.player.addEventJSCallback(i,t[i])},loadVideo:function(){var t={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(t.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,t)},initializeCaptionStyles:function(){var t,e={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(t in e)this.player.setStyleAttribute(t,e[t])},dashToCamel:function(t){return t.replace(/(-\w)/g,function(t){return t[1].toUpperCase()})}}),t.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},t.VPF_Flash.styleTransform={_opacity:function(t){return 100*+t},backgroundOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontSize:function(t){var e=.01*+t.substr(0,t.indexOf("%"));return Math.round(14*e)}}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(t){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",t.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",t)),this._super(t),t.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:t.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!uvpjs.util.isEmpty(t.startTime)&&(this.startTime=Math.floor(t.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",t)},handleEvent:function(t){var e=this.eventTypes.HTML5;this.videoTagRef&&(this._super(t),t.type===e.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(t,e){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:t,message:e,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(t){console.log("Error caught at setSource: ",t)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(this.activeMetadataTrack=t.track),t.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(t){t&&t.target&&t.target.activeCues&&t.target.activeCues.length>=1&&("metadata"===t.target.kind?this.resourceProvider.facadeId3Data(t.target.activeCues):"captions"!==t.target.kind&&"subtitles"!==t.target.kind||(t.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(t){if(e.isEmpty(this.resourceProvider)||e.isEmpty(this.resourceProvider.cviModel))this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",t);else{var i=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",t,i)}}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"production"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isLiveStreamKnown=!1,this._isHdStreamLive=!1,this._isPlayingLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy"),this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null},initialize:function(t){return this._super(t),this.id3HandlingEnabled=t.enableId3Handling,"number"==typeof t.liveSyncDurationCount&&t.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=t.liveSyncDurationCount),!0===t.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=t.capLevelToPlayerSize),uvpjs.util.isEmpty(t.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=t.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof t.startBitrate&&t.startBitrate>-1&&(this.startBitrate=t.startBitrate),"number"==typeof t.maxBitrate&&t.maxBitrate>-1&&(this.maxBitrate=t.maxBitrate),"number"==typeof t.minBitrate&&t.minBitrate>-1&&(this.minBitrate=t.minBitrate),t.startTime&&(this.startTime=Math.round(t.startTime)),t.errorRecovery&&this.setErrorRecoveryOverrides(t.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){var t=this.player,e=this.player.liveSyncPosition,i=this.isHDStreamLive();i&&t&&e?this.seekTo(e):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+i)},seekTo:function(t){var e=this.player,i=this.player.liveSyncPosition,n=this.isHDStreamLive();this._isPlayingLive=e&&n&&i&&t===i,this._super(t)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(t){this._super(),this.player?this.player.nextLevel=t?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(t){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,t,!1))},switchToIndex:function(t){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var e=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,i=isNaN(e)?this.bitrateList.length-1:e;t>=0&&t<=i?this.player.nextLevel=t:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",i," : Index=",t)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){this.player.subtitleTracks.length>0&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var t=this.player;return this.startBitrate||this.minBitrate||t&&t.levels&&t.levels[0]&&t.levels[0].bitrate||-1},setStartBitrate:function(t){this.player?(t<this.getMinBitrateAllowed()&&(t=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,t,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var t=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[t].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(t){if(this.player){this.player.config.minAutoBitrate=t-1;var e=this.getIndexForBitrate(this.bitrateList,t,!0);this.player.currentLevel<e&&(this.player.nextAutoLevel=e),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",t)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var t=this.player.maxAutoLevel;return void 0!==t?this.bitrateList[t].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(t){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===t?t:this.getIndexForBitrate(this.bitrateList,t,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",t)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var t=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(t=this.bitrateList[this.player.currentLevel].bitrate),t},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var t,e;if(this.player)return(e=(t=this.player.media).getVideoPlaybackQuality)&&"function"==typeof e?e.call(t).droppedVideoFrames:t.webkitDroppedFrameCount||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var t=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,e=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(e,t)},getFacadeState:function(){this.videoTagRef&&this.videoTagRef.length>0&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var t={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(t.abrInfo=this.bitrateList,t.currentAbr=this.bitrateList[this.player.currentLevel],t.cappedAbrInfo=this.getCappedAbrInfo(),t.startBitrate=this.getStartBitrate(),t.currentBitrate=this.getCurrentBitrate(),t.minBitrate=this.getMinBitrateAllowed(),t.maxBitrate=this.getMaxBitrateAllowed()),t},getStreamType:function(){return"HLS"},isPlayingLive:function(){return this._isPlayingLive},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,n=this.onFragmentEvent;this.player.on(t.MEDIA_ATTACHING,e,!1),this.player.on(t.MEDIA_ATTACHED,e,!1),this.player.on(t.MEDIA_DETACHING,e,!1),this.player.on(t.MANIFEST_PARSED,e,!1),this.player.on(t.MANIFEST_LOADED,e,!1),this.player.on(t.MANIFEST_LOADING,e,!1),this.player.on(t.FPS_DROP,e,!1),this.player.on(t.SUBTITLE_TRACKS_UPDATED,e,!1),this.player.on(t.LEVEL_SWITCHING,i,!1),this.player.on(t.LEVEL_SWITCHED,i,!1),this.player.on(t.LEVEL_LOADING,i,!1),this.player.on(t.LEVEL_LOADED,i,!1),this.player.on(t.LEVEL_UPDATED,i,!1),this.player.on(t.LEVEL_PTS_UPDATED,i,!1),this.player.on(t.FRAG_LOADING,n,!1),this.player.on(t.FRAG_LOAD_PROGRESS,n,!1),this.player.on(t.FRAG_LOADED,n,!1),this.player.on(t.FRAG_PARSED,n,!1),this.player.on(t.FRAG_BUFFERED,n,!1),this.player.on(t.FRAG_CHANGED,n,!1),this.player.on(t.FRAG_PARSING_DATA,n,!1),this.id3HandlingEnabled&&this.player.on(t.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(t.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,n=this.onFragmentEvent;this.player.off(t.MEDIA_ATTACHING,e),this.player.off(t.MEDIA_ATTACHED,e),this.player.off(t.MEDIA_DETACHING,e),this.player.off(t.MANIFEST_PARSED,e),this.player.off(t.MANIFEST_LOADED,e),this.player.off(t.MANIFEST_LOADING,e),this.player.off(t.FPS_DROP,e),this.player.off(t.SUBTITLE_TRACKS_UPDATED,e),this.player.off(t.LEVEL_SWITCHING,i),this.player.off(t.LEVEL_SWITCHED,i),this.player.off(t.LEVEL_LOADING,i),this.player.off(t.LEVEL_LOADED,i),this.player.off(t.LEVEL_UPDATED,i),this.player.off(t.LEVEL_PTS_UPDATED,i),this.player.off(t.FRAG_LOADING,n),this.player.off(t.FRAG_LOAD_PROGRESS,n),this.player.off(t.FRAG_LOADED,n),this.player.off(t.FRAG_PARSED,n),this.player.off(t.FRAG_BUFFERED,n),this.player.off(t.FRAG_CHANGED,n),this.player.off(t.FRAG_PARSING_DATA,n),this.id3HandlingEnabled&&this.player.off(t.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(t.ERROR,this.onError)},handleManifestData:function(t){this.bitrateList=this.player.levels;for(var e,i=t.levels,n=i.length,s=[];n--;)e=i[n],s.unshift({name:e.name||null,rate:e.bitrate,width:e.width,height:e.height});s.sort(function(t,e){var i=t.rate,n=e.rate;return i<n?-1:i>n?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:s})},onRequest:function(t,e){this.withCredentials=this.withCredentials||e.indexOf("akamaihd")>-1&&e.indexOf("csmil")>-1,t.withCredentials=this.withCredentials,(this.multiCDNEnabled||-1!==e.indexOf(".m3u8"))&&t.addEventListener("readystatechange",function(i){if(-1!==e.indexOf(".m3u8"))t.readyState===XMLHttpRequest.DONE&&200===t.status&&(this._isHdStreamLive=-1===t.responseText.indexOf("STREAM-INF")&&-1===t.responseText.indexOf("EXT-X-ENDLIST"),!this._isLiveStreamKnown&&this._isHdStreamLive&&(this._isPlayingLive=!0,this._isLiveStreamKnown=!0));else if(-1!==e.indexOf(".ts")&&t.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled){var n=t.getAllResponseHeaders();this.multiCDNEnabled=-1!==n.indexOf(this.responseHeaders.MULTI_CDN);var s=this.multiCDNEnabled?t.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(e);this.processResponseHeader(s,this.responseHeaders.MULTI_CDN)}}.bind(this))},onLibraryEvent:function(t,e){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.MEDIA_ATTACHING:case i.MEDIA_ATTACHED:case i.MEDIA_DETACHING:case i.MANIFEST_LOADING:break;case i.MANIFEST_PARSED:this.handleManifestData(e);break;case i.FPS_DROP:break;case i.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case i.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(t,e){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(e.details);break;case i.LEVEL_LOADING:case i.LEVEL_UPDATED:case i.LEVEL_PTS_UPDATED:break;case i.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[e.level].bitrate);break;case i.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[e.level].bitrate)}},onFragmentEvent:function(t,e){var i,n,s=Hls.Events;switch(t){case s.FRAG_LOAD_PROGRESS:break;case s.FRAG_PARSING_DATA:"video"===e.type&&(this._playbackFramerate=e.nb/(e.endPTS-e.startPTS));break;case s.FRAG_LOADED:i=8e3*(n=e.stats).loaded/Number(window.performance.now()-n.trequest),this._currentBandwidth=i,this._currentMaxBandwidth=Math.max(i,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case s.FRAG_CHANGED:}},onID3Event:function(t,e){this.resourceProvider.facadeId3Data(e.samples)},onError:function(t,e){var i=!1,n=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(e.fatal&&-1===n.indexOf(e.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal),e.type){case Hls.ErrorTypes.NETWORK_ERROR:(i=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts)&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(i).network());break;case Hls.ErrorTypes.MEDIA_ERROR:i=this.tryRecoveryFromMediaError()}else e.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",e.type,e.details,"isFatal: "+e.fatal),i=this.tryRecoveryFromMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal);i||(e.response&&e.response.code&&e.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,e.details,e.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(e.type,e.details,e.fatal)))},tryRecoveryFromMediaError:function(){var t=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return t&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(t).media()),t},getErrorMsg:function(t){var e=t?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,i=" attempt : ";return{network:function(){return i+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+e+i}.bind(this),media:function(){return i+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+e+i}.bind(this)}},getErrorInfoForType:function(t,e,i){var n=uvpjs.ErrorInfo,s=Hls.ErrorTypes,a=uvpjs.ErrorInfo.errorCodes;switch(t){case s.NETWORK_ERROR:return new n({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_NETWORK_ERROR,message:n.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",e),isFatal:i});case s.MEDIA_ERROR:return new n({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_MEDIA_ERROR,message:n.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",e),isFatal:i});case s.MUX_ERROR:return new n({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_MUX_ERROR,message:n.messages.HLSJS_MUX_ERROR.replace("{INFO}",e),isFatal:i});case s.OTHER_ERROR:return new n({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_OTHER_ERROR,message:n.messages.HLSJS_OTHER_ERROR.replace("{INFO}",e),isFatal:i});case a.RESOURCE_GEOBLOCKED:return new n({errorCode:a.RESOURCE_GEOBLOCKED,hlsjsErrorCode:a.HLSJS_OTHER_ERROR,message:n.messages.RESOURCE_GEOBLOCKED,isFatal:i})}},setErrorRecoveryOverrides:function(t){["network","media"].forEach(function(e){t[e]&&t[e].attempts&&"number"==typeof t[e].attempts&&(this.errorRecovery[e+"RetryAttempts"]=t[e].attempts)}.bind(this))}}),function(t){"use strict";function e(t){if(!isNaN(t))return t<1048576?(t/1024).toFixed(2)+"k":t<1073741824?(t/1048576).toFixed(2)+"M":(t/1073741824).toFixed(2)+"G"}uvpjs.register("uvpjs").Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(t){var e,i=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),t&&(e=t.videoEl,this._videoEl=e,this._containerEl=t.containerEl,this._eventsMgr=t.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":i.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),this._diagEl&&this._contentEl?(this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window.")},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=t,this._createDiag(),this._addEventListeners()},_createDiag:function(){var t,e,i,n=uvpjs.util,s=this._styleEl,a=this._contentEl;this._template,this._params;a&&((t=document.createElement("div")).id=this._diagnosticId,a.insertBefore(t,a.firstChild),(i=uvpjs.util.htmlToElement("<span>x</span>")).addEventListener("click",this._handleCloseButton.bind(this),!0),t.appendChild(i),e=document.createElement("table"),t.appendChild(e),n.addCSSObject(s,t,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),n.addCSSObject(s,t,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),n.addCSSObject(s,t,{color:"#fff"},"span:hover"),n.addCSSObject(s,t,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),n.addCSSObject(s,t,{background:"transparent"},"table td"),n.addCSSObject(s,t,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),n.addCSSObject(s,t,{width:"60px"},"table td:last-child"),this._diagEl=t,this._diagTableEl=e,this._hideDiagBtn=i)},_removeDiag:function(){var t=this._diagEl,e=this._hideDiagBtn;e&&e.removeEventListener("click",this._handleCloseButton.bind(this)),t&&t.remove()},_hideDiag:function(){var t=this._diagEl,e=this._eventsMgr;t&&(t.style.display="none"),e.dispatchEvent(e.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var t=this._diagEl;t&&(t.style.display="block")},_toggleDiag:function(){var t=this._diagEl;t&&("block"!==t.style.display?this._showDiag():this._hideDiag())},_handleCloseButton:function(){var t=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),t.dispatchEvent(t.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;this._containerEl;e&&t?(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_START+t,this._onVideoTransitionStart.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_COMPLETE+t,this._onVideoTransitionComplete.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;this._containerEl;e&&t?(e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_TRANSITION_START+t),e.removeEventListener(i.VIDEO_TRANSITION_COMPLETE+t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners.")},_updateTableHtml:function(){var t,e,i="",n=this._params;for(t in n)null!=(e=n[t])&&(i+="<tr><td>"+t+"</td><td>"+e+"</td></tr>");this._diagTableEl.innerHTML=i},_onVideoProgress:function(t){var i=t.payload,n=i.facadeState,s=this._params,a=n.minABRLevel,r=n.maxABRLevel;t.target===this._containerId&&(s["stream type"]=i.streamType,s.duration=i.duration,s["current time"]=i.currentTime.toFixed(2),s["buffer length"]=i.bufferLength.toFixed(2),s["total dropped frames"]=i.droppedFrames>=0&&i.droppedFrames||null,s["average dropped (fps)"]=i.averageDroppedFPS>=0&&i.averageDroppedFPS.toFixed(2)||null,s["playback framerate (fps)"]=i.playbackFramerate>=0&&i.playbackFramerate.toFixed(2)||null,s["current bandwidth (B/s)"]=i.currentBandwidth>=0&&e(i.currentBandwidth)||null,s["switching mode"]=i.switchingMode,s["current index bitrate (B/s)"]=e(n.currentAbr&&n.currentAbr.bitrate),s["start index bitrate (B/s)"]=e(n.startBitrate),void 0!==a&&void 0!==r&&(s["available indexes"]=a+" to "+r),this._updateTableHtml())},_onVideoStateChange:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(i["playback state"]=e.newState,this._updateTableHtml())},_onVideoTransitionStart:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",e),i["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",e),i["transition state"]="complete",this._updateTableHtml())}})}(),function(t){"use strict";uvpjs.register("uvpjs").Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){this._imgEl&&this._contentEl?(this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark.")},_createImage:function(){var t;this._contentEl&&((t=document.createElement("img")).id=this._watermarkId,t.src=this.IMAGE,t.style.position="absolute",t.style.display="none",this._imgEl=t,this._contentEl.appendChild(t))},_removeImage:function(){var t=this._imgEl;t&&t.parentNode&&t.parentNode.removeChild(t)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var t=this._imgEl;t&&(t.style.display="none")},_showImage:function(){var t=this._imgEl;t&&(t.style.display="block")},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.addEventListener(i.AD_START+t,this._hideImage.bind(this)),e.addEventListener(i.CONTENT_START+t,this._showImage.bind(this)),e.addEventListener(i.CONTENT_END+t,this._hideImage.bind(this)),e.addEventListener(i.CONTAINER_RESIZE+t,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),e.addTimedEventCallback(e.HALF_SECOND,t,this._ensureImage.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.removeEventListener(i.AD_START+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeTimedEventCallback(this.TIMER_INTERVAL,t),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(t){t.target===this._containerId&&this._setPosition()},_setPosition:function(){var t,e,i,n,s,a,r,o,l,d,u,c,h,p,g,f,v,m,_,E,A;e=this._contentEl,i=this._videoEl,(t=this._imgEl)&&i&&e&&(h=i.videoHeight,(p=i.videoWidth)&&h&&(a=this.OFFSET,d=this.SIZE,r=i.getBoundingClientRect(),g=e.getBoundingClientRect(),u=(o=r.height)/(l=r.width)/(c=h/p),n=l*c,s=o/c,f=g.bottom-r.bottom,v=g.right-r.right,u>1?(m=(o-n)/2,_=0,A=l*d+"px",E="auto"):(m=0,_=(l-s)/2,A="auto",E=o*d*(this.RATIO/c)+"px"),t.style.width=A,t.style.height=E,t.style.bottom=m+f+a+"px",t.style.right=_+v+a+"px"))}})}(),function(t){"use strict";uvpjs.register("uvpjs").Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){this._360El&&this._kaleidoscopeViewer?(this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360.")},_loadKaleidoscope:function(t){if("function"==typeof t){if(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),!window.Kaleidoscope||!window.Kaleidoscope.Video)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB);this.pluginLoadedCB()}else this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.addEventListener(i.CONTAINER_RESIZE+t,this._handleContainerResize.bind(this)),e.addEventListener(i.CONTENT_START+t,this._startKaleidoscopeRender.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeEventListener(i.CONTENT_START+t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")}})}(),uvpjs.register("uvpjs").ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(t,e,i){this.debug=uvpjs.debug,this.validationInfo=null,this.id=e,this.vidContId=i,this.rcoSeed={},this.initialize(t)},initialize:function(t){this.validationInfo=this.validateUserRco(t),this.validationInfo&&(this.rcoSeed=t,this.populateSelf(t))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(t){var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},has:function(t){return!uvpjs.util.isEmpty(this[t])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(t){return{error:!1,message:""}}}),uvpjs.register("uvpjs").RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t),i=uvpjs.util.isDefinedString(t.assetURL);return{error:e.error||!i,message:e.error?e.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(t,e,i)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(t){this.cmsRefGuid=t,this.daiParams.daiVideoId=t},canMakePlatformCall:function(t){var e=uvpjs.util.isDefinedString(t),i=this.has("selectorCall")&&this.selectorCall||e&&t;return!!i&&(i.indexOf("$PID$")>-1?this.has("pid"):!(i.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var t=this.daiParams.dfpMediaId,e=this.daiParams.daiVideoId,i=t||e||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return t||e||i},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(t){var e=window.google&&google.ima&&google.ima.dai,i=this.validateDaiConfig(t),n=this._super(t),s=e?i?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!((t.useSsb||e)&&i&&!n.error),missingSDK:!e,message:n.error?n.message:s}},populateSelf:function(t){var e,i;for(e in t)(i=t.hasOwnProperty(e))&&void 0!==this.daiParams[e]?this.daiParams[e]=t[e]:i&&(this[e]=t[e]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(t){var e=uvpjs.util,i=!e.isEmpty(t.adTagParameters),n=!e.isEmpty(t.contentSourceId);return t.useSsb||i&&n?t.useSsb?!e.isEmpty(t.assetURL):i&&n:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),i&&n)},checkCustomAdTagParams:function(){var t,e=uvpjs.util,i=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;i&&"string"!=typeof i&&e.isPlainObject(i)&&(t=e.queryStrFromObj(i),this.daiParams.adTagParameters.cust_params=encodeURIComponent(t))}}),uvpjs.register("uvpjs").RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=window.google&&google.ima,i=this._super(t);return{error:!(e&&!i.error),missingSDK:!e,message:i.error?i.message:"IMA SDK is missing."}}}),uvpjs.register("uvpjs").RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t);return{error:e.error||!uvpjs.util.isDefinedString(t.assetURL),message:e.err?e.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=uvpjs.util,i=e.isDefinedString(t.pid),n=!i&&e.isDefinedString(t.cmsRefGuid)&&!e.isDefinedString(t.assetURL),s=this._super(t);return{error:!(!s.error&&(i||n||e.isDefinedString(t.selectorCall))),message:s.error?s.message:"Supplied RCO is not valid for type rp_platform"}}}),function(t){"use strict";t.UvpSwfService=uvpjs.Class.subClass({init:function(t){this.debugId=t.debugId,this.debug=uvpjs.debug,this.containerId=t.containerId,this.dom=t.contentVideoDom,this.playerDom=t.playerDom,this.callback=t.readyCallback,this.id3OwnerIds=t.id3OwnerIds||"",this.capLevelToPlayerSize=t.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){var t;for(t in this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype,this.windowLabels)window[this.windowLabels[t]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var t=this.getContainerSize(),e=t.width,i=t.height;this.swf&&this.swf.setSize(e,i,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=-1!==navigator.appName.indexOf("Microsoft")?window[this.swfName]:document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(t){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(t){t.success?this.startTimer():this.callback(null,this.svcC.error.EMBED_FAILED)},embed:function(t){var e=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,t,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:e.jsReady,playerReady:e.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var t,e,i=this.dom;this.svcC.hasFlash()?(this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),(t=document.createElement("div")).id=this.swfName,(e=i.querySelector("video")).style.display="none",i.style.height="100%",this.playerDom.style.height="100%",i.insertBefore(t,e),this.embed(t)):this.callback(null,this.svcC.error.FLASH_NOT_DETECTED)}}),t.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"//vidtech.cbsinteractive.com/uvpjs/uvpjsf/js_falback.swf",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},t.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},t.UvpSwfService.hasFlash=function(){var t=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(t)&&parseInt(t)>0},t.UvpSwfService.setWindowMethods=function(t){var e,i,n,s=uvpjs.util;for(e in t)i=t[e],n="f_"+s.uid8(),window[n]=i,t[e]=n;return t},t.UvpSwfService.swfobject=function(){var t,e,i,n,s,a,r="undefined",o="object",l="Shockwave Flash",d="application/x-shockwave-flash",u="SWFObjectExprInst",c="onreadystatechange",h=window,p=document,g=navigator,f=!1,v=[],m=[],_=[],E=[],A=!1,y=!1,b=!0,S=!1,T=function(){var t=typeof p.getElementById!=r&&typeof p.getElementsByTagName!=r&&typeof p.createElement!=r,e=g.userAgent.toLowerCase(),i=g.platform.toLowerCase(),n=/win/.test(i||e),s=/mac/.test(i||e),a=!!/webkit/.test(e)&&parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),u="Microsoft Internet Explorer"===g.appName,c=[0,0,0],v=null;if(typeof g.plugins!=r&&typeof g.plugins[l]==o)(v=g.plugins[l].description)&&typeof g.mimeTypes!=r&&g.mimeTypes[d]&&g.mimeTypes[d].enabledPlugin&&(f=!0,u=!1,v=v.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),c[0]=F(v.replace(/^(.*)\..*$/,"$1")),c[1]=F(v.replace(/^.*\.(.*)\s.*$/,"$1")),c[2]=/[a-zA-Z]/.test(v)?F(v.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof h.ActiveXObject!=r)try{var m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");m&&(v=m.GetVariable("$version"))&&(u=!0,c=[F((v=v.split(" ")[1].split(","))[0]),F(v[1]),F(v[2])])}catch(t){}return{w3:t,pv:c,wk:a,ie:u,win:n,mac:s}}();T.w3&&((typeof p.readyState!=r&&("complete"===p.readyState||"interactive"===p.readyState)||typeof p.readyState==r&&(p.getElementsByTagName("body")[0]||p.body))&&C(),A||(typeof p.addEventListener!=r&&p.addEventListener("DOMContentLoaded",C,!1),T.ie&&(p.attachEvent(c,function t(){"complete"==p.readyState&&(p.detachEvent(c,t),C())}),h==top&&function t(){if(!A){try{p.documentElement.doScroll("left")}catch(e){return void setTimeout(t,0)}C()}}()),T.wk&&function t(){A||(/loaded|complete/.test(p.readyState)?C():setTimeout(t,0))}()));function C(){if(!A&&document.getElementsByTagName("body")[0]){try{var t,e=x("span");e.style.display="none",(t=p.getElementsByTagName("body")[0].appendChild(e)).parentNode.removeChild(t),t=null,e=null}catch(t){return}A=!0;for(var i=v.length,n=0;n<i;n++)v[n]()}}function I(t){A?t():v[v.length]=t}function D(){var t=m.length;if(t>0)for(var e=0;e<t;e++){var i=m[e].id,n=m[e].callbackFn,s={success:!1,id:i};if(T.pv[0]>0){var a=j(i);if(a)if(!G(m[e].swfVersion)||T.wk&&T.wk<312)if(m[e].expressInstall&&P()){var o={};o.data=m[e].expressInstall,o.width=a.getAttribute("width")||"0",o.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(o.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(o.align=a.getAttribute("align"));for(var l={},d=a.getElementsByTagName("param"),u=d.length,c=0;c<u;c++)"movie"!=d[c].getAttribute("name").toLowerCase()&&(l[d[c].getAttribute("name")]=d[c].getAttribute("value"));w(o,l,i,n)}else k(a),n&&n(s);else H(i,!0),n&&(s.success=!0,s.ref=R(i),s.id=i,n(s))}else if(H(i,!0),n){var h=R(i);h&&typeof h.SetVariable!=r&&(s.success=!0,s.ref=h,s.id=h.id),n(s)}}}function R(t){var e=null,i=j(t);return i&&"OBJECT"===i.nodeName.toUpperCase()&&(e=typeof i.SetVariable!==r?i:i.getElementsByTagName(o)[0]||i),e}function P(){return!y&&G("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function w(s,a,o,l){var d=j(o);if(o=B(o),y=!0,i=l||null,n={success:!1,id:o},d){"OBJECT"==d.nodeName.toUpperCase()?(t=M(d),e=null):(t=d,e=o),s.id=u,(typeof s.width==r||!/%$/.test(s.width)&&F(s.width)<310)&&(s.width="310"),(typeof s.height==r||!/%$/.test(s.height)&&F(s.height)<137)&&(s.height="137");var c=T.ie?"ActiveX":"PlugIn",g="MMredirectURL="+encodeURIComponent(h.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+c+"&MMdoctitle="+encodeURIComponent(p.title.slice(0,47)+" - Flash Player Installation");if(typeof a.flashvars!=r?a.flashvars+="&"+g:a.flashvars=g,T.ie&&4!=d.readyState){var f=x("div");o+="SWFObjectNew",f.setAttribute("id",o),d.parentNode.insertBefore(f,d),d.style.display="none",N(d)}O(s,a,o)}}function k(t){if(T.ie&&4!=t.readyState){t.style.display="none";var e=x("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(M(t),e),N(t)}else t.parentNode.replaceChild(M(t),t)}function M(t){var e=x("div");if(T.win&&T.ie)e.innerHTML=t.innerHTML;else{var i=t.getElementsByTagName(o)[0];if(i){var n=i.childNodes;if(n)for(var s=n.length,a=0;a<s;a++)1==n[a].nodeType&&"PARAM"==n[a].nodeName||8==n[a].nodeType||e.appendChild(n[a].cloneNode(!0))}}return e}function O(t,e,i){var n,s=j(i);if(i=B(i),T.wk&&T.wk<312)return n;if(s){var a,l,u,c=T.ie?x("div"):x(o);for(u in typeof t.id==r&&(t.id=i),e)e.hasOwnProperty(u)&&"movie"!==u.toLowerCase()&&L(c,u,e[u]);for(a in T.ie&&(c=function(t,e){var i=x("div");return i.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+t+"'>"+e+"</object>",i.firstChild}(t.data,c.innerHTML)),t)t.hasOwnProperty(a)&&("styleclass"===(l=a.toLowerCase())?c.setAttribute("class",t[a]):"classid"!==l&&"data"!==l&&c.setAttribute(a,t[a]));T.ie?_[_.length]=t.id:(c.setAttribute("type",d),c.setAttribute("data",t.data)),s.parentNode.replaceChild(c,s),n=c}return n}function L(t,e,i){var n=x("param");n.setAttribute("name",e),n.setAttribute("value",i),t.appendChild(n)}function N(t){var e=j(t);e&&"OBJECT"==e.nodeName.toUpperCase()&&(T.ie?(e.style.display="none",function t(){if(4==e.readyState){for(var i in e)"function"==typeof e[i]&&(e[i]=null);e.parentNode.removeChild(e)}else setTimeout(t,10)}()):e.parentNode.removeChild(e))}function U(t){return t&&t.nodeType&&1===t.nodeType}function B(t){return U(t)?t.id:t}function j(t){if(U(t))return t;var e=null;try{e=p.getElementById(t)}catch(t){}return e}function x(t){return p.createElement(t)}function F(t){return parseInt(t,10)}function G(t){t+="";var e=T.pv,i=t.split(".");return i[0]=F(i[0]),i[1]=F(i[1])||0,i[2]=F(i[2])||0,e[0]>i[0]||e[0]==i[0]&&e[1]>i[1]||e[0]==i[0]&&e[1]==i[1]&&e[2]>=i[2]}function V(t,e,i,n){var o=p.getElementsByTagName("head")[0];if(o){var l="string"==typeof i?i:"screen";if(n&&(s=null,a=null),!s||a!=l){var d=x("style");d.setAttribute("type","text/css"),d.setAttribute("media",l),s=o.appendChild(d),T.ie&&typeof p.styleSheets!=r&&p.styleSheets.length>0&&(s=p.styleSheets[p.styleSheets.length-1]),a=l}s&&(typeof s.addRule!=r?s.addRule(t,e):typeof p.createTextNode!=r&&s.appendChild(p.createTextNode(t+" {"+e+"}")))}}function H(t,e){if(b){var i=e?"visible":"hidden",n=j(t);A&&n?n.style.visibility=i:"string"==typeof t&&V("#"+t,"visibility:"+i)}}function $(t){return null!=/[\\\"<>\.;]/.exec(t)&&typeof encodeURIComponent!=r?encodeURIComponent(t):t}v[0]=function(){f?function(){var t=p.getElementsByTagName("body")[0],e=x(o);e.setAttribute("style","visibility: hidden;"),e.setAttribute("type",d);var i=t.appendChild(e);if(i){var n=0;!function s(){if(typeof i.GetVariable!=r)try{var a=i.GetVariable("$version");a&&(a=a.split(" ")[1].split(","),T.pv=[F(a[0]),F(a[1]),F(a[2])])}catch(t){T.pv=[8,0,0]}else if(n<10)return n++,void setTimeout(s,10);t.removeChild(e),i=null,D()}()}else D()}():D()};T.ie&&window.attachEvent("onunload",function(){for(var t=E.length,e=0;e<t;e++)E[e][0].detachEvent(E[e][1],E[e][2]);for(var i=_.length,n=0;n<i;n++)N(_[n]);for(var s in T)T[s]=null;for(var a in T=null,swfobject)swfobject[a]=null;swfobject=null});return{registerObject:function(t,e,i,n){if(T.w3&&t&&e){var s={};s.id=t,s.swfVersion=e,s.expressInstall=i,s.callbackFn=n,m[m.length]=s,H(t,!1)}else n&&n({success:!1,id:t})},getObjectById:function(t){if(T.w3)return R(t)},embedSWF:function(t,e,i,n,s,a,l,d,u,c){var h=B(e),p={success:!1,id:h};T.w3&&!(T.wk&&T.wk<312)&&t&&e&&i&&n&&s?(H(h,!1),I(function(){i+="",n+="";var g={};if(u&&typeof u===o)for(var f in u)g[f]=u[f];g.data=t,g.width=i,g.height=n;var v={};if(d&&typeof d===o)for(var m in d)v[m]=d[m];if(l&&typeof l===o)for(var _ in l)if(l.hasOwnProperty(_)){var E=S?encodeURIComponent(_):_,A=S?encodeURIComponent(l[_]):l[_];typeof v.flashvars!=r?v.flashvars+="&"+E+"="+A:v.flashvars=E+"="+A}if(G(s)){var y=O(g,v,e);g.id==h&&H(h,!0),p.success=!0,p.ref=y,p.id=y.id}else{if(a&&P())return g.data=a,void w(g,v,e,c);H(h,!0)}c&&c(p)})):c&&c(p)},switchOffAutoHideShow:function(){b=!1},enableUriEncoding:function(t){S=typeof t===r||t},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(t,e,i){return T.w3?O(t,e,i):void 0},showExpressInstall:function(t,e,i,n){T.w3&&P()&&w(t,e,i,n)},removeSWF:function(t){T.w3&&N(t)},createCSS:function(t,e,i,n){T.w3&&V(t,e,i,n)},addDomLoadEvent:I,addLoadEvent:function(t){if(typeof h.addEventListener!=r)h.addEventListener("load",t,!1);else if(typeof p.addEventListener!=r)p.addEventListener("load",t,!1);else if(typeof h.attachEvent!=r)!function(t,e,i){t.attachEvent(e,i),E[E.length]=[t,e,i]}(h,"onload",t);else if("function"==typeof h.onload){var e=h.onload;h.onload=function(){e(),t()}}else h.onload=t},getQueryParamValue:function(t){var e=p.location.search||p.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return $(e);for(var i=e.split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==t)return $(i[n].substring(i[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(y){var s=j(u);s&&t&&(s.parentNode.replaceChild(t,s),e&&(H(e,!0),T.ie&&(t.style.display="block")),i&&i(n)),y=!1}},version:"2.3"}}()}(uvpjs.register("uvpjs")),function(t){var e=t._;t.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.containers=t.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=t.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=t.p2pClient,this.multiCdnClient=t.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(t.rco,t.cviMgr,t.vidContId)},initialize:function(t,i,n){var s;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",t),this.rco=t,this.vidContId=n,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",(s=this.cviModel.contentVideoState).sendResumeEvent=!1,s.startTime=0,s.elapsedTime=0,s.showPreroll=!0,s.playedChapterTime=0,s.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({defaults:this.cviModel.contentVideoStateDefaults,eventsManager:this.eventsMgr}),e.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var t=this.eventsMgr;this._removeTimers(),t.addTimedEventCallback(t.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),t.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(t){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(t)},_removeTimers:function(){var t=this.eventsMgr;t.removeTimedEventCallback(t.TENTH_SECOND,this.internalNS),t.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var t=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(t)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(t){var e=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),e.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),e.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),e.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=t,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(t){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,t)})):this.finishLoadVideoAndBeginPlayback(t),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(t,e,i){var n,s=uvpjs.ErrorInfo;if(i)return n=new s({errorCode:s.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+i,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:n},this.vidContId);setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,t),2)},handleCdnDecision:function(t,e){this.setNewAssetUrlAndCdn(e),this.doFlashCheck(t)},shouldUseFlash:function(){var t=this.mc.systemInfo,e=this.cviModel.getSessionOption("preventFlashPlayback"),i=t.supportsNativeHls||t.isHlsjsEligible,n=!e&&t.isDesktop&&uvpjs.UvpSwfService.hasFlash(),s=this.mc.isHlsUrl(this._getAssetUrl()),a=uvpjs.Configuration.env;return!("local"!==a&&"dev"!==a&&"stage"!==a||!window.forceFlash||!n)||s&&!i&&n},prepForCaptionEvents:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY],i=e.length;i--;)this.eventsMgr.addEventListener(e[i]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY],i=e.length;i--;)this.eventsMgr.removeEventListener(e[i]+this.internalNS)},hCaptionEventForUvp:function(t){var e=this.eventsMgr.eventTypes;if(this._hasFacade()&&t.target===this.vidContId)switch(t.type){case e.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case e.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions();break;case e.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions()}},finishLoadVideoAndBeginPlayback:function(t){var e,i=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),i.incrementMedNum(),this.createFacade(),e=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(e),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),e===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(t){var e,i,n,s=t&&t.providers||null,a=s&&s[0]?s[0]:null,r=a&&a.host||null,o=a&&a.provider||null;r&&(e=this._getAssetUrl(),r!==(i=uvpjs.util.parseUrl(e)).host&&(n=i.protocol+"//"+r+i.pathname+i.search,this.cviModel.contentVideoState.assetURL=n)),o&&this.setContentVideoStateCdn(o)},setContentVideoStateCdn:function(t){this.cviModel.contentVideoState.cdn=t,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:t},this.vidContId)},getContentVideoStateCdn:function(t){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var t=function(t){var e=i.getSessionOption(t);return"boolean"==typeof e?e:void 0!==i.getVideoPlaybackCDOProperty(t)&&i.getVideoPlaybackCDOProperty(t)},e=function(t){var e=i.getSessionOption(t);return"number"==typeof e&&e>=0?e:void 0!==i.getVideoPlaybackCDOProperty(t)?Number(i.getVideoPlaybackCDOProperty(t)):-1},i=this.cviModel,n=e(i.START_BITRATE),s=e(i.MIN_BITRATE),a=e(i.MAX_BITRATE),r=e(i.LIVE_SYNC_DURATION_COUNT),o=t(i.CAP_LEVEL_TO_PLAYER_SIZE),l=t(i.DASHJS_FAST_SWITCH_ABR),d=i.getSessionOption("useDynamicSwitching"),u=i.getSessionOption("errorRecovery"),c=Number(this.rco.startBitrate)||-1,h=Number(this.rco.minBitrate)||-1,p=Number(this.rco.maxBitrate)||-1,g=Number(this.rco.liveSyncDurationCount)||-1,f=this.rco.capLevelToPlayerSize,v=this.rco.enableDashJSFastSwitchABR,m=this.rco.useDynamicSwitching,_=(m=this.rco.useDynamicSwitching,this.rco.errorRecovery);c>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",c),i.setStartBitrate(c)):i.setStartBitrate(n),h>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",h),i.setMinBitrate(h)):i.setMinBitrate(s),p>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",p),i.setMaxBitrate(p)):i.setMaxBitrate(a),g>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",g),i.setLiveSyncDurationCount(g)):i.setLiveSyncDurationCount(r),"boolean"==typeof f?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",f),i.setCapLevelToPlayerSize(f)):i.setCapLevelToPlayerSize(o),"boolean"==typeof v?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",v),i.setDashJSFastSwitchABR(v)):i.setDashJSFastSwitchABR(l),"boolean"==typeof m?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",m),i.setUseDynamicSwitching(m)):i.setUseDynamicSwitching(d),"object"==typeof _?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",_),i.setErrorRecovery(_)):i.setErrorRecovery(u)},createId3Parser:function(t){this.id3EventQueue=[];var e={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(t){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(e);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(e);break;case this.mc.FLASH_HLS:e.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(e)}},handleId3Metadata:function(t){this.id3EventQueue&&this.id3EventQueue.push(t)},checkId3Events:function(t){for(var e,i=this.id3EventQueue,n=i&&i.length||0;n--;)t>=(e=i[n]).pts&&(this.dispatchCuepointEvent(e),this.id3EventQueue.splice(n,1))},dispatchCuepointEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,t,this.vidContId)},createFacade:function(){var t=this.cviModel,e=t.getContentVideoState(),i=this._getAssetUrl(),n={enableId3Handling:this.id3HandlingEnabled,assetURL:i,isMuted:t.isMuted,resourceProvider:this,startTime:e.startTime,startBitrate:t.startBitrate,maxBitrate:t.maxBitrate,minBitrate:t.minBitrate,useDynamicSwitching:t.useDynamicSwitching,liveSyncDurationCount:t.liveSyncDurationCount,volume:t.volume,capLevelToPlayerSize:t.capLevelToPlayerSize,enableDashJSFastSwitchABR:t.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:t.errorRecovery,drm:e.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",n),this.facade=this.getFacade(i),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(n.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(n.swfService=this.uvpSwfService);var s=this.facade.initialize(n);!s||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:s,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(t.nativeControls)},destroyFacade:function(){var t=this._hasFacade()&&"function"==typeof this.facade.destroy;this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),t?(this.facade.destroy(),this.facade={}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up.")},muteContentForAdPlay:function(t){var e=this.cviModel,i=this.facade;this._hasFacade()&&(!1!==t?i.muteVideo():e.isMuted||i.unMuteVideo())},getModule:function(t){return this.cviModel.getModule(t)},getModuleParam:function(t,e){return this.cviModel.getModuleParam(t,e)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:t},this.vidContId)},dispatchContentEnd:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:t},this.vidContId)},dispatchSeekDone:function(){var t=this.eventsMgr;t.dispatchEvent(t.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var t=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,e=t?"Fatal ERROR encountered":"";this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+e),!t&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId)},dispatchVideoStateChange:function(t){isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:t,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+t,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(t){t&&t.abrInfo&&this.cviModel.setAbrInfo(t.abrInfo)},facadeProgress:function(t){!uvpjs.util.isEmpty(t)&&"object"==typeof t&&t.currentTime&&t.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:t.currentTime}),this.setModelDuration(parseInt(t.duration)))},facadeDurationChanged:function(t){!uvpjs.util.isEmpty(t)&&"object"==typeof t&&t.duration},setModelDuration:function(t){t>0&&this.cviModel.contentVideoState.duration!==t&&(this.cviModel.setContentVideoStateItems({duration:t}),this.cviModel.setContentPlaybackStateItems({duration:t}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",t),this._seekFromTime?(this._seekToTime=t.seekToTime,this.dispatchSeekDone()):this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE.")},facadeError:function(t){var e,i,n,s,a=uvpjs.util,r=this.RPM&&this.RPM.currRP,o=this.eventsMgr,l=this.cviModel,d=!a.isEmpty(l),u=t.isFatal;if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+t.message),d&&u&&(i=(e=this.cviModel.getContentVideoState()).playbackStarted,n=a.isDefinedString(e.overrideAssetURL),!i&&n&&!this._overrideAssetUrlFailure))this._handleOverrideAssetURLError(t);else if(d||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),a.isEmpty(o)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(s=t.eventType||o.eventTypes.VIDEO_PLAYBACK_ERROR,t.eventType=s,o.dispatchEvent(s,{errorInfo:t},this.vidContId)),u){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),d&&(l.contentPlaybackState.fatalError=!0),r&&r.rco&&r.rco.type===uvpjs.mediaCapabilities.RP_IMA)return void r.imaContentComplete();this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+t),this.dispatchVideoStateChange(t)},facadeVideoLevelLoaded:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:t},this.vidContId)},facadeVideoTransitionStart:function(t,e){var i=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+t+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:t,mode:i},this.vidContId)},facadeVideoTransitionComplete:function(t,e){var i=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+t+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:t,mode:i},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeId3Data:function(t){this.id3Parser&&this.id3Parser.parse(t)},facadeMinimumBitrateAllowedChanged:function(t){this.cviModel.setMinBitrate(t)},facadeMaximumBitrateAllowedChanged:function(t){this.cviModel.setMaxBitrate(t)},getFacade:function(t){var e,i=this.mc.STREAMING,n=(t=t||this._getAssetUrl(),this.mc.isHlsUrl(t)),s=this.mc.isDashUrl(t),a=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(a||n||s)&&this._setDeliveryType(i),!a&&n)this.mc.canPlayHLSJS()&&(e=new uvpjs.VPF_HLSJS);else if(!a&&s)if(uvpjs.VPF_DASHJS)e=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));e=new uvpjs.VPF_SHAKA}else a&&(e=new uvpjs.VPF_Flash);return e||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,n=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",n),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,t.addEventListener(e.CONTROL_SEEK+i,this.onVideoSeekTo.bind(this)),t.addEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i,this.onVideoSeekToLive.bind(this)),t.addEventListener(e.CONTROL_PAUSE+i,this.onPauseVideo.bind(this)),t.addEventListener(e.CONTROL_PLAY+i,this.onPlayVideo.bind(this)),t.addEventListener(e.CONTROL_MUTE+i,this.onMuteVideo.bind(this)),t.addEventListener(e.CONTROL_UNMUTE+i,this.onUnMuteVideo.bind(this)),t.addEventListener(e.CONTROL_VOLUME_SET+i,this.onChangeVideoVolume.bind(this)),t.addEventListener(e.CONTROL_FULLSCREEN+i,this.onFullscreen.bind(this)),t.addEventListener(e.SWITCH_REQUEST+i,this.onSwitchRequest.bind(this)),t.addEventListener(e.USE_DYNAMIC_SWITCHING+i,this.onUseDynamicSwitching.bind(this)),t.addEventListener(e.MAXIMUM_BITRATE_ALLOWED+i,this.onMaximumBitrateAllowed.bind(this)),t.addEventListener(e.MINIMUM_BITRATE_ALLOWED+i,this.onMinimumBitrateAllowed.bind(this)),t.addEventListener(e.CONTAINER_RESIZE+i,this.handleContainerResize.bind(this)))},_removeUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,n=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",n),t.removeEventListener(e.CONTROL_SEEK+i),t.removeEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i),t.removeEventListener(e.CONTROL_PAUSE+i),t.removeEventListener(e.CONTROL_PLAY+i),t.removeEventListener(e.CONTROL_MUTE+i),t.removeEventListener(e.CONTROL_UNMUTE+i),t.removeEventListener(e.CONTROL_VOLUME_SET+i),t.removeEventListener(e.SWITCH_REQUEST+i),t.removeEventListener(e.USE_DYNAMIC_SWITCHING+i),t.removeEventListener(e.MAXIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.MINIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CAPTIONS_READY+i),t.removeEventListener(e.CONTAINER_RESIZE+i)},_getAssetUrl:function(t){var e=uvpjs.util,i=t||this.cviModel.getContentVideoState(),n=i.overrideAssetURL,s=e.isDefinedString(n)&&!this._overrideAssetUrlFailure,a=s?n:i.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+s+")",a),a},_setDeliveryType:function(t){this.cviModel.setContentVideoStateItems({deliveryType:t})},_handleOverrideAssetURLError:function(t){var e=uvpjs.ErrorInfo,i=this.eventsMgr,n=i.eventTypes.VIDEO_START_ERROR,s=e.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,s+" Error using overrideAssetURL; will use assetURL."),t.eventType=n,t.message=s,t.isFatal=!1,t.errorCode=e.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,i.dispatchEvent(n,{errorInfo:t},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(t){var e=t&&t.target,i=t&&t.payload,n=i&&i.bitrate,s=this.cviModel,a=this.facade;if(e===this.vidContId&&n&&this._hasFacade())switch(typeof n){case"string":if("up"===n)s.setUseDynamicSwitching(!1),a.switchUp();else if("down"===n)s.setUseDynamicSwitching(!1),a.switchDown();else{if(n=Number(n),isNaN(n))return;s.setUseDynamicSwitching(!1),a.switchToBitrate(n)}break;case"number":s.setUseDynamicSwitching(!1),a.switchToBitrate(n);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",n)}},onUseDynamicSwitching:function(t){if(t&&t.target===this.vidContId&&t.payload){var e=t.payload.data;this.cviModel.setUseDynamicSwitching(e),this._hasFacade()&&(this.facade.useDynamicSwitching(e),e&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",e)}},onMinimumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,n=this.facade;t.target===this.vidContId&&(i&&"number"==typeof i?(this.cviModel.setMinBitrate(i),this._hasFacade()&&n.setMinBitrateAllowed(i)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i))},onMaximumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,n=this.facade;t.target===this.vidContId&&(i&&"number"==typeof i?(this.cviModel.setMaxBitrate(i),this._hasFacade()&&n.setMaxBitrateAllowed(i)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i))},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,n=i&&i.seekTime,s=this.cviModel.contentVideoState.duration,a=this.cviModel.contentPlaybackState.currentTime,r=this.facade;"number"==typeof n&&e===this.vidContId&&(n<0||n>s?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+n):(this._seekFromTime=this._seekFromTime||a,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:n,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&r.seekTo(n)))},onVideoSeekToLive:function(){var t=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&t.seekToLive()},facadeVolumeChange:function(t){!e.isNaN(t)&&e.isNumber(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:t},this.vidContId)},facadeLoading:function(t){var e={data:t};t&&(t.bufferLength||t.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,e,this.vidContId)},facadeTimeUpdate:function(t){this.cviModel.setContentPlaybackStateItems({currentTime:t})},onFullscreen:function(t){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(t.payload.isFs)},onPauseVideo:function(t){var e=t&&t.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&i.pauseVideo()},onPlayVideo:function(t){var e=t&&t.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&i.playVideo()},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,n=i&&i.vol,s=uvpjs.util.inRange(n,0,1),a=this.cviModel.isMuted,r=this.facade;e===this.vidContId&&s&&!a&&this._hasFacade()&&r.setVolume(n)},onMuteVideo:function(t){var e=t&&t.target,i=this.facade;e===this.vidContId&&this._hasFacade()&&i.muteVideo()},onUnMuteVideo:function(t){var e=t&&t.target,i=this.facade;e===this.vidContId&&this._hasFacade()&&i.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var t={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),t=this.cviModel.getContentVideoState(),!e.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:t},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var i=this.getVideoProgressPayload();this.setModelDuration(i.duration),this.id3HandlingEnabled&&this.checkId3Events(i.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,i,this.vidContId)}},checkBuffering:function(t){var e,i=this.cviModel?this.cviModel.contentPlaybackState:null;i&&i.playbackStarted&&i.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(e=t||i.currentTime||0,!this.bufferingDetected&&e<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&e>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=e)},getVideoProgressPayload:function(){this.cviModel.getCurrentVideoState();var t={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:this.facade.getDuration(),errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(t),t},setFacadeStateOnProgressPayload:function(t){var e=this.facade,i=this._hasFacade()&&e.getFacadeState();if(!i)return t;t.facadeState=i,t.averageDroppedFPS=e.getAverageDroppedFPS(),t.bufferLength=e.getBuffered()||0,t.currentTime=e.getCurrentTime()||0,t.currentBandwidth=e.getCurrentBandwidth(),t.currentMaxBandwidth=e.getCurrentMaxBandwidth(),t.droppedFrames=e.getDroppedFramesCount(),t.playbackFramerate=e.getPlaybackFramerate(),t.playbackState=e.getPlaybackState(),t.streamType=e.getStreamType(),t.isHDStreamLive=e.isHDStreamLive(),t.isPlayingLive=e.isPlayingLive(),t.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var t=this.cviModel.contentVideoState,e=localStorage.getItem("UVPJS.resumePid")||null,i=localStorage.getItem("UVPJS.resumeContentTime")||null,n=localStorage.getItem("UVPJS.resumeEpochTime")||null,s=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(e&&(t.resumePid=e),i&&(t.resumeContentTime=i),n&&(t.resumeEpochTime=n),s&&(t.resumeSessionId=s))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var t=this.cviModel;t&&(t.resetAdVideoState(),t.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}})}(uvpjs.register("uvpjs")),function(t){var e=t._,i="pubads.g.doubleclick.net",n="ad.doubleclick.net",s="request.php",a="Request.jsp";t.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(t){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=t||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.opts.defaults&&this.populateDefaults(this.opts.defaults),this.eventsMgr=this.opts.eventsManager,delete this.opts.defaults,this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(t){var e;for(e in t)this.opts[e]=t[e]},getModel:function(){return this.mdl},getProperty:function(t){return this.mdl[t]},setProperty:function(t,e){this.mdl[t]=e},loadData:function(t,e){var i,n="callback=uvpHandleJsonpResult",s=e||this.opts.queryParams,a=!1,r=!uvpjs.util.isEmpty(s);if(this.opts.url=t,this.opts.queryParams=e,r)for(i in t+=t.indexOf("?")<0?"?":"&",s)t+=(a?"&":"")+i+"="+s[i],a=!0;t.indexOf(n)<0&&(t+=(t.indexOf("?")<0?"?":"&")+n),this.selectorCall=t,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var t=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),t.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(t){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(t)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(t){var e,i,n,s,a,r,o,l,d,u=t.getElementsByTagName("ref"),c=null,h=u[0],p=!1,g=this.mdl,f=h&&this.checkForPlatformError(h);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",t),f&&f.error)return f;if(null===(i=(e=t.getElementsByTagName("switch"))[0]?e[0].getElementsByTagName("video"):t.getElementsByTagName("video"))[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(g.chapterTimesString="",h)for(n=0,s=u.length;n<s;n++)o=(a=u[n]).attributes.src.nodeValue,this.isAdCallURL(o)?(!p&&(g.imaAdCall=o),p=!0):c||(c=a,g.assetURL=c.getAttribute("src"),l=a.getElementsByTagName("param")),null!==a.getAttribute("clipEnd")&&(g.chapterTimesString+=a.getAttribute("clipEnd")+",");for(n=0,s=i.length;n<s&&(o=(r=i[n]).attributes.src.nodeValue,c||(c=r,g.assetURL=c.getAttribute("src"),l=r.getElementsByTagName("param"),null!==r.getAttribute("clipEnd")));n++)null!==r.getAttribute("clipEnd")&&(g.chapterTimesString+=r.getAttribute("clipEnd")+",");return d=l&&this.extractParams(l)||{},this.populateModelFromContentNodeAndParams(c,d),{error:!1}},populateModelFromContentNodeAndParams:function(t,e){var i,n,s=this.mdl,a=uvpjs.mediaCapabilities,r={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},o={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},l="true";for(q in r)s[q]=t.getAttribute(r[q])||"";for(q in o)s[q]=e[o[q]]||"";s.mediaId=this.getMediaId(e),s.duration=this.getDuration(t),s.sourceOwner=this.getSourceOwner(e),s.cmsRefGuid=t.getAttribute("guid")||t.getAttribute("vid")||"",s.isEmbedable=e.Embeddable===l,s.isLive=e.IsLive===l,s.episodeFlag=e.EpisodeFlag===l,s.useWatermark=e.WatermarkPlayback===l,s.chapterTimesString.length>0?(n=(i=s.chapterTimesString).length-1,i.lastIndexOf(",")===n&&(s.chapterTimesString=i.substring(0,n)),s.chapterStartTimes=this.convertChapterTimesToSeconds(s.chapterTimesString)):s.chapterStartTimes=[],s.assetURL.indexOf(a.M3U)>-1?(s.cdn="",s.fileType=a.M3U):s.assetURL.indexOf(a.MP3)>-1?s.fileType=a.MP3:s.fileType=a.MP4},handleData:function(t){var e=t.responseText,i=uvpjs.util,n=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),s=this.isValidJsonStr(n)&&JSON.parse(n)||null,a=i.isEmpty(s)?null:s.metafile,r=a&&new DOMParser,o=r&&r.parseFromString(a,"application/xml"),l=o&&this.parseSmilXML(o);if(this.callAttempts=0,l){if(l.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+l.errorInfo.message),void this.signalError(l.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(t){return"string"==typeof t&&("{"===t.charAt(0)&&"}"===t.charAt(t.length-1)||"["===t.charAt(0)&&"]"===t.charAt(t.length-1))},handleError:function(t){var e,i="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(t.status);this.debug&&uvpjs.error(this.DEBUG_ID,i,this.selectorCall),this.shouldRetryCall(t)?(e=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+e,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),e)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:i+" URL: "+this.selectorCall,isFatal:!0,serverCode:t.status})))},shouldRetryCall:function(t){var e=t.status;return this.selectorCall.indexOf("link.theplatform")>-1&&this.callAttempts<this.retryLimit&&500!==e&&404!==e&&403!==e&&0!==e},defineProperties:function(){},checkForPlatformError:function(t){var e=t&&this.parseSmilRefNodeForException(t);return e?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(e),serverCode:e.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(t){var e=t.responseCode||"n/a",i="; PID: "+(this.opts.pid||"n/a")+"; ",n=this.opts&&this.opts.cmsRefGuid+"; "||"",s=t.abstract?t.abstract+" ":"";return"Platform Error; code: "+e+i+n+(t.exception||"Resource Unavailable.")+" "+s},populateDefaults:function(t){!uvpjs.util.isEmpty(t)&&e.assign(this.mdl,t)},parseSmilRefNodeForException:function(t){var e,i=t.getElementsByTagName("param"),n={};if(i&&i.length){for(e=i.length;e--;)n[i[e].getAttribute("name")]=i[e].getAttribute("value");if("true"===n.isException)return n.abstract=t.getAttribute("abstract")||"",n}return null},extractParams:function(t){var e,i,n,s,a={};if(uvpjs.util.isEmpty(t))return a;for(s=t.length;s--;)i=(e=t[s]).getAttribute("name"),n=e.getAttribute("value"),i&&n&&(a[i]=n);return a},isAdCallURL:function(t){return t.indexOf(n)>-1||t.indexOf(i)>-1||t.indexOf(s)>-1||t.indexOf(a)>-1},getMediaId:function(t){var e,i,n,s="",a=t.trackingData;if(uvpjs.util.isEmpty(a))return"";for(i=0,n=(e=a.split("|")).length;i<n;i++)e[i].indexOf("cid=")>-1&&(s=e[i].split("=")[1]);return s},getSourceOwner:function(t){var e=t.Source;return uvpjs.util.isEmpty(e)&&"true"===t.WatermarkPlayback?"Entertainment":e||""},getDuration:function(t){var e=parseInt(t.getAttribute("dur"))||0;return e>0?.001*e:e},convertChapterTimesToSeconds:function(t){for(var e=[],i=t.split(","),n=i.length,s=function(t){var e=parseInt;switch((t=i[n].split(":")).length){case 1:return e(t[0]);case 2:return 60*e(t[0])+e(t[1]);case 3:return 3600*e(t[0])+60*e(t[1])+e(t[2])}};n--;)e.unshift(s(i[n]));return e}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(t,e,i){this._super(t,e,i)},loadData:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),e.isFunction(t)&&e.isFunction(i)?(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,this.dataLoadErrorCB=i,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS)},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(t)}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(t,e){var i=this.getSelectorCall(),n=i.url||null,s=null;if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+i.message),void("function"==typeof e&&e(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+i.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,uvpjs.util.isDefinedString(this.rco.sig)&&(s={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:e}),this.contentDataProxy.loadData(n,s)},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(t)},getSelectorCall:function(){var t,e,i,n,s,a,r,o=this.rco,l=o.has("selectorCall")&&o.selectorCall||null;if(!l){if(i=(l=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"))&&l.indexOf("$PID$")>-1,n=l&&l.indexOf("$GUID$")>-1,t=o.has("pid")&&o.pid||null,e=o.has("cmsRefGuid")&&o.cmsRefGuid||null,(s=!i&&!n)||!t&&!e)return{error:!0,message:"Config error: "+(s?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(i?"pid":"cmsRefGuid"))};a=i?t:e,r=i?/\$PID\$/g:/\$GUID\$/g,l=(l=l.replace(r,a)).replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:l}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var t=uvpjs.util;t.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),t.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var t,e,i,n,s,a,r,o,l,d=this.cviModel.contentVideoState,u=this.contentDataProxy,c=this.rco;this.populateContentVideoStateFromLocalStorage(),e=Date.now()-+d.resumeEpochTime,u.setProperty("resumePid",d.resumePid),u.setProperty("resumeEpochTime",+d.resumeEpochTime),u.setProperty("resumeSessionId",d.resumeSessionId),u.setProperty("resumeContentTime",+d.resumeContentTime),u.setProperty("playedChapterTime",+d.playedChapterTime),u.setProperty("showPreroll",d.showPreroll),u.setProperty("sendResumeEvent",!1),u.getProperty("episodeFlag")&&!0!==d.isLive&&(l=u.getProperty("duration"),s=!(i=!uvpjs.util.isEmpty(c.globalResumeTime)&&c.globalResumeTime>0&&l>0&&l-c.globalResumeTime>20)&&c.pid===d.resumePid,i||s?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),n=i?c.globalResumeTime:+d.resumeContentTime||0,t=i?0:e||0,o=!i&&e>this.ONE_HOUR_MS,r=i?this.cviModel.sessionId:"",a=this.getPlayedChapterTimeForContentResume(n),u.setProperty("sendResumeEvent",!0),u.setProperty("startTime",n),u.setProperty("elapsedTime",t),u.setProperty("showPreroll",o),u.setProperty("playedChapterTime",a),u.setProperty("previousSessionId",r),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(s?"local":"global")+"Resume"]},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(t){var e,i=0,n=this.contentDataProxy.getProperty("chapterStartTimes"),s=n.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",n),s)for(;s--;)if(t>=(e=n[s])){t-e>=4?i=e:(this.contentDataProxy.setProperty("startTime",t-4),s>0&&(i=n[s-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",i),i}}),function(t){var e=t._;t.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(t,e,i)},loadData:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),e.isFunction(t)?(this.dataLoadedCB=t,this.dataLoadErrorCB=i,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS)}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(t){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(t,e,i){var n,s;this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",t),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",i)),this.playbackState=this.mc.EMPTY,this.vidContId=i,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=t,this.isContentScenario=!1,this._super(t,e,i),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(n=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(n.eventType,{errorInfo:n},i)):(s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=s.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(t,e){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:t();break;case this.PLATFORM:this._super(t,e);break;case this.CONTENT_AND_AD_CALL:t()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,n=uvpjs.util.isDefinedString(e.adCall)?e.adCall:null,s=this.imaScenario===this.PLATFORM,a=n||(s?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(i.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(a)):(i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,a)):this.doFlashCheck(a))},finishLoadVideoAndBeginPlayback:function(t){var e="",i=uvpjs.adUtil,n=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,n.incrementMedNum(),this.isContentScenario=!0),t?(e=i.populateImaAdCallValues(t,n,this.isContentScenario),this.viewGuid=i.getDwViewGuid(n),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",e)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(e)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(t){e.isString(t)&&!e.isEmpty(t)?this._requestAdsManager(t):this._onContentResumeRequested()},setImaAdUrl:function(){var t=this.checkForAdCallOverride();t?(this.contentDataProxy.setProperty("imaAdCall",t),this.imaAdCall=t):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var t=this.cviModel.getModule(this.AD_SETTINGS),i=null!=t&&1==t.enabled,n=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),s=null;return i&&!e.isUndefined(n)&&(s=n),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(s||"null")),s},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var t,e="",i=this.contentDataProxy,n=i.getProperty("chapterStartTimes");return i.getProperty("showPreroll")||(e="1"),n.length>0&&(t=n.indexOf(i.getProperty("playedChapterTime")))>=0&&(t+=2,e=e.length>0?e+","+String(t):String(t)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",e),e},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(t){var e=t&&t.id,i=this.trueXInteractionIds;switch(e){case i.CLOSED_BEFORE_CREDIT:case i.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case i.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case i.OPT_OUT:case i.TIME_OUT:this.resetTrueXStatus();break;case i.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(t){var e=this.getAdPodInfo(t),i=e.podIndex,n=0===i?"pre":-1===i?"post":"mid_"+i;if(this.currAdPod=this.APM.getAdPodById(n),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(t)}),adCallUrl:this.adCallUrl},this.vidContId),!1;var s=this.currAdPod;return s.adCount=e.totalAds,s.podDuration=e.maxDuration,s.isBumper=e.isBumper,s.imaPodIndex=e.podIndex,s.timeOffset=e.timeOffset,s.totalAds=e.totalAds,s.imaAdPostion=e.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",i,this.currAdPod),!0},getAdPodInfo:function(t,e){var i=t.getAdPodInfo(),n=e||{};return n.adPosition=i.getAdPosition(),n.isBumper=i.getIsBumper(),n.maxDuration=i.getMaxDuration(),n.podIndex=i.getPodIndex(),n.timeOffset=i.getTimeOffset(),n.totalAds=i.getTotalAds(),n},assembleAdInfo:function(t){return{adId:t.getAdId(),adPodInfo:this.getAdPodInfo(t),adSystem:t.getAdSystem(),advertiserName:t.getAdvertiserName(),apiFramework:t.getApiFramework(),contentType:t.getContentType(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId(),dealId:t.getDealId(),description:t.getDescription(),duration:t.getDuration(),height:t.getHeight(),mediaUrl:t.getMediaUrl(),minSuggestedDuration:t.getMinSuggestedDuration(),skipTimeOffset:t.getSkipTimeOffset(),surveyUrl:t.getSurveyUrl(),title:t.getTitle(),traffickingParams:t.getTraffickingParameters(),traffickingParametersString:t.getTraffickingParametersString(),uiElements:t.getUiElements(),universalAdIdRegistry:t.getUniversalAdIdRegistry(),universalAdIdValue:t.getUniversalAdIdValue(),vastMediaHeight:t.getVastMediaHeight(),vastMediaWidth:t.getVastMediaWidth(),vastMediaBitrate:t.getVastMediaBitrate(),width:t.getWidth(),wrapperAdIds:t.getWrapperAdIds(),wrapperAdSystems:t.getWrapperAdSystems(),wrapperCreativeIds:t.getWrapperCreativeIds(),isLinear:t.isLinear()}},onAdEvent:function(t){var i,n=t.getAdData(),s=t.getAd(),a=google.ima.AdEvent.Type;if(t.type!==a.INTERACTION){if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(t.type),t.type){case a.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",s),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(t)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(s))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(s,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this._dispatchAdLoaded(this.assembleAdInfo(s));break;case a.STARTED:var r,o,l=s.getContentType();this.ad=s,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=s.getDuration(),this._populateAdVideoState(s,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this.cviModel.mergeCDOData(),"application/javascript"!==l&&"application/x-shockwave-flash"!==l||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===l&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(s),this.trackAdEvent(a.STARTED),(r=s.getAdPodInfo())&&(o=r.getTotalAds()),this._dispatchAdStart(o),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case a.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case a.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case a.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case a.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case a.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||e.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case a.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),(i=this.cviModel.getAdVideoState()).paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:i},this.vidContId);break;case a.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case a.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case a.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case a.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,i=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:i,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case a.LOG:var d,u=n&&n.adError,c=(uvpjs.ErrorInfo,null===s);this.eventsMgr.eventTypes.AD_ERROR;!u&&c?(d=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof d&&d()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(u,s,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),c&&!u&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",a))}}else this.processInteractionEvent(n)},_populateAdVideoState:function(t,i){var n,s;if(e.isObject(t)){if(s=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.IMA),i)for(n in i)s[n]=i[n];this.cviModel.setAdVideoState(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())}else this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN")},_requestAdsManager:function(t){var e=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",t),this.adStartEventReceived=!1,this.adCallUrl=t,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var i=new google.ima.AdsRequest;i.adTagUrl=t,this._updateAdSize(),i.linearAdSlotWidth=this.containerWidth,i.linearAdSlotHeight=this.containerHeight,i.nonLinearAdSlotWidth=this.containerWidth,i.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof i.setAdWillAutoPlay&&(i.setAdWillAutoPlay(e.isAutoplay),i.setAdWillPlayMuted(e.isMuteAtPlayStart&&!e.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(i)},onAdsManagerLoaded:function(t){var i,n,s,a=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,r=this.cviModel.contentPlaybackState.facadeState.currentBitrate,o=uvpjs.util;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",t),this._dispatchAdResponse(),o.isEmpty(this.RPM)||o.isEmpty(this.RPM.currRP)||o.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var l=this.renderSettings;l.bitrate=r>0&&r/1e3||900,l.restoreCustomPlaybackStateOnAdBreakComplete=!1,l.enablePreloading=!1,l.loadVideoTimeout=this._returnIMATimeout(),i=this.adsManager=t.getAdsManager(a,l),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",i.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",i.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",i.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(n=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",n)),this.imaCuePoints=this.adsManager.getCuePoints(),e.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,n,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",n),this.APM.initialize(this.vidContId,n,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),s=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,s),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},startAds:function(){var t,e,i=null,n=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(s){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),t=(e=uvpjs.ErrorInfo).messages.NO_AD_CONTENT,s&&"function"==typeof s.getMessage&&(t+=": "+s.getMessage(),i=s.getErrorCode(),n=s.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new e({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:e.errorCodes.IMA_AD_ERROR,message:t,imaErrorCode:i,imaVastErrorCode:n,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var t,i=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),e.isEmpty(this.facade)||(i=this.cviModel.contentVideoState.isLive,!(t=this.imaUsesContentVideoTag())&&this.facade.hideVideo(),i&&!t?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),t&&(this.savedSeekToTime=i?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!e.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),e.isEmpty(this.APM)||!this.APM.isPostRoll(this.currAdPod)){if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),e.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!e.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}}else this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN")},facadePlaybackStateChange:function(t){this.seekPending&&t===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(t)},_updateIMAPlaybackState:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",t),t!==this.playbackState&&(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(t){var e=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:t||1,adData:e,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(t){var e;this.uvpjsAdStartOpened&&((e=this.cviModel.getAdVideoState()).skipped=!0===t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:e,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(t){var e="function"==typeof t.getAdData?t.getAdData():{},i="function"==typeof t.getAd?t.getAd():{};return("function"==typeof i.getMediaUrl?i.getMediaUrl():e.mediaUrl)||null},_dispatchAdLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:t},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(t,e){var i,n,s;t&&(this.containerWidth=t),e&&(this.containerHeight=e),this.mc.isChromecast()||(i=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),n=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),i===this.containerWidth&&n===this.containerHeight||(this.containerWidth=i,this.containerHeight=n,this.adsManager&&(s=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,s))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var t=this.adsManager.getRemainingTime();this._checkForStuckAd(t),this.currImaAdTime=Math.floor(this.duration-t),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime})}},_checkForStuckAd:function(t){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=t,!1;var e=this.previousRemainingTime-t;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+e),0===e?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var i="Ad playback stuck for "+this.stuckIntervals+" intervals.",n=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:i,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,i,n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:n,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=t,!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(t){var e=t&&t.getAd&&t.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(t.getError(),e),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(t){this.dispatchAdErrorEvent(t.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(t,e,i){var n,s=null,a=null,r=null,o=uvpjs.ErrorInfo,l=uvpjs.util.isFunction;t&&l(t.getMessage)&&(s=t.getMessage(),s+=" imaErrorCode: "+(a=t.getErrorCode()||"n/a")+"; vastErrorCode: "+(r=t.getVastErrorCode()||"n/a")),t&&l(t.getInnerError)&&(n=t.getInnerError())&&(!s&&(s=""),s+=" Inner error: "+(l(n.getMessage)?n.getMessage():n.message||"n/a")+"; inner error code: "+(l(n.getErrorCode)?n.getErrorCode():"n/a")),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+s),i&&(s=i+" "+s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new o({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:o.errorCodes.IMA_AD_ERROR,message:o.messages.IMA_AD_ERROR_EVENT_RECEIVED+(s||" Unspecified IMA ad error."),isFatal:!1,imaErrorCode:a,imaVastErrorCode:r,adInfo:this.extractAdInfo(e)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),e.isEmpty(this.facade))return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var t=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(t)}},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(t){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",t),null===this.adsManager?(this.dynamicMidRollPodCount++,e=uvpjs.adUtil.populateImaAdCallValues(t,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=e,this._requestAdsManager(e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call")},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(t)))},onPlayVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(t)))},onVideoSeekTo:function(t){var i,n,s,a=this.cviModel.contentPlaybackState.currentTime;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",t),t.target===this.vidContId&&!e.isEmpty(this.facade)&&this.canSeek(t&&t.payload)){if(e.isEmpty(this.APM)||!this.APM.hasMidRoll())return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(t);i=t.payload.seekTime,this._seekFromTime=a,n=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(i):i,s=this.APM.returnPrecedingUnplayedAdPod(n),e.isEmpty(s)||s.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(t)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",s.startTime),this.savedSeekToTime=n,s.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=s.startTime)}else this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")},canSeek:function(t){return void 0!==t.seekTime&&null!==t.seekTime&&t.seekTime>=0&&t.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(t){return t},onChangeVideoVolume:function(t){e.has(t,"target")&&t.target===this.vidContId&&!this.cviModel.isMuted&&t.payload.vol>=0&&t.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(t.payload.vol):this._super(t))},onMuteVideo:function(t){e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},onUnMuteVideo:function(t){e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var t,e=this.adsManager,i=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),t=this.onAdEvent,e.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.addEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.addEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.addEventListener(i.LOADED,t),e.addEventListener(i.STARTED,t),e.addEventListener(i.FIRST_QUARTILE,t),e.addEventListener(i.MIDPOINT,t),e.addEventListener(i.THIRD_QUARTILE,t),e.addEventListener(i.COMPLETE,t),e.addEventListener(i.ALL_ADS_COMPLETED,t),e.addEventListener(i.CLICK,t),e.addEventListener(i.PAUSED,t),e.addEventListener(i.RESUMED,t),e.addEventListener(i.USER_CLOSE,t),e.addEventListener(i.SKIPPED,t),e.addEventListener(i.LOG,t),e.addEventListener(i.VOLUME_CHANGED,t),e.addEventListener(i.VOLUME_MUTED,t),e.addEventListener(i.INTERACTION,t)},_removeAdsManagerEventListeners:function(){var t=this.onAdEvent,e=this.adsManager,i=google.ima.AdEvent.Type;e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),e.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.removeEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.removeEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.removeEventListener(i.LOADED,t),e.removeEventListener(i.STARTED,t),e.removeEventListener(i.FIRST_QUARTILE,t),e.removeEventListener(i.MIDPOINT,t),e.removeEventListener(i.THIRD_QUARTILE,t),e.removeEventListener(i.COMPLETE,t),e.removeEventListener(i.ALL_ADS_COMPLETED,t),e.removeEventListener(i.CLICK,t),e.removeEventListener(i.PAUSED,t),e.removeEventListener(i.RESUMED,t),e.removeEventListener(i.USER_CLOSE,t),e.removeEventListener(i.SKIPPED,t),e.removeEventListener(i.LOG,t),e.removeEventListener(i.VOLUME_CHANGED,t),e.removeEventListener(i.VOLUME_MUTED,t))},onUVPJSTimerTick:function(){var t,e,i,n,s=uvpjs.util,a=this.cviModel.contentPlaybackState.facadeState.currentBitrate,r=!s.isEmpty(a)&&a>0,o=a/1e3!==this.renderSettings.bitrate,l=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,d=!s.isEmpty(this.adsManager),u=!s.isEmpty(this.facade);if(d&&r&&o&&(this.renderSettings.bitrate=a/1e3,this.adsManager.updateAdsRenderingSettings(this.renderSettings)),l&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:u?(t=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=t):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return e=(n=d&&l&&(this.cviModel.sessionOptions.adBlockerCallback||null))&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),n&&(i=(new Date).getTime())&&(this.lastAdBlockCheckTime<i||e)&&(this.lastAdBlockCheckTime=i+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&u&&this.checkId3Events(t),this.playbackState===this.mc.PLAYING){var c=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,c,this.vidContId)}},_checkForCloseToMidrollPod:function(t){var e,i,n,s=this.APM.getMidRollPods();if(t<=0)return!1;for(e=s.length;e--;)if((i=(n=s[e]).startTime-t)>0&&i<1&&!n.hasPlayed&&!n.hasBeenChecked)return n.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(t){var e=uvpjs.util,i=this._getAssetUrl(t),n=e.isDefinedString(t.pid),s=e.isDefinedString(t.cmsRefGuid),a=e.isDefinedString(t.selectorCall),r=e.isDefinedString(t.assetURL);return n||s&&!r||a?this.PLATFORM:e.isDefinedString(i)?this.CONTENT_AND_AD_CALL:e.isDefinedString(t.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var t=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),t},_checkForContentPreload:function(){var t=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,e=this.adsManager.isCustomPlaybackUsed(),i=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!e;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&t&&this.duration>5&&i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var t=-1,e=this.cviModel.getModule(this.AD_SETTINGS),i=e&&e.enabled&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return i&&(t=(t=parseInt(i))>0?1e3*t:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+t),t},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(t){"use strict";t._;var e,i=["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"],n=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];t.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(t){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,i,n){var s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+n),a=s.getElementsByTagName("video")[0];!e&&(e=google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new e.StreamManager(a),this.adClickElement=this.createAdClickElement(a),this.streamManager.setClickElement(this.adClickElement),this._super(t,i,n),this.resetAdStates(),this.contentVideoDiv=s,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(t,e){var i=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(i)?this._super(t,e):(this.dataLoadedCB=t,this.onDataProxyComplete())},onDataProxyComplete:function(){var t=this.contentDataProxy.getProperty("cmsRefGuid");!uvpjs.util.isEmpty(t)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(t),this._super()},loadVideoAndBeginPlayback:function(t){var e,i=this.rco,n=this.cviModel,s=this.contentDataProxy.getModel();if(this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),n.setNonDefaultContentVideoStateItems(s),n.setContentVideoStateItems(i),n.mergeCDOData(),this.killDataProxy(),!(e=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.requestStream(e)},requestStream:function(t){var i=this.cviModel.contentVideoState.isLive,n=new(i?e.LiveStreamRequest:e.VODStreamRequest),s=t||testRsrcDef;n.apiKey=s.apiKey||null,n.adTagParameters=s.adTagParameters,i?(n.assetKey=s.assetKey,n.attemptPreroll=!0,this.id3HandlingEnabled=!0):(n.contentSourceId=s.contentSourceId,n.videoId=s.videoId),this.streamManager.requestStream(n)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(t){var e=t.getStreamData().url;if(!uvpjs.util.isDefinedString(e))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=e,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(t){this.daiStreamId=t.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(t){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(t){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null},hCuePointsChanged:function(t){this.currAdPod=this.getNewPod(t.getStreamData().cuepoints)},hAdStarted:function(t){var e=t.getAd();this.resetAdStates(),this.updateAdModel(e),this.currAd=e,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.currAdPod?(this.trackAdEvent(t.type),this.dispatchAdPodStart()):this.dispatchError(this.eventsMgr.eventTypes.AD_ERROR,uvpjs.ErrorInfo.messages.DAI_ADPOD_ERROR,uvpjs.ErrorInfo.errorCodes.DAI_AD_ERROR)),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(t){var i,n,s,a=t.type,r=e.StreamEvent.Type,o=null;switch(a){case r.FIRST_QUARTILE:o=25;break;case r.MIDPOINT:o=50;break;case r.THIRD_QUARTILE:o=75;break;case r.AD_PROGRESS:(s=(n=(i=t.getStreamData())&&i.adProgressData)&&this.createAdProgressPayload(n))&&this.dispatchVideoProgress(s)}o&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=o,this.dispatchAdQuartile(o))},hStreamError:function(t){var e=t.getStreamData(),i=e&&e.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+i,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,i||"Uknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(t){},hStreamEvent:function(t){this.isAdPlaying()&&this.trackAdEvent(t.type),this[this.hMap[t.type]](t)},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,n=i&&i.seekTime,s=this.facade,a=this._hasFacade(),r=s.getDuration(),o=this.facade.getCurrentTime();"number"==typeof n&&e===this.vidContId&&((n=this.streamManager.streamTimeForContentTime(n))<0||n>r?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+n):(this._seekFromTime=this._seekFromTime||o,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:n,seekFromTime:this._seekFromTime},null,2)),a&&s.seekTo(n)))},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,n){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===n,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(t){var e,i,n=null,s=t&&t.length;for(s&&!this.adPods&&this.createAdPods(t);s--;)e=t[s],i=this.adPods["t_"+e.start],n||i.hasPlayed===e.played||(n=i),i.hasPlayed=e.played;return n},createAdPods:function(t){var e,i,n,s,a,r=0,o=[],l=t.length;for(this.adPods={},i=0;i<l;i++)e=t[i],n=(a=i)===l-1?"post":0===a?"pre":"mid",s=e.start,o.push(s),this.adPods["t_"+s]={startTime:s,hasPlayed:!1,adPodId:n+("mid"===n?"_"+r++:"_0"),adCount:0,podDuration:e.end-s};this.cviModel.contentVideoState.chapterStartTimes=o},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(t){var e=t.getAdPodInfo();this.populateAdVideoState(t),e&&this.currAdPod&&(this.currAdPod.adCount=e.getTotalAds(),this.currAdPod.podDuration=e.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(t){var e=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.DAI);this.cviModel.setAdVideoState(e)},createAdProgressPayload:function(t){var e=this.getVideoProgressPayload(),i=t.currentTime;return e.isAd=!0,e.duration=t.duration,e.currentTime=i,e.absoluteStreamTime=this.facade.getCurrentTime(),e.lastSecondCompleted=Math.floor(i),e.lastPercentageCompleted=this.currAdPercentComplete,e},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&t!=e.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var t,e,i;this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying()&&(e=this.facade.getCurrentTime(),this.checkForAdBlocker(e,!1),t=this.streamManager.contentTimeForStreamTime(e),!this.contentStartOpen&&t>0&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(t),i=this.createVideoProgressPayload(t,e),this.dispatchVideoProgress(i))},createVideoProgressPayload:function(t,e){var i=this.getVideoProgressPayload();return i.currentTime=t,i.absoluteStreamTime=e,i.duration=this.contentDuration||-1,i},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(t,e){var i=t-this.lastAdBlockCheckTime>this.adBlockCheckInterval,n=e||i,s=n&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return n&&(this.lastAdBlockCheckTime=t),s&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!s},assembleResourceDefinition:function(){var t=this.rco.getAdTagParameters(),e=this.rco.getVideoId(),i=this.rco.getContentSourceId();return t&&e&&i?{adTagParameters:t,videoId:e,contentSourceId:i}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(t){for(var s,a="add"===t?"addEventListener":"removeEventListener",r="addEventListener"===a,o=e.StreamEvent.Type,l=i.length,d=[];l--;)s=o[i[l]],d.push(s),r&&(this.hMap[s]=n[l]);this.streamManager[a](d,this.hStreamEvent,!1)},createAdClickElement:function(t){var e,i,n,s,a=t.nextSibling;if(a&&"uvpjsDaiContainer"===a.getAttribute("data-role"))return a;for(n in(e=document.createElement("div")).setAttribute("data-role","uvpjsDaiContainer"),i={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},s=e.style,i)s[n]=i[n];return t.insertAdjacentElement("afterend",e),e},onPauseVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onPlayVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,n=i&&i.vol,s=uvpjs.util.inRange(n,0,1),a=this.cviModel.isMuted;e===this.vidContId&&s&&!a&&this._hasFacade()&&(this.facade.setVolume(n),this.isAdPlaying()&&this.trackAdEvent(t.type))},onMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onUnMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},facadeId3Data:function(t){var e,i,n;for(e=t.length,n=0;n<e;n++)i=t[n],this.streamManager.processMetadata("ID3",i.data,i.pts)},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){this.contentDuration=this.streamManager.contentTimeForStreamTime(t.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(t){this.adClickElement&&(this.adClickElement.style.display=!1!==t?"block":"none")},log:function(t,e,i){uvpjs[i||"log"](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};t.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){this._super(t,e,i),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(t){t()},loadVideoAndBeginPlayback:function(t){var e,i=this.rco,n=this.cviModel;this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),n.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),n.setContentVideoStateItems(i),n.mergeCDOData(),this.killDataProxy(),this.contentDuration=n.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),(e=this.assembleAssetUrl(i))?(this.cviModel.contentVideoState.assetURL=e,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(i.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),!this.suppressFacadePlayOnLoad&&this.facade.playVideo()):this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0)},assembleAssetUrl:function(t){var e,i,n=t.assetURL,s=uvpjs.util;return s.isEmpty(n)?null:n.indexOf("?")>-1?n:(e=(i=t.getAdTagParameters())?s.queryStrFromObj(i):null,s.isEmpty(e)?n:n+"?"+e)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(t){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(t),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(t){var e=this.getPrerollPod(t);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:e})},dispatchAdPodEnd:function(){var t=this.getPrerollPod();t.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:t})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,n){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e,isFatal:!0===n,adInfo:null})})},getPrerollPod:function(t){return this.adPod||(this.adPod={startTime:t,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var t=uvpjs.adUtil.getAdStateBlank();t.adServerName="dai_ssb",t.duration=this.getPrerollAdDuration(),t.adClipID="pre_0",t.adPosition=1,t.adType="pre",this.cviModel.setAdVideoState(t)},getPrerollAdDuration:function(){var t=this.getAbsoluteDuration();return t>0&&this.contentDuration>0?t-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var t,e,i=this.getVideoProgressPayload(),n=this.facade.getCurrentTime(),s=this.getPrerollAdDuration(),a=Math.floor(n/s*100);switch(a){case 25:t=this.quartiles[25],e=25;break;case 50:t=this.quartiles[50],e=50;break;case 75:t=this.quartiles[75],e=75}return e&&!t&&this.dispatchAdQuartile(e),e&&(this.quartiles[String(e)]=1),i.isAd=!0,i.duration=s,i.currentTime=n,i.absoluteStreamTime=this.facade.getCurrentTime(),i.lastSecondCompleted=Math.floor(n),i.lastPercentageCompleted=a,i},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var t,e=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,i=this.isAdPlaying(),n=this.contentStartOpen,s=e&&this.facade.getCurrentTime();e&&(t=i?this.createAdProgressPayload():n?this.createVideoProgressPayload():null,s>1&&!n&&!i&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+s),this.contentStartTime=s,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(s),t&&this.dispatchVideoProgress(t))},createVideoProgressPayload:function(){var t=this.getVideoProgressPayload(),e=this.facade.getCurrentTime(),i=e-this.contentStartTime;return t.currentTime=i,t.absoluteStreamTime=e,t.duration=this.contentDuration||-1,t},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,n=i&&i.seekTime,s=this.facade,a=this._hasFacade(),r=a&&(this.absoluteDuration||s.getDuration()),o=this.getPrerollAdDuration(),l=this.facade.getCurrentTime();"number"==typeof n&&e===this.vidContId&&r&&((n+=o>0?o:0)<0||n>r?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+n):(this._seekFromTime=this._seekFromTime||l,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:n,seekFromTime:this._seekFromTime},null,2)),a&&s.seekTo(n)))},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){!this.absoluteDuration&&(this.absoluteDuration=t.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){this.vidEl.textTracks.removeEventListener("addtrack",this.hAddTextTrack,!1)},hAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(t.track.addEventListener("cuechange",this.hCueChange.bind(this),!1),t.track.mode="hidden")},hCueChange:function(t){t.target&&t.target.activeCues&&1==t.target.activeCues.length&&this.handleId3Cue(t.target.activeCues[0])},handleId3Cue:function(t){var i,n,s=t.value;"TXXX"===s.key&&(i=""!==s.info?s.info:s.data,(n=e[i])&&this[n](t.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(t,e,i){uvpjs[i||"log"](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.P2pClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var t=uvpjs.P2pClient.clientMap[this.clientName];return t&&t.getHlsjsLoader&&(t.getHlsjsLoader()||null)}}),t.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,t.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(t,e){var i;this.getHlsjsLoader()?t():e.apiKey?(i=this.loadHlsLoader.bind(this,t),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+e.apiKey,i,2e3)):t(!0)},loadHlsLoader:function(t,e){if(e)return uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",e),void t(!0);uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,t,2e3)}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.MultiCdnClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(t){this.inFlight||(this.inFlight=!0,this.decisionCallback=t,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),(new uvpjs.CodeLoader).loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(t){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(t.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),t.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(t){return t&&t.customerId&&t.appId?this.decisionUrl.replace("{customerId}",t.customerId).replace("{appId}",t.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(t){t()}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t,e){var i=uvpjs.VideoDeliveryPluginService.clientType;this.model=e,this.callback=t,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(i.P2P),this.multiCdnClientOptions=this.getClientOptions(i.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var t=null,e=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(t=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(e=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(t,e))},handleMcdnReady:function(t){var e=this.multiCdnClientOptions;!t&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,e.clientName)||(e.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+e.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var t=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,t.clientName,this.handleMcdnReady.bind(this),t.requiredParams)},handleP2pReady:function(t,e){var i=this.p2pClientOptions;!e&&this.validateScriptLoad(this.staticSvc.clientType.P2P,i.clientName)||(i.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+i.clientName)),t?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var t=this.p2pClientOptions,e=this.multiCdnClientOptions.canUse;t.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,t.clientName,this.handleP2pReady.bind(this,e),t.requiredParams):e?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(t,e,i,n){var s=this.getClientObject(t,e);s||i(!0),s.loadScripts(i,n)},validateScriptLoad:function(t,e){var i=this.getClientObject(t,e);return i&&i.validateScriptLoad()||!1},createClient:function(t,e){return new t(e)},getClientOptions:function(t){var e,i,n,s,a,r,o,l,d,u=this.model,c=this.getSupportedClients(t),h={canUse:!1,clientName:null};if(t===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return h;for(e in c)if((l=(n=c[i=e])&&n.uvpcModuleName)&&u.isModuleEnabled(l)){for(a=(s=n.requiredParams)&&s.length||0,o={},d=!0;a--;){if(r=u.getModuleParam(l,s[a]),uvpjs.util.isEmpty(r)){d=!1;break}o[s[a]]=r}return{canUse:d,clientName:i,requiredParams:o}}return h},getSupportedClients:function(t){var e,i,n={},s=t.clientMap;if(!s)return n;for(e in s)i=s[e],n[e]={uvpcModuleName:i.uvpcModuleName,requiredParams:i.requires};return n},getClientObject:function(t,e){return t.clientMap[e]||null}});var e=t.VideoDeliveryPluginService;e.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},e.load=function(t,e,i){(new uvpjs.CodeLoader).loadScript(t,e,i)}}(uvpjs.register("uvpjs")),function(t){t.FullscreenManager=uvpjs.Class.subClass({init:function(t){var e=uvpjs.util,i=t||{},n=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,i.videoElement&&i.container?(this.videoEl=i.videoElement,this.container=i.container,this.fullscreenChangeCallback=e.isFunction(i.fullscreenChangeCallback)&&i.fullscreenChangeCallback,this.readyCallback=e.isFunction(i.readyCallback)&&i.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=n.getEnterFullscreenMethodName(),this.exitMethod=n.getExitFullscreenMethodName(),this.fsElementName=n.getFullScreenElementName(),this.isFullscreenProperty=n.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()):uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.")},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(t){var e=this.isFullscreen();t.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(e)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener("loadedmetadata",this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var t=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return t&&uvpjs.util.isFunction(t[this.exitMethod])?t:null},validateEntryAndExitMethods:function(){var t=this.fsElement&&this.fsElement[this.enterMethod],e=this.exitScope&&this.exitScope[this.exitMethod],i=uvpjs.util;this.hasValidEntryMethod=i.isFunction(t),this.hasValidExitMethod=i.isFunction(e)},initialize:function(){var t,e,i,n=uvpjs.mediaCapabilities;this.hasFsApiSupport=n.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(i=n.getFullscreenEventName(),(n.isFirefox()||n.isIE()?document:this.container).addEventListener(i,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,t=n.getFullscreenEnterEventName(),e=n.getFullscreenExitEventName(),this.fsElement.addEventListener(t,this.hFullScreenEvent,!1),this.fsElement.addEventListener(e,this.hFullScreenEvent,!1),this.enterEvt=t,this.exitEvt=e),this.validateEntryAndExitMethods(),this.hasValidEntryMethod?(this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener("loadedmetadata",this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())):this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo())}}),t.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(uvpjs.register("uvpjs")),function(t){"use strict";var e,i,n,s,a=t._;t.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=t.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=t.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(t.skinConfig)},destroy:function(){var t=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=t,this._replayCB=t,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(t){var e=uvpjs.util,i=uvpjs.Configuration.path,n=this._containerId,s=t.customCSS;this._namespace="."+n+".skin",this._autoPlay=t.isMutedAutoplay||t.isUnmutedAutoplay,this._isMutedAutoplay=t.isMutedAutoplay,this._previewImage=t.previewImage,this._enableReplay=t.enableReplay,this._themeName=t.themeName,this._controls=t.controls,this._template=t.template,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=e.isDefinedString(s)&&s||i+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(t)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(t){this._playbackState=t,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),a.includes(this._disabledButtons,t)||this._disabledButtons.push(t),this._disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),a.pull(this._disabledButtons,t),this._enableButton(t)},_handleFullscreenMgrReady:function(t){t&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(t){var e=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),t?(this.vci.fullscreen(!0),e&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),e&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",t),this._disable(t),e&&e.setAttribute("disabled","disabled")},_enableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",t),a.includes(this._disabledButtons,t)||(this._enable(t),e&&e.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t.addEventListener(i.AD_START+e,this._onAdStart.bind(this)),t.addEventListener(i.AD_END+e,this._onAdEnd.bind(this)),!this._isIOS&&t.addEventListener(i.CAPTIONS_READY+e,this._onCaptionsReady.bind(this)),t.addEventListener(i.CONTENT_START+e,this._onContentStart.bind(this)),t.addEventListener(i.CONTENT_END+e,this._onContentEnd.bind(this)),t.addEventListener(i.VIDEO_PROGRESS+e,this._onVideoProgress.bind(this)),t.addEventListener(i.VIDEO_STATE_CHANGE+e,this._onVideoStateChange.bind(this)),t.addEventListener(i.VIDEO_LOADING+e,this._onVideoLoading.bind(this)),t.addEventListener(i.CONTROL_MUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.CONTROL_UNMUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.RESOURCE_START+e,this._onResourceStart.bind(this)),t.addEventListener(i.RESOURCE_END+e,this._onResourceEnd.bind(this)),t.addEventListener(i.CONTAINER_RESIZE+e,this._onUVPJSResize.bind(this)),t.addEventListener(i.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+e,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t&&t instanceof uvpjs.VideoControlInterface&&(t.removeEventListener(i.AD_START+e),t.removeEventListener(i.AD_END+e),!this._isIOS&&t.removeEventListener(i.CAPTIONS_READY+e),t.removeEventListener(i.CONTENT_START+e),t.removeEventListener(i.CONTENT_END+e),t.removeEventListener(i.VIDEO_PROGRESS+e),t.removeEventListener(i.VIDEO_STATE_CHANGE+e),t.removeEventListener(i.VIDEO_LOADING+e),t.removeEventListener(i.CONTROL_MUTE+e),t.removeEventListener(i.CONTROL_UNMUTE+e),t.removeEventListener(i.RESOURCE_END+e),t.removeEventListener(i.CONTAINER_RESIZE+e))},_addUIEventListeners:function(){for(var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this.css,n=this.shouldTrapTaps(),s=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],a=s.length;a--;)"_onClosedCaptionBtnClick"===s[a]&&this._isIOS||(this[s[a]]=this[s[a]].bind(this));var r=this._onUVPJSGestureEvent,o=this._hNonTap,l=this._onProgressSliderEvent,d=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",o),e.addEventListener("mouseenter",r,!0),e.addEventListener("mouseleave",r,!0),e.addEventListener("mousemove",r,!0),e.addEventListener("mousedown",r,!1),e.addEventListener("mouseup",r,!1),e.addEventListener("click",r,!1),e.addEventListener("touchstart",r,!0),e.addEventListener("touchend",r,!0),this._previewBtn=this._queryByElementName(i.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",o),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(i.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(i.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(i.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(i.PROGRESS_SLIDER),this._progressSlider.addEventListener(t,l,!1),this._progressSlider.addEventListener("mousedown",l,!1),this._progressSlider.addEventListener("mouseup",l,!1),this._progressSlider.addEventListener("touchstart",l,!0),this._progressSlider.addEventListener("touchend",l,!0),this._volumeSlider=this._queryByElementName(i.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(t,d,!1),this._volumeSlider.addEventListener("mouseover",d,!1),this._volumeSlider.addEventListener("mouseout",d,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(i.LARGE_PLAY_BTN),!n&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(i.PLAYSTATE_BTN),!n&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(i.VOLUME_BTN),!n&&this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._isIOS||(this._ccBtn=this._queryByElementName(i.CLOSED_CAPTION_BTN),!n&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(i.SETTINGS_BTN),!n&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,i.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(i.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this._hNonTap,n=this._onUVPJSGestureEvent,s=this._onProgressSliderEvent,a=this._onVolumeSliderEvent,r=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",i,!1),e.removeEventListener("mouseenter",n,!0),e.removeEventListener("mouseleave",n,!0),e.removeEventListener("mousemove",n,!0),e.removeEventListener("mousedown",n,!1),e.removeEventListener("mouseup",n,!1),e.removeEventListener("click",n,!1),e.removeEventListener("touchstart",n,!0),e.removeEventListener("touchend",n,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",i,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(t,s,!1),this._progressSlider.removeEventListener("mousedown",s,!1),this._progressSlider.removeEventListener("mouseup",s,!1),this._progressSlider.removeEventListener("touchstart",s,!0),this._progressSlider.removeEventListener("touchend",s,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(t,a,!1),this._volumeSlider.removeEventListener("mouseover",a,!1),this._volumeSlider.removeEventListener("mouseout",a,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",r,!1),this._volumeBtn.removeEventListener("mouseover",r,!1),this._volumeBtn.removeEventListener("mouseout",r,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var t=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(t,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var t=!0;for(var e in this._controlList)this._checkControlOnDOM(this._controlList[e])||(t=!1);return t},_waitForControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls.");setTimeout(function(){++this._waitCount>100||(this._haveControlsLoaded()?t.call(this):this._waitForControls(t))}.bind(this),50)},_clearMouseMoveInterval:function(t){var e=this._getClassName(t,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[e]&&(clearInterval(this._intervals[e]),this._intervals[e]=-1)},_clearIntervals:function(){var t,e=this._intervals;for(t in e)-1!==e[t]&&(clearInterval(e[t]),e[t]=-1)},_setupDom:function(){var t=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),e(this._containerEl,this.PRIMARY_BLOCK),e(this._contentEl,this._getClassName(t.CONTENT)),e(this._controlsEl,this._getClassName(t.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&e(this._adEl,this._getClassName(t.AD)),this._hide(t.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(t.BUFFERING_FRAME),this._hide(t.LARGE_PLAY_BTN),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._hide(t.VOLUME_SLIDER),this._show(t.CONTROLS),this._hide(t.BUFFERING_FRAME),this._hide(t.SETTINGS_MENU),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(t){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t]=t},_setupControlsContainer:function(){var t=JSON.parse(JSON.stringify(this._controls))||[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(t)},_generateSettingsMenu:function(t,e){var i,n,s,r,o,l,d,u,c=this._queryByElementName(this.css.SETTINGS_MENU),h=this._getClassName(this.css.SETTINGS_MENU_ITEM),p=a.assign({},this._menuSelections,this._getCaptionsStyle()),g=document.createRange(),f=uvpjs.util,v=[],m=this.shouldTrapTaps();for(u=t&&t.length,d=0;d<u;d++)s=e,(r=(o=t[d]).name)&&(s=f.isDefinedString(e)&&[e,r].join(":")||r),v.push(_(o,s));for(e&&((l=_(this._findMenuItem(e),s=e.split(":").slice(0,-1).join(":"))).cls=h+"--back",v.unshift(l)),g.selectNodeContents(c),g.deleteContents(),c.insertAdjacentHTML("beforeend",this._templateToHTML(v)),i=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),n=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),d=i&&i.length;d--;)!m&&i[d].addEventListener("click",this._onSettingsMenuBtnClick);for(d=n&&n.length;d--;)!m&&n[d].addEventListener("click",this._onSettingsMenuInputClick);function _(t,e){var i,n,s,r,o={};if(!1!==t.enabled)return void 0===t.value?(o.el="SETTINGS_MENU_ITEM",o.type="button",o.label=t.label,o.target=e):(o.el="SETTINGS_MENU_INPUT",o.type="menu",o.label=t.label||t.value,o.value=t.value,o.property=e&&a.last(e.split(":")),o.selected=(n=(i=o).value,s=i.property,!(((r=s&&p[s])&&r.toLowerCase())!==(n&&n.toLowerCase())))),o}},_removeMenuEventListeners:function(){var t,e=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),i=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);for(t=e&&e.length;t--;)e[t].removeEventListener("click",this._onSettingsMenuBtnClick);for(t=i&&i.length;t--;)i[t].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(t){var e={items:this.settingsMenu};if(a.isEmpty(t))return e;var i=this,n=t.split(":");return a(n).each(function(t){i.debug&&uvpjs.log(i.DEBUG_ID,"_findMenuItem key",t),e=a.find(e.items,function(e){return e.name===t})}),e},_createAdLearnMoreButton:function(){},_setupPreview:function(){var t=uvpjs.util,e=this.css.PREVIEW_BTN,i=this._previewImage,n=this._queryByElementName(e);uvpjs.log(this.DEBUG_ID,"_setupPreview",i),t.isDefinedString(i)&&(n.style.backgroundImage="url('"+i+"')"),this._show(e)},_setupReplay:function(){var t=uvpjs.util,e=this.css,i=e.REPLAY_BTN,n=this._previewImage,s=this._queryByElementName(i);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),t.isDefinedString(n)&&(s.style.backgroundImage="url('"+n+"')"),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.BUFFERING_FRAME),this._show(e.CONTROLS),this._hide(e.CONTROL_BAR),this._hide(e.PROGRESS),this._show(i),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var t=this._getClassName(this.css.BUFFERING_FRAME);new Spinner({lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:t,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(this._controlsEl)},_disableInactiveButtons:function(){!this._isIOS&&this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(t){var e=this.css;this._containerId===t.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(t.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._disableButton(e.SETTINGS_BTN),this._disableButton(e.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._hasActive(e.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),t.payload.adData.isCustomClickTrackingUsed||this._disable(e.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(t){return this.vci.getContentVideoData().isLive&&!!t},_onAdEnd:function(t){this._containerId===t.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,t.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(t){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",t),this._captionsLoaded=!0,this._enableCaptions(),this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",t),this._isIOS||this._disableCaptions()},_onContentStart:function(t){var e=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",t),this._containerId===t.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),!this._isLive()&&this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._captionsLoaded&&this._enableButton(e.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(e.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(e.PROGRESS)):this._isStreaming()&&this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),!this._isIOS&&this._hasActive(e.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===t.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(t){var e="controlMute"===t.type;this._containerId===t.target&&this._updateVolumeUI(this._volumeSlider.value,e)},_onDiagCloseButton:function(t){this._containerId===t.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",t),this._menuSelections.debug=null)},_onResourceStart:function(t){(t&&t.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(t){var e=t.target,i=0===t.payload.playlistLength;this._containerId===e&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",t),this._hide(this.css.CONTROLS),this._enableReplay&&i?this._setupReplay():this._captionsLoaded=!1,this._resetProgressSlider())},_onVideoProgress:function(t){var e,i,n=t.payload,s=n.playbackState,a=this.vci.getVolume(),r=this.css.TIME_DURATION,o=this.css.TIME_CURRENT,l=!1;this._containerId===t.target&&(a!==Number(this._volumeSlider.value)&&this._updateVolumeUI(a),s!==this._playbackState&&(this._playbackState=s,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(n),s!==this.mc.PLAYING||this._isSliding||n.duration!==1/0&&(e=this._queryByElementName(r),i=this._queryByElementName(o),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&n.duration>=3600&&(this.durationChecked=l=!0):(this.durationChecked=!0,n.duration>=3600&&(l=!0)),l&&(i.parentNode.style.width="100px"),e.innerHTML=this._formatTimestampByType(r,n.duration),i.innerHTML=this._formatTimestampByType(o,n.currentTime),this._updateProgressUI(n)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(t){a.has(t,"target")&&this._containerId===t.target&&a.isObject(t)&&a.has(t,"payload.data")&&this._updateProgressLoad(t.payload.data)},_onVideoStateChange:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",t),a.isObject(t)&&this._containerId===t.target&&a.isObject(t.payload)&&a.isNumber(parseInt(t.payload.newState))&&(!this.ignoreVideoStateChange||e===this.mc.PAUSED||e===this.mc.PLAYING)){var e=t.payload.newState;e!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),e===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(t,e,i){null!==t&&(this.isMonitoringMuting=t),e&&clearInterval(this.muteMonitorIntervalId),i&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var t=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&t!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=t,t?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(t){var e=!1;switch(t.type){case"mouseenter":this._onUVPJSMouseEnter(t);break;case"mouseleave":this._onUVPJSMouseLeave(t);break;case"mousemove":this._onUVPJSMouseMove(t);break;case"mousedown":this._onUVPJSMouseDown(t);break;case"mouseup":this._onUVPJSMouseUp(t);break;case"click":this._showControlBar(t),e=!0;break;case"touchstart":this._onUVPJSTouchStart(t);break;case"touchend":this._onUVPJSTouchEnd(t),e=!0}!this._hasFirstTouch&&e&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(t)))},_getTargetInfo:function(t){var e=t.target;return{isVolumeButton:-1!==e.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==e.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(t){switch(t.type){case"input":case"change":this._onProgressSliderChange(t);break;case"touchstart":case"mousedown":this._onProgressSliderStart(t);break;case"touchend":case"mouseup":this._onProgressSliderEnd(t)}},_onVolumeSliderEvent:function(t){switch(t.type){case"input":case"change":this._onVolumeSliderChange(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onVolumeBtnEvent:function(t){switch(t.type){case"click":case"touchend":this._onVolumeBtnClick(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onUVPJSMouseEnter:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._showControlBar(t))},_onUVPJSMouseDown:function(t){t.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(t){var e,i=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),t.target.getAttribute("disabled"))return t.stopPropagation(),void t.preventDefault();if(this._touchStartTime=t.timeStamp,this._previewCallbackDone){if(!this._hasDisabled(this.css.CONTROLS)&&i!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),t.target===this._progressSlider)){var n=t.target.getBoundingClientRect(),s=(t.pageX||t.targetTouches[0].pageX)-n.left;e=1-(t.target.clientWidth-s)/t.target.clientWidth,this._onProgressSliderChange(t,e)}}else this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet.")},_onUVPJSTouchEnd:function(t){var e,i,n,s,a=this.css,r=this._isTap(t.timeStamp),o=[a.CLOSED_CAPTION_BTN,a.VOLUME_BTN,a.PLAYSTATE_BTN,a.SETTINGS_BTN,a.SETTINGS_MENU,a.SETTINGS_MENU_ITEM,a.SETTINGS_MENU_INPUT,a.LARGE_PLAY_BTN,a.FULLSCREEN_BTN],l=o.length,d=t.target.className;if(t.target.getAttribute("disabled"))return t.stopPropagation(),void t.preventDefault();if(!this._hasDisabled(a.CONTROLS)){for(;l--&&!(i=i||d.indexOf(o[l])>-1););if(this.shouldTrapTaps()&&i&&l<o.length-1)return t.stopPropagation(),t.preventDefault(),void this.handleTap(o[l],t);(n=!(i||this._isTouchActive&&r))&&t.preventDefault(),n&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),s=e||n?this.HIDE_DELAY:0,e&&clearTimeout(e),e=setTimeout(function(){if(this._hasPaused())return;e=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER)}.bind(this),s)}},handleTap:function(t,e){var i=this.css;if(!this._queryByElementName(t).hasAttribute("disabled"))switch(t){case i.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(e);break;case i.VOLUME_BTN:this._onVolumeBtnEvent(e);break;case i.PLAYSTATE_BTN:case i.LARGE_PLAY_BTN:this._onPlayToggle(e);break;case i.SETTINGS_BTN:this._onSettingsBtnClick(e);break;case i.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(e);break;case i.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(e)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(t){t.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(t){var e=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[e]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[e]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(t){this._isMouseActive||(this._clearMouseMoveInterval(t),this._removeModifier(t,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(t){t.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var t=this._containerEl.offsetWidth;t>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),t<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(t){var e=this.vci.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(e?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(t){var e=parseFloat(t.target.value),i=this.vci.getPlayerMuted();i&&e>0&&this.vci.unMute(),this.vci.setVolume(e),this._updateVolumeUI(e,i)},_onFullscreenBtnClick:function(t){t.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),t.stopPropagation(),t.preventDefault(),this.ignoreVideoStateChange&&this._isLive())this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo());else{var e=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",e),e===this.mc.PAUSED||e===this.mc.EMPTY||e===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();e!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())}},_onPreviewBtn:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),!this._isTouch||this._isTap(t.timeStamp)?(t.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback.")},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),t.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),t.stopPropagation();var e=this.css.CLOSED_CAPTION_BTN;if(this._hasActive(e))return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),t.stopPropagation();var e=this.css.SETTINGS_MENU,i=this._hasHidden(e);if(uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",i),i)return this._addModifier(e,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(e);this._removeModifier(e,this.ACTIVE_MODIFIER),this._hide(e)},_onSettingsMenuBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",t);var e=t.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",e),t.target.parentNode.setAttribute("data-target",e);var i=this._findMenuItem(e);this._generateSettingsMenu(i.items,e)},_onSettingsMenuInputClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",t);var e=t.target.parentNode.getAttribute("data-target");switch(e&&e.split(":")[0]){case"cc":this._onSettingsCaptionsChange(t);break;case"controls":this._onSettingsControlsChange(t);break;case"debug":this._onSettingsDiagWindowChange(t)}},_onSettingsCaptionsChange:function(t){var e=t.target,i=e.parentNode,n=e.getAttribute("data-property"),s=e.getAttribute("data-value").toLowerCase();this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",n,s),a(i.children).each(function(t){t.setAttribute("data-selected","false")}.bind(this)),e.setAttribute("data-selected","true"),"text-position"!==n?this.vci.setCaptionsStyleProperty(n,s):this._setCCPosition(s)},_onSettingsControlsChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",t);var e=t.target,i=e.getAttribute("data-property"),n=e.getAttribute("data-value").toLowerCase(),s="#"+this._containerId+" ";if("background-opacity"===i){i="background-color";var a=this._queryByElementName(this.css.CONTROL_BAR),r=getComputedStyle(a).getPropertyValue(i);if(-1===r.indexOf("rgba"))return;n=r.split(",").slice(0,-1).join(",")+", "+n+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",n),s+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(s,i,n)},_onSettingsDiagWindowChange:function(t){var e=t.target,i=e.getAttribute("data-property"),n=e.getAttribute("data-value"),s=!("true"===e.getAttribute("data-selected"));this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",t),this._menuSelections[i]=n,e.setAttribute("data-selected",s),s?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(t){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",t),this.vci.setCaptionsStyle(t))},_setCaptionsStyleProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",t,e),this.vci.setCaptionsStyleProperty(t,e))},_setCueProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&(this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",t,e),this.vci.setCaptionsCueProperty(t,e)))},_setCCPosition:function(t){var e="text-position";!this._isIOS&&this._captionsLoaded&&(t=t||this._getCaptionsStyle()[e],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",e,t),this.vci.setCaptionsStyleProperty(e,t))},_showControlBar:function(t){var e=this.vci.getCurrentPlaybackState().playbackState,i=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&e!==this.mc.EMPTY&&(a.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this.controlsVisible=!0,this._show(i.PROGRESS))},_hideMenu:function(t){this._hasHidden(this.css.SETTINGS_MENU)||t.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(t){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=a.debounce(function(){this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch?this._hideControlBar.hide.cancel():(this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS))},t||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(t){var e=this.css;this._hasDisabled(e.VOLUME_BTN)||this._hasDisabled(e.CONTROLS)||(this._hasActive(e.SETTINGS_MENU)&&this._hide(e.SETTINGS_MENU),this._setDataAttribute(this._containerEl,e.VOLUME_SLIDER,!0),this._addModifier(e.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(e.VOLUME_SLIDER))},_hideVolumeSlider:function(t){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._hasModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER)&&this.vci.showCaptions())},_disableCaptions:function(){this._isIOS||(this._disableButton(this.css.SETTINGS_BTN),this._disableButton(this.css.CLOSED_CAPTION_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),a.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(t,e){var i,n=uvpjs.util,s=this._containerEl;!0===this.vci.getPlayerMuted()?i="mute":t>.85?i="full":n.inRange(t,.5,.85)?i="high":n.inRange(t,.15,.5)?i="medium":n.inRange(t,0,.15)&&(i="low"),this._volumeSlider.value=t||this._videoEl.volume,this._setDataAttribute(s,"volume-level",i),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,t)},_onProgressSliderChange:function(t,e){var i,n,s=this.vci.getContentVideoData(),a=this.vci.getCurrentPlaybackState(),r=this.css.TIME_CURRENT,o=this._queryByElementName(r),l=e||this._progressSlider.value;l=l>1?1:l<0?0:l,i=Math.ceil(l*s.duration*1e4)/1e4,n=Math.abs((a.currentTime-i)/i),this._updateProgressSlider(l),o.innerHTML=this._formatTimestampByType(r,i),this._hasActive(this.css.PROGRESS_SLIDER)||n<=.02||this.vci.seekTo(i)},_onProgressMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(t){var e=this.css;if(this._hasAd()||this._hasDisabled(e.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._addModifier(e.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(t){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(t)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(t){var e;this._isLive()||(e=Math.ceil(t.bufferLength/t.duration*1e4)/1e4,a.isNaN(e)||e===1/0||e<=0||(this._downloaded=e,this._hasAd()||(this._queryByElementName(this.css.PROGRESS_LOADED).value=this._downloaded)))},_updatePlaybackStateUI:function(t){var e=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",t),t){case this.mc.PLAYING:this._show(e.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(e.PROGRESS);break;case this.mc.PAUSED:this._show(e.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(e.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(e.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(e.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(e.CONTROLS),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.LARGE_PLAY_BTN),this._show(e.BUFFERING_FRAME)}},_updateProgressUI:function(t){var e=Math.ceil(t.currentTime/t.duration*1e4)/1e4;this._updateProgressSlider(e)},_updateSliderUI:function(t,e,i){var n=this,s={};if(!a.isUndefined(this._vendorPrefix)&&!a.isUndefined(t))if(s.id="#"+this._containerId,s.cls=n._getClass(e),s.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[n._vendorPrefix],this._isMSEdge&&(s.pseudo=""),s.add=function(t,e,i){if(!a.isUndefined(this.pseudo)){var s=this.id+(e||"")+" "+this.cls+(i||"")+this.pseudo;n._addCSSRule(s,"background-size",100*t+"% 100%")}},s.before=function(t,e){var i=n._getClass(n.PRIMARY_BLOCK);e&&(i+=n._getClass(n.PRIMARY_BLOCK,e)),this.add(t,i,null)},s.after=function(t,e){this.add(t,null,e)},e!==n.css.VOLUME_SLIDER){var r=i*t.offsetWidth,o=(.5-i)*t.offsetHeight,l=r/t.offsetWidth,d=(r+o)/t.offsetWidth;t.value=i;var u=n._hasAd();s.before(l,u?n.AD_MODIFIER:null),this._isTouch&&s.before(d,n.TOUCH_MODIFIER)}else s.add(i)},_checkControlOnDOM:function(t){var e=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t;return!!this._controlCache[e]},_getClassName:function(t,e){var i=this.PRIMARY_BLOCK;return t!==this.PRIMARY_BLOCK&&(i+=this.BLOCK_ELEMENT_DELIMITER+t),e&&(i+=this.ELEMENT_MODIFIER_DELIMITER+e),i},_getClass:function(t,e){return this.CLASS_SELECTOR_PREFIX+this._getClassName(t,e)},_queryByClassName:function(t){var e,i;if(this._containerId)return e=this.ID_SELECTOR_PREFIX+this._containerId,t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),(i=this._controlCache[e]||document.querySelector(e))&&(this._controlCache[e]=i),i},_queryAllByClassName:function(t){var e=this.ID_SELECTOR_PREFIX+this._containerId;return t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),document.querySelectorAll(e)},_queryByElementName:function(t){return this._queryByClassName(this._getClassName(t))},_queryAllByElementName:function(t){return this._queryAllByClassName(this._getClassName(t))},_show:function(t){if(t===this.css.PROGRESS&&!this._isLive()){var e=this._queryByElementName(t),i=e.querySelector("input"),n=e.querySelector("progress");e&&(e.style.display="block"),i&&(i.style.display="block"),n&&(n.style.display="block")}this._removeModifier(t,this.HIDDEN_MODIFIER)},_hide:function(t){if(t===this.css.PROGRESS){var e=this._queryByElementName(t),i=e.querySelector("input"),n=e.querySelector("progress");e&&(e.style.display="none"),i&&(i.style.display="none"),n&&(n.style.display="none")}this._addModifier(t,this.HIDDEN_MODIFIER)},_enable:function(t){this._removeModifier(t,this.DISABLED_MODIFIER)},_disable:function(t){this._addModifier(t,this.DISABLED_MODIFIER)},_enableMenuItem:function(t){var e;t&&(e=this._findMenuItem(t))&&(e.enabled=!0)},_hasHidden:function(t){return this._hasModifier(t,this.HIDDEN_MODIFIER)},_hasActive:function(t){return this._hasModifier(t,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(t){return this._hasModifier(t,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.PLAYING},_isStreaming:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.STREAMING},_hasModifier:function(t,e){a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));var n=this._getClassName(t,e),s=this._queryByElementName(t);return!!s&&i(s,n)},_addModifier:function(t,i){a.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var n=this._getClassName(t,i),s=this._queryByElementName(t);s&&e(s,n)},_removeModifier:function(t,e){var i,s=this._queryByElementName(t);a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER)),i=this._getClassName(t,e),s&&n(s,i)},_toggleModifier:function(t,e){a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));var i=this._getClassName(t,e),n=this._queryByElementName(t);n&&s(n,i)},_setDataAttribute:function(t,e,i){t.setAttribute("data-"+e,i)},_removeDataAttribute:function(t,e){t.removeAttribute("data-"+e)},_formatTimestamp:function(t){var e,i;return uvpjs.util.isEmpty(t)||t===1/0?this.NULL_TIME:(isNaN(t)&&(t=0),(e=new Date(null)).setSeconds(Math.round(t)),i=e.toISOString(),t>=3600?i.substr(11,8):i.substr(14,5))},_formatTimestampByType:function(t,e){if(void 0===e||e<0){if(t===this.css.TIME_DURATION)return this.NULL_TIME;if(t===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(e)},_addCSSRule:function(t,e,i){var n=this._styleEl.sheet,s=n.cssRules.length,r=this._cssRules[t];if(!a.isUndefined(r)){var o=n.rules||n.cssRules;if(o.length>0&&o[r])return void(o[r].style[e]=i)}this._cssRules[t]=s,uvpjs.util.addCSSRule(this._styleEl,t,e,i)},_setStyleSheet:function(t){var e=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(i){this._styleEl=i,e||"function"!=typeof t||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),e=!0,t())}.bind(this))},_templateToHTML:function(t){if(a.isArray(t)&&!a.isEmpty(t)){var e=function(t){return this._getClassName(this.css[t]||t)}.bind(this),i=JSON.parse(JSON.stringify(this._template))||{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},n=this._isIOS;return function t(s){var r="";return a(s).each(function(s){s&&("CLOSED_CAPTION_BTN"!==s.el&&"SETTINGS_BTN"!==s.el||!n)&&(s.cls=a.isUndefined(s.cls)?e(s.el):[s.cls,e(s.el)].join(" "),s.children&&(s.children=t(s.children)),r+=a.template(i[s.type],{variable:"o"})(s))}),r}(t)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(t){return!!this._touchStartTime&&t-this._touchStartTime<this.TAP_THRESHOLD}}),i=function(t,e){return!a.isNull(t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)")))},e=function(t,e){i(t,e)||(t.className=(t.className+=" "+e).trim())},n=function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()},s=function(t,s){i(t,s)?n(t,s):e(t,s)}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(t,i,n,s){this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",i),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",n)),e.isArray(i)?(this.vidContId=t,this._generateAdPods(i,n,s)):this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN")},_generateAdPods:function(t,e,i){var n,s,a,r=e.length,o=function(t,e,i){return{hasBeenChecked:!1,startTime:i||0,hasPlayed:!1,adPodId:t,adCount:0,podDuration:0,adCallURL:e}};for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",e)),this.adPods={},r>0&&(e.indexOf(0)>-1&&(this.adPods[this.PRE]=o(this.PRE+"_0",i)),e.indexOf(-1)>-1&&(this.adPods[this.POST]=o(this.POST+"_0",i))),n=0;n<r;n++)s=0===e[0]?n:n+1,a=e[n],isNaN(a)||0===a||-1===a||(this.adPods[this.MID_+s]=o(this.MID_+s,i,a));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",t),e.isString(t)){var i=this.adPods[t];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",i),i}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var t=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",t),t},getMidRollPods:function(){var t,e=[];if(!this.midRollPods){for(t in e=[],this.adPods)t.indexOf(this.MID)>=0&&e.push(this.adPods[t]);this.midRollPods=e}return this.midRollPods},isPreRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.MID)>-1},isPostRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var t in this.adPods)if(t.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(t){var e,i,n,s=null,a="No eligible ad pod found.";for(n in this.adPods)this.adPods.hasOwnProperty(n)&&(e=this.adPods[n],this.isPreRoll(e)||this.isPostRoll(e)||e.startTime<=t&&(s?t-e.startTime<t-s.startTime&&(s=e):s=e));return s&&(i=s.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",a="Found Ad pod; adPodId = "+s.adPodId+"; "+i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+t+";  "+a),s}})}(uvpjs.register("uvpjs")),function(t){var e,n=t._;t.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",SEGMENT_MODULE_NAME:"Segment",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,t&&this.initialize(t.vidContId,t.cviMgr)},destroy:function(){for(var t,e=this.agents.length;e--;)this.agents[e]&&"function"==typeof this.agents[e].destroy&&this.agents[e].destroy(),this.agents.splice(e,1);for(t in this.eventCBs)this.eventsMgr.removeEventListener(t+this.internalNS+".agent"),delete this.eventsMgr[t];for(t in this.progressEvents)delete this.progressEvents[t];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),n.isString(t)&&n.isObject(e)&&(this.vidContId=t,this.eventsMgr=e.getEventsMgr(),this.cviModel=e.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._createAgentsArray(),this._addTrackingEventListeners(),this._initializeAgents())},hasTrackingConfigOverrides:function(t){return null!==t&&t.hasOwnProperty("trackingConfigOverrides")&&null!==t.trackingConfigOverrides},getAgentConfig:function(t,e){for(var i=null,n=t.length;n-- >0;){var s=t[n];if(s.name===e){i=s;break}}return i},doTrackingConfigOverrides:function(t){if(this.hasTrackingConfigOverrides(t)){for(var e=t.getModules().slice(0),i=e.length;i-- >0;){var n=e[i],s=this.getAgentConfig(t.trackingConfigOverrides,n.name);null!==s&&(e[i]=s)}this.agentConfigs=e}else this.agentConfigs=t.getModules().slice(0)},isTrackingAgentEnabled:function(t){var e,i=this.getAgentConfig(this.agentConfigs,t),n=this.mc.systemInfo.trackingAvailability,s=!1;for(e in uvpjs.tracking)if(uvpjs.tracking[e]===t&&n[e]){s=!0;break}return this.debug&&i&&i.enabled&&!s&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",i,n),null!==i&&i.enabled&&s},_createAgentsArray:function(t){var e,i,n,s,a,r,o;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),i=t||this.cviModel,this.doTrackingConfigOverrides(i),this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),s=i.isModuleEnabled.bind(i),a=i.isModuleSet.bind(i),n={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr},o=this.getPlayerName(),this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),n.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,n.playerName=o,e=new uvpjs.AdobeHeartbeatAgent(n),this.agents.push(e)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),n.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,e=new uvpjs.AkamaiAnalyticsAgent(n),this.agents.push(e)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),n.moduleName=this.COMSCORE_SS_MODULE_NAME,n.playerName=this.getPlayerName("|","_"),e=new uvpjs.ComScoreAgent(n),this.agents.push(e)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),n.moduleName=this.CONVIVA_MODULE_NAME,n.playerName=o,e=new uvpjs.ConvivaAgent(n),this.agents.push(e)),((r=s(this.DW_MODULE_NAME))||s(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),n.moduleName=r?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,n.playerName=this.getPlayerName(";"),e=new uvpjs.DWAgent(n),this.agents.push(e)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),n.moduleName=this.NIELSEN_MODULE_NAME,n.playerName=o,e=new uvpjs.NielsenAgent(n),this.agents.push(e)),a(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME))this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC");else{this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent");var l=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME);n.moduleName=this.MUX_MODULE_NAME,n.playerName=this.PLAYER_NAME_ONLY,n.playerVersion=this.PLAYER_VERSION_ONLY,n.useDefaultProperty=!l("propertyKey"),e=new uvpjs.MuxAgent(n),this.agents.push(e)}var d=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(d&&d.params&&d.params.length>0)for(var u=d.params.length;u-- >0;)this.beaconEndPoint[d.params[u].name]=d.params[u].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(n.moduleName=this.OZTAM_MODULE_NAME,n.playerName=o,n.playerVersion=this.PLAYER_VERSION_ONLY,e=new uvpjs.OzTamAgent(n),this.agents.push(e)),this.isTrackingAgentEnabled(this.SEGMENT_MODULE_NAME)&&(n.moduleName=this.SEGMENT_MODULE_NAME,n.playerName=o,n.playerVersion=this.PLAYER_VERSION_ONLY,e=new uvpjs.SegmentAgent(n),this.agents.push(e))},_addTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),t.addEventListener(e.RESOURCE_START+i,this._onResourceStart.bind(this)),t.addEventListener(e.PLAYBACK_DURATION_RESUME+i,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.removeEventListener(e.VIDEO_PROGRESS+i),t.removeEventListener(e.AD_QUARTILE+i),t.removeEventListener(e.RESOURCE_START+i)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),n.isEmpty(this.agents))this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled.");else{for(var t=this.agents.length;t--;)this.agents[t].initialize();this._addAgentEventListeners()}},fireTrackingPixel:function(t){var e=document.createElement("img");e.setAttribute("src",t),e.setAttribute("width","1"),e.setAttribute("height","1"),e.setAttribute("border","0"),e.style.position="absolute",e.style.bottom="0",e.style.right="0",this._beaconElement.appendChild(e)},registerEventCallbacks:function(t){if(n.isPlainObject(t)&&!n.isEmpty(t))for(var e in t)this.eventCBs[e]=this.eventCBs[e]||[],this.eventCBs[e].push(t[e])},registerProgressEvents:function(t){if(n.isPlainObject(t)&&!n.isEmpty(t))for(var e in t)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",e),this.progressEvents[e]=this.progressEvents[e]||[],this.progressEvents[e].push(t[e])},getContentPlayhead:function(){var t=this.cviModel.contentPlaybackState.currentTime;return parseInt(t)},getPlayerName:function(t,e){var i=this.PLAYER_NAME;return n.isEmpty(i)?"UVPJS":(t&&(i=i.replace("_",t)),e&&(i=i.replace(/\./g,e)),i)},getAdLength:function(){return this._adLength=e(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=e(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var t in this.eventCBs)this.eventsMgr.addEventListener(t+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(t){if(t.target===this.vidContId){var e,i=this.eventCBs[t.type];if(!n.isEmpty(i)){e=i.length;for(var s=0;s<e;s++)i[s](t)}}},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(t){var e,s=this.progressEvents[t];if(!n.isEmpty(s))for(e=s.length,i=0;i<e;i++)s[i]()},_onPlaybackDurationResume:function(e){var i=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),n=this.cviModel.getContentVideoState(),s={ts:Math.floor(Date.now()/1e3),contentid:n.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:i("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:n.isPaidContent,affiliate:n.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},a=(new t.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(s).devMode(this.debug).buildUrl();this.fireTrackingPixel(a)},_onVideoProgress:function(t){var e,i=t.payload,s=Math.floor(i.currentTime),a=i.duration;if(s&&a&&!i.isAd&&!(this._lastContentSecondCompleted>=s)){if(this._lastContentSecondCompleted=s,s%15==0&&s<=60||s%60==0){if(this._contentTimeFired[s])return;this._contentTimeFired[s]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",s),this._onProgressEvent(this.progressEvents.TIMED)}i.isPlayingLive||a<=10||((e=Math.floor(s/a*100))!==this.percentDone&&(this.percentDone=e),n.inRange(e,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),n.inRange(e,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),e>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),e=function(t,e){var i=e>0?Math.floor(1e3*e):0;return uvpjs.util.inRange(t,i-1e3,i+1e3)?t:i}}(uvpjs.register("uvpjs")),function(t){"use strict";var e,i,n,s,a,r;r=t._,t.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata={},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),r.isUndefined(this._visitorData.marketingCloudOrgId)?this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."):this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(t,e){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),r.isFunction(t)){i=e?e.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),this._usesTealium=i.usesTealium;var n=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),n=r.without(n,this.scriptPaths.APP_MEASUREMENT)),s()&&!this.isPluginLoaded)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(n,this.pluginLoadedCB);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()}else this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!")},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var t=this._qosObject;return e.createQoSObject(t.bitrate,t.startupTime,t.fps,t.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),e=t(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),i=t(this.TRACKING_SERVER_PARAM_NAME);this.mc.isSecure()&&(r.isString(i)&&0!==i.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(i=this.TRACKING_SERVER_SSL_PREFIX+i),r.isString(e)&&(e=e.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:t(this.ACCOUNT_PARAM_NAME),charSet:t(this.CHAR_SET_PARAM_NAME),trackingServer:i},this._heartbeatData={publisher:t(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:e},this._visitorData={marketingCloudOrgId:t(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:i},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var t=this.cviModel.sessionOptions;this._usesTealium=t.usesTealium;r.each({ftag:"ftag",netwk:"Network"},function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",e,i);var n=t[i];r.isNull(n)||r.isUndefined(n)||r.isEmpty(n)||(this._sessionMetadata[e]=n)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_POD_END]=this._onAdPodEnd.bind(this),e[t.AD_CLICK]=this._onAdClick.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),e[t.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),e[t.PLAYER_LOADED]=this._updateVideoInfo.bind(this),e[t.RESOURCE_START]=this._updateVideoInfo.bind(this),e[t.VIDEO_RESUME]=this._updateVideoInfo.bind(this),e[t.VIDEO_DONE]=this._updateVideoInfo.bind(this),this._contextMetadataCBSetup||(e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(e)},_setupContextMetadataEventCallback:function(){var t={};t[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t),this._contextMetadataCBSetup=!0},_initializePlugin:function(){var t,o,l,d;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),s())this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded.");else if(this._mediaHeartbeat)this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used.");else{if(e=ADB.va.MediaHeartbeat,i=ADB.va.MediaHeartbeatConfig,n=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!a(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)o=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(t=this._appMeasurementData.account,r.isString(t)&&r.isEmpty(t))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));(d=new Visitor(this._visitorData.marketingCloudOrgId)).trackingServer=this._visitorData.trackingServer,d.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),(o=new AppMeasurement(t)).visitor=d,o.account=t,o.trackingServer=this._appMeasurementData.trackingServer,o.pageName=this._appMeasurementData.pageName,o.charSet=this._appMeasurementData.charSet,o.visitorID=this._appMeasurementData.visitorID}r.isNull(o)?this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."):((l=new i).trackingServer=this._heartbeatData.trackingServer,l.playerName=this._playerName,l.channel=this._heartbeatData.channel,l.debugLogging=this._heartbeatDebug,l.appVersion=this.SDK_VERSION,l.ssl=this.mc.isSecure(),l.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",l),r.extend(u.prototype,n.prototype),u.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},u.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new e(new u(this),l,o),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad())}function u(t){this._agent=t}},_getTealium:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),a(this._s)||this._waitForTealium)this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.");else{if(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),!r.has(window,"s")||!a(window.s))return this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL);this._s=window.s,this._waitForTealium=!0,this._initializePlugin()}},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(t,i){if(r.isNull(this._mediaHeartbeat))this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined");else switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",t),t){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(e.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(e.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(e.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(e.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(e.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(e.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(i)}},_getContentVideoMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),n=this._contextMetadata,s=this._sessionMetadata,a={};for(t in n)n.hasOwnProperty(t)&&(a[t]=n[t]);for(t in s)s.hasOwnProperty(t)&&(a[t]=s[t]);if(i.contextMetadata)for(t in e=i.contextMetadata)e.hasOwnProperty(t)&&(a[t]=e[t]);return a.tl=i.videoTitle,a.mediaAutoPlay=this.cviModel.isAutoplay.toString(),a.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),a.mediaIsPaidContent=i.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",a),a},_onContextMetadata:function(t){var e,i=t.payload.contextMetadata;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",t),!r.isEmpty(i)&&(this._contextMetadata=i,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),r.isEmpty(i[this.PAGE_REPORT_SUITE_ID_KEY]),e=i[this.PAGE_SITE_ACCOUNT_KEY],!r.isEmpty(e))){var n=r.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=e,n&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+e),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(t){var i,n,s,a,r,o=t.chapterStartTimes,l=o&&o.length||0,d=parseInt(t.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",t),isNaN(d)&&(d=1),n=(i=d<0?0:d-1)<=0?0:o[i],r=(s=i+1>l?t.duration:o[i+1])-n,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",s,n),(a={}).name="",a.length=isNaN(r)?0:r,a.position=d,a.startTime=o[i],this._chapterObject=e.createChapterObject(a.name,a.position,a.length,a.startTime),this._chapterInfo=a,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(t){var i,n,s,a,o,l;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",t),"pre"===(a=(o=(l=t.payload.adData).adClipID.split("_"))[0])?s=1:"mid"===a?s=parseInt(o[1])+1:"post"===a&&(s=this.cviModel.getNumberOfAdPods()),(n={}).name=r.isEmpty(l.adVideoTitle)?"na":l.adVideoTitle,n.position=s,n.playerName=this._playerName,n.startTime=this.getCurrentPlaybackTime(),(i={}).id=r.isEmpty(l.adVideoId)?r.isEmpty(l.adVatId)?"na":l.adVatId:l.adVideoId,i.name=n.name,i.length=l.duration,i.position=l.adPosition,this._adObject=e.createAdObject(i.name,i.id,i.position,i.length),this._adBreakObject=e.createAdBreakObject(n.name,n.position,n.startTime),this._adInfo=i,this._adBreakInfo=n,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(t){var e=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(e)},_onAdClick:function(t){var e=!0===t.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),e&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(t){var e=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",e),this._contentStarted=!0,this._sendInitialPlay(),e.chapterStartTimes.length>0&&(this._setChapterInfo(e),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(t){var e=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",e),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&e.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(t){var e=this._videoInfo,i=this._contentStarted&&e&&Math.ceil(e.playhead)>=.95*e.length;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",i),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,i&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(t){var e=t.payload.newState,i=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",e),this._videoLoaded&&(this._isBuffering||e!==this.mc.BUFFERING?this._isBuffering&&e!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),e===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),i&&e===this.mc.PAUSED&&this._onControlPause(t))},_updateVideoInfo:function(){var t,i=this.cviModel.getCurrentPlaybackState(),n=this.cviModel.getContentVideoState(),s=e.StreamType,a=n.duration,o=n.isLive,l=n.episodeFlag,d={};r.isEmpty(n.cmsRefGuid)?r.isEmpty(n.mediaId)?r.isEmpty(n.pid)?r.isEmpty(n.assetURL)?d.id="na":d.id=n.assetURL:d.id=n.pid:d.id=n.mediaId:d.id=n.cmsRefGuid,d.name=n.videoTitle,d.playerName=this._playerName,d.length=o?-1:isNaN(a)?0:a,d.playhead=i.currentTime,o?t=s.LIVE:(t=s.VOD,t+=":"+(l?this.FULL_EPISODES:this.CLIPS)),d.streamType=t,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",e),this._mediaObject=e.createMediaObject(d.name,d.id,d.length,d.streamType),this._videoInfo=d,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(t){var e=t&&t.facadeState,i=this._qosObject;e&&i&&(i.bitrate=e.currentBitrate||0,i.droppedFrames=e.droppedFrames||0,i.fps=e.playbackFramerate||0)},_updatePlayhead:function(t){var e=t.payload;this._videoInfo&&e&&(e.isAd||(this._updateQosObj(e),this._videoInfo.playhead=e.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)}}),s=function(){return"undefined"==typeof ADB||"undefined"===r.get(ADB,"va.Heartbeat")},a=function(t){return r.isObject(t)&&!r.isEmpty(t)&&r.isFunction(t.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(t){var e,i=t._,n=function(t){return(t>0&&t<10?"0":"")+t.toString()},s={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};t.ComScoreAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:t("c2")||"3005086",ns_st_pu:t("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.RESOURCE_START]=this._onResourceStart.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),e[t.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){e()?this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."):this._setupEventCallbacks()},_createStreamingTag:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",t),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(t)},_getContentMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),a=(this.cviModel.getContentPlaybackState(),uvpjs.util),r=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),o=this.cviModel.getContentVideoState().isLive,l=parseInt(i.episodeNumber),d=parseInt(i.seasonNumber),u=(i.seriesTitle,i.videoTitle),c=u&&u.split("-")[1],h=!isNaN(l),p=!isNaN(d),g=null!==i.contextMetadata&&i.contextMetadata.comscore_c4,f=u;return h&&p&&(t=n(l),f+="--"+(e=n(d))+t),{ns_st_ci:a.getDefinedString(i.cmsRefGuid,i.mediaId,"0"),ns_st_cl:o?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[s.publisherBrand],ns_st_pr:a.getDefinedString(i.seriesTitle,i.videoTitle),ns_st_ep:c,ns_st_sn:p&&e||"*null",ns_st_en:h&&t||"*null",ns_st_ge:i.category||"*null",ns_st_ia:o?1:0,ns_st_ddt:"*null",ns_st_tdt:"*null",ns_st_st:r("c4")||"*null",ns_st_ce:i.episodeFlag?1:0,c3:r("c3")||this._playerName,c4:g||r("c4")||"*null",c6:r("c6")||f}},_onAdStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",t),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",t),this._isAd=!1,this._trackStop()},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",t);var e=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?e.Live:e.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",t),this._trackStop()},_onControlPlay:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",t),this.streamingTag?this._isAd?this._trackAdPlay():this._trackContentPlay():this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized")},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",t),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",t),this.streamingTag=null},_onLiveSegmentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",t),this._isLiveEvent(t)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=t.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",t),this._trackStop()},_onVideoProgress:function(t){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",t);var e=t.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(e===this._mc.PAUSED?this._onControlPause(t):e===this._mc.PLAYING&&this._onControlPlay(t))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=t.util.copyObjectWithKeyMap(s).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(t){return this.cviModel.getContentVideoState().isLive&&t.payload&&t.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof t.payload.liveSegmentData},_isSameLiveStation:function(t){return t.stationTitle===this._contentMetadata[s.stationTitle]},_getAdType:function(){var t,e=ns_.ReducedRequirementsStreamingAnalytics.AdType,i=this.cviModel.getAdVideoState().adClipID.split("_")[0];return t="pre"===i?e.LinearOnDemandPreRoll:"mid"===i?e.LinearOnDemandMidRoll:e.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(t=e.LinearLive),t}}),e=function(){return"undefined"==typeof ns_||i.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)}}(uvpjs.register("uvpjs")),function(t){"use strict";t.ConvivaAgent=uvpjs.Class.subClass({init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",t),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){if(void 0!==window.Conviva){var t=this.eventTypes,e=this.adEventHandlerMap={};e[t.AD_POD_START]=this.hPodStart.bind(this),e[t.AD_POD_END]=this.hPodEnd.bind(this),e[t.AD_LOADED]=this.hAdLoaded.bind(this),e[t.AD_START]=this.hAdStart.bind(this),e[t.AD_END]=this.hAdEnd.bind(this),e[t.AD_ERROR]=this.hAdError.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))}else this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded.")},_getAdType:function(t){var e="string"==typeof t?t.toLowerCase():null,i=Conviva.Client.AdPosition,n=uvpjs.ConvivaAgent.adPositions;return e?e.indexOf(n.PRE)>=0?i.PREROLL:e.indexOf(n.MID)>=0?i.MIDROLL:e.indexOf(n.POST)>=0?i.POSTROLL:void 0:i.PREROLL},_getArgsForStartAd:function(t){var e=Conviva.Client.AdStream,i=Conviva.Client.AdPlayer,n="ima"==t.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(t.adType),stream:n?e.SEPARATE:e.CONTENT,player:n?i.SEPARATE:i.CONTENT}},_onAdEvent:function(t){var e=t.type;this.startEvents.content=0,this.hasConvivaSession||e===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[e](t.payload,t)},hPodStart:function(t,e){this.podCount++,this._onContentPaused(e),this.currAdPodInfo=this._buildAdPodInfo(t.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);var i=this._getArgsForStartAd(t);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(i.key,i.stream,i.player,i.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",i),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(t,e){var i=this._buildAdInfo(t);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,i),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(t,e){this.adPodInProgress&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(t,e){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(t,e){var i=this.currAdPodInfo||{},n=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(n)||n===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",i),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(t,e){var i=t.errorInfo;this.hasConvivaAdSession?(this._sendError(i.message,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",i)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",i)},_onContentEvent:function(t){var e=!1;this.startEvents.ad=0,t.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),e=!0):t.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,e=!0,this.hasContentStarted=!0,this._killConvivaAdSession()),e&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(t){!this.isSeekPending&&this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",t),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*t.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(t){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",t),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(t){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",t),this._onContentPlaying(t),this.isSeekDone=!1)},_onVideoEvent:function(t){var e=this.eventTypes;switch(t.type){case e.VIDEO_STATE_CHANGE:var i=t.payload.newState,n=this._getMediaCapabilities();this.hasConvivaAdSession?i===n.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(t):i===n.PAUSED&&this._onAdPaused(t):this.hasConvivaSession&&(i===n.PLAYING?this._onContentPlaying(t):i===n.PAUSED?this._onContentPaused(t):i===n.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(t));break;case e.VIDEO_TRANSITION_COMPLETE:case e.VIDEO_DONE:this._onVideoTransition(t);break;case e.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(t){var e=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,i=new Conviva.ContentMetadata;i.defaultResource=this._validateStr(t.payload.cdn,""),this.convivaClient.updateContentMetadata(e,i)},_onError:function(t){var e=t.payload.errorInfo;e.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(e.message,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(e.message,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(t){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",t),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(t){var e=t.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(e>0&&(e*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",e),this.convivaPlayerStateManager.setBitrateKbps(e))},_createConvivaSession:function(){if(this.convivaClient){var t=this.cviModel,e=(this._getMediaCapabilities(),Conviva.PlayerStateManager.PlayerState,{userId:t.getSessionOption("userId"),userPPID:t.getSessionOption("userPPID"),userStatus:t.getSessionOption("userStatus")}),i=new Conviva.ContentMetadata;this._setContentMetadata(i,e),this.convivaSessionKey=this.convivaClient.createSession(i),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(t,e){var i=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",t,e),this.convivaClient&&this.convivaClient.sendCustomEvent(i,t,e)},_sendError:function(t,e,i){if(this.hasConvivaSession){var n="";!0===i?(n=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,t,e)):this.convivaPlayerStateManager.sendError(t,e),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+n+" ERROR: "+t)}},_setConvivaPlayerState:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",t),this.convivaPlayerStateManager.setPlayerState(t))},_setContentMetadata:function(t,e){var i=this.cviModel,n=Conviva.ContentMetadata.StreamType,s=i.contentVideoState,a=s.defaultBitrate;t.applicationName=this.playerName,t.assetName=this._validateStr(s.videoTitle,"N/A"),t.defaultBitrateKbps=a&&a>0?a:700,t.defaultResource=this._validateStr(s.cdn,""),t.duration=s.duration,t.streamType=s.isLive?n.LIVE:n.VOD,t.streamUrl=this._validateStr(s.assetURL,"N/A"),t.viewerId=this._validateStr(e.userId,"N/A"),t.custom={accessType:this._validateStr(e.userStatus,"anon"),contentId:this._validateStr(s.cmsRefGuid,"N/A"),contentType:s.isLive?"Live":"VOD",isEpisode:s.episodeFlag?"true":"false",Partner_ID:this._validateStr(i.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(s.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._validateStr(s.episodeTitle,s.videoTitle),appRegion:this._validateStr(i.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:s.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(s.drm),connectionType:this._validateStr(i.sessionOptions.userConnectionType,"unknown")}},_getWinDimension:function(){var t=this.cviModel.contentVideoState.sourceWidth,e=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(t=window.screen.width),window.screen.height&&(e=window.screen.height)),t+"x"+e},_createConvivaClient:function(){var t=this._getConvivaClientSettings();return t?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(t,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var t,e=this.moduleParams;return this._isValidStr(e.customerKey)&&this._isValidStr(e.serviceUrl)?((t=new Conviva.ClientSettings(e.customerKey)).heartbeatInterval=e.heartbeatInterval||this.defaultHeartbeatInterval,t.gatewayUrl=e.serviceUrl,t):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(t){var e="development"===uvpjs.Configuration.env,i=Conviva.SystemSettings.LogLevel;t.allowUncaughtExceptions=e,t.logLevel=e?i.WARNING:i.NONE},_createConvivaSystemFactory:function(){var t=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),e=new Conviva.SystemSettings;return this._setConvivaSystemProps(e),new Conviva.SystemFactory(t,e)},_buildAdPodInfo:function(t){var e,i,n,s={};uvpjs.ConvivaAgent.adPositions;return t?(void 0!==t.podDuration&&(s.podDuration=String(t.podDuration)),t.adPodId?(i=(e=t.adPodId.split("_")[0].toLowerCase()).charAt(0).toUpperCase()+e.slice(1),n=String(t.imaPodIndex+1),s.podPosition=i+"-roll",s.podIndex=this.podCount,s.absoluteIndex=n,s):s):null},_buildAdInfo:function(t){var e=new Conviva.ContentMetadata,i=t.adData,n=t.imaAdData,s=this.cviModel.getSessionOption("partner");if(!t)return null;e.adTitle="("+i.adVideoId+")"+i.adVideoTitle,e.assetName=e.adTitle,e.adClipId=this._validateStr(i.adClipID,"N/A"),e.Partner_ID=this._validateStr(s,"N/A"),e.adServerName=this._validateStr(i.adServerName,"N/A"),e.streamUrl=this._validateStr(i.adAssetUrl,"N/A"),e.duration=i.duration,e.streamType=Conviva.ContentMetadata.StreamType.VOD;var a=i.adType;return e.custom={"c3.ad.technology":"Client Side","c3.ad.id":n.adId,"c3.ad.system":n.adSystem,"c3.ad.position":a.charAt(0).toUpperCase()+a.substr(1)+"roll","c3.ad.mediaFileApiFramework":n.apiFramework,"c3.ad.sequence":n.adPodInfo.adPosition,"c3.ad.creativeId":n.creativeId,"c3.ad.advertiser":n.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",e),e},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_isDynamicStreaming:function(t){var e=t.split("?");return"mp4"===e[0].substr(e[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var t,e=this.cviModel.getModule(this.moduleName).params,i=e.length,n={};i--;)n[(t=e[i]).name]=t.value;this.moduleParams=n},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onAdEvent.bind(this),n=this._onContentEvent.bind(this),s=this._onVideoEvent.bind(this),a=this._onError.bind(this);e[t.AD_POD_START]=i,e[t.AD_LOADED]=i,e[t.AD_START]=i,e[t.AD_END]=i,e[t.AD_POD_END]=i,e[t.AD_ERROR]=i,e[t.CONTENT_DATA_LOADED]=n,e[t.CONTENT_START]=n,e[t.CONTENT_END]=n,e[t.VIDEO_STATE_CHANGE]=s,e[t.VIDEO_TRANSITION_COMPLETE]=s,e[t.VIDEO_DONE]=s,e[t.RESOURCE_END]=s,e[t.PLAYER_START_ERROR]=a,e[t.VIDEO_START_ERROR]=a,e[t.VIDEO_PLAYBACK_ERROR]=a,e[t.CDN_UPDATED]=this._onCdnUpdated.bind(this),e[t.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),t.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(t){"use strict";uvpjs.register("uvpjs").NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",t),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var t,e,i,n=this.cviModel,s=this._metadata,a=n.sessionOptions.partner,r=n.getModule(this._moduleName).params,o=r.length,l={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");o--;)""!==(t=r[o]).value&&(l[t.name]=t.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:l[this.NIELSEN_SFCODE_PARAM_NAME],apid:l[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:l[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},a){case"chow":e="us-700144",i="c06";break;case"tvcom":e="us-200330",i="c03";break;case"cbs":case"can":e="us-700144",i="c01";break;case"cbssports":case"cbssports_test":e="us-201669",i="c02";break;case"news":e="us-700144",i="c03";break;case"gamespot":e="us-200330",i="c13";break;case"cnettv":e="us-200330",i="c05";break;default:e="us-700144",i="c01"}s.ci=l.clientid||e,s.c6=l.vcid||i,s.iag_sid=l.iag_sid,s.iag_tfid=l.iag_tfid,s.channelName=l.channelName,s.segB=l.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",l,s)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){e()?this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams),this._setupEventCallbacks())},_notifySDK:function(t,e){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",t,e),this._gg.ggPM(t,e))},_onContentDataLoaded:function(t){var e,i,n,s,a,r,o,l,d=uvpjs.mediaCapabilities.isMobile(),u=this._metadata;t.payload&&(n=(e=t.payload.vidState).chapterStartTimes.length>0?"lf":"sf",a=e.episodeNumber,r=e.seasonNumber,o=e.seriesTitle,l=e.videoTitle,i=e.duration,s=[l,r,a,n].join("|"),""===r&&(r="0"),""===a&&(a="0"),e.isAffiliateFeed&&(u.tv="true"),(e.isLive||-1===i)&&(i=this.NIELSEN_LIVE_VIDEO_DURATION),u.pc=u.ci+u.c6+u.cmsRefGuid,u.c10="plt,"+(d?"MBL":"DSK"),u.sd=i,u.dur=i,u.cg=o,u.tl=s,u.videotype="content",u.guid=e.cmsRefGuid,u.seriestitle=o,u.episodetitle=l,u.isfullepisode=e.episodeFlag?"y":"n",u.crossId1=e.mediaId,u.iag_pgm=l,u.iag_epi=s,u.iag_pd=location.hostname,u.iag_fp=n,u.iag_cte="na",u.iag_oad="na",u.iag_seg=1,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",u))},_onAdStart:function(t){var e,i,n,s,a,r,o,l,d,u,c=this.cviModel.getContentVideoState(),h=t.payload;h&&(this._metadata.hasAds=1,this._adDisplayed=!0,u=uvpjs._.clone(this._metadata),s=(i=(e=h.adData).adClipID.split("_"))[0],l=this.cviModel.getNumberOfAdPods(),d="post"===s?l:++i[1],n=["dav0",c.videoTitle,c.seasonNumber,c.episodeNumber].join("-"),o=[l,d,this._numAdsInPod,i[2]].join("_"),a=e.adVatId,r=e.adVideoUrl,""!==a&&(r+="|"+a),u.videotype=s+"roll",u.iag_cte=r,u.iag_pod=o,u.iag_apt="na",u.tl=n,u.c3="st,a","pre"===s&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",u),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,u))},_onAdPodStart:function(t){var e=t.payload;e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",e.adPod.adCount),this._numAdsInPod=e.adPod.adCount)},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(t){var e,i=t.payload;this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),i&&(this._metadata.iag_seg&&this._metadata.iag_seg++,(e=t.payload.contentData).duration>0&&Math.abs(e.duration-this._lastContentSecond)<=5?this._notifySDK(this.events.END,this._lastContentSecond):this._notifySDK(this.events.STOP,this._lastContentSecond))},_onControlPlay:function(t){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(t){var e,i=t.payload;if(i&&!((e=Math.floor(i.currentTime))<0)){if(i.isAd){if(this._lastAdSecond===e)return;this._lastAdSecond=e}else{if(this._lastContentSecond===e)return;this._lastContentSecond=e}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,e)}},_onVideoCuepoint:function(t){var e=t.payload,i=e.data;e.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&i&&"string"==typeof i&&this._notifySDK(this.events.SEND_ID3,i)},_hasAds:function(){var t=this.cviModel.getNumberOfAdPods();return-1===t?2:0===t?0:1},_isDisabled:function(){var t=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===t||!0===t}});var e=function(){return void 0===window.NOLCMB}}(),function(t){var e,i,n,s=t._;t.DWAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),t.componentid=this.trackingMgr.componentid,t.device=this._getDevice(),t.mapp=this._playerName,t.part=this.cviModel.getSessionOption("partner"),t.playertime=0,t.siteid=this.trackingMgr.DEFAULT_SITEID,t.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var t=this.cviModel,e=t.getSessionOption("cms"),i=t.getContentVideoState(),n=t.getCurrentPlaybackState(),s=uvpjs.mediaCapabilities,a=this._tags.content,r=this._tags.ad,o=this.trackingMgr;r.adastid=e===o.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(a.medastid)||0===a.medastid||"0"===a.medastid)&&(i.isLive?i.isAffiliateFeed?a.medastid="cbsnews"===t.getSessionOption("playerId")?"601":"600":n.isHDStreamLive||s.isChromecast()?a.medastid="601":a.medastid="0":a.medastid=e===o.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",a.medastid,r.adastid))},_loadConfigParams:function(){for(var t,e,i,n=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),a=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],r=a.length;r--;)e=a[r],t=this._getTagType(e),i=n(e),s.isUndefined(t)||s.isEmpty(i)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",e,i),this._tags[t][e]=i);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var t,e,i,n=window.DW&&window.DW.pageParams||{};for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams"),n)n.hasOwnProperty(t)&&(i=n[t],s.isEmpty(i)||(this._pageParams[t]=i,e=this._getTagType(t),s.isUndefined(e)||(this._tags[e][t]=i)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_BLOCKED]=this._onAdBlocked.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.AD_ERROR]=this._onAdError.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.USER_GESTURE]=this._onUserGesture.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var t=this.trackingMgr.progressEvents,e={};e[t.FIRST_QUARTILE]=this._onProgressEvent.bind(this,t.FIRST_QUARTILE),e[t.MID_QUARTILE]=this._onProgressEvent.bind(this,t.MID_QUARTILE),e[t.THIRD_QUARTILE]=this._onProgressEvent.bind(this,t.THIRD_QUARTILE),e[t.TIMED]=this._onProgressEvent.bind(this,t.TIMED),this.trackingMgr.registerProgressEvents(e)},_sendDWEvent:function(t){var e=this._tags.content,s=e.event,a=s===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),e.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:n(this._gestval),s!==this.events.INIT&&(e.playertime=this._getPlayerTime()),e.ts=+new Date,a+=i(e),t&&(a+="&"+i(this._tags.ad)),this.trackingMgr.fireTrackingPixel(a),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",a),this._gestval={},e.gestval="",e.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var t=window.location,e=uvpjs.mediaCapabilities,i=e.isMobile()?"mobile%20web":"desktop%20web",n=this.cviModel.getSessionOption("userStatus"),a=this.cviModel.getSessionOption("userId"),r=this._tags.content,o=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,r.event=this.events.INIT,r.mso=this.trackingMgr.mso,r.pageurl=t.href,r.srchost=t.host,r.ursuid=a,r.v16=o.viewguid,r.v17=o.topic,r.v18=o.topicbrcrm,r.v19=o.pagetype,r.v20=o.assetguid,r.v21=e.isChromecast()?"chromecast":i,r.v23=o.rsid,r.v25=s.isEmpty(n)?"anon":n,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(t){var e=this.trackingMgr.progressEvents,i=this._tags.content,n=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",t),t)switch(t){case e.FIRST_QUARTILE:n.pct=25;break;case e.MID_QUARTILE:n.pct=50;break;case e.THIRD_QUARTILE:n.pct=75}i.event=this.events.PLAY,this._sendDWEvent(),delete n.pct}},_onAdBlocked:function(t){this._tags.ad;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(t){var e=this._tags.ad,i=t.payload.adData,n=i.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),e.adid=s.isEmpty(i.adVideoId)?"999":i.adVideoId,e.adnum=this.cviModel.adNum,e.adtime=0,e.adtitle=i.adVideoTitle,e.adtype=i.isLinear?1:2,e.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),e.adbreak="",e.adpos=n[0],e.adpod=n[1],e.adpodpos=n[2],this._sendDWEvent(!0)},_onAdQuartile:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",t),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(t){var e=t.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",t),this._tags.content.event=this.events.END,this._tags.ad.adtime=e.duration,this._sendDWEvent(!0)},_onAdError:function(t){var e=t.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",t),e===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(t){var e=this.cviModel,i=e.getContentVideoState(),n=this._tags.content,a=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",t),n.event=this.events.START,n.codec=i.fileType,n.distntwrk=e.getSessionOption("netwk"),n.playersz=this._getPlayerSize(),n.sdlvrytype=this._getStreamType(),n.v22=i.cmsRefGuid,n.medid=i.mediaId,n.medlength=this.trackingMgr.getContentLength()/1e3,n.mednum=e.medNum,n.medrls=i.pid,n.medtitle=i.videoTitle,n.contsessid=i.previousSessionId,s.isEmpty(i.contPlayState)||(a.autoplay=i.contPlayState),a.paywall=i.isPaidContent?"1":"0",a.caption_available=i.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",t),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(t),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(t.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),t.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(t){var e=t&&t.payload,i=e&&e.seekFromTime,n=e&&e.seekToTime,s=n-i,a=this._tags.content;a.eventdur=Math.floor(Math.abs(s)),a.event=s>0?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:i,seekToTime:n,seekDuration:s,event:a.event,eventdur:a.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(t){var e,i,n,a,r,o,l=this._tags.content,d=this._gestval,u=t.payload.gestureInfo,c=this.cviModel.contentVideoState,h=c.elapsedTime,p="",g=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",t),"string"!=typeof u||-1!==u.indexOf("event=")){if(s.isArray(u)){if(u.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");p=u[0]}if(c=this.cviModel.contentVideoState,"string"==typeof u)r=(a=/event=([^&]*)(?:&gestval=(.*))?/.exec(u))[1],o=a[2],l.event=r,l.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===o?"":o;else if(p===g.GLOBAL_RESUME||p===g.LOCAL_RESUME)d.prevcomponentid=c.previousSessionId,d.eventdur=h>0?Math.round(h/1e3):0,d.paywall=c.isPaidContent?"1":"0",l.event=this.events.RESUME,l.medtime=c.resumeContentTime;else if(p===g.CONT_CANCEL)d.action=this.events.PROMPT;else switch(l.medtime=this.cviModel.contentPlaybackState.currentTime,p){case g.RELATED_OVERLAY:l.event=g.RELATED_OVERLAY;break;case g.RELATED_CLICK_GESTURE:u.length>=2&&(d.related_pid=u[1]),l.event=g.RELATED_CLICK_GESTURE;break;case g.SHARE_OVERLAY:l.event=g.SHARE_OVERLAY;break;case g.SHARE_NETWORK_GESTURE:u.length>=2&&(d.network=u[1]),l.event=g.SHARE_NETWORK_GESTURE;break;case g.SEND_GESTURE:u.length>=2&&(i=(e=u[1].split(",")).shift(),n=e.join(","),d.sender=i,d.recipient=n),l.event=g.SEND_GESTURE;break;case g.EMBED_GESTURE:l.event=g.EMBED_GESTURE;break;case g.LINK_GESTURE:l.event=g.LINK_GESTURE;break;case g.REPLAY_GESTURE:l.event=g.REPLAY_GESTURE;break;case g.END_CARD_OVERLAY:l.event=g.END_CARD_OVERLAY;break;case g.ERROR_OVERLAY:l.event=g.ERROR_OVERLAY;break;case g.RECOMMEND_NOW:u.length>=3?(d.mediaid=u[1],d.pid=u[2]):(d.mediaid="",d.pid=""),l.event=g.RECOMMEND_NOW;break;case g.RECOMMEND_NEXT:u.length>=3?(d.mediaid=u[1],d.pid=u[2]):(d.mediaid="",d.pid=""),l.event=g.RECOMMEND_NEXT;break;case g.RECOMMEND_CLOSE:l.event=g.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",p)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",l),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",d)),this._sendDWEvent()}else uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.")},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(t){return s.has(this._tags.ad,t)?"ad":s.has(this._tags.content,t)?"content":void 0},_getStreamType:function(){var t=this.cviModel.getContentVideoState(),e=uvpjs.mediaCapabilities,i=t.deliveryType,n=t.isLive;return i===e.STREAMING?n?5:4:i===e.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var t=this._agentStartTime,e=s.isDate(t)&&parseInt((new Date-t)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",e),e},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var t=uvpjs.mediaCapabilities,e=window.screen,i={type:(t.getDevice()||"").toLowerCase(),os:(t.getOS()||"").toLowerCase(),ver:t.getOSVersion(),screensz:[e.width,e.height].join("x")};return n(i)},_getPlayerSize:function(){var t=this.cviModel.getContentVideoState();return[t.sourceWidth,t.sourceHeight].join("x")}}),e=function(t,e,i){var n,a,r=[];for(n in t)t.hasOwnProperty(n)&&(a=s.isUndefined(t[n])?"":encodeURIComponent(t[n]),r.push([n,a].join(e)));return r.join(i)},i=function(t){return e(t,"=","&")},n=function(t){return e(t,":",";")}}(uvpjs.register("uvpjs")),function(t){var e;t._,t.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){var t={};this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),e()?this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."):(t.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,t.streamHeadPosition=this.getStreamHeadPosition.bind(this),t.streamLength=this.getStreamLength.bind(this),t.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(t),this._setupEventCallbacks())},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var t=this.cviModel.adVideoState,e={};e.adTitle=t.adVideoTitle,e.adDuration=t.duration,e.id=t.adVideoId,e.adPartnerId=this.cviModel.sessionOptions.partner,e.adServer=t.adServerName,this.akamaiPlugin.handleAdLoaded(e)},setContentMetaData:function(){var t=this.cviModel,e=t.sessionOptions,i=this.akamaiPlugin,n=t.getContentVideoState(),s=t.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),i.setData("viewerId",t.getModuleParam(this._moduleName,"viewerID")),i.setData("partnerId",e.partner),i.setData("playerId",this.trackingMgr.getPlayerName("|")),i.setData("Host",e.host),i.setData("Referrer",e.referrer),i.setData("title",n.title),i.setData("category",n.category),i.setData("subCategory",n.sourceOwner),i.setData("show",n.title),i.setData("contentLength",1e3*s.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",t),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",t.payload),this.akamaiPlugin&&t.payload)switch(t.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",t),this.akamaiPlugin){var e=t.payload.newState;e!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),e===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",t),this.akamaiPlugin){this.akamaiPlugin.handlePlayEnd("Play.End.Detected")}},_onQosMetadata:function(t){var e,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",t),this.akamaiPlugin&&-1!==t.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI))for(e in i=t.payload.paramsObj)this.akamaiPlugin.setData(e,i[e])}}),e=function(){return"undefined"==typeof AkaHTML5MediaAnalytics}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(t){this.cviModel=t.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",t),this.trackingMgr=t.trackingMgr,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.playerVersion=t.playerVersion,this.useDefaultProperty=t.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var t=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!t&&!0===t[uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){console.log("[MUX] _initializePlugin"),void 0!==window.mux?this.cviModel&&this._setupEventCallbacks():this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded.")},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var t=this.cviModel,i=this.moduleParams,n=e.assign({page_type:"",viewer_user_id:t.getSessionOption("userId"),experiment_name:i&&!uvpjs.util.isEmpty(i.experimentName)?i.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(i.subPropertyId)?t.getSessionOption("partner"):i.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:t.initTime},this._getMuxVideoData());return this.useDefaultProperty?n.property_key=this.MUX_DEFAULT_PROPERTY_KEY:n.property_key=i.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:n}),this.videoElement.mux},_getMuxVideoData:function(){var t=this.cviModel.contentVideoState;return{video_id:this._validateStr(t.cmsRefGuid,""),video_title:this._validateStr(t.videoTitle,""),video_series:this._validateStr(t.seriesTitle,""),video_producer:"",video_content_type:t.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:t.duration,video_stream_type:t.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(t.cdn,""),video_source_url:this._validateStr(t.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_onContentEvent:function(t){t.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(t){if(this.muxMonitor)switch(t.payload.facadeType){case this.mc.HLSJS:break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:t.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(t){var e=t.payload.errorInfo;e&&e.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:e.errorCode,player_error_message:e.message}))},_gatherModuleParams:function(t){var e,i=this.cviModel.getModule(t).params,n={};if(!i)return null;for(var s=i.length;s--;)n[(e=i[s]).name]=e.value;return n},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onContentEvent.bind(this),n=this._onPlaybackLibraryLoaded.bind(this),s=this._onError.bind(this),a=this._onAdEvent.bind(this);e[t.CONTENT_DATA_LOADED]=i,e[t.PLAYBACK_LIBRARY_LOADED]=n,e[t.PLAYER_START_ERROR]=s,e[t.VIDEO_START_ERROR]=s,e[t.VIDEO_PLAYBACK_ERROR]=s,e[t.AD_ERROR]=s,e[t.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=a,e[t.AD_PLUGIN_CONTENT_RESUME_REQUEST]=a,e[t.AD_LOADED]=a,e[t.AD_START]=a,e[t.VIDEO_STATE_CHANGE]=a,e[t.AD_SKIPPED]=a,e[t.AD_END]=a,e[t.AD_ERROR]=a,e[t.AD_REQUEST]=a,e[t.AD_RESPONSE]=a,e[t.AD_QUARTILE]=a,this.trackingMgr.registerEventCallbacks(e)},_getMuxAdData:function(t){var e=t.payload.adData?t.payload.adData.adAssetUrl:t.payload.adAssetUrl;return{ad_tag_url:t.payload.adCallUrl,ad_asset_url:e}},_dispatchMuxAdEvent:function(t,e){t&&(e||(e={ad_tag_url:"",ad_asset_url:""}),e.ad_tag_url||(e.ad_tag_url=""),e.ad_asset_url||(e.ad_asset_url=""),window.mux.emit(this.videoElement,t,e))},_dispatchMuxEvent:function(t){window.mux.emit(this.videoElement,t)},_onAdEvent:function(t){var e=this.eventTypes,i=this.MUX_AD_EVENTS,n=this.MUX_EVENTS;switch(t.type){case e.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(n.PAUSE),this._dispatchMuxAdEvent(i.AD_BREAK_START);break;case e.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(i.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(n.PLAY),this._dispatchMuxEvent(n.PLAYING));break;case e.AD_LOADED:this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t));break;case e.AD_START:this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t));break;case e.VIDEO_STATE_CHANGE:if(!t.payload.isAd)return;var s=t.payload.newState,a=t.payload.currentState;s===this.mc.PAUSED?this._dispatchMuxAdEvent(i.AD_PAUSE,this._getMuxAdData(t)):a==this.mc.PAUSED&&s===this.mc.PLAYING&&(this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t)),this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t)));break;case e.AD_SKIPPED:case e.AD_END:this._dispatchMuxAdEvent(i.AD_ENDED,this._getMuxAdData(t));break;case e.AD_ERROR:this._dispatchMuxAdEvent(i.AD_ERROR,this._getMuxAdData(t));break;case e.AD_REQUEST:this._dispatchMuxAdEvent(i.AD_REQUEST,this._getMuxAdData(t));break;case e.AD_RESPONSE:this._dispatchMuxAdEvent(i.AD_RESPONSE,this._getMuxAdData(t));break;case e.AD_QUARTILE:switch(t.payload.percent){case 25:this._dispatchMuxAdEvent(i.AD_FIRST_QUARTILE,this._getMuxAdData(t));break;case 50:this._dispatchMuxAdEvent(i.AD_MIDPOINT,this._getMuxAdData(t));break;case 75:this._dispatchMuxAdEvent(i.AD_THIRD_QUARTILE,this._getMuxAdData(t))}}}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"production"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isPaused:!1,isBuffering:!1,init:function(t){this.options=t,this.ozTamVo=new uvpjs.OzTamVo(this);var e=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(e.publisherId,e.vendorVersion,e.productionMode,e.verboseLogging,e.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",e,this.ozTamService)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e=this.onVideoEvent.bind(this),i={};i[t.RESOURCE_START]=e,i[t.CONTENT_START]=e,i[t.CONTROL_SEEK]=e,i[t.SEEK_DONE]=e,i[t.CONTENT_END]=e,i[t.VIDEO_STATE_CHANGE]=e,this.options.trackingMgr.registerEventCallbacks(i)},onVideoEvent:function(t){var e=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out");else switch(t.type){case e.RESOURCE_START:this.onResourceStart(t);break;case e.CONTENT_START:this.onContentStart(t);break;case e.CONTROL_SEEK:this.onSeekStart(t);break;case e.SEEK_DONE:this.onSeekDone(t);break;case e.CONTENT_END:this.onContentEnd(t);break;case e.VIDEO_STATE_CHANGE:this.onVideoStateChange(t)}},onResourceStart:function(t){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(t){this.ozTamService.seekBegin()},onSeekDone:function(t){this.ozTamService.seekComplete()},onContentEnd:function(t){this.ozTamService.complete()},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.ozTamService.haltProgress());break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.ozTamService.haltProgress());break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.ozTamService.resumeProgress()),this.isBuffering&&(this.isBuffering=!1,this.ozTamService.resumeProgress())}},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}}),uvpjs.register("uvpjs").SegmentAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"production"!==uvpjs.Configuration.env,options:null,segmentVo:null,hasSegmentSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(t){this.options=t,this.initTime=new Date,this.segmentVo=new uvpjs.SegmentVo(this),this.segmentEvent=this.segmentVo.Event,window.analytics&&"function"==typeof window.analytics.load&&(analytics.load(this.segmentVo.getApiKey()),this.hasSegmentSdk="function"==typeof analytics.track),this.debug&&uvpjs.log(this.DEBUG_ID,"Segment Sdk",this.hasSegmentSdk)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e={};e[t.RESOURCE_START]=this.onResourceStart.bind(this),e[t.CONTENT_START]=this.onContentStart.bind(this),e[t.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),e[t.CONTROL_SEEK]=this.onSeekStart.bind(this),e[t.SEEK_DONE]=this.onSeekDone.bind(this),e[t.CONTENT_END]=this.onContentEnd.bind(this),e[t.RESOURCE_END]=this.onResourceEnd.bind(this),e[t.CONTEXT_METADATA]=this.onContextMetadata.bind(this),e[t.AD_POD_START]=this.onAdPodStart.bind(this),e[t.AD_POD_END]=this.onAdPodEnd.bind(this),e[t.AD_START]=this.onAdStart.bind(this),e[t.AD_CLICK]=this.onAdClick.bind(this),e[t.AD_END]=this.onAdEnd.bind(this),e[t.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),e[t.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),this.options.trackingMgr.registerEventCallbacks(e),(e={})[(t=this.options.trackingMgr.progressEvents).FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.FIRST_QUARTILE),e[t.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.MID_QUARTILE),e[t.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(e)},onResourceStart:function(t){this.hasResourceStart||(this.sendTrackEvent(this.segmentEvent.SESSION_START,this.segmentVo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(t){this.hasContentStart=!0,this.trackContentStartEvent=!0},onQuartileProgress:function(t){this.sendTrackEvent(t,this.segmentVo.getQuartileInfo())},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.segmentEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.segmentEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.segmentEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.segmentEvent.BUFFER_COMPLETE))}},onSeekStart:function(t){this.sendTrackEvent(this.segmentEvent.SEEK_START,this.segmentVo.getSeekInfo())},onSeekDone:function(t){this.sendTrackEvent(this.segmentEvent.SEEK_COMPLETE,this.segmentVo.getSeekInfo())},onContentEnd:function(t){this.sendTrackEvent(this.segmentEvent.CONTENT_COMPLETE)},onResourceEnd:function(t){this.hasContentStart&&(this.sendTrackEvent(this.segmentEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata},onAdPodStart:function(t){this.sendTrackEvent(this.segmentEvent.AD_BREAK_START,this.segmentVo.getAdBreakInfo())},onAdPodEnd:function(t){this.sendTrackEvent(this.segmentEvent.AD_BREAK_COMPLETE)},onAdStart:function(t){this.sendTrackEvent(this.segmentEvent.AD_START,this.segmentVo.getAdItemInfo())},onAdClick:function(t){this.sendTrackEvent(this.segmentEvent.AD_CLICK)},onAdEnd:function(t){this.sendTrackEvent(this.segmentEvent.AD_COMPLETE)},onVideoTransition:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Segment bitrate",t.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(t){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.segmentEvent.QOS,this.segmentVo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.sendTrackEvent(this.segmentEvent.CONTENT_START,this.segmentVo.getContentStartInfo()))},sendTrackEvent:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"Segment Track",t,e||{}),this.hasSegmentSdk&&analytics.track(t,e||{})},destroy:function(){this.segmentVo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.segmentVo=null,this.contextMetadata=null}}),uvpjs.register("uvpjs").OzTamVo=uvpjs.Class.subClass({agent:null,init:function(t){this.agent=t;var e=this.agent.options;this.getModuleParam=e.cviModel.getModuleParam.bind(e.cviModel,e.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.agent.options.playerVersion,productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:top.location.href.search(/^https/)>-1}},getMediaInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration;return{mediaId:e.ozTamMediaId||e.cmsRefGuid||e.mediaId,url:e.assetURL,mediaDuration:e.isLive?-1:isNaN(i)?0:i,mediaType:e.isLive?"live":"vod",mediaPositionFunction:function(){return t.getCurrentPlaybackState().currentTime}}},getPropertyDictionary:function(){var t=this.agent.options.cviModel.getContentVideoState(),e=this.agent.ozTamService,i={};return t.ozTamMediaId&&(i[e.PROP_ALT_MEDIA_ID]=t.cmsRefGuid||t.mediaId),i},isOzTamOptOut:function(){var t=this.agent.options.cviModel.getContentVideoState();return t.hasOwnProperty("ozTamOptOut")&&t.ozTamOptOut},getValue:function(t){return t.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}}),uvpjs.register("uvpjs").SegmentVo=uvpjs.Class.subClass({Event:{SESSION_START:"Video Playback Started",CONTENT_START:"Video Content Start",CONTENT_COMPLETE:"Video Content Completed",PAUSE:"Video Playback Paused",STOP:"Video Playback Interrupted",BUFFER_START:"Video Playback Buffer Started",BUFFER_COMPLETE:"Video Playback Buffer Completed",SEEK_START:"Video Playback Seek Started",SEEK_COMPLETE:"Video Playback Seek Completed",PLAY_RESUME:"Video Playback Resumed",SESSION_END:"Video Playback Completed",AD_BREAK_START:"Video Ad Break Started",AD_BREAK_COMPLETE:"Video Ad Break Completed",AD_START:"Video Ad Started",AD_COMPLETE:"Video Ad Completed",AD_CLICK:"Video Ad Clicked",QOS:"Video Quality Updated",FIRST_QUARTILE:"Video Playback First Quartile",MID_QUARTILE:"Video Playback Mid Quartile",THIRD_QUARTILE:"Video Playback Third Quartile"},agent:null,channelName:null,apiKey:null,init:function(t){this.agent=t;var e=this.agent.options;this.getModuleParam=e.cviModel.getModuleParam.bind(e.cviModel,e.trackingMgr.SEGMENT_MODULE_NAME),this.apiKey=this.getModuleParam("apiKey"),this.channelName=this.getModuleParam("channelName")},getApiKey:function(){return this.apiKey},getSessionStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,n=t.contentPlaybackState.facadeState,s=e.isLive?-1:isNaN(i)?0:i;return{adAssetId:t.adVideoState.adClipID,adPodId:t.adVideoState.adVideoId||t.adVideoState.adVatId,adType:t.adVideoState.adType,allowConcurrentPlayback:t.sessionOptions.allowConcurrentPlayback,bitrate:n.currentBitrate,channel:this.channelName,cdn:e.cdn,cms:t.sessionOptions.cms,contentAssetId:e.cmsRefGuid||e.mediaId,currentIndex:1,"drm.dash.playreadyURL":e.drm.dash.playreadyURL,"drm.dash.widevineURL":e.drm.dash.widevineURL,"drm.enabled":e.drm.enabled,"drm.fairplay.appCertURL":e.drm.fairplay.appCertURL,"drm.ticket":e.drm.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(e.drm),enableMutedAutoplay:t.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:t.sessionOptions.enableNativeMobileAutoplay,enableReplay:t.sessionOptions.enableReplay,enableUnmutedAutoplay:t.sessionOptions.enableUnmutedAutoplay,framerate:n.playbackFramerate,fullScreen:t.isFullscreen,isAutoplay:t.isAutoplay,isMultiCDN:t.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:t.isMuteAtPlayStart,isMuted:e.isMuted,isSslRequired:window.location.href.search(/^https/)>-1,length:s,livestream:e.isLive,liveSyncDurationCount:t.sessionOptions.liveSyncDurationCount,maxBitrate:t.maxBitrate,method:"",minBitrate:t.minBitrate,pageProvidesTealium:t.sessionOptions.usesTealium,pagetype:t.dwPageParams.pagetype,partner:t.sessionOptions.partner,pguid:t.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sessionId:t.sessionId,sound:t.volume,startTime:e.startTime,streamType:e.isLive?"Live":"VOD",title:e.videoTitle,totalLength:s,usesIMA:t.sessionOptions.usesIMA,userConnectionType:t.sessionOptions.userConnectionType,userCountry:t.sessionOptions.userCountry,userIsp:t.sessionOptions.userISP,userPpid:t.sessionOptions.userPPID,userStatus:t.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName,viewguid:t.dwPageParams.viewguid}},getContentStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,n=t.contentPlaybackState.facadeState,s=e.isLive?-1:isNaN(i)?0:i;return{assetUrl:e.assetURL,assetId:e.cmsRefGuid||e.mediaId,contentAssetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,chapterStartTimes:e.chapterStartTimes.join(","),closedCaptionPath:e.closedCaptionPath,cms:t.sessionOptions.cms,cmsRefGuid:e.cmsRefGuid,contextMetadata:this.agent.contextMetadata,dfpMediaId:e.dfpMediaId,duration:s,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,excludeNielsenTracking:e.excludeNielsenTracking,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,is360:e.is360,isAffiliateFeed:e.isAffiliateFeed,isEmbedable:e.isEmbedable,isPaidContent:e.isPaidContent,mediaId:e.mediaId,overrideAssetURL:e.overrideAssetURL,program:e.videoTitle.split("-")[0],pguid:t.dwPageParams.pguid,playbackBitrate:n.currentBitrate,playheadTime:this.getPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:s}},getContentCompleteInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,n=t.contentPlaybackState.facadeState;return{contentAssetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,mediaId:e.mediaId,playbackBitrate:n.currentBitrate,playheadTime:this.getPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:e.isLive?-1:isNaN(i)?0:i}},getQuartileInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState();return{contentAssetId:e.cmsRefGuid||e.mediaId,playheadTime:this.getPlayhead(),playerTime:this.getPlayerElapsedTime(),sessionId:t.sessionId}},getQosInfo:function(){var t=this.agent.options.cviModel,e=t.contentPlaybackState,i=t.contentPlaybackState.facadeState;return{averageDroppedFPS:e.averageDroppedFPS,bufferLength:e.bufferLength,currentContentSegment:e.currentContentSegment,currentMaxBandwidth:e.currentMaxBandwidth,currentTime:e.currentTime,currentBitrate:i.currentBitrate,droppedFPS:i.droppedFPS,droppedFrames:i.droppedFrames,playbackFramerate:i.playbackFramerate}},getAdBreakInfo:function(){var t=this.agent.options.cviModel,e=t.adVideoState,i=e.adClipID.split("_"),n=1;return"post"===e.adType?n=t.getNumberOfAdPods():"mid"===e.adType&&(n=parseInt(i[1])+1),{indexPosition:n,startTime:this.getPlayhead(),title:e.adVideoTitle}},getAdItemInfo:function(){var t=this.agent.options.cviModel.adVideoState;return{adCallUrl:t.assetURL||t.adAssetUrl||t.adVideoUrl,adParams:t.adParameters,assetId:t.adVideoId||t.adVatId,indexPosition:t.adPosition,isCustomClickTrackingUsed:t.isCustomClickTrackingUsed,title:t.adVideoTitle,totalLength:t.duration}},getSeekInfo:function(){return{seekPosition:this.getPlayhead()}},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}}),function(t){var e={prodUrl:"//sparrow.cbs.com",stageUrl:"//stage-sparrow.cbs.com",path:"/streamer/v1.0/ingest/beacon.json"},i=!1,n=null,s=null,a=function(t){return(t=t.replace(/\s/g,"")).search(/^\/\//)>-1?t:"//"+t};t.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(t){return s=e,t&&t.prodUrl&&t.stageUrl&&(s.prodUrl=a(t.prodUrl),s.stageUrl=a(t.stageUrl)),this},queryParams:function(e){return n=t.util.queryStrFromObj(e,!1),this},devMode:function(t){return i=t,this},buildUrl:function(){return null===s?"Unable to build url.":(i?s.stageUrl:s.prodUrl)+s.path+(null===n?"":"?"+n)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=t.drm,this.videoTagRef=t.videoTagRef,this.eventTypes=t.eventTypes,this.errorCallback=t.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var t=this.getLicenseServerUrl(this.initData),e=this.getId(t);if(this.drmVendor=this.getDRMVendor(t),e){if(!this.videoTagRef.webkitKeys){var i=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(i,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(i))}if(this.videoTagRef.webkitKeys){var n=this.concatInitDataIdAndCertificate(this.initData,e,this.appCertData),s=this.videoTagRef.webkitKeys.createSession("video/mp4",n);s?(s.contentId=e,s.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,t),!1),s.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),s.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)):this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null)}else this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null)}else this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null)},loadAppCert:function(){e.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",t),this.appCertData=new Uint8Array(t.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(t){this.webKitNeedKeyCalled=!0,this.initData=t.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(t,e,i){"string"==typeof e&&(e=this.stringToArray(e));var n=0,s=new ArrayBuffer(t.byteLength+4+e.byteLength+4+i.byteLength),a=new DataView(s);new Uint8Array(s,n,t.byteLength).set(t),n+=t.byteLength,a.setUint32(n,e.byteLength,!0),n+=4;var r=new Uint8Array(s,n,e.byteLength);return r.set(e),n+=r.byteLength,a.setUint32(n,i.byteLength,!0),n+=4,new Uint8Array(s,n,i.byteLength).set(i),new Uint8Array(s,0,s.byteLength)},onLicenseRequestReady:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+t,e);var i=new XMLHttpRequest;i.session=e.target,i.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),i.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),i.open("POST",t,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?i.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(i.responseType="text");var n="spc="+encodeURIComponent(this.base64EncodeUint8Array(e.message))+"&"+i.session.contentId;(i=this.setRequestHeaders(i)).send(n)},onLicenseRequestLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",t);var i=t.target,n=i.session,s=null;e.inRange(i.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,t),this.drmVendor===this.DRM_VENDORS.DRMTODAY?s=this.base64DecodeUint8Array(i.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(s=new Uint8Array(i.response)),n.update(s)},onError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t,e),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,t)},onKeyAdded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",t)},getLicenseServerUrl:function(t){var i=null;e.isEmpty(this.drm.fairplay.licenseURL)?i="https://"+String.fromCharCode.apply(null,new Uint16Array(t.buffer)).split("://")[1]:i=this.drm.fairplay.licenseURL;return this.appendDRMQueryParams(i)},appendDRMQueryParams:function(t){var e=-1===t.indexOf("?")?"?":"&";return this.drm.sessionId&&(t+=e+"SessionId="+this.drm.sessionId),this.drm.ticket&&(t+="&Ticket="+this.drm.ticket),t},getDRMVendor:function(t){var e=null;return-1!==t.indexOf(this.DRM_VENDORS.DRMTODAY)?e=this.DRM_VENDORS.DRMTODAY:-1!==t.indexOf(this.DRM_VENDORS.IRDETO)&&(e=this.DRM_VENDORS.IRDETO),e},setRequestHeaders:function(t){if(t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!e.isEmpty(this.drm.fairplay.header)){var i=this.drm.fairplay.header;for(var n in i){var s=encodeURIComponent(i[n]);t.setRequestHeader(n,s)}}return t},getId:function(t){var e=uvpjs.util.objFromQueryStr(t);return e.ContentId||e.contentId||e.assetId||null},base64EncodeUint8Array:function(t){var e=String.fromCharCode.apply(null,t);return btoa(e)},base64DecodeUint8Array:function(t){var e=window.atob(t),n=e.length,s=new Uint8Array(new ArrayBuffer(n));for(i=0;i<n;i++)s[i]=e.charCodeAt(i);return s},stringToArray:function(t){for(var e=new ArrayBuffer(2*t.length),i=new Uint16Array(e),n=0,s=t.length;n<s;n++)i[n]=t.charCodeAt(n);return i}})}(uvpjs.register("uvpjs"))}(),define("libs/cbsi-player/uvpjs-2.9.52",function(){}),function(t){if(!t.fn.dotdotdot){t.fn.dotdotdot=function(i){if(0==this.length)return i&&!1===i.debug||function(t,e){if(!t)return!1;e="string"==typeof e?"dotdotdot: "+e:["dotdotdot:",e];void 0!==window.console&&void 0!==window.console.log&&window.console.log(e)}(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(i)});var n=this;n.data("dotdotdot")&&n.trigger("destroy.dot"),n.data("dotdotdot-style",n.attr("style")),n.css("word-wrap","break-word"),"nowrap"===n.css("white-space")&&n.css("white-space","normal"),n.bind_events=function(){return n.bind("update.dot",function(e,i){e.preventDefault(),e.stopPropagation(),l.maxHeight="number"==typeof l.height?l.height:function(t){for(var e=t.innerHeight(),i=["paddingTop","paddingBottom"],n=0,s=i.length;n<s;n++){var a=parseInt(t.css(i[n]),10);isNaN(a)&&(a=0),e-=a}return e}(n),l.maxHeight+=l.tolerance,void 0!==i&&(("string"==typeof i||i instanceof HTMLElement)&&(i=t("<div />").append(i).contents()),i instanceof t&&(r=i)),(h=n.wrapInner('<div class="dotdotdot" />').children()).empty().append(r.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var o=!1,u=!1;return d.afterElement&&(o=d.afterElement.clone(!0),d.afterElement.remove()),a(h,l)&&(u="children"==l.wrap?function(t,e,i){var n=t.children(),s=!1;t.empty();for(var r=0,o=n.length;r<o;r++){var l=n.eq(r);if(t.append(l),i&&t.append(i),a(t,e)){l.remove(),s=!0;break}i&&i.detach()}return s}(h,l,o):function e(i,n,r,o,l){var d=i.contents(),u=!1;i.empty();for(var c=0,h=d.length;c<h&&!u;c++){var p=d[c],g=t(p);void 0!==p&&(i.append(g),l&&i[i.is("table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style")?"after":"append"](l),3==p.nodeType?a(r,o)&&(u=s(g,n,r,o,l)):u=e(g,n,r,o,l),u||l&&l.detach())}return u}(h,n,h,l,o)),h.replaceWith(h.contents()),h=null,t.isFunction(l.callback)&&l.callback.call(n[0],u,r),d.isTruncated=u,u}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(n[0],d.isTruncated),d.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(n[0],r),r}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),n.unwatch().unbind_events().empty().append(r).attr("style",n.data("dotdotdot-style")).data("dotdotdot",!1)}),n},n.unbind_events=function(){return n.unbind(".dot"),n},n.watch=function(){if(n.unwatch(),"window"==l.watch){var e=t(window),i=e.width(),s=e.height();e.bind("resize.dot"+d.dotId,function(){i==e.width()&&s==e.height()&&l.windowResizeFix||(i=e.width(),s=e.height(),c&&clearInterval(c),c=setTimeout(function(){n.trigger("update.dot")},10))})}else u=o(n),c=setInterval(function(){var t=o(n);u.width==t.width&&u.height==t.height||(n.trigger("update.dot"),u=o(n))},100);return n},n.unwatch=function(){return t(window).unbind("resize.dot"+d.dotId),c&&clearInterval(c),n};var r=n.contents(),l=t.extend(!0,{},t.fn.dotdotdot.defaults,i),d={},u={},c=null,h=null;return l.lastCharacter.remove instanceof Array||(l.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),l.lastCharacter.noEllipsis instanceof Array||(l.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),d.afterElement=function(e,i){if(void 0===e)return!1;if(!e)return!1;if("string"==typeof e)return!!(e=t(e,i)).length&&e;if("object"==typeof e)return void 0!==e.jquery&&e;return!1}(l.after,n),d.isTruncated=!1,d.dotId=e++,n.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&n.watch(),n},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}};var e=1,i=t.fn.html;t.fn.html=function(t){return void 0!==t?this.data("dotdotdot")&&"function"!=typeof t?this.trigger("update",[t]):i.call(this,t):i.call(this)};var n=t.fn.text;t.fn.text=function(e){if(void 0!==e){if(this.data("dotdotdot")){var i=t("<div />");return i.text(e),e=i.html(),i.remove(),this.trigger("update",[e])}return n.call(this,e)}return n.call(this)}}function s(t,e,i,n,o){var u=!1;if(void 0===(y=t[0]))return!1;for(var c=-1!==(b=d(y)).indexOf(" ")?" ":"　",h="letter"==n.wrap?"":c,p=b.split(h),g=-1,f=-1,v=0,m=p.length-1;v<=m&&(0!=v||0!=m);){var _=Math.floor((v+m)/2);if(_==f)break;f=_,l(y,p.slice(0,f+1).join(h)+n.ellipsis),a(i,n)?m=f:(g=f,v=f),m==v&&0==m&&n.fallbackToLetter&&(h="",g=-1,f=-1,v=0,m=(p=p[0].split(h)).length-1)}if(-1==g||1==p.length&&0==p[0].length){var E=t.parent();t.remove();var A=o?o.length:0;if(E.contents().size()>A){u=s(E.contents().eq(-1-A),e,i,n,o)}else{var y,b,S=E.prev();if(void 0!==(y=S.contents().eq(-1)[0]))l(y,b=r(d(y),n)),o&&S.append(o),E.remove(),u=!0}}else u=!0,l(y,b=r(p.slice(0,g+1).join(h),n));return u}function a(t,e){return t.innerHeight()>e.maxHeight}function r(e,i){for(;t.inArray(e.slice(-1),i.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),i.lastCharacter.noEllipsis)<0&&(e+=i.ellipsis),e}function o(t){return{width:t.innerWidth(),height:t.innerHeight()}}function l(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function d(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}}(jQuery),define("libs/jquery/dotdotdot-1.6.1",function(){}),define("quantum/videoPlayer",["jquery","version!fly/managers/debug","managers/client-storage","translations/video","version!fly/managers/components","utils/cookie","managers/device","managers/edition","managers/events","version!fly/managers/history","managers/page-vars","managers/recommendation","managers/global-functions","managers/tealium","managers/mpulse","version!fly/utils/url-helper","utils/targeting-helper","managers/waypoints","version!fly/components/base","version!libs/cbsi-player/uvpjs","version!libs/waypoints/inview","version!libs/jquery/dotdotdot"],function(t,e,i,n,s,a,r,o,l,d,u,c,h,p,g,f,v,m){var _="videoPlayer";e=e.init(_),m.init();var E={cnetvideocreate:0,playerloaded:0,showplayoverlay:0,adstart:0,adend:0,contentstart:0},A=0,y=new window.uvpjs.VideoManager;t.widget("cnet.videoPlayer",t.fly.base,{options:{apeList:!1,autoplay:!1,classActive:"active",classCaptions:"captions",classCaptionsMissing:"captionsMissing",classDisabled:"disabled",classHidden:"hidden",classNoAutoplay:"pausedAtStartup",classPlaybackStarted:"playbackStarted",classPlaying:"playing",config:null,contentType:"vod-curated",customCSS:null,enableHistoryUpdates:!1,eventChannels:null,eventSubscriptions:null,getPlaylistSelector:null,getRelatedPlaylist:!1,getRecommendedPlaylist:!1,getShortcodeVideo:!1,idPrefix:"videoPlayer",loaderSelector:"#related-area",loop:!0,mainPlayer:!1,mutedVideoCountThreshold:10,playlist:[],preventCaptions:!1,resizePlayer:!0,selectorScrollingAutoplayDisabled:".inviewElement.exited",showAsModal:!1,showPreviewMetadata:!1,suppressAds:!1,suppressFirstAd:!0,tagTopicPlaylistRoute:"",titleTagPostText:"",upNextTriggerTime:30,uvpPartner:"cnet",videoShortcodeSelector:".video.shortcode"},adPodStartTimestamp:0,autoplayState:null,blurredVideoCountThreshold:null,chapters:null,contentStartTimeStamp:null,contentVideoState:-2,errorDetails:{MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError"},haveFirstGesture:!1,id:null,initialized:!1,interrupted:!1,isAd:!1,isAmp:!1,isPlaying:!1,history:null,mutedAutoplayEnabled:!1,closePlayerRequested:!1,pauseRequested:!1,outOfViewPaused:!0,player:null,playlist:[],playlistPaused:!1,scrollingAutoplayWaypoint:null,startingNewPlaylist:!1,timelineRequests:null,suppressAds:!1,systemInfoObject:{},testGroup:null,testName:null,testVideoUrl:"data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",uvpPayload:{},video:null,watchedVideoCount:0,windowHasFocus:!0,initialPlay:!0,autoplayScrollDisabled:!1,uvpEvents:{adError:function(t){this._trackEvent("logError","trackVideoAdError",t),this.suppressAds?e.error("UVPJS encountered a potentially fatal ad creative exception:",t):e.info("Ad failed to load because ads are being suppressed.",t)},controlMute:function(t){this._trackEvent("trackClick","mute",{})},controlUnmute:function(t){this.mutedAutoplayEnabled&&(this.$element.find("[data-overlay=mute]").addClass("hide"),this.$element.removeClass(this.options.classCaptions+" "+this.options.classCaptionsMissing),setTimeout(function(){this.$element.find("[data-overlay=mute]").removeClass("visible")}.bind(this),2e3)),this.mutedAutoplayEnabled=!1,this._trackEvent("trackClick","unmute",{})},firstGesture:function(t){if(!this.haveFirstGesture){this.haveFirstGesture=!0;var i=this,n=this.$element.find("#content_"+this.id+" video")[0];if(this.playlistPaused&&n){n.src=i.testVideoUrl;var s=n.play();s?s.then(function(){e.log("Promise fulfilled..."),i.player.getPlayerMuted()&&i.unmute(),i._resumePlaylist()}).catch(function(t){e.error("Promise not met...",t)}):e.log("no Promise")}else i.player.getPlayerMuted()&&(i.unmute(),i.$element.removeClass(i.options.classCaptions+" "+i.options.classCaptionsMissing))}},onAdBlocked:function(t){this._trackEvent("logError","trackVideoAdBlocked",t),this.suppressAds?e.error("UVPJS encountered a potentially fatal ad creative blockage:",t):e.info("Ad failed to load because ads are being suppressed.",t)},onAdEnd:function(t){this.isAd=!1,this._trackPerformanceEvent("adend")},onAdPodStart:function(t){this.adPodStartTimestamp=Date.now()},onAdStart:function(t){this.isAd=!0,this.options.eventChannels&&l.publish(this.options.eventChannels,"onAdStart"),setTimeout(function(){this.options.eventChannels&&l.publish(this.options.eventChannels,"onDelayedAdStart")}.bind(this),250),this._trackPerformanceEvent("adstart");var e=Date.now()-this.adPodStartTimestamp;e=e<1001?"0 - 1000 ms":e<1501?"1001 - 1500 ms":e<2001?"1501 - 2000 ms":e<2501?"2001 - 2500 ms":e<3001?"2501 - 3000 ms":"3001 and more",this._setAspectRatio(!0)},onCaptionsReady:function(t){this.$element.find("[data-control=captions]").removeClass(this.options.classDisabled)},onCaptionsUnavailable:function(t){e.warn("Unable to fetch captions."),this._trackEvent("logError","trackVideoCaptionsUnavailable",t)},onContentEnd:function(t){this._trackPerformanceEvent("contentend"),this.watchedVideoCount++,this.$element.find(".chapters").empty(),this.$element.find("[data-control=captions]").addClass(this.options.classDisabled),0===Math.floor(this.player.getCurrentPlaybackState().duration-this.player.getCurrentPlaybackState().currentTime)&&c.onVideoComplete()},onContentStart:function(t){this.options.eventChannels&&l.publish(this.options.eventChannels,"onContentStart"),this.contentStartTimeStamp=(new Date).getTime(),this._trackPerformanceEvent("contentstart"),this._showChapterStarts(),this._setAspectRatio()},onResourceEnd:function(t){if(this.windowHasFocus||this.watchedVideoCount%this.blurredVideoCountThreshold!=0||this.player.getPlayerMuted()){if(this.mutedAutoplayEnabled&&this.player.getPlayerMuted()&&!this.haveFirstGesture)this.watchedVideoCount===this.options.mutedVideoCountThreshold&&this._pausePlaylist();else if(0===t.payload.playlistLength&&this.options.loop&&!this.startingNewPlaylist){var i=this.playlist[this.playlist.length-1];t.payload.rco&&t.payload.rco.cmsRefGuid===i.id&&(this.playlist=this.options.playlist,this._setPlaylist(this.playlist))}}else e.log("onResourceEnd: paused out of focus playlist after "+this.blurredVideoCountThreshold+" videos"),this._pausePlaylist()},onResourceStart:function(e){if(this.uvpPayload=e.payload,this.$element.find("[data-video-still]").addClass(this.options.classHidden),this.startingNewPlaylist=!1,this.video=this._getVideoFromPlaylist(e.payload.rco.index)||e.payload.rco,this.options.getRelatedPlaylist&&this._getRelatedPlaylist(),this._setPageContextMetadata(),this.player.getPlayerMuted()&&this.$element.find("[data-overlay=mute]").addClass("visible").addClass("muted"),this.chapters={},this.video.chapters&&this.video.chapters.data)for(var i=0;i<this.video.chapters.data.length;i++)this.chapters["time"+this.video.chapters.data[i].time]=t.extend(!0,{hasSeen:!1},this.video.chapters.data[i]);if(this.options.apeList){var n=a.read("apeList"),s=n?n.split(","):[];s.indexOf(this.video.id)<0&&(s.unshift(this.video.id),a.write("apeList",s.slice(0,10),{expires:1}))}this._showVideoInfo(),this._showCloseButton(),this.options.enableHistoryUpdates&&(this.updateHistory(),-1===document.title.indexOf(this.video.title)&&""!==this.options.titleTagPostText&&(document.title=this.video.title+this.options.titleTagPostText))},onStateChange:function(t){switch(this.contentVideoState=t.payload.isAd?-2:t.payload.newState,t.payload.newState){case 0:e.info("onStateChange: stop"),this.isPlaying=!1,this.$element.removeClass(this.options.classPlaying),this._setEmbeddedVideoState(!1);break;case 1:e.info("onStateChange: play"),this.isPlaying=!0,this.$element.addClass(this.options.classPlaying),(this.pauseRequested||!this._isInView()&&"scroll"===this.options.autoplay&&!this.$element.hasClass(this.options.classPlaybackStarted))&&this.pause(),this.$element.addClass(this.options.classPlaybackStarted),this._setEmbeddedVideoState(!0),this.closePlayerRequested&&(this.pause(),this._closePlayerComplete()),"none"===this.$element.css("display")&&this.pause(),this.options.eventChannels&&!this.pauseRequested&&l.publish(this.options.eventChannels,"playVideo"),this.pauseRequested=!1,this.initialPlay=!1;break;case 2:e.info("onStateChange: pause"),this.closePlayerRequested&&this._closePlayerComplete(),this.isPlaying=!1,this.$element.removeClass(this.options.classPlaying),this._setEmbeddedVideoState(!1)}},onVideoProgress:function(e){var i=this;if(!e.payload.isAd){i.uvpPayload=e.payload;var s=e.payload.currentTime,a=e.payload.duration,o="time"+Math.round(s);if(this.chapters[o]&&!this.chapters[o].hasSeen){this.chapters[o].hasSeen=!0;var l=this.$element.find("#"+o);l.addClass("highlight"),setTimeout(function(){l.removeClass("highlight")}.bind(this),3e3),this.$element.trigger("timelineEvent",this.chapters[o])}var d=i.$element.parent().find("[data-video-info=upnext]");if(Math.floor(a-s)<=i.options.upNextTriggerTime&&d.hasClass(i.options.classHidden)&&!d.hasClass(i.options.classDisabled)&&r.isDesktopUserAgent()){var u=this._getNextVideo(this.video.id);u.title&&this.playlist.length>1&&(d.html("<div class='slate'><div><b>"+n.upnext+":</b> "+u.title+"</div><button class='closeButton' data-item='closeButton' aria-label='Close player'><svg class='close'><use xlink:href='#close'></use></svg></button></div>"),d.off("click."+_),d.on("click."+_,".slate",function(e){t(this).addClass(i.options.classHidden),i._trackEvent("trackClick","video-nudge-click",e),i.player.advancePlayList()}),d.on("click."+_,"[data-item=closeButton]",function(t){t.stopPropagation(),d.addClass(i.options.classHidden),d.addClass(i.options.classDisabled)}),setTimeout(function(){d.removeClass(i.options.classHidden),d.dotdotdot({watch:"window"}),d.css("background-image","url("+u.thumbnail+")")},100))}}},playerStartError:function(t){e.error("UVPJS encountered a fatal exception starting the player: ",t),this._trackEvent("logError","trackPlayerStartError",t)},videoPlaybackError:function(i){(e.error("UVPJS encountered a fatal exception while playing the video: ",i),i.payload&&i.payload.errorInfo)&&((i.payload.errorInfo.message||"").indexOf(this.errorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR)>-1&&(t("[data-video-info]").empty(),this.player.destroyPlaylist()));this._trackEvent("logError","trackVideoPlaybackError",i)},videoStartError:function(t){t&&t.payload&&t.payload.errorInfo&&1001===t.payload.errorInfo.errorCode&&!this.suppressAds?(e.warn("IMA failed to load; attempting to play video without ads due to UVPJS exception:",t),this._trackEvent("logError","trackVideoStartImaError",t)):(e.error("UVPJS encountered a fatal error starting the video: ",t),this._trackEvent("logError","trackVideoStartError",t))}},_create:function(){var i=this;this._setup(),h.gdprConsentCallback("video_player",function(){i.isAmp=-1!==window.location.hash.indexOf("amp=1")||-1!==window.location.hash.indexOf("ampreview=1")||-1!==window.location.hash.indexOf("ampvideo=1"),require(["comscore-video","optional!"+(window.CnetPageVars.services.googleima&&window.CnetPageVars.services.googleima.enabled?"google-ima":"feature-disabled"),"optional!"+(i.isAmp?"video-iframe-integration":"feature-disabled")],function(){var n=window.uvpjs.mediaCapabilities;if(!(n.canPlayType("video/mp4")||n.canPlayNativeHLS()||n.canPlayHLSJS()))return e.error("This device is unable to play supported video types."),i.$element.addClass(i.options.classPlaybackStarted),void i._showCloseButton();if(i.testGroup=u.tracking.data.testGroup,i.testName=u.tracking.data.testName,i.options.eventSubscriptions&&l.subscribe(i,i.options.eventSubscriptions),A++,i.id=i.options.idPrefix+A,i.$element.attr("id",i.id),i.options.apeList&&i._setupApeList(),i.options.getShortcodeVideo){var s=[];t(i.options.videoShortcodeSelector).each(function(){s.push(t(this).data("videoPlaylist")[0])});var a=[];t.each(i.options.playlist,function(e){var n=!0;t.each(s,function(){i.options.playlist[e].id===this.id&&(n=!1)}),n&&a.push(i.options.playlist[e])}),i.options.playlist=a.concat(s),i.options.getRelatedPlaylist&&(i.playlist=i.options.playlist,i._getRelatedPlaylist())}t.each(i.options.playlist,function(t){i.options.playlist[t].index=t}),i.options.getPlaylistSelector&&i._getExternalPlaylist(),t(window).on("appendPlaylist",function(t,e){i.appendPlaylist(e.data)}),window.cbsoptanon.onScriptsReady(function(t){t.ot.awaitInitialConsent(function(){t.ot.getState(function(t,e,n,s){var a={targeting:t,performance:e,functional:n,social:s},r=i._getUvpConfigs(a);i._initializeUvp(r)})})})})},{},"targeting")},_destroy:function(){this.$document.off("."+_),this.$element.off("."+_),this.$element.find("[data-control=share]").off("."+_),this.$element.find("[data-control=playlist]").off("."+_),y.destroyVideoPlayer(this.id),this.$element.removeAttr("id").html(""),t("[data-load-video]").removeClass(this.options.classPlaying)},_closeOverlays:function(t,e){t.find("[data-item=close]").off("."+_),t.removeClass(this.options.classActive).html(""),e&&(this.interrupted=!1,this.play())},closePlayer:function(){if(this.player){var t=this.player.getCurrentPlaybackState().playbackState,e=window.uvpjs.mediaCapabilities;t!==e.PAUSED&&(this.closePlayerRequested=!0),t!==e.EMPTY&&this.pause(),this.$element.closest('[data-video-player="container"]').length>0?this.$element.closest('[data-video-player="container"]').addClass(this.options.classHidden):this.$element.addClass(this.options.classHidden),this.$window.trigger("closePlayer")}},_closePlayerComplete:function(){this.closePlayerRequested=!1},_formatTime:function(t){t=isNaN(parseInt(t))?0:t;var e=new Date(null);return e.setSeconds(t),e.toISOString().substr(14,5)},_getRecommendedVideos:function(){var i=this,n=u.tracking.data.contentId,s=("roadshow"===u.tracking.data.brand?"/roadshow":"")+"/videos/video-recs/"+n+"/xhr/";e.log("video recs request",s),t.ajax({dataType:"json",type:"GET",url:s}).done(function(n){n&&n.length>0?(e.log("video recs response",n),i.options.getShortcodeVideo&&t.each(i.options.playlist,function(e){t.each(n,function(t){i.options.playlist[e].id===this.id&&n.splice(t,1)})}),i.playlist=i.options.playlist.concat(n),t.each(i.playlist,function(t){i.playlist[t].index=t}),e.log("video recs new playlist",i.playlist),i.options.playlist=i.playlist,i.$element.on("onVideoPlayerReady",function(){i.$element.find('[data-video-info="title"]').text(i.playlist[0].title)})):(e.log("video recs - none available",n),i.playlist=i.options.playlist,i.options.getShortcodeVideo&&(i.options.getRelatedPlaylist=!0))}).fail(function(t,i,n){e.log("video recs failed to load",t,i,n)}).always(function(){e.log("video recs complete"),i._setupPlayer()})},_getAdUrl:function(e,i){var n=u.ads.data.gpt.targeting,s="sz={param:sz}&iu=/8264/{param:region}-cnet/{param:device}/{param:partner}&ciu_szs={param:ciu_szs}&impl=s&gdfp_req=1&env=vp&output={param:output}&unviewed_position_start=1&url={param:referrer_url}&description_url={param:referrer_url}&correlator={param:timestamp}&cmsid=2289&vid={param:mpxRefId}&pp={param:pp}&cust_params=",a="vid={param:mpxRefId}&ptype={param:ptype}&vguid={param:vguid}&partner={param:partner_cust}&session={param:session}&subses={param:sub_session}&microsite={param:microsite}&campaign={param:campaign}&cid={param:cid}&collection={param:collection}&mfr={param:mfr}&carrier={param:carrier}&section={param:section}&userGroup={param:userGroup}&tag={param:tag}&edition={param:edition}&test={param:test}&score={param:score}&subcollection={param:subcollection}&topic={param:topic}&sectopic={param:sectopic}&pid={param:pid}&pv={param:pv}&show={param:show}&feat={param:feat}",o=r.isMobileUserAgent()||r.isIPhone()||r.isIPad(),l="cnet",d="";"es"===u.tracking.data.siteEdition?l="es-cnet":"roadshow"===u.tracking.data.brand&&(l="roadshow"),o&&(l+="_mobile"),this.isAmp&&(d="amp");var c=e.liveShowName&&e.liveShowName.length>0?e.liveShowName:null,h={};try{h=JSON.parse(t.cookie("cnet_ad"))||{}}catch(t){}var p={sz:this.mutedAutoplayEnabled&&0===i?"640x483":"640x480",device:o?"mobile_web":"desktop",partner:l,partner_cust:d,ciu_szs:"300x60",output:r.isDesktopUserAgent()?"xml_vmap1":"xml_vast2",microsite:"string"==typeof n.microsite?n.microsite:"",campaign:"",referrer_url:location.protocol+"//"+location.host+location.pathname,timestamp:(new Date).getTime(),ptype:"string"==typeof n.ptype?n.ptype:u.tracking.data.pageType,vguid:u.guid,session:h.session,sub_session:h.subses||h.subSession,cid:n.cid,collection:n.collection,subcollection:n.subcollection,mfr:n.mfr,carrier:n.carrier,section:n.section,userGroup:v.getAdUserGroups(),tag:n.tag,edition:n.edition,region:{au:"vau",uk:"vuk"}[h.region]||"vaw",test:n.test,score:n.score,topic:n.topic&&n.topic.constructor===Array?n.topic.join():n.topic,sectopic:n.sectopic&&n.sectopic.constructor===Array?n.sectopic.join():n.sectopic,mpxRefId:e.mpxRefId,pp:"vpaid_js",pid:n.pid,pv:parseInt(t.cookie("pv"))||0,show:c,feat:c?"live":null};return t.each(f.getAllParams(),function(t,e){var i=t.match(/adTargeting_(.+)/);i&&i[1]?p[i[1]]=e:"adNetwork"===t&&(p.network=e)}),t.each(p,function(t,e){var i=new RegExp("{param:"+t+"}","g"),n=e&&"||"!==e?e:"";s=s.replace(i,n),a=a.replace(i,n)}),s+encodeURIComponent(a)},_getExternalPlaylist:function(){var e=t(this.options.getPlaylistSelector).data("videoPlaylist");e&&this.appendPlaylist(e)},_getMediaUrl:function(t){var e=window.uvpjs.mediaCapabilities,i=!(e.isAndroid()&&parseInt(e.getOSVersion())<7)&&(window.MediaSource||window.WebKitMediaSource||!0===e.canPlayNativeHLS()),n=t.mp4;if(i&&t.m3u8){var s="ott";r.isMobileUserAgent()||r.isIPhone()?s="mobile":(r.isIPad()||window.uvpjs.mediaCapabilities.isChromeOS())&&(s="tablet"),n=t.m3u8,n+=-1==n.indexOf("?")?"?":"&",n+="device="+s,n+="&change-to-host=cnetmedia-a.akamaihd.net"}return n},_getPlaylistConfigs:function(i,n){var s,a=this;return s=i.map(function(e,i){var s=0;if(!a.player.getCurrentPlaybackState().playbackStarted&&0===i&&t.inArray(u.tracking.data.pageType,["video_page","video_share"])>-1){var o=parseInt(f.getParam("t"),10);s=!isNaN(o)&&o>0&&o<e.duration?o:0}return{cmsRefGuid:e.id,duration:e.duration,index:e.index,adCall:"//pubads.g.doubleclick.net/gampad/ads?"+a._getAdUrl(e,i),assetURL:a._getMediaUrl(e),seriesTitle:a.isAmp?"CNET AMP Video":"CNET Video",startTime:s,type:a.suppressAds||a.mutedAutoplayEnabled&&r.isMobile()&&0===i&&n?window.uvpjs.mediaCapabilities.RP_URL:window.uvpjs.mediaCapabilities.RP_IMA,vidContId:a.id,videoTitle:e.title,closedCaptionPath:e.closedCaptionPath}}),e.log("playlistConfigs",s),s},_getRelatedPlaylist:function(){var i,n=this;i=n.playlist[n.playlist.length-1].slug;var s=o.getEdition(),a=("us"===s?"":"/"+s)+"/videos/related-playlist/"+i+"/xhr/";i&&t.ajax({dataType:"json",type:"GET",url:a}).done(function(i){i&&i.length>0&&(n.playlist=n.playlist.concat(i),t.each(n.playlist,function(t){n.playlist[t].index=t}),n.options.playlist=n.playlist,n.player&&"load"===n.autoplayState&&n.player.addResourcesToPlaylist(n._getPlaylistConfigs(i,!1)),n.options.getRelatedPlaylist=!1,e.log("_getRelatedPlaylist new playlist",n.playlist))}).fail(function(t,i,n){e.log("_getRelatedPlaylist failed to load",t,i,n)})},_getUvpConfigs:function(e){var i=window.document.location.search.indexOf(_)>0,n=u.tracking.data.siteSection,s=t.inArray(n,["home","how_to","news","reviews","videos"])?n:"id",a=this.options.config&&this.options.config.tracking?escape(this.options.config.tracking["comscore_sense_"+s]):"",r={news:"P50B755CF-7443-484D-80EB-15D0499ACEB9",reviews:"P051D033D-BD8F-4F2B-93B7-A1F9F1402AB1",videos:"PB2485A3C-22F7-433C-B50B-332EF2270710"}[u.tracking.data.siteSection]||"P0EA7CD2E-455C-4925-95F9-FC8A7E69BB99";return{allowConcurrentPlayback:!1,capLevelToPlayerSize:!0,cms:"platform",controls:[{el:"PREVIEW_BTN",type:"buttonContainer",label:"Start video",children:[{el:"duration",type:"previewTitle",name:"title"},{el:"title",type:"previewDuration",name:"duration"}]},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"title",type:"videoInfo",videoInfo:"title"},{el:"PLAYSTATE_BTN",type:"svgToggle",label:"Play pause",svgOn:"pause",svgOff:"play"},{el:"VOLUME_BTN",type:"svgToggle",label:"Volume",svgOn:"speaker-on",svgOff:"speaker-off"},{el:"TIME_CURRENT",type:"span",text:"00:00"},{el:"TIME_DURATION",type:"span",text:this.options.playlist[0]&&this.options.playlist[0].duration?this._formatTime(this.options.playlist[0].duration):"00:00"},{el:"btn-share",type:"svg",label:"Share",svg:"share",control:"share"},{el:"CLOSED_CAPTION_BTN",type:"svg",control:"captions",label:"Closed captions",svg:"captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"FULLSCREEN_BTN",type:"svg",label:"Fullscreen",svg:"fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",label:"Progress",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]},{el:"overlays",type:"wrapper",name:"overlays",children:[{el:"share",type:"overlay",name:"share"},{el:"mute",type:"overlay",name:"mute"}]}],customCSS:this.options.customCSS,netwk:"cnet",partner:this.options.uvpPartner,playsInline:!0,preventFlashPlayback:!0,skin:!0,template:{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',buttonContainer:'<button class="${ o.cls }" aria-label="${ o.label }">${ o.children }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',overlay:'<div class="overlay ${ o.name }" data-overlay="${ o.name }"></div>\n',previewDuration:'<div class="videoMeta ${ o.name }"><div data-video-info="${ o.type }" class="${ o.type }"></div></div>',previewTitle:'<div class="videoMeta ${ o.name }"><div data-video-info="${ o.type }" class="${ o.type }"></div><div data-video-info="previewAuthor" class="previewAuthor"></div></div>',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }"  aria-label="${ o.label }" />\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',svg:'<button class="${ o.cls }" data-control="${ o.control }" data-target="${ o.target }" aria-label="${ o.label }"><svg class="${ o.svg }"><use xlink:href="#${ o.svg }"/></svg></button>\n',svgToggle:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }"><svg class="${ o.svgOn }"><use xlink:href="#${ o.svgOn }"/></svg><svg class="${ o.svgOff }"><use xlink:href="#${ o.svgOff }"/></svg></button>\n',toggle:'<span class="${ o.cls }" data-control="${ o.control }">${ o.text }<button class="on" aria-label="${ o.text } ${ o.textOff }">${ o.textOn }</button><button class="off" aria-label="${ o.text } ${ o.textOn }">${ o.textOff }</button></span>\n',videoInfo:'<span class="${ o.cls }" data-video-info="${ o.videoInfo }">'+(this.options.playlist.length>0&&this.options.playlist[0].title?this.options.playlist[0].title:"")+"</span>\n",wrapper:'<div class="${ o.name }">${ o.children }</div>\n'},usesIMA:!0,uvpc:{modules:[{name:"UVPJSDebug",category:"internal",enabled:i,params:[{name:"showAll",value:!0}]},{name:"ComScore_ss",category:"tracking",enabled:e.performance,params:[{name:"partnerID",value:"cnet"},{name:"c1",value:"19"},{name:"c2",value:"3005086"},{name:"publishersSecret",value:"2cb08ca4d095dd734a374dff8422c2e5"},{name:"c3",value:""},{name:"c4",value:a}]},{category:"qos",enabled:e.performance,name:"MuxQOSPluginJS",params:[{name:"propertyKey",value:"prod"===u.environment?"f13b9be8b7851594e8da77ea2":"930577dfc824ba10a4d593063"},{name:"experimentName",value:"||"===u.ads.data.gpt.targeting.test?"":u.ads.data.gpt.targeting.test}]},{name:"SiteCatalyst",category:"qos",enabled:e.performance,params:[{name:"account",value:""},{name:"brand",value:"cnet"},{name:"edition",value:"us"},{name:"charSet",value:"UTF-8"},{name:"currencyCode",value:"USD"},{name:"visitorNamespace",value:"cbsinteractive"},{name:"TrackLiveStreams",value:"y"},{name:"trackingServer",value:"saa.cbsi.com"},{name:"heartbeatTrackingServer",value:"cbsinteractive.hb.omtrdc.net"},{name:"heartbeatAdobePublisherId",value:"10D31225525FF5790A490D4D@AdobeOrg"},{name:"heartbeatVisitorMarketingCloudOrgId",value:"10D31225525FF5790A490D4D@AdobeOrg"}]},{category:"tracking",name:"NielsenTracking_SDK",enabled:e.performance,params:[{name:"apid",value:r},{name:"clientid",value:"us-200330"},{name:"sfcode",value:"prod"===u.environment?"us":"dcr-cert"},{name:"vcid",value:"c07"},{name:"channelInfo",value:""},{name:"iag_sid",value:"1000011"},{name:"iag_tfid",value:"902"},{name:"channelName",value:"cbs"},{name:"segB",value:"CNET.com"},{name:"nol_devDebug",value:i?"console":""}]}]}}},_getNextVideo:function(e){var i=this,n={};return t.each(this.playlist,function(t){if(e===this.id)return n=i.playlist[t+1]||i.playlist[0],!1}),n},getVideo:function(){if(!this.video||!this.video.id)return null;var e,i="MANUAL";switch(("load"===this.autoplayState||"first"===this.autoplayState&&this.$element.is(t("[data-component*=videoPlayer]").first()))&&(this.playlist.length>1||this.options.getRelatedPlaylist?i="CONTINUOUS":this.autoplayState&&(i="AUTOPLAY")),this.contentVideoState){case-2:e="UNPLAYED";break;case-1:case 1:case 2:e="PLAYED";break;case 0:e="STOPPED";break;default:e="COMPLETED"}return t.extend(!0,{},this.video,{autoplayType:i,currentPlaybackState:this.player.getCurrentPlaybackState(),contentStartTimeStamp:this.contentStartTimeStamp,mediaUrl:this._getMediaUrl(this.video).split("?")[0],videoState:e})},_getVideoFromPlaylist:function(t){return this.playlist.filter(function(e){return e.index===t})[0]||null},_hideContainer:function(){this.$element.closest('[data-video-player="container"]').length>0&&!this.isPlaying&&1===t(".videoPlayer.playing").length&&this.$element.closest('[data-video-player="container"]').addClass(this.options.classHidden)},_initializeUvp:function(i){var s=this;y.initialize(i,function(i){s.systemInfoObject=i,s.options.showAsModal&&s.$element.addClass(s.options.classHidden),y.addEventListener(uvpjs.EventType.PLAYER_INIT+"."+s.id,function(i){if(s.id===i.target){if(s.player=i.payload.player,s.$element.trigger("onVideoPlayerReady",s.video),e.log("onVideoPlayerReady"),s.options.showPreviewMetadata&&s.options.playlist.length>0){s.$element.find("[data-video-info=previewDuration]").html('<svg class=" video"><use aria-hidden="false" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#video"></use></svg>'+s._formatTime(s.options.playlist[0].duration)),s.$element.find("[data-video-info=previewTitle]").text(s.options.playlist[0].title?s.options.playlist[0].title:"");var a=s.options.playlist[0].author;a&&a.firstName.length>0&&s.$element.find("[data-video-info=previewAuthor]").html('<div><span class="by">'+n.by+"</span> "+a.firstName+" "+a.lastName+"</div>")}t("[data-video-info]").dotdotdot({watch:"window"})}}),s._setupData(),s.options.showAsModal&&s.$element.addClass(s.options.classHidden),s._setupExternalEvents(),s.isAmp&&(s.options.suppressFirstAd=!1,s._setupAmpIntegration()),"scroll"===s.autoplayState?s._setupScrollingAutoplay():s.options.getRecommendedPlaylist?s._getRecommendedVideos():s._setupPlayer()}),s._trackPerformanceEvent("cnetvideocreate")},_isInView:function(){var e=this.$element.offset().top,i=e+this.$element.outerHeight(),n=t(window).scrollTop(),s=n+t(window).height();return i>n&&e<s},_isFilteredShowPage:function(){try{return 1===t(window.location.hash).length}catch(t){return!1}},isAdPlaying:function(){return this.isAd},_setupAmpIntegration:function(){var t=this,i=u.ads.data.gpt.targeting;try{if(window.DW=window.DW||{},window.DW.pageParams=window.DW.pageParams||{},-1!==window.location.hash.indexOf("amp=1")){window.DW.pageParams.pagetype="article_amp";var n=f.getHashParam("pageType");i.ptype=n||window.DW.pageParams.pagetype}else-1!==window.location.hash.indexOf("ampreview=1")?window.DW.pageParams.pagetype="product_main_amp":-1!==window.location.hash.indexOf("ampvideo=1")&&(window.DW.pageParams.pagetype="video_page_amp")}catch(t){e.log("Couldn't update pagetype",t)}(window.AmpVideoIframe=window.AmpVideoIframe||[]).push(function(e){!1!==t.options.autoplay&&(e.method("play",function(){t.play()}),e.method("pause",function(){t.pause()}),e.method("mute",function(){t.mute()}),e.method("unmute",function(){t.unmute()})),e.postEvent("canplay")})},_loadChapter:function(e){var i=this;this.timelineRequests=this.timelineRequests||[],e.slug&&this.timelineRequests.push(t.ajax({dataType:"html",type:"POST",url:"/videos/video-timeline/"+e.slug+"/",data:{id:e.objectId,image:e.image?e.image:null,link:e.link,rating:e.metaData&&e.metaData.starRating?e.metaData.starRating:null,slug:e.slug,text:e.text,title:e.title,typeLabel:e.typeLabel,typeName:e.typeName},success:function(n){var s=100*e.time/i.video.duration,a=t('<div class="chapterDot" style="left:'+s+'%" id="time'+e.time+'"></div>'),r=t(n);r.on("click",function(t){i.pause()}),a.append(r),i.$element.find(".chapters").append(a)}}))},mute:function(){this.player&&this.player.mute()},_openOverlay:function(t,e){var i=this;this.isPlaying&&(this.pause(),this.interrupted=!0),this._closeOverlays(this.$element.find("[data-overlay]"),!1),t.addClass(this.options.classActive).html(e),s.process(t),t.find("[data-item=close]").on("click."+_,function(e){i._closeOverlays(t,i.interrupted)})},pause:function(){this.player&&this.player.pauseVideo()},_pausePlaylist:function(){if(this.player.pausePlaylist(),this.playlistPaused=!0,this.$element.find("[data-overlay=mute]").removeClass("visible"),this.$element.find(".uvpjs__controlbar").css("pointer-events","none"),r.isDesktop())if(this.haveFirstGesture){var t=this;this.$element.find("button.uvpjs__btn-large-play").one("click",function(e){e.stopPropagation(),t._resumePlaylist()})}else this.$element.find("button.uvpjs__btn-large-play").addClass(this.options.classDisabled),this.$element.find(".uvpjs__controls").addClass(this.options.classActive);try{this.$element.find("button.uvpjs__btn-large-play").css("background-image","url("+this.playlist[this.watchedVideoCount].image.path+")"),this.$element.find('[data-video-info="title"]').text(this.playlist[this.watchedVideoCount].title)}catch(t){}this.$element.parent().find("[data-video-info=upnext]").addClass(this.options.classHidden).removeClass(this.options.classDisabled)},play:function(){var t=this.$element.find(".uvpjs__btn-preview");this.player&&t.hasClass("uvpjs__btn-preview--hidden")?this.player.playVideo():t[0]&&(t[0].dispatchEvent(new Event("touchstart")),t[0].dispatchEvent(new Event("touchend")))},playVideoClip:function(t,e){t&&(e&&e.type&&e.type===window.uvpjs.EventType.RESOURCE_END&&this.playlist.length>1?this.play():(this.unmute(),this._setPlaylist(t)))},_processEvent:function(t){if(t&&t.target===this.id){["onVideoProgress"].indexOf(t.type)<0&&e.log(t.type,t),this.uvpEvents[t.type].call(this,t),this.$element.trigger(t.type,this.video)}},_resumePlaylist:function(){this.player.resumePlaylist(),this.playlistPaused=!1,this.$element.find(".uvpjs__controlbar").css("pointer-events",""),this.$element.find("button.uvpjs__btn-large-play").css("background-image",""),r.isDesktop()&&(this.$element.find("button.uvpjs__btn-large-play").removeClass(this.options.classDisabled),this.$element.find(".uvpjs__controls").removeClass(this.options.classActive))},_setAspectRatio:function(e){if(this.options.resizePlayer)if(!0===e)this.$element.css("height","");else if(this.video.isVertical){var i=t(window).height()-this.$element.find(".uvpjs__controlbar").height();this.$element.css("height",i+"px")}},_setEmbeddedVideoState:function(e){var i=this;i.options.mainPlayer?t("[data-load-video]").each(function(){var n=t(this).closest("[data-video-playlist]").data("videoPlaylist"),s=t(this).data("loadVideo"),a=!1;n&&n[s]&&n[s].id==i.video.id?a=!0:t(this).data("videoId")==i.video.id&&(a=!0),a?t(this).addClass(i.options.classActive):t(this).removeClass(i.options.classActive),a&&e?t(this).addClass(i.options.classPlaying):t(this).removeClass(i.options.classPlaying)}):e&&i.options.eventChannels&&l.publish(i.options.eventChannels,"heroVideoPlaying")},_setPageContextMetadata:function(){var e=null!=this.video.primaryCollection?this.video.primaryCollection.id:"",i=this.video.datePublished?this.video.datePublished.slice(0,10):"";this.player.setPageContextMetadata(t.extend(!0,{},p.getHbParams(),{collectionId:e,contentType:this.options.contentType,"a.media.originator":[null!=this.video.author?this.video.author.firstName+" "+this.video.author.lastName:null],"a.media.airDate":i,siteType:this.isAmp?"google_amp|||mobile":u.tracking.data.siteType}))},_setPlaylist:function(t){t.length>0?(this.startingNewPlaylist=!0,this.playlist=t,this.player.destroyPlaylist(),this.player.addResourcesToPlaylist(this._getPlaylistConfigs(t,this.options.suppressFirstAd)),this.$element.addClass(this.options.classPlaying)):e.error("No videos found in the playlist.")},_setupApeList:function(){u.video.prepend&&!a.read("viewedPrepend")&&(this.options.playlist.unshift(u.video.prepend),a.write("viewedPrepend","1",{expires:1}));var t=a.read("apeList");if(t)for(var e=0,i=t.split(",");e<this.options.playlist.length&&i.indexOf(this.options.playlist[0].id)>=0;)this.options.playlist.push(this.options.playlist.shift()),e++},_setupData:function(){this.video=this.options.playlist.length>0?this.options.playlist[0]:{};var e=f.getParam("adSuppress")||a.read("adSuppress")||"";this.suppressAds=this.options.suppressAds||"all"===e||e.split(",").indexOf(_)>=0||u.services.googleima&&!u.services.googleima.enabled||!(window.google&&window.google.ima),this.history=d.init(),!this.systemInfoObject.supportsMutedAutoplay&&!this.systemInfoObject.supportsUnmutedAutoplay||this.video.ratingVChip&&"TV-MA"==this.video.ratingVChip||this._isFilteredShowPage()?this.autoplayState=!1:this.autoplayState=this.options.autoplay,this.mutedAutoplayEnabled=(t.inArray(this.autoplayState,["load","scroll"])>-1||"first"===this.autoplayState&&this.$element.is(t("[data-component*=videoPlayer]").first()))&&this.systemInfoObject.supportsMutedAutoplay},_setupExternalEvents:function(){var e=this;this.$document.on("keyup."+e.id,"[data-load-video]",function(t){13===t.which&&e._videoExternalInteractionEvent(t,this)}),this.$document.on("click."+e.id,"[data-load-video]",function(t){e._videoExternalInteractionEvent(t,this)}),this.$document.on("click","[data-replace-video-playlist]:not([data-active-video-playlist])",function(i){var n=i.target.getAttribute("data-replace-video-playlist"),a=i.target.getAttribute("data-video-tag-type"),r=e.options.tagTopicPlaylistRoute.replace("replace-me",n),o=t("[data-tag-playlist-container]").first();r+="?currentVideo="+e.video.id,e.loader=t.cnet.loading({disabled:!1}),e.loader.$element.appendTo(t(e.options.loaderSelector)),e.loader.add(),e._trackEvent("trackClick","video-playlist|"+a+"|"+n,{}),o.hasClass("loaded")&&(o.removeClass("loaded fullLoad"),o.addClass("reset"),setTimeout(function(){t("[data-tag-playlist]").first().empty()},500)),t.ajax({dataType:"json",type:"GET",url:r}).done(function(n){n&&void 0!==n.template&&void 0!==n.playlist&&(e.playlist=n.playlist,e.loader.remove(),e._setPlaylist(e.playlist),t("[data-tag-playlist]").first().append(n.template),o.addClass("loaded"),o.removeClass("reset"),t("[data-replace-video-playlist]").removeAttr("data-active-video-playlist"),t(i.target).attr("data-active-video-playlist","true"),setTimeout(function(){o.addClass("fullLoad")},500),s.process(o))})}),this.$document.on("click","[data-active-video-playlist]",function(i){var n=t("[data-tag-playlist-container]").first();n.removeClass("loaded fullLoad"),n.addClass("reset"),t(i.target).removeAttr("data-active-video-playlist"),e.playlist=e.options.playlist,e._setPlaylist(e.playlist),setTimeout(function(){t("[data-tag-playlist]").first().empty()},500)}),"video_focus"===e.testName&&t.inArray(e.testGroup,["a","b","c"])>-1&&("a"===e.testGroup?e.blurredVideoCountThreshold=5:"b"===e.testGroup?e.blurredVideoCountThreshold=10:"c"===e.testGroup&&(e.blurredVideoCountThreshold=20),this.$window.on("blur."+this.id,function(t){e.windowHasFocus=!1}),this.$window.on("focus."+this.id,function(t){e.windowHasFocus=!0,e.playlistPaused&&e._resumePlaylist()})),this.$element.on("onVideoPlayerReady",function(){t("body").addClass("videoPlayerReady"),e.player.setVolume(.5),e.options.eventChannels&&l.publish(e.options.eventChannels,"videoReady")})},_setupInternalEvents:function(){var e=this;if(t.each(this.uvpEvents,function(t){e.player.addEventListener(t+"."+e.id,e._processEvent.bind(e))}),this.$element.find("[data-control=share]").on("click."+_,function(i){var n=e.$element.find("[data-overlay=share]");if(n.hasClass(e.options.classActive))e._closeOverlays(n,e.interrupted);else{var s=o.getEdition();t.ajax({url:("us"===s?"":"/"+s)+"/videos/video-share-xhr/"+e.video.slug+"/"}).done(function(t){e._openOverlay(n,t)})}}),this.$element.on("click."+_,function(t){if(!e.$element.hasClass(e.options.classActive)){var i=function(t){e.$element.removeClass(e.options.classActive),e.$document.off("tap",i)};e.$element.addClass(e.options.classActive),e.$document.on("tap."+_,i)}}),this.$element.find(".uvpjs__progress").append('<div class="chapters"></div>'),this.options.enableHistoryUpdates&&this.history.stateChange(function(e){var i=-1;if(t.each(this.playlist,function(t){if(e.data.id===this.id)return i=t,!1}),i>-1){var n=this.playlist.slice(i),s=this.playlist.slice(0,i);this.playlist=n.concat(s)}else this.playlist=[e.data].concat(this.playlist);this._setPlaylist(this.playlist)}.bind(this)),this.mutedAutoplayEnabled){var i="click";t.inArray(this.testGroup,["c","d"])>-1&&(i+=" mouseover");var s=this.$element.find("[data-overlay=mute]");s.html('<div class="speaker-off"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#speaker-on"></use></svg><span class="label">'+n.playSound+"</span></div>"),s.one(i,function(i){t(this).removeClass("muted"),e.unmute(),e.$element.removeClass(e.options.classCaptions+" "+e.options.classCaptionsMissing)})}},_videoExternalInteractionEvent:function(i,n){i.preventDefault();var s=t(n),a=s.data("loadVideo")||0,r=s.closest("[data-video-playlist]").data("videoPlaylist");if(this._closePlayerComplete(),s.data("videoId")){var o=null;t.each(this.options.playlist,function(t,e){if(e.id===s.data("videoId"))return o=t,!1}),null!=o&&(a=o,r=this.options.playlist)}var l=r.slice(a),d=r.slice(0,a),u=(r=l.concat(d))&&r.length>0?r[0].id:null,c=s.hasClass(this.options.classPlaying),h=parseInt(this.id.replace(this.options.idPrefix,""))===s.closest("[data-playlist-target]").data("playlistTarget"),p=t(n).is(this.options.videoShortcodeSelector);if(this.options.mainPlayer||h)if(this.options.showAsModal&&(this.$element.removeClass(this.options.classHidden),this._showCloseButton()),c)this.pause(),p&&this._trackEvent("trackClick","inbody|videopause",i),s.data("trackPlaylist")&&this._trackEvent("trackClick","playlist_pause",i);else{if(this.$element.closest('[data-video-player="container"]').removeClass(this.options.classHidden),t(window).trigger("playerShowing"),this.unmute(),r&&r.length>0&&(!this.video||this.video&&this.video.id!=u))this.player.getCurrentPlaybackState().playbackStarted?this._setPlaylist(r):(this.options.playlist=r,this.player.overrideUserGesture(!0));else if(this.player.getCurrentPlaybackState().playbackStarted)if(this.player.getCurrentPlaybackState().playbackStarted)this.play();else{var g=this.$element.find("#content_"+this.id+" video")[0];if(g){g.src=this.testVideoUrl;var f=g.play();f?f.then(function(){e.log("Promise fulfilled..."),t(".uvpjs__btn-preview").trigger("click")}).catch(function(t){e.error("Promise not met...",t)}):e.error("no Promise")}}else this.player.overrideUserGesture(!0);s.data("scrollToTop")&&t("html, body").animate({scrollTop:this.$element.offset().top},1e3),t("[data-load-video]").removeClass(this.options.classActive),t("[data-load-video]").removeClass(this.options.classPlaying),s.addClass(this.options.classActive),s.addClass(this.options.classPlaying),p&&this._trackEvent("trackClick","inbody|videoplay",i),s.data("trackPlaylist")&&this._trackEvent("trackClick","playlist_play",i),s.data("trackPlaylistRedesign")&&this._trackEvent("trackClick","video-playlist|playlist-item|"+s.data("trackPlaylistRedesign"),i)}},_setupPlayer:function(){var i=this;if(e.log("_setupPlayer"),!this.initialized){this.initialized=!0,this.autoplayState||(this.$element.addClass(this.options.classNoAutoplay),this.$window.trigger(this.options.classNoAutoplay),this._showCloseButton());var n=r.isDesktopUserAgent()&&"videos"===u.tracking.data.siteSection&&t.inArray(u.tracking.data.pageType,["video_share","article_amp"])<0;y.createVideoPlayer(i.id,function(t){(i.player=t,i._setPageContextMetadata(),i._trackPerformanceEvent("playerloaded"),i._setupInternalEvents(),i._setPlaylist(i.options.playlist),i.options.apeList)||(window._cbv||(window._cbv=[])).push(i.player.DOMMgr.dom.video.el);i.$element.trigger("onVideoPlayerReady",i.video)},{enableMutedAutoplay:this.mutedAutoplayEnabled,enableUnmutedAutoplay:"load"===i.autoplayState&&i.systemInfoObject.supportsUnmutedAutoplay&&n,previewImage:i.options.playlist.length>0&&i.options.playlist[0].image&&i.options.playlist[0].image.path?i.options.playlist[0].image.path:"",deferLoadingCaptions:i.options.preventCaptions})}},_showCloseButton:function(){if(0==this.$element.find("[data-item=closeButton]").length){this.$element.prepend("<button class='closeButton' data-item='closeButton' aria-label='Close player'><svg class='close'><use xlink:href='#close'></use></svg></button>");var t=this;this.$element.find("[data-item=closeButton]").click(function(e){e.stopPropagation(),t.closePlayer(),t._trackEvent("trackClick","close-scroll-video",e)})}},_showVideoInfo:function(){var e=this;e.$element.parent().find("[data-video-info]").each(function(){var i=t(this),n=i.data("videoInfo"),s=e.video[n]||"";0===e.watchedVideoCount&&"title"===n&&e.video.primaryCollection&&"0d8f9ac8-61cb-4e36-9263-552d5468e04b"===e.video.primaryCollection.id?s=e.video.primaryCollection.title||"":"author"===n&&e.video.author?s=(e.video.author.firstName||"")+" "+(e.video.author.lastName||""):"collection"===n&&e.video.primaryCollection?s=e.video.primaryCollection.title||"":"upnext"===n&&(s="",i.addClass(e.options.classHidden).removeClass(e.options.classDisabled)),i.text(s)}),setTimeout(function(){t("[data-video-info]").dotdotdot({watch:"window"})},100)},_setupScrollingAutoplay:function(){var t=this,e=function(e){t.player?(t.options.eventChannels&&l.publish(t.options.eventChannels,"videoReady"),t.outOfViewPaused&&!t.autoplayScrollDisabled&&t.play()):t._setupPlayer()};this.scrollingAutoplayWaypoint=new Waypoint.Inview({element:this.$element,entered:e,enter:e,exited:function(e){if(t.player&&t.player.getPlayerMuted()&&0===t.$element.closest(t.options.selectorScrollingAutoplayDisabled).length){var i=t.player.getCurrentPlaybackState();t.outOfViewPaused=2!=i.playbackState,i.playbackStarted?t.pause():t.pauseRequested=!0}}})},_showChapterStarts:function(){if(this.timelineRequests)for(var t=0;t<this.timelineRequests.length;t++)this.timelineRequests[t].abort();if(this.$element.find(".chapters").empty(),this.video&&this.video.chapters)for(var e in this.video.chapters.data)this._loadChapter(this.video.chapters.data[e])},_trackEvent:function(e,i,n,s){if("logError"!==e){s=s||{};var a="";if(n.errorInfo){var r=n.errorInfo.errorCode||"null",o=n.errorInfo.serverCode||"null";if(3005===r&&"string"==typeof n.errorInfo.message){var l=n.errorInfo.message.split(" ");o+="_"+l[l.length-1]}a=r+"_"+o}var d=-1<a.indexOf("3005_null_buffer"),c=-1<a.indexOf("3005_null_levelLoad");!(d||c)&&this.video&&p.trackCustomEvent(e,t.extend(!0,{articleAuthorId:this.video.author?[this.video.author.id]:null,articleAuthorName:this.video.author?[this.video.author.firstName+" "+this.video.author.lastName]:null,articleId:u.tracking.data.articleId,articleTitle:u.tracking.data.articleTitle,articleType:u.tracking.data.articleType,brand:u.tracking.data.brand,channel:"video",clickGenericText:i,collectionId:this.video.primaryCollection?[this.video.primaryCollection.id]:null,deviceType:u.tracking.data.deviceType,error:a,pageType:u.tracking.data.pageType,siteEdition:u.tracking.data.siteEdition,siteHier:u.tracking.data.siteHier,siteSection:u.tracking.data.siteSection,siteType:u.tracking.data.siteType,videoAdIds:n.adData?n.adData.adVideoId:null,videoAdTitle:n.adData?n.adData.adVideoTitle:null,videoContentType:"video",videoId:this.video.id,videoTitle:this.video.title||this.video.headline,_pageChannelType:u.tracking.data._pageChannelType,_pageTitle:u.tracking.data._pageTitle,_pageViewGuid:u.tracking.data._pageViewGuid},s))}},_trackPerformanceEvent:function(i){e.info("Firing event: cnet_video."+i),u.video=u.video||{},u.video.performance=u.video.performance||{},u.video.performance[i]=!0;try{window.dispatchEvent(new Event("cnet_video."+i)),t(window).trigger("cnet_video."+i)}catch(t){e.error("Unable to trigger event cnet_video."+i)}try{void 0===performance.getEntriesByName(i)[0]&&performance.mark("cnet_video_"+i)}catch(t){e.error("Unable to set performance mark cnet_video_"+i)}try{var n=void 0===E[i]||0===E[i],s=["video_page","article","product_main"].indexOf(u.tracking.data.pageType)>-1;if(n&&s){E[i]=performance.now();var a=E[i],r={cnetvideocreate:["create"],playerloaded:["ploaded","cnetvideocreate"],adstart:["adStart","playerloaded"],showplayoverlay:["showoverl","playerloaded"]}[i];if(t.isArray(r)){var o=E[r[1]]||0;a=E[i+"_from_"+r[1]]=E[i]-o}var l=t.isArray(r)?r[0]:"";-1===["adstart","cnetvideocreate"].indexOf(i)&&l&&g.sendBeacon("video_"+l,a),"adstart"===i&&g.sendBeacon("video_adStart_c",E[i])}}catch(t){e.error("mpulse error tracking "+i+": "+t)}},unmute:function(){this.player&&this.player.getPlayerMuted()&&(this.player.unMute(),this.player.hideCaptions())},updateHistory:function(){-1===document.location.pathname.indexOf(this.video.urlPath)&&this.video.urlPath&&(this.history.navigate({title:this.video.title,data:this.video},{replace:!1,url:this.video.urlPath}),t(window).trigger("historystatechange"))},appendPlaylist:function(i){var n=this;i.length>0?this.playlist.length>0?(this.options.playlist=this.options.playlist.concat(i),t.each(n.options.playlist,function(t){n.options.playlist[t].index=t}),this.playlist=this.options.playlist,this.player&&this.player.addResourcesToPlaylist(this._getPlaylistConfigs(i))):(this.options.playlist=this.options.playlist.concat(i),t.each(n.options.playlist,function(t){n.options.playlist[t].index=t})):e.error("No videos found in the playlist."),e.log("appendPlaylist: new videos",i),e.log("appendPlaylist: new playlist",this.options.playlist)},setAutoplayToPause:function(){!1!==this.options.autoplay&&(this.initialPlay&&(this.pauseRequested=!0),this.autoplayScrollDisabled=!0)}})}),define("quantum/inviewElement",["jquery","managers/page-vars","managers/client-storage","version!fly/managers/debug","managers/events","version!fly/components/base","version!libs/waypoints/inview"],function(t,e,i,n,s){n=n.init("inviewElement"),t.widget("cnet.inviewElement",t.fly.base,{options:{containerAwareClassPrefix:null,containerAwareSelector:null,contentsClass:null,contentsSelector:null,customEventPercentage:"",events:["enter","entered","exit","exited"],eventChannels:null,eventSubscriptions:null,exitDirection:"both",repeat:!0,setStateOnLoad:!1,waypointParentOffsetSelector:"",mainPlayer:!1},enabled:!0,inviewWaypoint:null,_create:function(){this._setup(),this._setupWaypoints(),this._setupEvents(),this.options.setStateOnLoad&&this._setState()},_destroy:function(){this.inviewWaypoint.destroy(),this.$element.removeClass(this.options.events.join(" ")),this.options.contentsSelector&&this.$element.find(this.options.contentsSelector).removeClass(this.options.contentsClass)},disable:function(){for(var t=0;t<this.inviewWaypoint.waypoints.length;t++)this.inviewWaypoint.waypoints[t].disable();this.$element.removeClass(this.options.events.join(" "))},enable:function(){t("[data-component*=inviewElement]").not(this.$element).each(function(e,i){try{t(i).inviewElement("disable")}catch(t){n.log("Inview element not ready to be disabled.",t)}});for(var e=0;e<this.inviewWaypoint.waypoints.length;e++)this.inviewWaypoint.waypoints[e].enable()},_setState:function(){if("off"!==i.read("autoplayEnabled")&&this.$element.is(t("[data-component*=inviewElement]").first())){var e=this.$element.offset().top,n=e+this.$element.outerHeight(),s=t(window).scrollTop(),a=s+t(window).height();n>s&&e<a||(this.$element.addClass("exit exited"),this.options.contentsSelector&&this.$element.find(this.options.contentsSelector).addClass(this.options.contentsClass))}},_setupEvents:function(){var e=this;t(window).on("closePlayer",function(){e.$element.find(e.options.contentsSelector).removeClass(e.options.contentsClass)}),this.options.eventSubscriptions&&s.subscribe(this,this.options.eventSubscriptions)},_setupWaypoints:function(){var e=this;if(""!==this.options.customEventPercentage&&this.options.contentsSelector)this.customWaypoint=new Waypoint({element:this.$element,handler:function(t){if("up"===t)e.$element.find(e.options.contentsSelector).removeClass(e.options.contentsClass);else if(e.options.customChildSelector){var i=e.$element.find(e.options.customChildSelector);(0===i.length||i.length>0)&&e.$element.find(e.options.contentsSelector).addClass(e.options.contentsClass)}else e.$element.find(e.options.contentsSelector).addClass(e.options.contentsClass)},offset:function(){return-(""===e.options.waypointParentOffsetSelector?this.element.height():t(this.element).closest(e.options.waypointParentOffsetSelector).height())*parseFloat(e.options.customEventPercentage)}});else{var i=this.options.events.reduce(function(t,i){return t[i]=function(t){if(n.log("Waypoint "+i+" "+t+" triggered."),e.options.eventChannels&&s.publish(e.options.eventChannels,i),(i.indexOf("exit")<0||"both"===e.options.exitDirection||e.options.exitDirection===t)&&(e.$element.removeClass(e.options.events.join(" ")).addClass(i),e.options.containerAwareClassPrefix&&e.options.containerAwareSelector&&e.$element.parents(e.options.containerAwareSelector).removeClass(e.options.events.map(function(t){return e.options.containerAwareClassPrefix+t}).join(" ")).addClass(e.options.containerAwareClassPrefix+i)),e.options.contentsSelector)if(0===i.indexOf("enter"))e.$element.find(e.options.contentsSelector).removeClass(e.options.contentsClass);else if("both"===e.options.exitDirection||e.options.exitDirection===t){var a=e.$element.find("[data-component=videoPlayer]");(0===a.length||a.length>0)&&e.$element.find(e.options.contentsSelector).addClass(e.options.contentsClass)}!e.options.repeat&&e.inviewWaypoint&&e.inviewWaypoint.destroy()},t},{});this.inviewWaypoint=new Waypoint.Inview(t.extend(!0,{element:this.$element},i))}}})}),define("components/ellipsis",["jquery","version!fly/managers/debug","version!libs/jquery/dotdotdot","version!fly/components/base"],function(t,e){e=e.init("ellipsis"),t.widget("cnet.ellipsis",t.fly.base,{options:{selectors:{target:"[data-ellipsis]"}},_create:function(){var e=this.options;this._super(),t.each(this.$element.find(e.selectors.target),function(e,i){var n=t(i),s=n.data("ellipsis")||{};n.dotdotdot(s)})}})}),define("translations/image-gallery",["managers/edition"],function(t){return t.getTranslation({en:{page:"Page",pictures:"pictures"},es:{page:"Página",pictures:"imagenes"}})}),define("translations/social-links",["managers/edition"],function(t){return t.getTranslation({en:{cnet:"CNET",roadshow:"Roadshow",copied:"URL copied to clipboard"},es:{cnet:"CNET_Es",copied:"URL copiado al portapapeles"}})}),define("fly/components/social-links-1.0",["jquery","version!fly/managers/debug","version!fly/utils/string-vars","version!fly/components/base"],function(t,e,i){var n=t.support.touch?"vclick":"click",s=e.init("socialLinks");t.widget("fly.socialLinks",t.fly.base,{options:{title:"",url:"",description:"",shortUrl:"",via:"",data:{},popupWidth:620,popupHeight:440,location:null},isLoading:!1,popupId:"popup",linkId:"link",links:{facebook:"http://www.facebook.com/sharer.php?u={url}&t={title}",reddit:"http://reddit.com/submit?url={url}&title={title}",digg:"http://digg.com/submit?url={url}&title={title}",stumbleupon:"http://www.stumbleupon.com/submit?url={url}",twitter:function(t){var e="https://twitter.com/intent/tweet?text={title}&related={related}";return e+=t.shortUrl?"&url={shortUrl}&counturl={url}":"&url={url}",e+=t.via?"&via={via}":""},delicious:"http://del.icio.us/post?url={url}&title={title}",googleplus:"https://plus.google.com/share?url={url}&utm_content={title}&utm_campaign=&utm_medium=share%2Bbutton",linkedin:"http://www.linkedin.com/shareArticle?mini=true&url={url}&title={title}&summary={description}",pinterest:"http://pinterest.com/pin/create/button/?url={url}&media={media}&description={description}",tumblr:"http://www.tumblr.com/share/link?url={url}&description={description}",whatsapp:function(e){var n={ios:{match:/(ipad|iphone|ipod)/,store:"https://itunes.apple.com/app/whatsapp-messenger/id310633997",url:"whatsapp://send?text={title}%20{url}"},androidChrome:{match:"androidChrome",store:"market://details?id=com.whatsapp",url:"intent://send?text={title}%20{url}#Intent;package=com.whatsapp;scheme=whatsapp;end;"},android:{match:"android",store:"market://details?id=com.whatsapp",url:"whatsapp://send?text={title}%20{url}"}},s=window.navigator.userAgent.toLowerCase();for(var a in n)if(a=n[a],s.match(a.match)){a.url=i.compile(a.url,e,["urlencode"]);var r=t("<iframe />").css("display","none").attr("src",a.url).appendTo("body");return setTimeout(function(){window.open(a.store,"_blank"),r.remove()},300),!1}},print:function(){return window.print(),!1},email:"mailto:?subject={title}&body={url}%0D%0D{description}"},_create:function(){this.options;var t={};this._setup(),t[n+" [data-"+this.popupId+"]"]="_handlePopup",t[n+" [data-"+this.linkId+"]"]="_handleLink",this._on(this.$element,t)},_handlePopup:function(e){var i=t(e.currentTarget),n=i.data(this.popupId);e.preventDefault(),this.$el=i,this._setupClickEvent(e,{el:i,name:n}),this.popup(e,n)},_handleLink:function(e){var i=t(e.currentTarget),n=i.data(this.linkId);e.preventDefault(),this.$el=i,this._setupClickEvent(e,{el:i,name:n}),this.link(e,n)},_getLink:function(e){var n=this.links[e.toLowerCase()],s=this._getLinkData();return t.isFunction(n)&&(n=n(s)),n=i.compile(n,s,["urlencode"])},setLink:function(t,e){this.links[t]=e},_getLinkData:function(){var e=this.options;return t.extend({title:e.title,description:e.description,url:e.url,shortUrl:e.shortUrl,via:e.via},e.data)},popup:function(t,e){var i=this._getLink(e),n=this._getPopUpCoords(),s=this.$el;i&&(window.open(i,"button_share","width="+n.width+", height="+n.height+", left="+n.left+", top="+n.top+", personalbar=0, toolbar=0, scrollbars=1, resizable=1"),this._setupLoadEvent(t,{el:s,name:e,type:this.popupId}))},link:function(t,e){var i=this._getLink(e),n=this.$el;i&&(this._setupLoadEvent(t,{el:n,name:e,type:this.linkId}),window.location=i)},_getPopUpCoords:function(t,e){var i=this.options,n=t||i.popupWidth,s=e||i.popupHeight,a=screen.width,r=screen.height;return{left:Math.round(a/2-n/2),top:r>s?Math.round(r/2-s/2):0,width:a>n?n:a,height:r>s?s:r}},_setupClickEvent:function(e,i){e=e||null;var n=this.options.location;n&&t.extend(i,{location:n}),s.log("clicked"),this._trigger("clicked",null,i)},_setupLoadEvent:function(e,i){e=e||null;var n=this.options.location;n&&t.extend(i,{location:n}),this._trigger("loaded",e,i)}})}),define("fly/components/social-counts-1.0",["jquery","version!fly/managers/debug","version!fly/utils/string-helper","version!fly/utils/string-vars","version!fly/utils/object-helper","version!fly/components/social-links"],function(t,e,i,n,s){t.support.touch;var a=e.init("socialCounts");t.widget("fly.socialCounts",t.fly.socialLinks,{options:{url:null,facebookKey:null,showZeros:!1,countType:"human",containerClass:"social-count",containerTemplate:"<span></span>",loadingClass:"loading",loadedClass:"loaded",googleButtonType:"small",showTotal:!1,totalContainerSelector:".social-count-total",location:null,timeout:1e3},selectorId:"counts",total:0,countTotals:0,services:{facebook:"http://api.facebook.com/restserver.php?v=1.0&method=links.getStats&urls={url}&format=json",twitter:"http://cdn.api.twitter.com/1/urls/count.json?url={url}",linkedin:"http://www.linkedin.com/countserv/count/share?url={url}",delicious:"http://feeds.delicious.com/v2/json/urlinfo/data?url={url}",pinterest:"http://api.pinterest.com/v1/urls/count.json?url={url}"},responseKeys:{facebook:"like_count",twitter:null,reddit:"score",linkedin:null,delicious:"total_posts",stumbleupon:"views",pinterest:null,googleplus:null},responseObj:{facebook:function(t){return t[0]},delicious:function(t){return t[0]},reddit:function(t){return t.children.length>0?t.children[0]:null}},requestDataType:{},requestData:{},_create:function(){var t=this.options;this._super("_create"),this.url=t.url||window.location.href,this.$links=this.$element.find("[data-"+this.selectorId+"]"),this._setupRequests()},_setupRequests:function(){if(this.$links.length<=0)return a.log("Error: No links found in element.",this.$element),!1;var e,n=this,s=this.$links.length;this.$links.each(function(r,o){var l=t(o),d=l.data(n.popupId).toLowerCase(),u=n._getService(d),c="_load"+i.capitalize(d),h=0;n._loader("add",l),u?(n.load(d,u),e="socialcountsloaded"):t.isFunction(n[c])?n[c]():(a.log("Error: No service or custom function found for "+d,n.$element),n._loader("remove",l)),n.$element.on(e,function(t,e){h=e.count||0,n.total+=h,n._setTotal(s)})})},load:function(e,i){if(e.length<=0||i.length<=0)return a.log("Error: Service url or name not defined"),!1;var n=this,r=this.responseKeys[e]||"count",o=this.requestDataType[e]||"jsonp",l=this.requestData[e]||{};a.log("Requesting: "+e+"("+i+")"),t.ajax({dataType:o,url:i,data:l,timeout:n.options.timeout}).done(function(i,a,o){i=t.isFunction(n.responseObj[e])?n.responseObj[e](i):i;var l=s.deepFind(i,r)||{};n.setContent(e,l)}).fail(function(t,s,r){a.log("Error: "+e+"("+i+") response failed",t,s),n.setContent(e,{})})},_getService:function(t){var e=this.services[t],i=this._getServiceData();return e=n.compile(e,i,["urlencode"])},_getServiceData:function(){var e=this.options;return t.extend({url:this.url,googleplusKey:e.googleplusKey,facebookKey:e.facebookKey},e.data)},_loadGoogleplus:function(){var t='<div class="g-plusone" data-size="'+this.options.googleButtonType+'" data-href="'+this.url+'" data-count="true" data-callback="handleGooglePlusCallback"></div>',e=this._getLinkEl("googleplus"),i=this;e.html(t),window.handleGooglePlusCallback=function(t){t.state},require(["https://apis.google.com/js/plusone.js"],function(){window.handleGooglePlusCallback=function(t){var e="on"==t.state?"plusone":"rmvplusone";i._trigger(null,{button:"googleplus",type:e})}.bind(this),i._setupLoadEvent({el:e,name:"googleplus"})})},setContent:function(e,i){var n,s,a=this.options,r="[class="+a.containerClass+"]",o=0;return s=(s=(n=this._getLinkEl(e)).find(r)).length?s:t(a.containerTemplate).addClass(a.containerClass).addClass(a.containerClass+"-"+e).insertAfter(n).before(" "),a.showZeros&&"object"==typeof i&&(i="0"),"object"!=typeof i&&(o=parseInt(i,10),"human"===a.countType&&(i=this._getNormalizedCount(o)),s.text(i),n.addClass(a.loadedClass)),this._loader("remove",n),this._setupLoadEvent({el:n,name:e,count:o,type:"countSet"}),!0},_setTotal:function(t){var e=this.options,i=this.$element.find(e.totalContainerSelector),n="human"===e.countType?this._getNormalizedCount(this.total):this.total;if(this.countTotals++,i.length<0)return a.log("Error: total container not found. Selector: "+e.totalContainerSelector),!1;i.text(n),this.countTotals===t&&(this._setupLoadEvent({el:this.$element,type:"totalSet"}),this.$element.addClass(e.loadedClass))},_setupLoadEvent:function(e){e=e||{};var i=this.options.location;i&&t.extend(e,{location:i}),this._trigger("loaded",null,e)},_getLinkEl:function(e){var i=this;return this.$links.filter(function(n){var s=t(this).attr("data-"+i.popupId).toLowerCase();return s===e&&t(this)})},_getNormalizedCount:function(t){return t>=1e9?t=(t/1e9).toFixed(2)+"B":t>=1e6?t=(t/1e6).toFixed(2)+"M":t>=1e3&&(t=(t/1e3).toFixed(1)+"K"),t},_loader:function(t,e){var i=this.options;e=e||this.$element,"add"===t?e.addClass(i.loadingClass):e.removeClass(i.loadingClass)}})}),define("components/social-counts",["jquery","version!fly/managers/debug","translations/social-links","managers/page-vars","managers/tealium","managers/device","version!fly/utils/string-vars","version!fly/utils/object-helper","managers/edition","version!fly/components/social-counts","components/modal-email"],function(t,e,i,n,s,a,r,o,l){e=e.init("socialCounts");var d=t.support.touch?"vclick":"click";t.widget("cnet.socialCounts",t.fly.socialCounts,{options:{data:{media:t('meta[property="og:image"]').first().attr("content")}},$emailModal:null,totalCount:0,services:{facebook:"https://api.facebook.com/restserver.php?v=1.0&method=links.getStats&urls={url}&format=json",twitter:"",linkedin:"https://www.linkedin.com/countserv/count/share?url={url}",delicious:"http://feeds.delicious.com/v2/json/urlinfo/data?url={url}",pinterest:"https://api.pinterest.com/v1/urls/count.json?url={url}"},ftags:{copy:"#ftag=COS-05-10aaa2d",email:"#ftag=COS-04-10aaa1a",facebook:"#ftag=COS-05-10aaa0i",googleplus:"#ftag=COS-05-10aaa1c",linkedin:"#ftag=COS-05-10aaa1h",pinterest:"#ftag=COS-05-10aaa1d",reddit:"?ftag=COS-05-10aaa1e",tumblr:"#ftag=COS-05-10aaa1g",twitter:"#ftag=COS-05-10aaa0j",sms:"#ftag=CAD-05-10aai5g",flipboard:"#ftag=COS-05-10aaa2f"},links:{email:function(e){if(a.isMobile())window.location=r.compile("mailto:?subject={title}&body={url}%0D%0A%0D%0A{description}",e,["urlencode"]);else if(this.$emailModal)this.$emailModal.modalEmail("open");else{var i={openOnInit:!0,pageTitle:e.title,pageUrl:e.url};this.options.isAuto&&(i.emailType="friendRoadshow"),this.$emailModal=t.cnet.modalEmail(i).$element}},googleshare:"https://plus.google.com/share?url={url}&utm_content={title}&utm_campaign=&utm_medium=share%2Bbutton",twitter:function(t){var e="https://twitter.com/intent/tweet?text={title}&related={related}"+(t.shortUrl?"&url={shortUrl}&counturl={url}":"&url={url}");return"none"!=t.via&&(e+="&via="+(null!==t.url.match(/\/roadshow\//)?i.roadshow:i.cnet)),e},tumblr:"http://www.tumblr.com/share/link?url={url}",flipboard:"https://share.flipboard.com/bookmarklet/popout?v=2&title={title}&url={url}&utm_source=cnet&utm_medium=article-share&utm_campaign=publisher",sms:function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/iPad|iPhone|iPod/.test(t)&&!window.MSStream?"sms:&body={title}%20{url}":"sms:?body={title}%20{url}"},copy:function(n){element=this.$el;var s=function(){t(element).children(".copy").append('<div class="copyNotice">'+i.copied+"</div>"),setTimeout(function(){t(".copyNotice").detach()},3e3);var e=null;return document.addEventListener("copy",function(t){if(null!==e)try{t.clipboardData.setData("text/plain",e),t.preventDefault()}finally{e=null}}),function(t){e=t,document.execCommand("copy")}}();return e.log("copied:",n.url),s(n.url)}},getTotal:function(){return this.totalCount},_create:function(){var i=this;this._super(),this._setupTracking(),t.each(this.links,function(t,e){"function"==typeof e&&(i.links[t]=e.bind(i))}),this._on(this.$element,{}),"counts"===this.options.type&&this.options.noLinks&&(i._handlePopup=function(t){e.log("Blocked _handlePopup event")},i._handleLink=function(t){e.log("Blocked _handleLink event")})},_getLink:function(e,i,n){this._setupUrl(e);var s=this,a="json";if(!this.options.data.shortUrl&&"twitter"==e){var r=(l.isEspanol()?"/es":"")+"/ShareBarUrlShortener/";null!==this.options.url.match(/\/roadshow\//)&&(r="/roadshowurlshortener/"),"www.cnet.com"!==window.location.host&&(a="jsonp",r=window.location.protocol+"//www.cnet.com"+r);var o=s._super;t.ajax({url:r,data:{longUrl:this.options.url},dataType:a,callback:"callback",jsonpCallback:"handle_callback",async:!1,cache:!0,success:function(t){s.options.data.shortUrl=void 0!==t.short_url?t.short_url:t.data.url,n(o.call(s,e),i)}})}if("json"==a)return this._super(e)},popup:function(t,e){var i=this._getPopUpCoords(),n=this._getLink(e,i,a),s=this.$el;function a(t,i){t&&(window.open(t,"button_share_"+e,"width="+i.width+", height="+i.height+", left="+i.left+", top="+i.top+", personalbar=0, toolbar=0, scrollbars=1, resizable=1")||(window.location=t))}n&&(a(n,i),this._setupLoadEvent(t,{el:s,name:e,type:this.popupId}))},link:function(t,e){var i=this._getLink(e,{},s),n=this.$el;function s(t,e){t&&(window.location=t)}i?(s(i),this._setupLoadEvent(t,{el:n,name:e,type:this.linkId})):this.options.url&&"link"==e&&(s(i=this.options.url),this._setupLoadEvent(t,{el:n,name:e,type:this.linkId}))},_setupTracking:function(){t("[data-popup]",this.$element).on("click vclick ",function(e){var i=t(this).data("tracking");s.trackSocial({socialService:i,event:"share",eventt:"socialsite",socialId:{facebooksend:1,facebook:2,googlePlus:3,linkedin:4,pinterest:5,reddit:6,stumbleupon:7,twitter:8,twitterfollow:9,delicious:12,tumblr:14,sms:27,flipboard:28}[i],wd:"sharelink",sharebarSection:t(this).closest("[section]").attr("section")}),t(this).off("click vclick")}),"counts"===this.options.type&&this._bindCountsEvents()},_bindCountsEvents:function(){t("[data-link]",this.$element).on(d,function(e){var i=t(this).data("link");s.trackSocial({socialService:i,event:"share",eventt:"socialsite",socialId:{email:10}[i],wd:"sharelink",sharebarSection:t(this).closest("[section]").attr("section")}),t(this).off(d)}),t(".comment-count, .comment-countab",this.$element).on("click vclick",function(e){"object"==typeof n.tracking.data.collectionId?sharebarCollectionId=n.tracking.data.collectionId[0]:"string"==typeof n.tracking.data.collectionId?sharebarCollectionId=n.tracking.data.collectionId:sharebarCollectionId="",s.trackCustomEvent("trackShareBarComments",{_articleType:n.tracking.data.articleType,_pageType:n.tracking.data.pageType,brand:n.tracking.data.brand,siteEdition:n.tracking.data._siteEdition,_siteTypeDevice:n.tracking.data._siteTypeDevice,clickGenericText:"show_comments",dwLinkTag:s.getDwTag(t(this)),_collectionPrimaryId:sharebarCollectionId},"trackClick")})},_loadGoogleplus:function(){var t='<div class="g-plusone" data-size="'+this.options.googleButtonType+'" data-href="'+this.url+'" data-count="true" data-callback="$.cnet.google.trackPlusOne"></div>',e=this._getLinkEl("googleplus");e.html(t),google.isInitialized()?google.parse(e[0]):google.init()},_loadGooglepluscounts:function(){var i=[{method:"pos.plusones.get",id:"p",params:{nolog:!0,id:this.url,source:"widget",userId:"@viewer",groupId:"@self"},jsonrpc:"2.0",key:"p",apiVersion:"v1"}];t.ajax({url:"https://clients6.google.com/rpc",type:"POST",contentType:"application/json",data:JSON.stringify(i),dataType:"json",success:function(t){if("object"==typeof t&&t.length){var i=t[0].result.metadata.globalCounts.count;self.setContent("googlepluscounts",i),e.log("G+ Count:",i)}else e.log("Failed to get Google+ count")},error:function(){e.log("Failed to get Google+ count")}})},load:function(i,n){if(i.length<=0||n.length<=0)return e.log("Error: Service url or name not defined"),!1;var s=this,a=this.responseKeys[i]||"count",r=this.requestDataType[i]||"jsonp",l=this.requestData[i]||{};t.ajax({dataType:r,url:n,data:l,timeout:5e3}).done(function(e,n,r){e=t.isFunction(s.responseObj[i])?s.responseObj[i](e):e;var l=o.deepFind(e,a)||{};s.setContent(i,l),l===parseInt(l,10)&&(s.totalCount+=l,s.$element.trigger("socialCountTotalUpdate",s.totalCount))}).fail(function(t,n,a){e.log("Error: "+i+" response failed",t,n),s.setContent(i,{})})},_setupUrl:function(t){this.options.url=this.options.url.split("#")[0],t in this.ftags&&(this.options.url+=this.ftags[t],this.options.data.shortUrl=null)},setData:function(t,e){this.options.data[t]=e}})}),define("components/sharebar",["jquery","managers/tealium","managers/page-vars","managers/global-functions","version!fly/managers/debug","version!fly/utils/url-helper","components/social-counts","version!fly/components/base","version!libs/modernizr.custom","version!fly/libs/jquery.throttle-debounce","version!libs/waypoints/jquery.waypoints"],function(t,e,i,n,s,a){s=s.init("sharebar");var r=t.support.touch?"vclick":"click",o=!0;t.widget("cnet.sharebar",t.fly.base,{options:{viewClasses:{inline:"inline-view",side:"side-view"},enableViewToggling:!1,selectorContainer:null,containerClass:"count",showZeros:!0,throttle:!1,longform:!1,data:{media:t('meta[property="og:image"]').first().attr("content")},type:"counts",offsetElements:["#primary",".pageHeader","#specialHeader .fixation"],scrollToComments:!0,isSelectedClass:"-isSelected"},$buttons:null,$links:null,previousPath:null,lastScrollPosition:0,maxInnerHeight:0,isPastScrollTopZero:!1,disableScrollShowLogic:!1,_create:function(){this._setup(),this.options.title||(this.options.title=t("meta[property='og:title']").attr("content")),this.options.description||(this.options.description=t("meta[property='og:description']").attr("content")),this.options.url||(this.options.url=t("meta[property='og:url']").attr("content")),this.options.selectorContainer&&this.$element.appendTo(this.options.selectorContainer),this.options.enableViewToggling&&(this.updateView(null),this.$element.fixate&&this.$element.fixate("checkPosition")),this.$links=this.$element.socialCounts(this.options),this._setupEvents(),o&&window.location.hash.indexOf("#comment")>=0&&!t(".commentsContainer").parent().hasClass("selected")&&(o=!1,this.$element.find('a[href="#comments"], a[href="#comentarios"]').trigger("click"))},_setupEvents:function(){var s=this;this.options.enableViewToggling&&this.$window.on("resize.sharebar",function(){this.updateView()}.bind(this)),t("div[data-close='comments']").on("click",function(){var t=null!=s.previousPath?s.previousPath+"#":"#";history.replaceState(null,null,t),s.previousPath=null}),this.$element.on("click",".comment-count-redesign a, a[href='#comments'], a[href='#comentarios']",function(r){r.preventDefault();var o,l,d,u=t(".commentsContainer"),c=t(this).parent().attr("data-conversation-id"),h=t("#disqusContainer-"+c);t(this.firstElementChild).hasClass("social-button-small-redesign")?o="left-social":t(this.firstElementChild).hasClass("wrapper")&&(o="bottom");var p=t(this).closest("div:data(sharebar-options)").first().data("sharebar-options");d=o+"-"+(l=h.parent().hasClass("selected")?"hide":"show")+"-comments";var g=t.extend({},i.tracking.data,{clickGenericText:d});if(e.trackCustomEvent("impression",g,"trackClick"),"hide"===l){var f=null!=s.previousPath?s.previousPath+"#":"#";return h.parent().removeClass("selected"),history.replaceState(null,null,f),void(s.previousPath=null)}s.previousPath=window.location.pathname+window.location.search,s.$window.trigger("beginSharebarCommentClick");var v=0;t.each(s.options.offsetElements,function(e,i){v+=t(i).outerHeight(!0)}),s.options.scrollToComments&&u.offset()&&t("html, body").animate({scrollTop:(0===u.length?h:u).offset().top-v},0);var m=window.location.hash,_=a.getPath(p.url)+window.location.search;"#comment"!==m.substring(0,"#comment".length)?_+="#comments":_+=m,history.replaceState(null,null,_),h.parent().addClass("selected").removeClass("hidden"),u.parent().removeClass("selected").addClass("hidden"),h.parent().addClass("selected").removeClass("hidden"),i.services.disqus.enabled&&n.gdprConsentCallback("script_disqus",function(){require(["managers/third-party/disqus"],function(t){"article"==i.pageType||"product_main"==i.pageType||"buy_guide"==i.pageType?t.init({enabled:!0,disqusSelector:"#disqusContainer-"+c+' [data-social="disqus"]'}):t.parse(h)})},{},"functional")});var o=this.$element.find('[data-item="moreTrigger"]'),l=this.$element.find('[data-item="moreDropdown"]'),d=this.$element.find('[data-item="esTrigger"]'),u=this.$element.find('[data-item="esDropdown"]');o.length&&l.length&&o.on(r,function(){l.toggleClass(s.options.isSelectedClass),u.length&&u.removeClass(s.options.isSelectedClass)}),d.length&&u.length&&d.on(r,function(){u.toggleClass(s.options.isSelectedClass),l.length&&l.removeClass(s.options.isSelectedClass)}),this.options.throttle&&(this._on(this.$document,{scroll:t.throttle(200,this._checkShowSharebar)}),t("[data-sharebar-waypoint]").length&&(t("img[data-original]").each(function(){t(this).one("load",function(){Waypoint.refreshAll()})}),this._setupWaypoint()))},updateView:function(e){e?(t.each(this.options.viewClasses,function(t,e){this.$element.removeClass(e)}.bind(this)),this.$element.addClass(e)):this.$window.width()<1430?this.updateView(this.options.viewClasses.inline):this.updateView(this.options.viewClasses.side)},_checkShowSharebar:function(){var e=this.$window.scrollTop(),i=this;1==this.options.longform&&e<t(window).height()?t(this.element).removeClass("show"):this.lastScrollPosition>=e&&t(window).scrollTop()+t(window).height()<t("body").height()&&!t(this.element).hasClass("show")&&!this.disableScrollShowLogic?(1==this.options.longform&&e>t(window).height()||1!=this.options.longform)&&t(this.element).addClass("show"):this.lastScrollPosition<=e&&t(window).scrollTop()>0&&t(this.element).hasClass("show")&&this.maxInnerHeight==window.innerHeight&&!this.disableScrollShowLogic&&t(this.element).removeClass("show"),t(this.element).hasClass("show")&&t(window).scrollTop()<=0&&this.isPastScrollTopZero&&window.setTimeout(function(){t(i.element).removeClass("show")},2e3),this.lastScrollPosition=e,!this.isPastScrollTopZero&&e>0&&(this.isPastScrollTopZero=!0),this.maxInnerHeight<window.innerHeight&&(this.maxInnerHeight=window.innerHeight)},_setupWaypoint:function(){var e=this;new Waypoint({element:t("[data-sharebar-waypoint]"),handler:function(i){e.disableScrollShowLogic=!0,t(e.element).addClass("show"),window.setTimeout(function(){e.disableScrollShowLogic=!1},4e3),this.destroy()},offset:"bottom-in-view"})},_trackAction:function(n,s){e.trackCustomEvent("socialShareBarPosition",t.extend(!0,{},{pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,brand:i.tracking.data.brand,deviceType:i.tracking.data.deviceType,siteSection:i.tracking.data.siteSection,_pageChannelType:i.tracking.data._pageChannelType,articleId:i.tracking.data.articleId,articleTitle:i.tracking.data.articleTitle,articleType:i.tracking.data.articleType,_collectionPrimaryId:i.tracking.data._collectionPrimaryId,siteHier:i.tracking.data.siteHier,_pageTitle:i.tracking.data._pageTitle},s),"trackClick")}})}),define("fly/components/image-gallery-1.0",["jquery","version!fly/managers/debug","version!fly/utils/string-vars","version!fly/managers/history","version!fly/components/base"],function(t,e,i,n){var s=t.mobile?"vclick":"click";e.init("imageGallery");t.widget("fly.imageGallery",t.fly.base,{options:{index:0,count:0,preloadThreshold:2,selectors:{image:'[data-item="image"]',count:'[data-item="image-count"]'},classes:{selected:"selected",disabled:"disabled"},countTemplate:'<span class="index">{index}</span> / <span class="count">{count}</span>',pushState:{enabled:!1,route:function(t){return t.index>1?"./{index}":"./"},title:function(t){return"{title}"+(t.index>1?"- {index}":"")}}},index:1,indexPrevious:null,count:0,selectors:{control:"[data-to-image]",next:'[data-to-image="next"]',previous:'[data-to-image="previous"]',jump:'[data-to-image="{index}"]'},_create:function(){var t=this.options;this._setup(),this.index=parseInt(t.index,10),this.count=parseInt(t.count,10),this.$images=this.$element.find(t.selectors.image),this.$count=this.$element.find(t.selectors.count),this._setupEvents(),this._updateControls(),this._preloadImages(),t.pushState.enabled&&this._setupPushState()},_setupEvents:function(){var t={};t[s+" "+this.selectors.control]="_handleControlClick",this._on(this.$element,t)},_setupPushState:function(){var t=this.options,e=this;this.history=n.init(t.pushState,{index:this.index}),this._on({imagegalleryshown:function(t,i){var n={index:i.index};"stateChange"!==i.action&&e.history.navigate(n,{title:i.title,url:i.url})}}),this.history.stateChange(function(t){e.show(t.index,"stateChange")})},_handleControlClick:function(e){var i=t(e.target).closest(this.selectors.control).data("toImage");switch(e.preventDefault(),e.stopPropagation(),i){case"next":this.next();break;case"previous":this.previous();break;default:this.show(parseInt(i,10),"to")}},_updateControls:function(){var t=this.options,e=this.$element.find(this.selectors.previous),n=this.$element.find(this.selectors.next),s=this.$element.find(i.compile(this.selectors.jump,{index:this.indexPrevious})),a=this.$element.find(i.compile(this.selectors.jump,{index:this.index}));n[this.index===this.count?"addClass":"removeClass"](t.classes.disabled),e[1===this.index?"addClass":"removeClass"](t.classes.disabled),a.addClass(t.classes.selected),s.removeClass(t.classes.selected)},_updateCount:function(){var t,e=this.options;this.$count.length&&(t={index:this.index,count:this.count},this.$count.html(i.compile(e.countTemplate,t)))},show:function(t,e){var i,n,s=this.options;t!==this.index&&(i=this.$images.eq(this.index-1),n=this.$images.eq(t-1),this._loadImage(n),i.removeClass(s.classes.selected),n.addClass(s.classes.selected),this.indexPrevious=this.index,this.index=t,this._updateControls(),this._updateCount(),this._trigger("shown",null,{$current:n,$previous:i,index:this.index,action:e}),this._preloadImages())},next:function(){this.options;var t=this.index+1;t>this.count||(this.show(t,"next"),this._trigger("next"))},previous:function(){this.options;var t=this.index-1;0!==t&&(this.show(t,"previous"),this._trigger("previous"))},_preloadImages:function(){var e,i,n=this.options,s=this;0!==n.preloadThreshold&&(e=Math.max(1,this.index-n.preloadThreshold),i=Math.min(this.count,this.index+n.preloadThreshold),this.$images.slice(e-1,i).each(function(e,i){s._loadImage(t(i))}))},_loadImage:function(t){var e,i;t.data("isLoaded")||!1||(i=(e=t.find("img")).data("src"),e.length&&i&&(e.attr("src",i),e.removeData("src"),t.data("isLoaded",!0)))}})}),define("components/image-gallery",["jquery","version!fly/managers/debug","managers/page-vars","fly/utils/string-vars-1.0","managers/tealium","translations/image-gallery","managers/guid","managers/device","version!fly/managers/history","managers/ad","components/sharebar","version!fly/components/base","version!fly/components/image-gallery"],function(t,e,i,n,s,a,r,o,l,d){var u=e.get("imageGallery");t.widget("cnet.imageGallery",t.fly.imageGallery,{options:{selectors:{gridControl:'[data-item="grid-control"]',meta:'[data-item="meta"]',control:"[data-to-image]",next:'[data-to-image="next"]',previous:'[data-to-image="previous"]',jump:'[data-to-image="{index}"]',container:"#galleryPage",modalContainer:"#bodyWrapper #galleryPage",count:'[data-item="image-count"] [data-item="index"]',taboola:'[data-component="taboola"]'},pushState:{enabled:!0,title:function(e){return t("#galleryPage .gallery-header h1").text()+(e.index>1?" - "+("roadshow"==i.tracking.data.brand?"Roadshow":"CNET")+" - "+a.page+" {index}":"")}},nextOverride:"/"+a.pictures+"/",nextOverrideSection:null,defaultDek:"",edition:"",preloadThreshold:1},$container:null,$gallery:null,firstPageView:!0,isModal:!1,_create:function(){if("image_gallery"===i.tracking.data.pageType){var e=this.options;0!==t(".galleryModal").length&&(this.isModal=!0),this.isModal?this.$container=t(e.selectors.modalContainer):(window.scrollTo(0,0),this.$container=t(e.selectors.container)),this._setup(),this._super("_create"),this.$meta=this.$container.find(e.selectors.meta),this.$taboola=this.$container.find(e.selectors.taboola),this.defaultDek=t("meta[property='og:description']").attr("content"),this.edition=this.options.edition,this.$gallery=this.$container.find(".image-gallery"),this.$video=this.$container.find('[data-component="videoPlayer"]'),this._updateMetadata()}else u.log("pageType !== image_gallery -- abort")},_setupEvents:function(){var t={},e={};t["click "+this.options.selectors.control]="_handleControlClick",e.keydown="_handleKeyboardControl",this._on(this.$container,t),this._on(document,e)},_setupPushState:function(){var e=this.options,i=this,n=document.createElement("a");n.href=e.pushState.route;var s=n.pathname;-1===t.inArray(s[0],[void 0,"/"])&&(s="/"+s),e.pushState.route=function(t){return(t.index>1?s+"{index}/":s)+window.location.search},this.history=l.init(e.pushState),this._on({imagegalleryshown:function(t,e){var n={index:e.index};"stateChange"!==e.action&&i.history.navigate(n,{title:e.title,url:e.url})}}),this.history.stateChange(function(e){u.log("stateChange",e.index),void 0!==e.index?i.show(e.index,"stateChange"):t("#bodyWrapper .closeModal").trigger("click")}),this.isModal?(this.history.navigate({},{replace:!0,url:document.location}),this.history.navigate({index:this.index})):this.history.navigate({index:this.index},{replace:!0,url:document.location})},_updateControls:function(){u.log("updateControls");var t=this.options,e=this.$container.find(t.selectors.previous),i=this.$container.find(t.selectors.next),s=this.$container.find(n.compile(t.selectors.jump,{index:this.indexPrevious})),a=this.$container.find(n.compile(t.selectors.jump,{index:this.index}));this.isModal?i.removeAttr("href"):this.index===this.count&&t.nextOverride?(i.attr("href",t.nextOverride),i.removeAttr("data-to-image"),t.nextOverrideSection&&i.attr("section",t.nextOverrideSection)):i.attr("data-to-image","next"),e[1===this.index?"addClass":"removeClass"](t.classes.disabled),a.addClass(t.classes.selected),s.removeClass(t.classes.selected),a.attr("aria-selected",!0),s.attr("aria-selected",!1),this._updateCount()},_handleKeyboardControl:function(e){switch(e.keyCode){case 37:u.log("Left arrow key is down"),this.previous("keyboard");break;case 39:u.log("Right arrow key is down");var i=this.options;this.index===this.count?i.nextOverride?window.location.href=i.nextOverride:this.isModal&&t('[data-item="modal-close"]').trigger("click"):this.next("keyboard");break;case 27:u.log("Escape button is down"),t('[data-item="modal-close"]').trigger("click")}},_handleControlClick:function(e){var i=this.options,n=t(e.target).closest(i.selectors.control).data("toImage"),s=t(e.target).closest(i.selectors.control).data("controlName");switch(e.preventDefault(),e.stopPropagation(),n){case"next":this.next(s);break;case"previous":this.previous(s);break;default:this.show(parseInt(n,10),"to",s)}},_updateCount:function(){var t=this.options;this.$container.find(t.selectors.count).text(this.index)},show:function(e,n,a){if(e!==this.index){u.log("Showing slide: ",e);var o=this.options;this.$video.videoPlayer&&this.$video.videoPlayer("pause");var l="next"==n?e-1:e+1;$previousMeta=this.$container.find("[data-item-meta="+l+"]"),$currentMeta=this.$container.find("[data-item-meta="+e+"]"),$previousMeta.removeClass(o.classes.selected),$currentMeta.addClass(o.classes.selected),this._superApply([e,n]),r.resetViewGuid();var c={event:"log",pageNum:e,mapp:"gallery",comptyp:"gallery",riaevent:"view",objtyp:"image",_pageUrl:window.location.pathname,pageUrl:window.location.pathname,_pageViewGuid:i.guid,dwLinkTag:a,photoGalleryTitle:i.tracking.data.articleTitle,photoGalleryId:i.tracking.data.articleId,photoGalleryType:i.tracking.data.articleType,_siteEdition:i.tracking.data.siteEdition,siteEdition:i.tracking.data.siteEdition,brand:i.tracking.data.brand,mfr:i.tracking.data.mfr,pageType:i.tracking.data.pageType};i.services.chartbeat_tracking.enabled=!1,u.log("Track as new pageview"),s.trackPageLoad(c),u.log("refresh ads");var h=t.extend({},i.ads.data);t.extend(h.gpt.targeting,$currentMeta.data("customAdVars")),d.loadAds(d.getAdUnits(i.ads.data.gpt.containerId,null,["mpu-top","mpu-bottom","mpu-middle","mpu-middle2","leader-top","leader-middle","leader-bottom"]),h,{incrementPageView:!0}),this._updateMetadata(),this._updateSharebar()}},next:function(e){u.log("next"),this.options;var i=this.index+1;this.index===this.count?this.isModal&&(u.log("if modal, close it!"),t('[data-item="modal-close"]').trigger("click")):this.show(i,"next",e);var n=this.defaultDek,s=t(".image.selected .image-meta .caption p").text();1!==this.index&&""!==s?t("meta[name='description']").attr("content",s):t("meta[name='description']").attr("content",n),this._trigger("next")},previous:function(e){u.log("previous"),this.options;var i=this.index-1;if(0!==i){if(1===this.index)u.log("first slide, go to last slide now."),u.log("index: ",this.count),this.show(this.count,"previous",e);else{this.show(i,"previous",e);var n=t(".image.selected .image-meta .caption p").text();""!==n&&1!==i?t("meta[name='description']").attr("content",n):t("meta[name='description']").attr("content",this.defaultDek)}this._trigger("previous")}},_updateMetadata:function(){var e=t(".image-gallery .images .selected");t("meta[property='og:url']").attr("content",window.location.href),t("meta[property='twitter:url']").attr("content",window.location.href),t("meta[property='twitter:title']").attr("content",t(t(e).children("div").children(".image-meta").children("h2")).html()),t('link[rel="canonical"]').attr("href",window.location.href),u.log("Done updating Meta Data!")},_updateSharebar:function(){var e=t(".image-gallery .images .selected"),i=t(":cnet-socialCounts");i.socialCounts("setUrl",window.location.href),i.socialCounts("setData","media",t(e.children("div").children("figure").children("img")).attr("src"))},_uiTracking:function(t,e){itemTracking=i.tracking.data,s.trackCustomEvent(t,{_articleTitle:itemTracking.photoGalleryTitle,_articleId:itemTracking.photoGalleryId,_authorPrimaryName:itemTracking.articleAuthorName,_articleType:itemTracking.articleType,_pageType:itemTracking.pageType,siteSection:itemTracking.siteSection,siteEdition:itemTracking.siteEdition,_siteEdition:itemTracking.siteEdition,_siteTypeDevice:itemTracking._siteTypeDevice,_siteHier:itemTracking.siteHier,_pageViewGuid:itemTracking._pageViewGuid,clickGenericText:e},"trackClick")}})}),define("components/image-gallery-modal",["jquery","managers/components.desktop","version!fly/managers/debug","managers/page-vars","managers/tracking","managers/tealium","managers/trackonomics","managers/guid","managers/ad","managers/recommendation","version!fly/components/base"],function(t,e,i,n,s,a,r,o,l,d){i=i.init("imageGalleryModal"),t.widget("cnet.imageGalleryModal",t.fly.base,{options:{cssPath:"",trackUrl:"",url:"",index:1},cssLoadPath:"",latestDwLinkTag:"",url:"",hostUrl:"",hostState:{},hostScrollTop:0,hostAdData:{},hostGuid:0,isHostGallery:!1,_create:function(){var e=this;this._setup(),this.$video=t(".videoPlayer"),"www.theroadshow.com"!==window.location.hostname&&this.$element.on("click",function(i){e.cssLoadPath=e.options.cssPath,i.preventDefault(),e._clickControl(),e.latestDwLinkTag=a.getDwTag(t(i.target))})},_storeHostPageData:function(){this.hostUrl=window.location.href,this.hostState=window.history.state,this.hostScrollTop=t(window).scrollTop(),this.hostAdData=t.extend(!0,{},n.ads.data),this.hostTracking=t.extend(!0,{},n.tracking),this.hostImage=t('meta[property="og:image"]').attr("content").trim(),this.hostGuid=o.getViewGuid(),this.url=""!==this.options.url?this.options.url:this.$element.attr("href")},_clickControl:function(){var u=this,c=t("body");if($htmlTag=t("html"),t("#bodyWrapper").length>0){i.log("IGM: replacing gallery modal"),t("#bodyWrapper").data("persist","true"),t("#bodyWrapper .closeModal").trigger("click"),$htmlTag.removeClass("overflow");var h=t("<div id='bodyWrapper' class='loadingArea'></div>");c.append(h)}else i.log("IGM: setting up gallery modal"),h=t("<div id='bodyWrapper' class='loadingArea'></div>"),c.append(h),c.addClass("galleryModal image-gallery"),this._loadCss(this.cssLoadPath,"galleryCSS");if(this.$video.length)if(i.log("video is present. pause it for the gallery modal"),"videoPlayer"==this.$video.attr("data-component"))try{this.$video.videoPlayer("pause")}catch(t){i.log("Failed to pause video player.")}else i.warn("Video not ready"),this.$video.on("onVideoPlayerReady",function(t){"videoPlayer"==this.$video.attr("data-component")&&this.$video.videoPlayer("pause")});"image_gallery"==n.tracking.data.pageType&&(u.isHostGallery=!0),u._storeHostPageData();var p=window.location.search,g=/ab=.*&/,f=/ab=.*/;g.test(p)?p=p.replace(g,""):f.test(p)&&(p=p.replace(f,"")),t.ajax({url:this.url+p,dataType:"json",context:document.body}).done(function(h){i.log("Gallery loaded");var p=document.createElement("a");p.href=u.options.trackUrl;var g=p.pathname;t("head title").text(t(t.parseHTML(h.template)).find("h1").text()),s.resetTrackingData(h.trackingData,g),o.resetViewGuid(),a.trackPageLoad(t.extend(!0,h.trackingData,{viewguid:o.getViewGuid(),title:h.trackingData.photoGalleryTitle,_pageViewGuid:o.getViewGuid(),_topicPrimaryId:h.trackingData.topicId[0],_pageUrl:u.options.trackUrl,pageUrl:u.options.trackUrl,photoGalleryTitle:h.trackingData.photoGalleryTitle,photoGalleryId:h.trackingData.photoGalleryId,photoGalleryType:h.trackingData.articleType,pageName:""!=u.options.trackUrl?u.options.trackUrl:n.tracking.data._pageName,dwLinkTag:u.latestDwLinkTag}));var f=t(h.template);t("#bodyWrapper").append(f),t("#bodyWrapper").removeClass("loadingArea"),e.process(t("#bodyWrapper")),n.ads.data=t.extend({},h.adData),l.loadAds(l.getAdUnits(n.ads.data.gpt.containerId),n.ads.data,{excludeDisabled:!0,incrementPageView:!0}),d.registerOnScroll("#bodyWrapper"),this.$close=t('[data-item="modal-close"]'),this.$close.on("click",function(){u._closeModal(c,h.trackingData)}),t("#bodyWrapper").on("click",function(t){t.target===this&&u._closeModal(c,h.trackingData)}),r.refreshTrackonomics()}).fail(function(){c.removeClass("galleryModal"),t("#bodyWrapper").remove(),window.location=u.$element.attr("href")})},_closeModal:function(e,i){a.trackCustomEvent("trackCloseGallery",t.extend({},n.tracking.data,{_articleTitle:i.photoGalleryTitle,_articleId:i.photoGalleryId,_authorPrimaryName:i.articleAuthorName,_articleType:i.articleType,_pageType:i.pageType,siteSection:i.siteSection,siteEdition:i._siteEdition,_siteTypeDevice:i._siteTypeDevice,_siteHier:i.siteHier,_pageViewGuid:i._pageViewGuid,clickGenericText:"close-gallery"}),"trackClick");var r=document.createElement("a");r.href=this.hostUrl;var l=r.pathname;s.resetTrackingData(this.hostTracking,l),n.ads.data=this.hostAdData,window.history.replaceState&&window.history.replaceState(this.hostState,"",this.hostUrl),t('meta[property="og:image"]').attr("content",this.hostImage),t("title").text(this.hostTracking.data._pageTitle),o.resetViewGuid(this.hostGuid),this.isHostGallery||$htmlTag.removeClass("overflow"),"true"===t("#bodyWrapper").data("persist")?(t("#bodyWrapper").remove(),t("#bodyWrapper").data("persist",null)):(t("#bodyWrapper").remove(),e.removeClass("galleryModal image-gallery"),t(window).resize(),t(window).scrollTop(this.hostScrollTop))},_loadCss:function(e,i){var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("id",i),n.setAttribute("href",e),void 0!==n&&0==t("#"+i).length&&document.getElementsByTagName("head")[0].appendChild(n)},open:function(){this.cssLoadPath=this.options.cssPath,this._clickControl()}})}),define("components/shortcode-gallery",["jquery","version!fly/managers/debug","fly/utils/string-vars-1.0","version!fly/components/base","version!fly/components/image-gallery","version!libs/jquery/dotdotdot"],function(t,e,i){var n=e.init("shortcode-gallery"),s=t.support.touch?"vclick":"click";t.widget("cnet.shortcodeGallery",t.fly.imageGallery,{options:{index:1,preloadThreshold:3,countTemplate:'<span class="first">{first}</span> - <span class="last">{last}</span> of <span class="count">{count}</span>',selectors:{viewport:'[data-item="viewport"]',window:'[data-item="window"]'},visible:1},_create:function(){var e=this.options;this._super("_create"),this._setupViewports();var i=this.$element.find('[data-item="image-count"]').clone();i.find(".first").html("{first}"),i.find(".last").html("{last}"),i.find(".count").html("{count}"),e.countTemplate=i.html(),t.each(this.$element.find(".caption"),function(e,i){t(i).dotdotdot({watch:"window"})})},_setupEvents:function(){var e=this,i={};i[s+" "+this.selectors.control]="_handleControlClick",i.shortcodegalleryshown="_handleShown",this._on(this.$element,i),t(window).resize(function(t){e._handleResize(t)})},_setupViewports:function(){var e=this;this.$element.find(this.options.selectors.viewport).each(function(i,n){var s=t(n),a=s.find(e.options.selectors.image),r=0;a.each(function(e,i){r+=t(i).outerWidth(!0)}),s.width(r),e._updateWindowHeight(t(a[0]).height())})},_handleShown:function(t,e){var i=e.$current.position().left,n=parseInt(e.$current.css("marginLeft"),10)+i,s=e.$current.closest(this.options.selectors.viewport);t&&t.preventDefault(),-n!=parseInt(s.css("left"),10)&&e.$current.closest(this.options.selectors.viewport).css("left",-n)},_handleResize:function(t){var e=this.$element.find(this.options.selectors.viewport).find("."+this.options.classes.selected);this._handleShown(null,{$current:e}),this._updateWindowHeight(this.$element.find(this.options.selectors.image+":first").height())},_updateWindowHeight:function(t){if(!(t<=0)){var e=this.$element.find(this.options.selectors.window);t!=e.height()&&e.height(t)}},_updateCount:function(){var t,e=this.options;this.$count.length&&(t={first:this.index,last:Math.min(this.index+this.options.visible-1,this.count),count:this.count},this.$count.html(i.compile(e.countTemplate,t)))},_updatePushState:function(t,e){this.options.enablePushState&&history.pushState&&(n.log("pushState: "+t+": "+e),history.pushState({},"",e))},next:function(){var t=Math.min(this.index+this.options.visible,this.count-this.options.visible+1);t<0||t!==this.count&&(this.show(t),this._trigger("next"),this._updatePushState("next",t))},previous:function(){var t=Math.max(1,this.index-this.options.visible);1!==this.index&&(this.show(t),this._trigger("previous"),this._updatePushState("previous",t))},show:function(t){(t=Math.max(1,Math.min(t,this.count-this.options.visible+1)))!==this.index&&this._super(t)},_handleControlClick:function(e){var i=t(e.target).closest(this.selectors.control).data("toImage");switch(e.preventDefault(),i){case"next":this.next();break;case"previous":this.previous();break;default:this.show(parseInt(i,10))}},_updateControls:function(){this._super();var t=this.options;this.$element.find(this.selectors.next)[this.index+t.visible-1>=this.count?"addClass":"removeClass"](t.classes.disabled)}})}),define("components/disqus-count",["jquery","managers/page-vars","version!fly/managers/debug",window.CnetPageVars.services.disqus.enabled?"version!fly/components/disqus-count":""],function(t,e,i){i=i.init("disqusCount"),e.services.disqus.enabled&&t.widget("cnet.disqusCount",t.fly.disqusCount,{options:{shortname:e.disqus.shortname,disqusIdentifier:"",disqusZeroCommentsText:null,disqusOneCommentText:null},refreshCounts:function(){var n=this,s=n.options.disqusIdentifier;"product_main"===e.pageType&&(s=e.tracking.data.productSeriesId);var a='[data-component="disqusCount"][data-disqus-identifier="'+n.options.disqusIdentifier+'"] [data-item="buttonText"]',r='.sharebarRedesign [data-component="disqusCount"][data-disqus-identifier="'+n.options.disqusIdentifier+'"]',o='[data-component="disqusCount"][data-disqus-identifier="'+n.options.disqusIdentifier+'"] [data-item="iconText"]';t.ajax({type:"GET",url:"https://disqus.com/api/3.0/threads/details.json?api_key="+e.disqus.publicKey+"&thread:ident="+s+"&forum="+e.disqus.shortname,dataType:"jsonp",timeout:5e3,success:function(e){var s=e.response.posts,l="99+";if(s<=1){l="0";var d=n.options.disqusZeroCommentsText;1==s&&(l="1",d=n.options.disqusOneCommentText),null!=d&&t(a).text(d)}else s>1&&s<=99&&(l=s.toString());t(r).text(l),t(o).text(l),i.log("Replaced comment count with "+l)},error:function(e,s,l){"timeout"==l?(t(a).text(n.options.disqusZeroCommentsText),t(r).text(0),t(o).text(0)):i.log(l)}})}})}),define("managers/third-party/social-flags",["managers/page-vars"],function(t){return{enabled:{facebook:t.services.facebook&&t.services.facebook.enabled,google:!0,linkedIn:t.services.linkedin&&t.services.linkedin.enabled,pinterest:t.services.pinterest&&t.services.linkedin.pinterest,twitter:t.services.twitterwidget&&t.services.linkedin.twitterwidget,disqus:t.services.disqus&&t.services.linkedin.disqus}}}),define("managers/third-party/twitter",["jquery","version!fly/managers/debug","managers/third-party/social-flags","managers/global-functions","managers/tealium"],function(t,e,i,n,s){e=e.init("twitter");var a=!1,r={onInit:null};return{init:function(s){var o=this;i.enabled.twitter&&(t.extend(!0,r,s),a?r.onInit&&r.onInit():(window.twttr=t.extend(!0,{_e:[],ready:function(t){window.twttr._e.push(t)}},window.twttr),twttr.ready(function(){a=!0,o.setupEvents(),r.onInit&&r.onInit(),e.log("Initialized")}),n.gdprConsentCallback("script_twitter",function(){require(["twitter"])},{},"social")))},parse:function(){a?twttr.widgets.load():e.log("Parse failed -- not initialized yet")},isInitialized:function(){return a},setupEvents:function(){var t=this;twttr.events.bind("follow",function(i){e.log("Followed"),t.trackFollow({})}),twttr.events.bind("tweet",function(i){e.log("Tweeted"),t.trackTweet({})})},trackFollow:function(e){s.trackSocial(t.extend({socialService:"twitter",event:"connect",eventt:"followcnet",socialId:9},e))},trackTweet:function(e){s.trackSocial(t.extend({socialService:"twitter",event:"share",eventt:"socialsite",socialId:8},e))}}}),define("pages/desktop/article_video_test",["main.desktop","managers/recommendation","components/fixate","components/iframe-hover-fix","components/toc-nav","components/toggle","components/touch-menu-hover","components/sticky-element","components/form-trim","components/lazyload-images","components/modal-enlarge-image","utils/function-natives","components/article","components/page","components/sliding-element","components/sticky-column","components/selfish-scroll","components/update-area","components/sticky-leader","components/track-download","components/social-tracking","components/external-link","components/mobile-footer-link","quantum/videoPlayer","quantum/inviewElement","components/ellipsis","components/image-gallery","components/image-gallery-modal","components/shortcode-gallery","version!libs/jquery/dotdotdot","version!fly/components/image-gallery","components/disqus-count","components/sharebar","managers/edition-notifications","managers/third-party/social","managers/third-party/twitter"],function(t,e){e.registerOnScroll()});